<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>c7w çš„åšå®¢</title>
  
  <subtitle>æ˜¯ä¸€åª c7w çš„åšå®¢</subtitle>
  <link href="https://www.c7w.tech/atom.xml" rel="self"/>
  
  <link href="https://www.c7w.tech/"/>
  <updated>2022-03-03T14:58:55.403Z</updated>
  <id>https://www.c7w.tech/</id>
  
  <author>
    <name>c7w</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>202202 è¯»è¿‡çš„ä¸€äº› Paper æ€»ç»“</title>
    <link href="https://www.c7w.tech/paper2202/"/>
    <id>https://www.c7w.tech/paper2202/</id>
    <published>2022-03-03T14:01:54.000Z</published>
    <updated>2022-03-03T14:58:55.403Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸»è¦æ˜¯å¯¹ 202202 è¯»çš„ Paper çš„æ€»ç»“ã€‚</p><p>æ¶‰åŠçš„ä¸»è¦ä¸»é¢˜æ˜¯ Infomation Retrieval ä¸­çš„ Dense Retrieval.</p><a id="more"></a><h1 id="Pre-training-Methods-in-Information-Retrieval"><a href="#Pre-training-Methods-in-Information-Retrieval" class="headerlink" title="Pre-training Methods in Information Retrieval"></a>Pre-training Methods in Information Retrieval</h1><blockquote><p>Fan Y, Xie X, Cai Y, et al. Pre-training Methods in Information Retrieval[J]. arXiv preprint arXiv:2111.13853, 2021.</p></blockquote><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>è¿™æ˜¯ä¸€ç¯‡ç ”ç©¶é¢„è®­ç»ƒåœ¨ IR ä¸­åº”ç”¨çš„<strong>æ–‡çŒ®ç»¼è¿°</strong>ã€‚</p><p>è®ºæ–‡ä¸­é¦–å…ˆä»‹ç»äº† IR æ˜¯ä»€ä¹ˆï¼Œç„¶åä»‹ç»äº†é¢„è®­ç»ƒæ¨¡å¼åœ¨ IR ä¸­çš„åº”ç”¨ï¼ŒåŒ…æ‹¬ Retrieval Component, Re-ranking Component å’Œ Other Componentã€‚</p><p>æ­¤å¤–ï¼Œè¿˜åŒ…æ‹¬ä¸“é—¨ä¸º IR å®šåˆ¶çš„é¢„è®­ç»ƒä»»åŠ¡çš„ä»‹ç»ã€‚</p><p>ç„¶åï¼Œè®ºæ–‡ä»‹ç»äº† IR ä¸­ä½¿ç”¨é¢„è®­ç»ƒæ–¹æ³•å¯èƒ½ç”¨åˆ°çš„èµ„æºï¼ŒåŒ…æ‹¬æ•°æ®é›† benchmark å’Œ leaderboard. </p><p>ç„¶åä½œè€…æå‡ºäº†ç›®å‰ é¢„è®­ç»ƒ + IR å­˜åœ¨çš„æŒ‘æˆ˜ï¼Œç»™å‡ºäº†æœªæ¥å¯èƒ½çš„å·¥ä½œå‰æ™¯ã€‚</p><h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><h3 id="Intro-amp-Background"><a href="#Intro-amp-Background" class="headerlink" title="Intro &amp; Background"></a>Intro &amp; Background</h3><ul><li>ä»€ä¹ˆæ˜¯ IRï¼Ÿ<ul><li>ä»ä¸€ä¸ªå¤§è§„æ¨¡çš„ç­”æ¡ˆè¯­æ–™é›†åˆä¸­æ‰¾å›è·Ÿç”¨æˆ·çš„è¯·æ±‚æœ‰å…³çš„ä¿¡æ¯</li><li>å¯èƒ½ç›¸å…³çš„ç»“æœæœ‰å¤šä¸ªï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰â€œç›¸å…³æ€§å¾—åˆ†â€</li></ul></li><li>ä»€ä¹ˆæ˜¯é¢„è®­ç»ƒï¼Ÿï¼ˆç•¥å»ï¼‰</li><li>ä»ä¸åŒçš„è§†è§’æ¥çœ‹å¾… IR é—®é¢˜<ul><li>Core Problem View: æ ¸å¿ƒçš„é—®é¢˜æ˜¯è®¡ç®— Query q å’Œ Document d çš„ç›¸ä¼¼åº¦</li><li>Framework View: Retrieval Processï¼Œreturns top-k most relative results</li><li>System View: Given a query q, output a sorted list of documentsâ€¦</li></ul></li></ul><p><img src="https://s2.loli.net/2022/03/03/z58qKF7OWJL4YAv.png" alt="image-20220303221755076"></p><h3 id="Retrieval-Component"><a href="#Retrieval-Component" class="headerlink" title="Retrieval Component"></a>Retrieval Component</h3><p>åœ¨è¿™é‡Œè¡¥å…… Sparse Retrieval å’Œ Dense Retrieval çš„è¡¥å……çŸ¥è¯†ã€‚</p><p>ä¸ç®¡æ˜¯ Sparse Retrieval è¿˜æ˜¯ Dense Retrieval éƒ½æ˜¯ä½¿ç”¨æŸä¸ªå¤„ç†ç¨‹åºå°†æ–‡ä¹¦å¤„ç†æˆæŸç§ç‰¹æ®Šçš„è¡¨ç¤ºï¼Œå¹¶å¯¹è¿™ç§ç‰¹æ®Šçš„è¡¨ç¤ºå»ºç«‹ç´¢å¼•ï¼Œä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»ã€‚</p><p>Sparse Retrieval æ˜¯æŒ‡ token-level çš„åˆ‡åˆ†ï¼Œå¸¸è§çš„ç®—æ³•å¦‚ TF-IDF å’Œ BM25ã€‚è¿™ä¸¤ç§ç®—æ³•çš„è¿ä½œæ–¹å¼åœ¨ <a href="https://c7w.tech/elasticsearch/">https://c7w.tech/elasticsearch/</a> çš„ç¬¬ä¸€èŠ‚è¿›è¡Œè¿‡ç›¸å…³ä»‹ç»ï¼Œè¿™é‡Œç›´æ¥å¯¹å…¶è¿›è¡Œå¼•ç”¨ï¼š</p><blockquote><ul><li>TF-IDF</li></ul><p>TF æ˜¯æŒ‡å½’ä¸€åŒ–çš„è¯é¢‘ï¼ŒIDF æ˜¯æŒ‡é€†æ–‡æ¡£é¢‘ç‡ã€‚ç»™å®šæ–‡æ¡£é›†åˆ $D$ï¼Œæœ‰ $d_i \in D, 1 \le i \le n$. </p><p>æ–‡æ¡£é›†åˆæ€»å…±åŒ…å« $m$ ä¸ªè¯ï¼Œå»é™¤ä¸€äº›ååˆ†å¸¸è§çš„è¯ä½œä¸ºåœç”¨è¯ï¼ˆStop Wordsï¼‰ï¼Œæœ‰ $w_i \in W, 1 \le i \le m$.</p><p>å®šä¹‰ TF å¦‚ä¸‹ï¼Œå³ä¸€ç¯‡æ–‡æ¡£ä¸­æŸä¸ªè¯å‡ºç°çš„é¢‘ç‡ï¼š</p><script type="math/tex; mode=display">\text{TF}(q_i, d_j) = \dfrac {f_{i, d_j}}{ |d_j| }</script><p>TF åªèƒ½æè¿°è¯åœ¨æ–‡æ¡£ä¸­çš„é¢‘ç‡ï¼Œä½†å‡è®¾ç°åœ¨æœ‰ä¸ªè¯ä¸ºâ€œæˆ‘ä»¬â€ï¼Œè¿™ä¸ªè¯å¯èƒ½åœ¨æ–‡æ¡£é›† $D$ ä¸­æ¯ç¯‡æ–‡æ¡£ä¸­éƒ½ä¼šå‡ºç°ï¼Œå¹¶ä¸”æœ‰è¾ƒé«˜çš„é¢‘ç‡ã€‚é‚£ä¹ˆè¿™ä¸€ç±»è¯å°±ä¸å…·æœ‰å¾ˆå¥½çš„åŒºåˆ†æ–‡æ¡£çš„èƒ½åŠ›ï¼Œä¸ºäº†é™ä½è¿™ç§é€šç”¨è¯çš„ä½œç”¨ï¼Œå¼•å…¥äº† IDFï¼š</p><script type="math/tex; mode=display">\text{IDF}(q_i) = \ln \dfrac {|D|}{|\{d_i  : q_i \in d_i \}|}</script><p>äºæ˜¯æˆ‘ä»¬ç»¼åˆè¿™ä¸¤éƒ¨åˆ†ï¼Œ ä¾¿å¯ä»¥å¾—åˆ° TF-IDFï¼š</p><script type="math/tex; mode=display">\text{TF-IDF} = \text{TF} * \text{IDF}</script><p>TF å¯ä»¥è®¡ç®—åœ¨ä¸€ç¯‡æ–‡æ¡£ä¸­è¯å‡ºç°çš„é¢‘ç‡ï¼Œè€Œ IDF å¯ä»¥é™ä½ä¸€äº›é€šç”¨è¯çš„ä½œç”¨ã€‚å› æ­¤å¯¹äºä¸€ç¯‡æ–‡æ¡£æˆ‘ä»¬å¯ä»¥ç”¨æ–‡æ¡£ä¸­æ¯ä¸ªè¯çš„ TFâˆ’IDF ç»„æˆçš„å‘é‡æ¥è¡¨ç¤ºè¯¥æ–‡æ¡£ï¼Œå†æ ¹æ®ä½™å¼¦ç›¸ä¼¼åº¦è¿™ç±»çš„æ–¹æ³•æ¥è®¡ç®—æ–‡æ¡£ä¹‹é—´çš„ç›¸å…³æ€§ã€‚</p><ul><li>BM25</li></ul><p>BM25 æ˜¯ä¿¡æ¯ç´¢å¼•é¢†åŸŸç”¨æ¥è®¡ç®— query ä¸æ–‡æ¡£ç›¸ä¼¼åº¦å¾—åˆ†çš„ç»å…¸ç®—æ³•ã€‚</p><p>ä¸åŒäº TF-IDFï¼ŒBM25 çš„å…¬å¼ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ol><li>query ä¸­æ¯ä¸ªå•è¯ $q_i$ ä¸æ–‡æ¡£ $d$ ä¹‹é—´çš„ç›¸å…³æ€§</li><li>å•è¯ $q_i$ ä¸ query ä¹‹é—´çš„ç›¸ä¼¼æ€§</li><li>æ¯ä¸ªå•è¯çš„æƒé‡</li></ol><p>BM25 ç®—æ³•çš„ä¸€èˆ¬å…¬å¼ï¼š</p><script type="math/tex; mode=display">score(Q,d) = \sum_i^n W_i R(q_i, d)</script><p>å…¶ä¸­ $Q$ è¡¨ç¤º queryï¼Œ$q_i \in Q$ï¼Œ$d$ è¡¨ç¤º document.</p><p>ä¸‹å±•å¼€ä»‹ç»å„éƒ¨åˆ†å…¬å¼ï¼š</p><ul><li><strong>$W_i$</strong></li></ul><script type="math/tex; mode=display">W_i = IDF(q_i) = \ln \dfrac {N-df_i+0.5}{df_i+0.5}</script><p>å…¶ä¸­ $N$ æ˜¯ document æ€»æ•°ï¼Œ$df_i$ è¡¨ç¤ºå«æœ‰ $q_i$ çš„æ–‡æ¡£æ€»æ•°ã€‚</p><p>ä¾æ® IDF çš„ä½œç”¨ï¼Œå¯¹äºæŸä¸ª $q_i$ ï¼ŒåŒ…å« $q_i$ çš„æ–‡æ¡£æ•°è¶Šå¤šï¼Œè¯´æ˜ $q_i$ é‡è¦æ€§è¶Šå°ï¼Œæˆ–è€…åŒºåˆ†åº¦è¶Šä½ï¼ŒIDF è¶Šå°ï¼Œå› æ­¤ IDF å¯ä»¥ç”¨æ¥åˆ»ç”» $q_i$ ä¸æ–‡æ¡£çš„ç›¸ä¼¼æ€§ã€‚</p><ul><li><strong>$R(q_i, d)$</strong></li></ul><p>BM25 çš„è®¾è®¡ä¾æ®ä¸€ä¸ªé‡è¦çš„å‘ç°ï¼š<strong>è¯é¢‘å’Œç›¸å…³æ€§ä¹‹é—´çš„å…³ç³»æ˜¯éçº¿æ€§çš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªè¯å¯¹äºæ–‡æ¡£çš„ç›¸å…³æ€§åˆ†æ•°ä¸ä¼šè¶…è¿‡ä¸€ä¸ªç‰¹å®šçš„é˜ˆå€¼ï¼Œå½“è¯å‡ºç°çš„æ¬¡æ•°è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼åï¼Œå…¶å½±å“å°±ä¸åœ¨çº¿æ€§å¢åŠ äº†ï¼Œè€Œè¿™ä¸ªé˜ˆå€¼ä¼šè·Ÿæ–‡æ¡£æœ¬èº«æœ‰å…³ã€‚</p><script type="math/tex; mode=display">R(q_i, d) = \dfrac {f_i \cdot (k_1+1)}{f_i+K} \cdot \dfrac {qf_i \cdot(k_2+1)}{qf_i+k_2}</script><p>æˆ‘ä»¬å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†æ¥çœ‹å¾…ä¸Šè¿°å…¬å¼ï¼Œå…¶ä¸­ $f_i$ ä¸º $q_i$ åœ¨ $d$ ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œ$k_1, k_2, K$ æ˜¯å¸¸æ•°ã€‚</p><p>åä¸€éƒ¨åˆ† $\dfrac {qf_i \cdot(k_2+1)}{qf_i+k_2}$ åœ¨æ§åˆ¶ $q_i$ å’Œ Query çš„ç›¸ä¼¼åº¦ã€‚</p><p>å‰ä¸€éƒ¨åˆ†åœ¨è®¡ç®— $q_i$ ä¸ $d$ çš„ç›¸ä¼¼åº¦ï¼Œå…¶ä¸­ $K = k_1 \cdot (1-b+b\cdot \dfrac {|d|}{AVG_n(|d|)})$ï¼Œå‚æ•° $b$ åœ¨è°ƒèŠ‚æ–‡æœ¬é•¿åº¦å¯¹ç›¸å…³æ€§çš„å½±å“ã€‚</p><p>ä¸å¤±ä¸€èˆ¬æ€§åœ°æˆ‘ä»¬å¯ä»¥å– $k_1 = 2, k_2 = 0, b = 0.75$.</p><p>åæ­£åœ¨æ¥ä¸‹æ¥çš„è¿ç”¨ä¹Ÿæ˜¯å¤§è°ƒåº“ï¼Œè°ƒå‚æ•°å¯ä»¥é€šè¿‡æ›´æ”¹é…ç½®æ–‡ä»¶æ¥è¿›è¡Œã€‚</p><p><s>å†™åˆ°è¿™é‡Œå‘ç°ä¹‹å‰ Promise çš„ Elasticsearch 8.0 çš„æ•™ç¨‹è¿˜æ²¡å¼€å§‹å†™â€¦ä¸‹æ¬¡ä¸€å®šä¸‹æ¬¡ä¸€å®š</s></p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æŠŠæ¯ç¯‡ Document $d$ é¦–å…ˆè¿›è¡Œ token-level çš„åˆ‡åˆ†å¹¶è®¡ç®—æ¯ä¸ª token çš„ç›¸åº”å¾—åˆ†ï¼Œå»ºç«‹èµ· token å¯¹ document çš„å€’æ’ç´¢å¼•ã€‚ç„¶åæ¯å½“ Query $q$ æ¥ä¸´çš„æ—¶å€™ï¼Œç›´æ¥å¯¹ $q$ è¿›è¡Œåˆ‡åˆ†ï¼Œæ ¹æ®ç›¸åº”çš„å€’æ’ç´¢å¼•æŸ¥è¯¢å‡ºå¯¹åº”åˆ†æ•°åŠ èµ·æ¥å¾—åˆ°æ¯ç¯‡æ–‡ç« çš„ç›¸ä¼¼æ€§å¾—åˆ†ï¼Œç„¶åæ’åºå°±å¥½ã€‚</p><p>è¿™é‡Œç”¨åˆ°çš„æ•°æ®ç»“æ„å°±æ˜¯è¿™ç§å€’æ’ç´¢å¼•ç»“æ„ã€‚</p><p>è€Œ Dense Retrieval åˆ™ä¸åŒï¼Œæ­£å¦‚å…¶åå­—ä¸­çš„ â€œDenseâ€ æ‰€è¯´ï¼Œæˆ‘ä»¬æŠŠæ¯ç¯‡ Document $d$ é€šè¿‡ä¸€ä¸ª Encoder. Say, BERT $\phi$, ç„¶åé€šè¿‡ $\phi(d)[cls]$ æ¥ä½œä¸ºå…¶è¡¨ç¤ºã€‚</p><p>å½“ Query æ¥ä¸´çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°† Query q é€šè¿‡ç›¸åŒçš„ BERT $\phi$ å¾—åˆ° $\phi(q)$ï¼Œæˆ‘ä»¬è¦æ±‚è§£ top-k d çš„é›†åˆä½¿å¾— $\max Sim(\phi(q), \phi(d))$.</p><p>è¿™é‡Œå¯ä»¥ç”¨åˆ°ç»„ç»‡æ¬§å¼ç©ºé—´å†…å‘é‡çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ FAISSï¼Œå…¶å®ç°æ˜¯å¯¹æ¬§å¼ç©ºé—´åšåˆ†åˆ’ã€‚æœ‰ç‚¹åƒæœç´¢æ ‘çš„æ„Ÿè§‰ï¼Ÿå›å¤´å†è¯¦ç»†è¯»ä¸€è¯»ç›¸å…³æ•™ç¨‹å§ã€‚ç”¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸»è¦æ˜¯ä¸ºäº†æ‰¾å‡ºè·ç¦»æŸä¸ªå‘é‡æœ€è¿‘çš„ k ä¸ªç›¸åŒçº¿æ€§ç©ºé—´ä¸­çš„å‘é‡ã€‚</p><p>æ­¤å¤–ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ä¸€ä¸ª BERT $\psi$ åš $\psi( q + \text{â€˜[sep]â€™} + d)$ å‘¢ï¼Ÿå› ä¸ºè¿™æ ·è®¡ç®—æ•ˆç‡å¯¹äºæ¯ä¸ª q éƒ½é“æ˜¯ $O(d)$ çš„ï¼Œä¸”å› ä¸ºæ¯æ¬¡è®¡ç®—éƒ½è¦è¿‡ä¸€ä¸ª BERTï¼Œå¤æ‚åº¦æå¤§ã€‚ä»æ—¶é—´æ•ˆç‡ä¸Šæ¥è¯´ä¸è€ƒè™‘ï¼Œåç»­æˆ‘ä»¬ Re-ranker ä¸­ä¼šè¿™ä¹ˆç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å–åˆ°äº† top-k äº†ï¼Œè¿™é‡Œ $k \ll d$.</p><p>ä¸‹é¢æ˜¯ä¸¤ç§æ–¹æ³•åº”ç”¨ Pretrain Method çš„å¯èƒ½æ–¹æ³•ï¼š</p><h4 id="Sparse-Retrieval"><a href="#Sparse-Retrieval" class="headerlink" title="Sparse Retrieval"></a>Sparse Retrieval</h4><ul><li>Term re-weighting: measure term weights with contextual semantics.</li><li>Document Expansion: expanding documents or queries.</li><li>Re-weighting + expansion</li><li>Sparse Representation learning</li></ul><h4 id="Dense-Retrieval"><a href="#Dense-Retrieval" class="headerlink" title="Dense Retrieval"></a>Dense Retrieval</h4><ul><li><strong>Use pretrained models as encoders, then fine-tune them accordingly.</strong></li><li>Use specific tasks to pretrain for IR</li><li>Fine-tuning: distill; using informative negative models;</li></ul><h4 id="Hybrid-Retrieval"><a href="#Hybrid-Retrieval" class="headerlink" title="Hybrid Retrieval"></a>Hybrid Retrieval</h4><h3 id="Re-ranker-Component"><a href="#Re-ranker-Component" class="headerlink" title="Re-ranker Component"></a>Re-ranker Component</h3><ul><li>Representation focused $relevance = f(PLM(Q), PLM(D))$</li><li>Interaction focused $relevance=f(PLM(Q,D))$</li></ul><p>å…¶ä¸­ç¬¬äºŒç§å°±æ˜¯ä¸Šè¿°æè¿‡çš„ç”¨ BERT $\psi$ çš„æ–¹æ³•ã€‚</p><h3 id="Other-Component"><a href="#Other-Component" class="headerlink" title="Other Component"></a>Other Component</h3><p>Query Understanding:</p><ul><li>Query expansion</li><li>Query rewriting</li><li>Query suggestion$^*$</li><li>Search Clarification</li><li>Personalized Search</li></ul><p>Document Summarization</p><ul><li>Generic Document Summarization</li><li>Snippet Generation</li><li>Keyphrase Extraction</li></ul><h1 id="Latent-Retrieval-for-Weakly-Supervised-Open-Domain-Question-Answering"><a href="#Latent-Retrieval-for-Weakly-Supervised-Open-Domain-Question-Answering" class="headerlink" title="Latent Retrieval for Weakly Supervised Open Domain Question Answering"></a>Latent Retrieval for Weakly Supervised Open Domain Question Answering</h1><p>Lee K, Chang M W, Toutanova K. Latent retrieval for weakly supervised open domain question answering[J]. arXiv preprint arXiv:1906.00300, 2019.</p><h2 id="Background-Infomation"><a href="#Background-Infomation" class="headerlink" title="Background Infomation"></a>Background Infomation</h2><ul><li>ä»€ä¹ˆæ˜¯ Open Domain çš„ QAï¼Ÿç®€ç§° ODQAï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºå¼€æ”¾å¼é—®ç­”ï¼Œæ„ä¸ºåŸºäºæ¶µç›–å¹¿æ³›ä¸»é¢˜çš„æ–‡æœ¬é›†åˆç»™å‡ºé—®é¢˜ç­”æ¡ˆã€‚</li></ul><p><strong>Definition</strong>: Formally speaking, to give an answer based on the document collection covering wide range of topics is called open-domain question answering (ODQA). </p><p><strong>Challenges</strong>: The ODQA task combines the challenges of document retrieval (finding the relevant articles) with that of machine comprehension of text (identifying the answer span from those articles).</p><p><strong>Architecture</strong>: There are several approaches to the architecture of an ODQA system. A modular ODQA system consists of two components, the first one (<strong>the ranker</strong>) should be able to find the relevant articles in a database (e.g., Wikipedia), whereas the second one (<strong>the reader</strong>) extracts an answer from a single article or a small collection of articles retrieved by the ranker. In addition to the strictly two-component ODQA systems, there are hybrid systems that are based on several rankers where the last ranker in the pipeline is combined with an answer extraction module usually via reinforcement learning.</p><ul><li>ä»€ä¹ˆæ˜¯ Latent Variable?</li></ul><p>In statistics, latent variables (from Latin: present participle of lateo (â€œlie hiddenâ€), as opposed to observable variables) are variables that are not directly observed but are rather inferred (through a mathematical model) from other variables that are observed (directly measured).</p><h2 id="Motivation"><a href="#Motivation" class="headerlink" title="Motivation"></a>Motivation</h2><p>ç°æœ‰çš„æ–¹æ³•ï¼šè¦ä¹ˆ supervise ç»™å®šç›¸åº”å›ç­”çš„è¯æ®ï¼Œè¦ä¹ˆå†…åµŒä¸€ä¸ª IR ç³»ç»Ÿã€‚We show for the first time that <strong>it is possible to jointly learn the retriever and reader from question-answer string pairs and without any IR system</strong>ã€‚</p><p>ï¼ˆReview ç°æœ‰çš„ï¼šâ‘  DrQA 2017ï¼Œè®­ç»ƒæ—¶ç”¨ question-answer-evidence pairï¼Œæµ‹è¯•æ—¶æŠ“ä¸€ä¸ª IR ç³»ç»Ÿè¿‡æ¥ç”Ÿæˆ evidence. â‘¡ TriviaQA, SearchQA, Quasarï¼Œå¼±ç›‘ç£ï¼Œä¹Ÿæ˜¯ä¾èµ– IR å»ç”Ÿæˆ evidenceï¼‰</p><p><img src="https://s2.loli.net/2022/03/03/lTs5BWSYxE1bXpa.png" alt="image-20220206154839449"></p><p>ä½†æ˜¯ QA å’Œ IR ä¸åŒï¼Œå› ä¸º IR æ›´å…³æ³¨è¯ä¹‰å’Œè¯æ€§çš„ matchingï¼Œä½†æ˜¯ QA æ›´ä¾§é‡äºé—®é¢˜ç†è§£å’Œç­”æ¡ˆç†è§£ã€‚</p><h2 id="Approach-Feature"><a href="#Approach-Feature" class="headerlink" title="Approach / Feature"></a>Approach / Feature</h2><p>In this work, we introduce the first Open Retrieval Question Answering system (ORQA). <strong>ORQA learns to retrieve evidence from an open corpus, and is supervised only by question-answer string pairs.</strong></p><p>The key insight of this work is that end-to-end learning is possible if we pre-train the retriever with an unsupervised <strong>Inverse Cloze Task (ICT)</strong>. </p><p><strong>What is ICT?</strong> In ICT, a sentence is treated as a pseudo question, and its context is treated as pseudo evidence. Given a pseudo-question, ICT requires selecting the corresponding pseudo-evidence out of the candidates in a batch.</p><p>An important aspect of ORQA is its expressivityâ€”it is capable of retrieving any text in an open corpus, rather than being limited to the closed set returned by a blackbox IR system. </p><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h3><p>ä¾æ—§æ˜¯é­”æ”¹ BERTã€‚ $Score = S_{retr} + S_{read}$</p><ul><li>Retriever component</li></ul><script type="math/tex; mode=display">h_q = W_q \ \ (\text{BERT}_Q(q)[\text{CLS}]) \\ h_b = W_b \ \ (\text{BERT}_B(b)[\text{CLS}]) \\ S_{retr}(b,q) = h_q^Th_b</script><ul><li>Reader component</li></ul><script type="math/tex; mode=display">\begin{aligned}  h_{\text {start }} &=\operatorname{BERT}_{R}(q, b)[\operatorname{START}(s)] \\  h_{\text {end }} &=\operatorname{BERT}_{R}(q, b)[\operatorname{END}(s)] \\  S_{\text {read }}(b, s, q) &=\operatorname{MLP}\left(\left[h_{\text {start }} ; h_{\text {end }}\right]\right)  \end{aligned}</script><p>ä½†æ˜¯ç›®å‰å­˜åœ¨çš„é—®é¢˜å°±æ˜¯æ•°æ®é›†å¤ªå¤§äº†(Wikipedia)ï¼Œå¹²æ‰°ä¹Ÿå¤ªå¤šï¼Œç®€å•çš„æ–¹æ³•æ²¡æ³• Trainã€‚äºæ˜¯æå‡º ICTã€‚</p><h3 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h3><ul><li>Inverse Cloze Task: ä¸€ç§ Pretrain çš„æ–¹æ³•</li></ul><p>Since this is impractical to learn from scratch, we pre-train the retriever with an Inverse Cloze Task. We evaluate on open versions of five QA datasets.</p><p>å…ˆè€ƒè™‘ä¸ºä»€ä¹ˆä¼ ç»Ÿçš„ question-evidence æ–¹æ³•èƒ½å¥æ•ˆï¼Œè¿™æ˜¯å› ä¸ºé¦–å…ˆ evidence åŒ…å«äº† question æ‰€è¦çš„ä¿¡æ¯ï¼Œåªä¸è¿‡æ˜¯å¤šå«æœ‰äº†ä¸€äº› question ä¸éœ€è¦çš„ä¿¡æ¯ã€‚äºæ˜¯è¿™ç§ question-context çš„æ–¹æ³•æœ¬è´¨ä¸Šæ˜¯å°†ä¸ question åœ¨è¯­ä¹‰ä¸Šç›¸è¿‘çš„ context å–ä½œ evidence.</p><p>äºæ˜¯æˆ‘ä»¬å°±æå‡º Inverse Cloze Task. æ³¨æ„åˆ° Close Taskï¼ˆå®Œå½¢å¡«ç©ºï¼‰å°±æ˜¯åŸºäº context é¢„æµ‹ masked çš„æ–‡æœ¬ã€‚ï¼ˆ<strong>ICT ä»»åŠ¡æ˜¯ä»€ä¹ˆ</strong>ï¼‰è€Œ ICT åˆ™æ˜¯ç»™å®šä¸€ä¸ªå¥å­ï¼Œé¢„æµ‹å®ƒçš„ context.</p><script type="math/tex; mode=display">P_{ICT}(b | q) = \dfrac {\exp(S_{retr}(b, q))}{\sum_{b' \in BATCH} S_{retr}(b', q)}</script><p>å…¶ä¸­ q æ˜¯éšæœºå¥å­ï¼ŒBATCH-{b} æ˜¯éšæœº sample å‡ºæ¥åš negative samples çš„ï¼Œb æ˜¯ q å¯¹åº”çš„ context.</p><h3 id="Evaluation"><a href="#Evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h3><p>Evaluation was carried out on the following datasets:</p><ul><li>Natural Questions</li><li>WebQuestions</li><li>CuratedTrec</li><li>TriviaQA</li><li>SQuAD</li></ul><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>We presented ORQA, the first open domain question answering system where the retriever and reader are jointly learned end-to-end using only question-answer pairs and without any IR system. </p><p>This is made possible by pre-training the retriever using an Inverse Cloze Task (ICT). </p><p>Experiments show that learning to retrieve is crucial when the questions reflect an information need, i.e. <strong>the question writers do not already know the answer</strong>.</p><h1 id="Domain-matched-pre-training-tasks-for-dense-retrieval"><a href="#Domain-matched-pre-training-tasks-for-dense-retrieval" class="headerlink" title="Domain-matched pre-training tasks for dense retrieval"></a>Domain-matched pre-training tasks for dense retrieval</h1><h2 id="Motivation-1"><a href="#Motivation-1" class="headerlink" title="Motivation"></a>Motivation</h2><p>IR is a exception that pre-training doesnâ€™t produce convincing results. But with right setup, this barrier could be overcome.</p><p>So what is a right setup?</p><p>Itâ€™s been generally accepted that the more similar the end task is to the pre-training task, the larger the gains. We hypothesise that previously proposed pretraining tasks might be still too distant from the target task, which limits useful transfer.</p><h2 id="Approach"><a href="#Approach" class="headerlink" title="Approach"></a>Approach</h2><p>We therefore investigate pre-training tasks for retrieval which are as closely matched to the the target task and domain as possible. To this end, we propose using two corpora for retrieval pre-training:</p><p>1) 65M synthetically generated question-answer pairs.<br>2) A corpus of 220 million post-comment pairs from Reddit, which we use for dialogue retrieval tasks.</p><p>Finally we can prove that:</p><ol><li>pre-training leads to strong achievements in both cases</li><li>domain similarity and task similarity both matters</li><li>the retrieval can benefit from larger models</li></ol><h2 id="Dense-Retrieval-1"><a href="#Dense-Retrieval-1" class="headerlink" title="Dense Retrieval"></a>Dense Retrieval</h2><h3 id="Bi-encoder-architecture"><a href="#Bi-encoder-architecture" class="headerlink" title="Bi-encoder architecture"></a>Bi-encoder architecture</h3><p>Query encoder $E_Q$, passage encoder $E_p$, both output a fixed $d$-dim representation for each query / passage.</p><p>Passages are pre-processed offline, and their representations are indexed using a fast vector similarity search library such as FAISS(?)</p><p>Then when an query $q$ arrives we can use $E_Q(q)$ as its representation and use the index library to get the top-k closest passages.</p><h3 id="Training-1"><a href="#Training-1" class="headerlink" title="Training"></a>Training</h3><p>Given a query, a relevant (+) passage and a list of non-relevant (-) passages, the network is trained to minimize the <strong>negative log likelihood</strong> of picking the positive passage. And the probability assigned to each passage is proportional to $e^{sim(query, passage)}$.</p><p>We do training in two steps:</p><ul><li>use a single BM25 negative per query</li><li>use hard negatives obtained using the first round model</li></ul><h2 id="Experimental-setup"><a href="#Experimental-setup" class="headerlink" title="Experimental setup"></a>Experimental setup</h2><h3 id="Pre-training-tasks"><a href="#Pre-training-tasks" class="headerlink" title="Pre-training tasks"></a>Pre-training tasks</h3><ul><li>PAQ</li><li>Reddit</li></ul><h3 id="Evaluation-tasks"><a href="#Evaluation-tasks" class="headerlink" title="Evaluation tasks"></a>Evaluation tasks</h3><ul><li>Passage retrieval<ul><li>MSMARCO</li><li>Natural Questions</li><li>KILT</li></ul></li><li>Dialogue retrieval (to show the generality of conclusions)<ul><li>ConvAI2</li><li>Ubuntu v2</li><li>DSTC7</li></ul></li></ul><h1 id="Unsupervised-Corpus-Aware-Language-Model-Pre-training-for-Dense-Passage-Retrieval"><a href="#Unsupervised-Corpus-Aware-Language-Model-Pre-training-for-Dense-Passage-Retrieval" class="headerlink" title="Unsupervised Corpus Aware Language Model Pre-training for Dense Passage Retrieval"></a>Unsupervised Corpus Aware Language Model Pre-training for Dense Passage Retrieval</h1><h2 id="Motivation-2"><a href="#Motivation-2" class="headerlink" title="Motivation"></a>Motivation</h2><p>However, dense retrievers are hard to train, typically requiring heavily engineered fine-tuning pipelines to realize their full potential.</p><ul><li>iterative negative mining</li><li>multi-vector representations</li></ul><p>In this paper, we identify and address two underlying problems of dense retrievers: </p><p>i) fragility to training data noise </p><p>ii) requiring large batches to robustly learn the embedding space.</p><p>Then we try to give a hypothesis about why RocketQA (denoising + large batch size) succeeded. </p><ul><li>Denoising -&gt; remove mislabelled samples</li><li>Large bs -&gt; CLS vectors are not well trained, large training batches just helps the LM to learn to form the full embedding space.</li></ul><h2 id="Approach-1"><a href="#Approach-1" class="headerlink" title="Approach"></a>Approach</h2><p>We use the recently proposed Condenser pre-training architecture, which learns to condense information into the dense vector through LM pre-training. (?)</p><p> On top of it, we propose coCondenser, which adds an unsupervised corpus-level contrastive loss (?) to warm up the passage embedding space.</p><p>Then we could think up a way that could realize the two goals without these two approaches.</p><ul><li>Noise resistance -&gt; use Condenser pre-training architecture</li><li>Introduce a corpus-level contrastive learning objective: at each training step sample text pairs; train the model such that the CLS embeddings of text pairs from the same doc are close and those from different documents are far apart.</li></ul><p>-&gt; Combinating the two, propose coCondenser pre-training method.</p><h2 id="Experiment-Method"><a href="#Experiment-Method" class="headerlink" title="Experiment Method"></a>Experiment Method</h2><h3 id="Architecture-1"><a href="#Architecture-1" class="headerlink" title="Architecture"></a>Architecture</h3><ul><li><p>Based on Condenser</p></li><li><p>Added contrastive loss to loss function</p></li></ul><h3 id="Memory-efficient-Pretraining"><a href="#Memory-efficient-Pretraining" class="headerlink" title="Memory-efficient Pretraining"></a>Memory-efficient Pretraining</h3><ul><li>Gradient Caching</li></ul><h3 id="Pre-training"><a href="#Pre-training" class="headerlink" title="Pre-training"></a>Pre-training</h3><ul><li>Universal</li><li>Corpus aware</li></ul><h3 id="Evaluation-1"><a href="#Evaluation-1" class="headerlink" title="Evaluation"></a>Evaluation</h3><ul><li>Wikipedia</li><li>MS-MARCO</li></ul><h1 id="Sparse-Dense-and-Attentional-Representations-for-Text-Retrieval"><a href="#Sparse-Dense-and-Attentional-Representations-for-Text-Retrieval" class="headerlink" title="Sparse, Dense, and Attentional Representations for Text Retrieval"></a>Sparse, Dense, and Attentional Representations for Text Retrieval</h1><p>Luan Y, Eisenstein J, Toutanova K, et al. Sparse, dense, and attentional representations for text retrieval[J]. Transactions of the Association for Computational Linguistics, 2021, 9: 329-345.</p><p>è¿™ç¯‡æ–‡ç« åœ¨è¿›è¡Œç†è®ºæ¨å¯¼çš„æ—¶å€™æ¯”è¾ƒåæ•°å­¦è¯æ˜.</p><h2 id="Motivation-3"><a href="#Motivation-3" class="headerlink" title="Motivation"></a>Motivation</h2><p>ï¼ˆé¦–å…ˆå¯¹æ¯” Dense Retrieval ä¸ä¼ ç»Ÿçš„ Sparse Retrieval.ï¼‰Dual encoders perform retrieval by encoding documents and queries into dense low-dim vectors, scoring each document by its inner product with the query. We investigate the capacity of this architecture relative to sparse bag-of-words models and attentional neural networks. </p><p>ä¸‹é¢æ˜¯ Review éƒ¨åˆ†ï¼š</p><ul><li>Sparse Retrieval: more recent work has adopted a <strong>two-stage retrieval and ranking pipeline</strong>, where a large number of documents are retrieved using sparse high dimensional query/document representations, and are further reranked with learned neural models</li><li>Dense Retrieval: A promising alternative is to perform first-stage retrieval using learned dense low-dimensional encodings of documents and queries. The dual encoder model scores each document by the inner product between its encoding and that of the query.</li></ul><p>è¿™ä¸¤è€…çš„å¯å‘æ˜¯ä¸åŒçš„ã€‚Sparse Retrieval æ›´åŠ çœ‹é‡çš„æ˜¯ question ä¸­çš„é‡ç‚¹æœ¯è¯­ä¼šä¸ retrieved document ä¸­çš„æœ¯è¯­é‡åˆï¼Œè€Œ Dense Retrieval æ›´åŠ å…³æ³¨çš„æ˜¯è¯­ä¹‰ä¸Šçš„ç›¸ä¼¼åº¦ã€‚</p><h3 id="Analyzing-dual-encoder-fidelity"><a href="#Analyzing-dual-encoder-fidelity" class="headerlink" title="Analyzing dual encoder fidelity"></a>Analyzing dual encoder fidelity</h3><p>è¿™é‡Œ fidelity å¯ä»¥ç†è§£ä¸ºå¿ è¯šåº¦ï¼Œå¯¹åŸæ–‡æœ¯è¯­çš„è®°å¿†ç¨‹åº¦ã€‚</p><p>And that is, how much can we compress the input while maintaining the ability to mimic the performance of bag-of-words retrieval?</p><p>Section 2 é‡Œè¯æ˜äº†ï¼šFidelity is important for the sub-problem of detecting precise term overlap, and is a tractable proxy for capacity. Using the theory of dimensionality reduction, we relate fidelity to the normalized margin between the gold retrieval result and its competitors, and show that this margin is in turn related to the length of documents in the collection. ï¼ˆæ²¡ä»”ç»†çœ‹è¯æ˜è¿‡ç¨‹ï¼‰ã€‚</p><h2 id="Approach-Feature-1"><a href="#Approach-Feature-1" class="headerlink" title="Approach / Feature"></a>Approach / Feature</h2><p>Building on these insights, we propose a simple neural model that combines the efficiency of dual encoders with some of the expressiveness of more costly attentional architectures, and <strong>explore sparse-dense hybrids</strong> to capitalize on the precision of sparse retrieval. These models outperform strong alternatives in large-scale retrieval.</p><h3 id="Multi-vector-Encodings"><a href="#Multi-vector-Encodings" class="headerlink" title="Multi-vector Encodings"></a>Multi-vector Encodings</h3><p>The theoretical analysis suggests that fixed-length vector representations of documents may in general need to be large for long documents, if fidelity with respect to sparse high-dimensional representations is important. </p><p><img src="https://s2.loli.net/2022/03/03/49CxJ7kebNZIUX8.png" alt="image-20220206184818740"></p><h3 id="Hybrid"><a href="#Hybrid" class="headerlink" title="Hybrid"></a>Hybrid</h3><p> A natural approach to balancing between the fidelity of sparse representations and the generalization of learned dense ones is to build a hybrid. </p><p>To do this, we linearly combine a sparse and dense systemâ€™s scores using a single trainable weight Î», tuned on a development set.</p><h2 id="Experiment-1"><a href="#Experiment-1" class="headerlink" title="Experiment"></a>Experiment</h2><ul><li>Retrieval for Open-domain QA</li></ul><p><img src="https://s2.loli.net/2022/03/03/TlN3it8aIQGoXbY.png" alt="image-20220206185657503"></p><ul><li>Large Scale Supervised IR</li></ul><p><img src="https://s2.loli.net/2022/03/03/CjMy6aTvVzhiBDm.png" alt="image-20220206185728980"></p><h2 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>We have used both theoretical and empirical techniques to characterize the fidelity of fixed-length dual encoders, focusing on the role of document length. </p><p>Based on these observations, we propose hybrid models that yield strong performance while maintaining scalability.</p><h1 id="Condenser-a-pretraining-architecture-for-dense-retrieval"><a href="#Condenser-a-pretraining-architecture-for-dense-retrieval" class="headerlink" title="Condenser: a pretraining architecture for dense retrieval"></a>Condenser: a pretraining architecture for dense retrieval</h1><h2 id="Motivation-4"><a href="#Motivation-4" class="headerlink" title="Motivation"></a>Motivation</h2><p>However, dense encoders require a lot of data and sophisticated techniques to effectively train and suffer in low data situations. </p><p>Reasons?</p><p>This paper finds a key reason is that standard LMsâ€™ internal attention structure is not ready-to-use for dense encoders, which needs to aggregate text information into the dense representation.</p><p>Attention patterns, therefore, define how effective CLS can aggregate information. </p><p>In other words, the CLS token remains dormant in many middle layers and reactivates only in the last round of attention. </p><h2 id="Approach-2"><a href="#Approach-2" class="headerlink" title="Approach"></a>Approach</h2><p>We propose to pre-train towards dense encoder with a novel Transformer architecture, Condenser, where LM prediction CONditions on DENSE Representation. </p><h2 id="Experiment-2"><a href="#Experiment-2" class="headerlink" title="Experiment"></a>Experiment</h2><h3 id="Architecture-2"><a href="#Architecture-2" class="headerlink" title="Architecture"></a>Architecture</h3><p><img src="https://s2.loli.net/2022/03/03/6hteHNfrpa1Odg7.png" alt="image-20220205153145624"></p><ul><li>Pre-train </li></ul><p>é‡ç‚¹æ˜¯ Head çš„è®¾è®¡ï¼Œæˆ‘ä»¬ä¸ºäº†è®© CLS é‡Œå¡å…¥æ›´å¤šçš„ä¿¡æ¯ï¼Œåœ¨ head è¿™ä¸€å±‚æŠŠ LATE çš„ CLS å’Œ EARLY çš„ å…¶ä»– OUTPUT ç»™ CAT èµ·æ¥ï¼Œä½œä¸ºè¾“å…¥å¡ç»™ Head ç„¶åè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†è°ƒæ•´ CLS çš„è¡¨ç¤ºåŠ›åº¦ã€‚</p><p>ä¸ºäº†é¿å… head è®© back éƒ¨åˆ†çš„ encoding åæ‰ï¼Œloss è®¾ç½®ä¸º $L = L_{mlm} + L_{mlm}^c$.</p><p>$L_{mlm} = \sum_{i \in masked} CrossEntropy(Wh_i^{cd}, x_i)$</p><p>$L_{mlm}^c = \sum _ {i \in masked} CrossEntropy(Wh_i^{late}, x_i)$</p><ul><li>Fine tune</li></ul><p>fine tune çš„æ—¶å€™ç›´æ¥æŠŠè¿™ä¸ª head ç»™ drop æ‰ï¼Œå˜æˆäº†æ™®æ™®é€šé€šçš„ Transformer æ¨¡å‹.</p><h3 id="Fine-tuning"><a href="#Fine-tuning" class="headerlink" title="Fine tuning"></a>Fine tuning</h3><ol><li>Sentence Similarity</li></ol><p>Semantic Textual Similarity Benchmark</p><p>Wikipedia Section Distinction</p><ol><li>Retrieval for Open QA</li></ol><ul><li>NQ</li><li>TriviaQA</li></ul><ol><li>Retrieval for web search</li></ol><ul><li>MS MARCO</li></ul><h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h1 id="PRE-TRAINING-TASKS-FOR-EMBEDDING-BASED-LARGE-SCALE-RETRIEVAL"><a href="#PRE-TRAINING-TASKS-FOR-EMBEDDING-BASED-LARGE-SCALE-RETRIEVAL" class="headerlink" title="PRE-TRAINING TASKS FOR EMBEDDING-BASED LARGE-SCALE RETRIEVAL"></a>PRE-TRAINING TASKS FOR EMBEDDING-BASED LARGE-SCALE RETRIEVAL</h1><p>Chang W C, Yu F X, Chang Y W, et al. Pre-training tasks for embedding-based large-scale retrieval[J]. arXiv preprint arXiv:2002.03932, 2020.</p><h2 id="Motivation-5"><a href="#Motivation-5" class="headerlink" title="Motivation"></a>Motivation</h2><p>Unlike the scoring phase witnessing significant advances recently due to the BERT-style pre-training tasks on cross-attention models, <strong>the retrieval phase remains less well studied. </strong></p><p>Most previous works rely on classic Information Retrieval (IR) methods such as BM-25 (token matching + TF-IDF weights). <strong>These models only accept sparse handcrafted features and can not be optimized for different downstream tasks of interest. </strong></p><h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><p>In this paper, we conduct a comprehensive study on the <strong>embedding-based retrieval models</strong>. (Namely Dense Retrieval!)</p><p>We show that the <strong>key ingredient</strong> of learning a strong embedding-based Transformer model is <strong>the set of pre-training tasks</strong>. With adequately designed paragraph-level pre-training tasks, the Transformer models can remarkably improve over the widely-used BM-25 as well as embedding models without Transformers. The paragraph-level pre-training tasks we studied are <strong>Inverse Cloze Task (ICT), Body First Selection (BFS), Wiki Link Prediction (WLP)</strong>, and <strong>the combination of all three</strong>.</p><p>We contribute the following insight:</p><ul><li>The two-tower Transformer models (Retrieval Stage + Reranking stage) with proper pre-training can significantly outperform the widely used BM-25 algorithm;</li><li>Paragraph-level pre-training tasks such as Inverse Cloze Task (ICT), Body First Selection (BFS), and Wiki Link Prediction (WLP) hugely improve the retrieval quality, whereas the most widely used pre-training task (the token-level masked-LM) gives only marginal gains <em>( marginal: small and not important)</em></li><li>The two-tower models with deep transformer encoders benefit more from paragraph-level pre-training compared to its shallow bag-of-word counterpart </li></ul><h1 id="From-doc2query-to-docTTTTTquery"><a href="#From-doc2query-to-docTTTTTquery" class="headerlink" title="From doc2query to docTTTTTquery"></a>From doc2query to docTTTTTquery</h1><p>Nogueira R, Lin J, Epistemic A I. From doc2query to docTTTTTquery[J]. Online preprint, 2019, 6.</p><h2 id="Motivation-6"><a href="#Motivation-6" class="headerlink" title="Motivation"></a>Motivation</h2><p>Nogueira et al. [7] used a simple sequence-to-sequence transformer [9] for <strong>document expansion</strong>. We <strong>replace the transformer with T5</strong> [8] and observe large effectiveness gains.</p><h1 id="Document-Expansion-by-Query-Prediction"><a href="#Document-Expansion-by-Query-Prediction" class="headerlink" title="Document Expansion by Query Prediction"></a>Document Expansion by Query Prediction</h1><h2 id="Motivation-7"><a href="#Motivation-7" class="headerlink" title="Motivation"></a>Motivation</h2><p>One technique to improve the retrieval effectiveness of a search engine is to expand documents with terms that are related or representative of the documentsâ€™ content</p><h2 id="Feature-1"><a href="#Feature-1" class="headerlink" title="Feature"></a>Feature</h2><p>Following this observation, we propose a simple method that predicts which queries will be issued for a given document and then expands it with those predictions with a vanilla sequence-to-sequence model, trained using datasets consisting of pairs of query and relevant documents.</p><ul><li>Method [Doc2Query]: For each document, the task is to predict a set of queries for which that document will be relevant.<ul><li>Given a dataset of (query, relevant document) pairs, we use a sequence-to-sequence transformer model (Vaswani et al., 2017) that takes as an input the document terms and produces a query.</li><li>The document and target query are segmented using BPE (Sennrich et al., 2015) after being tokenized with the Moses tokenizer.1 </li><li>Once the model is trained, we predict 10 queries using top-k random sampling and append them to each document in the corpus.</li></ul></li></ul><p>ç„¶åç”¨ BM25 ä½œä¸º Retrieverï¼Œå¢å¹¿åçš„ Document ä»£æ›¿åŸæœ‰ Document.</p><h2 id="Experiment-3"><a href="#Experiment-3" class="headerlink" title="Experiment"></a>Experiment</h2><p>Evaluation was carried out on:</p><ul><li>MS MARCO</li><li>TREC-CAR</li></ul><h1 id="ColBERT-Efficient-and-Effective-Passage-Search-via-Contextualized-Late-Interaction-over-BERT"><a href="#ColBERT-Efficient-and-Effective-Passage-Search-via-Contextualized-Late-Interaction-over-BERT" class="headerlink" title="ColBERT: Efficient and Effective Passage Search via Contextualized Late Interaction over BERT"></a>ColBERT: Efficient and Effective Passage Search via Contextualized Late Interaction over BERT</h1><h2 id="Motivation-8"><a href="#Motivation-8" class="headerlink" title="Motivation"></a>Motivation</h2><p>While remarkably effective, the ranking models based on these LMs increase computational cost by orders of magnitude over prior approaches, particularly as they must feed each queryâ€“document pair through a massive neural network to compute a single relevance score</p><h2 id="Feature-2"><a href="#Feature-2" class="headerlink" title="Feature"></a>Feature</h2><p> To tackle this, we present ColBERT, a novel ranking model that adapts deep LMs (in particular, BERT) for efficient retrieval. </p><p>ColBERT introduces <strong>a late interaction architecture </strong>that independently encodes the query and the document using BERT and then employs a cheap yet powerful interaction step that models their fine-grained similarity. </p><p>Under late interaction, ğ‘ and ğ‘‘ are separately encoded into two sets of contextual embeddings, and relevance is evaluated using cheap and pruning-friendly computations between both setsâ€”that is, fast computations that enable ranking without exhaustively evaluating every possible candidate.</p><p><img src="https://s2.loli.net/2022/03/03/4TBhui5CsP8fWSb.png" alt="image-20220209150841730"></p><h1 id="Complement-Lexical-Retrieval-Model-with-Semantic-Residual-Embeddings"><a href="#Complement-Lexical-Retrieval-Model-with-Semantic-Residual-Embeddings" class="headerlink" title="Complement Lexical Retrieval Model with Semantic Residual Embeddings"></a>Complement Lexical Retrieval Model with Semantic Residual Embeddings</h1><h2 id="Feature-3"><a href="#Feature-3" class="headerlink" title="Feature"></a>Feature</h2><p>This paper presents <em>clear</em>, a retrieval model that seeks to complement classical lexical exact-match models such as BM25 with semantic matching signals from a neural embedding matching model.</p><h2 id="Approach-3"><a href="#Approach-3" class="headerlink" title="Approach"></a>Approach</h2><p>clear consists of a lexical retrieval model and an embedding retrieval model. Between these two models, oneâ€™s weakness is the otherâ€™s strength: lexical retrieval performs exact token matching but cannot handle vocabulary mismatch; meanwhile, the embedding retrieval supports semantic matching but loses granular (lexical level) information.</p><p>To ensure that the two types of models work together and fix each otherâ€™s weakness, we propose a residual-based learning framework that teaches the neural embeddings to be complementary to the lexical retrieval.</p><h3 id="Lexical-Retrieval-Model"><a href="#Lexical-Retrieval-Model" class="headerlink" title="Lexical Retrieval Model"></a>Lexical Retrieval Model</h3><p>BM25:</p><script type="math/tex; mode=display">s_{\text {lex }}(q, d)=\operatorname{BM} 25(q, d)=\sum_{t \in q \cap d} \operatorname{rsj}_{t} \cdot \frac{\mathrm{tf}_{t, d}}{\mathrm{tf}_{t, d}+k_{1}\left\{(1-b)+b \frac{|d|}{l}\right\}}</script><h3 id="Embedding-Retrieval-Model"><a href="#Embedding-Retrieval-Model" class="headerlink" title="Embedding Retrieval Model"></a>Embedding Retrieval Model</h3><script type="math/tex; mode=display">\begin{gathered}\mathbf{v}_{q}=\operatorname{AvgPool}\left[\operatorname{BERT}_{\theta}(\langle\mathrm{QRY}\rangle ; \text { query })\right] \\\mathbf{v}_{d}=\operatorname{AvgPool}\left[\operatorname{BERT}_{\theta}(\langle\operatorname{DOC}\rangle ; \text { document })\right]\end{gathered}</script><p>BERT: shared weight</p><script type="math/tex; mode=display">s_{emb}(q,d) = v_q^Tv_d</script><h3 id="Residual-Based-Learning"><a href="#Residual-Based-Learning" class="headerlink" title="Residual Based Learning"></a>Residual Based Learning</h3><p>To make the best use of the embedding model, we must avoid the embedding model â€œrelearningâ€ signals already captured by the lexical model. Instead, we focus its capacity on semantic level matching missing in the lexical model.</p><p>ä¸€èˆ¬çš„ Loss å‡½æ•°ï¼š</p><script type="math/tex; mode=display">\mathcal{L}=\left[m-s_{\mathrm{emb}}\left(q, d^{+}\right)+s_{\mathrm{emb}}\left(q, d^{-}\right)\right]_{+}</script><p>where $[x]^+ = max\{0,x\}$</p><p>ä¸ºäº†è®© embedding æ¥ complement lexical retrievalï¼Œæˆ‘ä»¬ propose ä¸¤ä¸ª techique:</p><ul><li>Error-based Negative Sampling</li></ul><p>Sample negative examples from those documents mistakenly retrieved by lexical retrieval.</p><p>Given a positive query-document pair, we uniformly sample irrelevant examples from the top N documents returned by lexical retrieval with probability p. With such negative samples, the embedding model learns to differentiate relevant documents from confusing ones that are lexically similar to the query but semantically irrelevant.</p><ul><li>Residual-based Margin</li></ul><p>Intuitively, different query-document pairs require different levels of extra semantic information for matching on top of exact matching signals.</p><p><strong>Our negative sampling strategy does not tell the neural model the degree of error made by the lexical retrieval that it needs to fix.</strong></p><p>äºæ˜¯åšä¿®æ”¹ï¼š</p><script type="math/tex; mode=display">m_{r}\left(\mathrm{~s}_{\text {lex }}\left(q, d^{+}\right), \mathrm{s}_{\text {lex }}\left(q, d^{-}\right)\right)=\xi-\lambda_{\text {train }}\left(\mathrm{s}_{\text {lex }}\left(q, d^{+}\right)-\mathrm{s}_{\text {lex }}\left(q, d^{-}\right)\right)</script><script type="math/tex; mode=display">\mathcal{L}=\left[m_{r}\left(\mathrm{~s}_{\mathrm{lex}}\left(q, d^{+}\right), \mathrm{s}_{\mathrm{lex}}\left(q, d^{-}\right)\right)-s_{\mathrm{emb}}\left(q, d^{+}\right)+s_{\mathrm{emb}}\left(q, d^{-}\right)\right]_{+}</script><h1 id="Poly-encoders-architectures-and-pre-training-strategies-for-fast-and-accurate-multi-sentence-scoring"><a href="#Poly-encoders-architectures-and-pre-training-strategies-for-fast-and-accurate-multi-sentence-scoring" class="headerlink" title="Poly-encoders: architectures and pre-training strategies for fast and accurate multi-sentence scoring"></a>Poly-encoders: architectures and pre-training strategies for fast and accurate multi-sentence scoring</h1><h2 id="Motivation-9"><a href="#Motivation-9" class="headerlink" title="Motivation"></a>Motivation</h2><p>ç°æœ‰çš„ï¼šCross-encoders å’Œ Bi-encoders</p><p>The former often performs better, but is too slow for practical use. </p><h2 id="Feature-4"><a href="#Feature-4" class="headerlink" title="Feature"></a>Feature</h2><p>In this work, we develop a new transformer architecture, the Poly-encoder, that learns global rather than token level self-attention features.</p><p>We introduce the Poly-encoder, an architecture with an additional learnt attention mechanism that represents more global features from which to perform self-attention, resulting in performance gains over Bi-encoders and large speed gains over Cross-Encoders</p><h2 id="Poly-Encoder"><a href="#Poly-Encoder" class="headerlink" title="Poly-Encoder"></a>Poly-Encoder</h2><p>A given candidate label is represented by one vector as in the Bi-encoder, which allows for caching candidates for fast inference time, while the input context is jointly encoded with the candidate, as in the Cross-encoder, allowing the extraction of more information.</p><p>The Poly-encoder uses two separate transformers for the context and label like a Bi-encoder, and the candidate is encoded into a single vector $y_{candi}$ .</p><p>As such, the Poly-encoder method can be implemented using a precomputed cache of encoded responses. However, <strong>the input context, which is typically much longer than a candidate</strong>, is represented with m vectors ($y^1_{ctxt}, \cdots, y^{m}_{ctxt}$) instead of just one as in the Bi-encoder, where m will influence the inference speed. </p><p>To obtain these m global features that represent the input, we learn m context codes $(c_1, \cdots, c_m)$, where $c_i$ extracts representation $y^i_{ctxt}$ by attending over all the outputs of the previous layer:</p><script type="math/tex; mode=display">y_{c t x t}^{i}=\sum_{j} w_{j}^{c_{i}} h_{j} \quad \text { where } \quad\left(w_{1}^{c_{i}}, . ., w_{N}^{c_{i}}\right)=\operatorname{softmax}\left(c_{i} \cdot h_{1}, \ldots, c_{i} \cdot h_{N}\right)</script><p>The m context codes are randomly initialized, and learnt during finetuning. Finally, given our m global context features, we attend over them using $y_{candi}$ as the query:</p><script type="math/tex; mode=display">y_{c t x t}=\sum w_{i} y_{c t x t}^{i} \quad \text { where } \quad\left(w_{1}, \ldots, w_{m}\right)=\operatorname{softmax}\left(y_{c a n d_{i}} \cdot y_{c t x t}^{1}, \ldots, y_{c a n d_{i}} \cdot y_{c t x t}^{m}\right)</script><p>The final score for that candidate label is then $y_{ctxt} \cdot y_{candi}$ as in a Bi-encoder. As m &lt; N, where N is the number of tokens, and the context-candidate attention is only performed at the top layer, this is far faster than the Cross-encoderâ€™s full self-attention.</p><p><img src="https://s2.loli.net/2022/03/03/rBlRIiAHuqK18jw.png" alt="image-20220208163723909"></p><p>ä½†æ˜¯â€¦æ—¶é—´å‘¢ï¼Ÿ</p><p><img src="https://s2.loli.net/2022/03/03/F56m4qxauOjoLA8.png" alt="image-20220208164130924"></p><p>å¥½å§ï¼Œè™½ç„¶å¤æ‚åº¦æ„Ÿè§‰ä¸å¤ªå¯¹ï¼Œä½†æ˜¯ä»–è¯´æ¯” Cross å¥½ä¸Šé‚£ä¹ˆå‡ ä¸ªæ•°é‡çº§ã€‚Fine.</p><h1 id="Improving-Document-Representations-by-Generating-Pseudo-Query-Embeddings-for-Dense-Retrieval"><a href="#Improving-Document-Representations-by-Generating-Pseudo-Query-Embeddings-for-Dense-Retrieval" class="headerlink" title="Improving Document Representations by Generating Pseudo Query Embeddings for Dense Retrieval"></a><strong>Improving Document Representations</strong> by Generating Pseudo Query Embeddings for Dense Retrieval</h1><h2 id="Motivation-10"><a href="#Motivation-10" class="headerlink" title="Motivation"></a>Motivation</h2><p>However, this simple structure may cause serious information loss during the encoding of documents since the queries are agnostic.</p><p>As it is very common that a document with hundreds of tokens contains several distinct topics, some important semantic information might be easily missed or biased by each other without knowing the query.</p><h2 id="Feature-5"><a href="#Feature-5" class="headerlink" title="Feature"></a>Feature</h2><p>To address this problem, we design a method to mimic the queries on each of the documents by an iterative clustering process and represent the documents by multiple pseudo queries.</p><p>To alleviate the query agnostic problem, we propose a novel approach that mimics multiple potential queries corresponding to the input document and we call them â€œpseudo query embeddingsâ€.</p><p>Ideally, each of the pseudo query embeddings corresponds to a semantic salient (most important or noticeable) fragment in the document which is similar to a semantic cluster of the document. </p><p>Thus, we implement the process by a clustering algorithm (i.e., K-means in this work) and regard the cluster centroids as the pseudo query embeddings. </p><ul><li>This is a novel approach to represent the document with multiple pseudo query embeddings which are generated by a clustering process.</li></ul><h2 id="Review-Aggregator"><a href="#Review-Aggregator" class="headerlink" title="Review: Aggregator"></a>Review: Aggregator</h2><p><img src="https://s2.loli.net/2022/03/03/mFe25cMlpigUVts.png" alt="image-20220207164752721"></p><p><strong>Independent Aggregator</strong></p><p>$q_<em>$ and $d_</em>$ are the direct output of the BERT layer. A pooler is needed to extract the inputs for the scoring function. For example, $e_q = q_*[CLS]$ in Karpukhin et al.</p><p>Although it might be efficient to compute, compressing m or n embeddings just into 1 embedding may lose information.</p><p><strong>Late Interaction Aggregator</strong></p><p>As shown in Figure 1 (c), the model preserves all of the document token embeddings {di} m i=1 in the cache until a new query is given.</p><p> It then computes token-wise matching scores using all of the document and query embeddings. The final matching score is generated by pooling the m Ã— n scores. </p><p>However, the time complexity of the score computation arises from constant O(1) to quadratic O(mn).</p><p><strong>Semi-interactive Aggregator</strong></p><p>compresses the document token embeddings to a constant number k much smaller than the document length m (k &lt;&lt; m).</p><p><strong>Their Method</strong></p><p>Firstly, following the semi-interactive aggregator, we feed the document tokens into BERT and use the last layer hidden states as the document token embeddings {di} m i=1. Next, we perform Kmeans algorithm on these token embeddings.</p><p>The <strong>K-means algorithm</strong> mainly contains two iterative steps: assignment step and update step. These two steps are performed alternatively until the convergence condition is satisfied. </p><p>The assignment step can be expressed by the following equation.</p><script type="math/tex; mode=display">\begin{gathered}s_{i}^{t}=\underset{j}{\operatorname{argmin}}\left\|d_{i}-c_{j}^{t}\right\|^{2} \\i \in\{1, \ldots, m\}, j \in\{1, \ldots, k\}\end{gathered}</script><p>Update:</p><script type="math/tex; mode=display">c_{j}^{t+1}=\frac{1}{\sum_{i=1}^{m} 1\left(s_{i}^{t}=j\right)} \sum_{\left\{i \mid s_{i}^{t}=j\right\}} d_{i}</script><p>å®é™…ä¸Šè¿™å°±æ˜¯ K-means Clustering çš„ç®—æ³•ï¼Œå°±æ˜¯ä¸€å †ä¸Šä¸‹æ ‡è®°å·ï¼Œæ²¡å•¥é«˜å¤§ä¸Šçš„åœ°æ–¹ã€‚</p><p>ç„¶åæˆ‘ä»¬å°±æŠŠ $c_j^t$ çœ‹ä½œæ˜¯ Query Embedding.</p><h2 id="Experiment-4"><a href="#Experiment-4" class="headerlink" title="Experiment"></a>Experiment</h2><p>Evaluation: MS MARCO; Open QA (ç¿»æ¥è¦†å»è¿™ä¸ªé¢†åŸŸçš„ baseline å°±è¿™ä¹ˆå‡ ä¸ª)</p><h1 id="Sentence-T5-Scalable-Sentence-Encoders-from-Pre-trained-Text-to-Text-Models"><a href="#Sentence-T5-Scalable-Sentence-Encoders-from-Pre-trained-Text-to-Text-Models" class="headerlink" title="Sentence-T5: Scalable Sentence Encoders from Pre-trained Text-to-Text Models"></a>Sentence-T5: <strong>Scalable</strong> Sentence Encoders from Pre-trained Text-to-Text Models</h1><h2 id="Motivation-11"><a href="#Motivation-11" class="headerlink" title="Motivation"></a>Motivation</h2><p>While T5 achieves impressive performance on language tasks cast as sequence-to-sequence mapping problems, it is unclear how to produce sentence embeddings from encoder-decoder models.</p><p>We investigate three methods for extracting T5 sentence embeddings: two utilize only the T5 encoder and one uses the full T5 encoder-decoder model.</p><h2 id="Feature-6"><a href="#Feature-6" class="headerlink" title="Feature"></a>Feature</h2><p>ç›®çš„å°±æ˜¯ä¸€ä¸ªå¥å­å¡è¿› T5 è·å–ä»–çš„ Representationï¼Œå¡çš„ä¿¡æ¯è¶Šå¤šè¶Šå¥½ã€‚</p><p>We explore three ways of turning a pre-trained T5 encoder-decoder model into a sentence embedding model: (i) using the first token representation of the encoder; (ii) averaging all token representations from the encoder; (iii) using the first token representation from the decoder.</p><h2 id="Conclusion-2"><a href="#Conclusion-2" class="headerlink" title="Conclusion"></a>Conclusion</h2><ul><li>encoder-only models have strong transfer performance while encoderdecoder models perform better on textual similarity tasks</li><li>We also demonstrate the effectiveness of scaling up the model size, which greatly improves sentence embedding quality</li></ul><p>å¦‚æœå¯¹ T5 è¿›è¡Œè¿›ä¸€æ­¥ç ”ç©¶ï¼Œèƒ½å¦æå–å‡ºå…¶æ¯å±‚çš„è¡¨ç¤ºæ¥åšåˆ†æï¼ŒæŸ¥çœ‹åˆ°åº•æ˜¯å“ªäº›å±‚é’ˆå¯¹å“ªäº›ä»»åŠ¡èµ·äº†ä½œç”¨ï¼Ÿä½†æ˜¯å› ä¸º T5 æœ¬æ¥å°±æ˜¯ä¸ºäº†åš Universal çš„ï¼Œè¿™ä¸ªä»»åŠ¡ä¹Ÿä¸ä¸€å®šæœ‰ä»·å€¼â€¦</p><h1 id="Multi-task-Retrieval-for-Intensive-Tasks"><a href="#Multi-task-Retrieval-for-Intensive-Tasks" class="headerlink" title="Multi-task Retrieval for Intensive Tasks"></a>Multi-task Retrieval for Intensive Tasks</h1><ul><li>ä»€ä¹ˆæ˜¯ multi-task retrieval?</li></ul><p>we target a retriever that can perform well on a wide variety of problems, without task-specific finetuning</p><ul><li>ä»€ä¹ˆæ˜¯ Knowledge intensive task? æ˜¯ä»»åŠ¡é›†ï¼ˆï¼Ÿ</li></ul><p>KILT (Knowledge Intensive Language Tasks) is a new unified benchmark to help AI researchers build models that are better able to leverage real-world knowledge to accomplish a broad range of tasks.</p><h2 id="Motivation-12"><a href="#Motivation-12" class="headerlink" title="Motivation"></a>Motivation</h2><p>Although neural retrieval outperforms traditional methods like tf-idf and BM25, its performance degrades considerably when applied to <strong>out-of-domain data.</strong></p><p>ç°æœ‰çš„ Dense Retrieval çš„å¼±ç‚¹ï¼š</p><p>First, unlike tf-idf or BM25, neural retrieval models are unsuitable for low data regimes such as few- and zero-shot settings. </p><p>Second, task-specific retrievers complicate practical applications where multiple knowledge-intensive tasks may need to be performed using the same supporting database or over the same input text. </p><h2 id="Feature-7"><a href="#Feature-7" class="headerlink" title="Feature"></a>Feature</h2><p><strong>By jointly training on an extensive selection of retrieval tasks</strong>, we obtain a model which is not only more robust than previous approaches, but also can lead to better performance on the downstream knowledge-intensive tasks when plugged into an existing system.</p><h2 id="Experiment-5"><a href="#Experiment-5" class="headerlink" title="Experiment"></a>Experiment</h2><ul><li>The universal retriever performing comparably to task-specific models</li><li>Plugged the universal retriever into a larger pipeline and achieved better results</li><li>Evaluated the modelâ€™s performance in the zero-shot and few-shot settings. <ul><li>our proposed approach performs comparably to BM25 in the zero shot setting, and quickly overtakes it even with minimal in-domain training</li></ul></li><li>In Section 4.5 we evaluated a number of more complex variants of the model involving task specialisation, but failed to see clear performance improvements. Finally, in Section 4.6 we saw how a simple iterative approach to data augmentation can lead to better performance.</li></ul><p>// ä¸‹å‘¨ç»„ä¼šè¦åˆ†äº«è®ºæ–‡ï¼Œå¯„å¯„å¯„ï¼Œæ€»ä¸èƒ½è®²è¿™äº› 21 å¹´åŠä¹‹å‰çš„è€è´§è‰²å§ï¼Œä¸‹å‘¨çœ‹èµ·æ¥è¦é¡¶ç€è½¯å·¥ init project çš„æ—¶å€™å¤šæ‰¾å‡ ç¯‡è®ºæ–‡äº†</p><p>// è¯»äº†ä¹Ÿä¸ç®—å¾ˆå¤šè®ºæ–‡ï¼Œä½†è¿ BERT éƒ½æ²¡ä¸Šæ‰‹è·‘è¿‡å‡ æ¬¡ï¼Œæå®ŒæŒ‘æˆ˜æ¯ä¸€å®šè¦ä¸Šæ‰‹å†™ä»£ç äº†ï¼Œä¸ç„¶æ„Ÿè§‰è¿˜æ˜¯å¤ªç†è®ºï¼Œå¤ªæ³›æ³›è€Œè°ˆäº†ï¼Œä¸æ¯«æ²¡æ„Ÿåˆ°ç åŠ›æœ‰æå‡ï¼ˆx</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸»è¦æ˜¯å¯¹ 202202 è¯»çš„ Paper çš„æ€»ç»“ã€‚&lt;/p&gt;
&lt;p&gt;æ¶‰åŠçš„ä¸»è¦ä¸»é¢˜æ˜¯ Infomation Retrieval ä¸­çš„ Dense Retrieval.&lt;/p&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/NLP" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-NLP/"/>
    
    
  </entry>
  
  <entry>
    <title>GAN ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ ç®€ä»‹</title>
    <link href="https://www.c7w.tech/gan/"/>
    <id>https://www.c7w.tech/gan/</id>
    <published>2022-03-02T12:24:47.000Z</published>
    <updated>2022-03-02T14:21:41.020Z</updated>
    
    <content type="html"><![CDATA[<p>Reference æ˜¯ 2021 Spring Hung-yi Lee çš„æœºå™¨å­¦ä¹ çš„ GAN éƒ¨åˆ†ã€‚</p><ul><li><a href="https://www.youtube.com/watch?v=4OWp0wDu6Xw&amp;list=PLJV_el3uVTsMhtt7_Y6sgTHGHp1Vb2P2J&amp;index=14">https://www.youtube.com/watch?v=4OWp0wDu6Xw&amp;list=PLJV_el3uVTsMhtt7_Y6sgTHGHp1Vb2P2J&amp;index=14</a></li></ul><a id="more"></a><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><ul><li>Network as Generator:<ul><li>Network çš„è¾“å…¥åŠ ä¸Šä¸€ä¸ª random variable $z$ sampled from a certain distribution.</li><li>ä½¿å¾—ç›¸åŒçš„ $x$ è¾“å…¥äº§ç”Ÿçš„è¾“å‡º $y$ ä¸åŒï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›éœ€è¦â€œcreativityâ€çš„ä»»åŠ¡.</li></ul></li></ul><h2 id="Unconditional-Generation"><a href="#Unconditional-Generation" class="headerlink" title="Unconditional Generation"></a>Unconditional Generation</h2><ul><li>Unconditional Generation<ul><li>Input: $z$, sampled from a normal distribution, low-dim vector.</li><li>Output: $y$, high-dim vector.</li><li>Generator(Network): æŠŠç®€å•çš„ distribution æ”¾å¤§æˆå¤æ‚çš„ distribution.</li><li>Discriminator: å¤šè®­ç»ƒä¸€ä¸ª Discriminatorï¼Œè¾“å…¥ä¸€ä¸ªå›¾ç‰‡ï¼Œè¾“å‡ºä¸€ä¸ªæ•°å€¼ï¼Œè¶Šå¤§ä»£è¡¨è¾“å…¥å›¾ç‰‡è¶ŠçœŸå®ã€‚</li></ul></li></ul><p><img src="https://s2.loli.net/2022/03/02/B7s6RfJOHdurVlz.png" alt="image-20220302204358282"></p><ul><li>è®­ç»ƒæ­¥éª¤ï¼š<ul><li>Fix generator G, update discriminator D</li><li>Fix discriminator D, update generator G</li></ul></li></ul><h2 id="Theory-behind-GAN"><a href="#Theory-behind-GAN" class="headerlink" title="Theory behind GAN"></a>Theory behind GAN</h2><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š</p><ul><li>Normal Distribution ç»è¿‡ Generator G åäº§ç”Ÿçš„ Distribution $P_G$ï¼Œä¸çœŸå®çš„æ•°æ®é›†çš„ $P_{data}$ è¶Šæ¥è¿‘è¶Šå¥½ã€‚</li><li>$G^{*}=\arg \min _{G} \operatorname{Div}\left(P_{G}, P_{d a t a}\right)$</li><li>é—®é¢˜æ˜¯ï¼Œè¯¥æ€ä¹ˆè®¡ç®— $\operatorname{Div}\left(P_{G}, P_{d a t a}\right)$ å‘¢ï¼Ÿ</li><li>äº‹å®ä¸Šï¼ŒGAN æ˜¯åœ¨è¿™ä¸¤ä¸ª Distribution ä¸­åš sample æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ Discriminator çš„åŠŸèƒ½ã€‚</li><li>$\max_D V(D,G)$ ä¸ $P_G$ å’Œ $P_{data}$ çš„ JS Divergence æœ‰å…³.</li><li>ä¹Ÿå°±æ˜¯ $G^{*}=\arg \min _{G} \max _{D} V(G, D)$.</li></ul><h2 id="Tips-for-training-GAN"><a href="#Tips-for-training-GAN" class="headerlink" title="Tips for training GAN"></a>Tips for training GAN</h2><ul><li>JS divergence çš„é—®é¢˜ï¼Ÿ<ul><li>$P_G$ å’Œ $P_{data}$ å¾€å¾€äº¤é›†ä¸å¤§ï¼Œå› ä¸ºäºŒè€…å¾€å¾€æ˜¯é«˜ç»´ç©ºé—´çš„ manifold.</li><li>å¯¹äºä¸¤ä¸ªæ²¡æœ‰é‡åˆçš„åˆ†å¸ƒï¼ŒJS Divergence æ°¸è¿œæ˜¯ log 2.</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼ŒJS Divergence æ²¡æœ‰è€ƒè™‘ä¸¤ä¸ª Distribution ä¹‹é—´çš„è·ç¦»â€¦</li></ul></li></ul><p><img src="https://s2.loli.net/2022/03/02/XNSAdmxy6QnHLjg.png" alt="image-20220302211540458"></p><p>äºæ˜¯ï¼Œæˆ‘ä»¬æ¢ä¸€ç§ Divergenceâ€¦</p><ul><li>Wasserstein distance<ul><li>ä¸¤ä¸ª Distribution ä¹‹é—´çš„è·ç¦»</li><li>è®©ä¸€ä¸ª Distribution å˜æˆå¦ä¸€ä¸ªæ‰€èŠ±è´¹çš„æœ€å°ä»£ä»·</li></ul></li></ul><script type="math/tex; mode=display">\max _{D \in 1-\text { Lipschitz }}\left\{E_{x \sim P_{d a t a}}[D(x)]-E_{x \sim P_{G}}[D(x)]\right\}</script><ul><li>1-Lipschitz é™åˆ¶<ul><li>ä½¿å¾— D è¶³å¤Ÿå¹³æ»‘ï¼Œä»¥å…å‡ºç°æœå‘ inf å‘å±•çš„æƒ…å†µ</li><li>å¦‚ä½•å®ç°è¿™ä¸ªé™åˆ¶ï¼Ÿ<ul><li>Improved WGAN</li><li>SNGAN</li></ul></li></ul></li></ul><h2 id="Evaluation-of-generation"><a href="#Evaluation-of-generation" class="headerlink" title="Evaluation of generation"></a>Evaluation of generation</h2><ul><li>Quality of Image</li></ul><p><img src="https://s2.loli.net/2022/03/02/vCqfKOxlocLFbjt.png" alt="image-20220302215009447"></p><p>å¯èƒ½ä¼šå‡ºç° Mode Collapse çš„ç°è±¡ï¼Œç”Ÿæˆçš„å›¾ç‰‡æ¯”è¾ƒé›†ä¸­ï¼Œè¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯ç”±äºå®é™…çš„æ•°æ®åˆ†å¸ƒå³°å€¼æœ‰å¤šä¸ªï¼Œè€Œè®­ç»ƒåªæ‹Ÿåˆäº†å…¶ä¸­çš„ä¸€ä¸ª.</p><p><img src="https://s2.loli.net/2022/03/02/ajGgzuOA4cUn7mh.png" alt="img"></p><p>ä¹Ÿå¯èƒ½ä¼šå‡ºç° Mode Dropping çš„ç°è±¡ï¼Œè®­ç»ƒåª pick äº†æŸä¸ªç‰¹å¾ï¼Œè®­ç»ƒäº†å¤šæ¬¡ä»¥åï¼Œç”Ÿæˆçš„å›¾ç‰‡äººè„¸éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰è‰²è°ƒçš„æ”¹å˜ã€‚</p><p><img src="https://s2.loli.net/2022/03/02/c48IWslmbdftrZX.png" alt="img"></p><ul><li>How to ensure diversity:</li></ul><p><img src="https://s2.loli.net/2022/03/02/SsDhqYEUzO3Ibvx.png" alt="image-20220302215633902"></p><ul><li>Quality çœ‹çš„æ˜¯ä¸€å¼ å›¾ç‰‡ä¸¢è¿› Image Classifier ä¹‹åçš„åˆ†å¸ƒæ˜¯å¦é›†ä¸­ï¼Œè€Œ Diversity çœ‹çš„æ˜¯ä¸€ç»„å›¾ç‰‡ä¸¢è¿› Image Classifier ä¹‹ååˆ†å¸ƒæ˜¯å¦å‡åŒ€.</li></ul><h2 id="Conditional-Generation"><a href="#Conditional-Generation" class="headerlink" title="Conditional Generation"></a>Conditional Generation</h2><p><img src="https://s2.loli.net/2022/03/02/dTHE8nAWeGLpawb.png" alt="image-20220302220339320"></p><ul><li>Discriminator ä¹Ÿå¢åŠ è¾“å…¥ $x$ï¼Œåªæœ‰å½“ G çš„è¾“å‡ºä¸ $x$ match çš„æ—¶å€™æ‰è¾“å‡ºé«˜åˆ†.</li></ul><p>åº”ç”¨ï¼š</p><ul><li>Text to image</li><li>Image to image</li><li>Sound to image</li></ul><h2 id="Learning-from-unpaired-data"><a href="#Learning-from-unpaired-data" class="headerlink" title="Learning from unpaired data"></a>Learning from unpaired data</h2><p>æœ€ç›´è§‚çš„æƒ³æ³•ï¼š</p><p><img src="https://s2.loli.net/2022/03/02/RwlZ9mcL6oQObpM.png" alt="image-20220302221524154"></p><p><img src="https://s2.loli.net/2022/03/02/g2YL19ds6fjetFJ.png" alt="image-20220302221623184"></p><p>ä½†æ˜¯ï¼ŒG å¯èƒ½åªä¼šæŠŠ input å½“æˆæ˜¯ä¸€ä¸ª noise æ¥å¤„ç†ï¼Œåœ¨è¾“å…¥å’Œè¾“å‡ºä¹‹é—´æ²¡ä»€ä¹ˆå…³ç³»â€¦</p><p>äºæ˜¯æˆ‘ä»¬æ”¹è¿›æ¨¡å‹ï¼š</p><p><img src="https://s2.loli.net/2022/03/02/LPsAvhYX9r24Bgi.png" alt="image-20220302221820843"></p><p>Then we add the dual part:</p><p><img src="https://s2.loli.net/2022/03/02/QpL75kSsZMYawPF.png" alt="image-20220302222132643"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Reference æ˜¯ 2021 Spring Hung-yi Lee çš„æœºå™¨å­¦ä¹ çš„ GAN éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=4OWp0wDu6Xw&amp;amp;list=PLJV_el3uVTsMhtt7_Y6sgTHGHp1Vb2P2J&amp;amp;index=14&quot;&gt;https://www.youtube.com/watch?v=4OWp0wDu6Xw&amp;amp;list=PLJV_el3uVTsMhtt7_Y6sgTHGHp1Vb2P2J&amp;amp;index=14&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>MATLAB ä»æ”¾å¼ƒåˆ°å…¥é—¨</title>
    <link href="https://www.c7w.tech/matlab-exercise/"/>
    <id>https://www.c7w.tech/matlab-exercise/</id>
    <published>2022-02-23T12:06:47.000Z</published>
    <updated>2022-02-23T13:48:22.660Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§æ¦‚è®°å½•çš„æ˜¯ MATLAB çš„ç»ƒä¹ ä¹‹è·¯ã€‚åæ­£ã€Šæ•°å€¼åˆ†æã€‹è¯¾ç¨‹ä¹Ÿå¾—ç”¨ã€‚</p><a id="more"></a><h2 id="Week-1-Optional"><a href="#Week-1-Optional" class="headerlink" title="Week 1 Optional"></a>Week 1 Optional</h2><ul><li>Figure 1</li></ul><p><img src="https://s2.loli.net/2022/02/23/IFc8GgE1VtMZ3kT.png" alt="image-20220223201253085"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>close all<span class="token punctuation">;</span><span class="token comment">%æ¸…ç©ºä¹‹å‰çš„å›¾çª—</span>t <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token keyword">pi</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">%æ—¶é—´</span>y <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token operator">.*</span> <span class="token function">cos</span><span class="token punctuation">(</span><span class="token number">0.7</span><span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">'r-'</span><span class="token punctuation">,</span><span class="token string">'LineWidth'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">%ç”¨ä¸‰ç£…çº¢å®çº¿ç”»æ›²çº¿</span>hold on <span class="token comment">% æ·»åŠ æ–°ç»˜å›¾æ—¶ä¿ç•™å½“å‰ç»˜å›¾</span>tt <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>y<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ts <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%å¯»æ‰¾è¿›å…¥5%è¯¯å·®å¸¦çš„æœ€å¤§æ—¶é—´</span><span class="token function">plot</span><span class="token punctuation">(</span>ts<span class="token punctuation">,</span><span class="token number">0.95</span><span class="token punctuation">,</span><span class="token string">'bo'</span><span class="token punctuation">,</span><span class="token string">'MarkerSize'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment">%(ts,0.95)ä¸ºæ–‡å­—çš„åæ ‡ï¼Œ'b'æŒ‡è“è‰²ï¼Œ'o'æŒ‡åœ†åœˆï¼Œ'MarkerSize','10'è®¾å®šåœ†åœˆå¤§å°ä¸º10</span>hold off<span class="token function">axis</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">inf</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token keyword">inf</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">%è®¾ç½®æ¨ªåæ ‡ä¸Šé™ä¸º6Ï€ï¼Œä¸‹é™è‡ªåŠ¨ç”Ÿæˆï¼›çºµåæ ‡ä¸‹é™ä¸º0.6ï¼Œä¸Šé™è‡ªåŠ¨ç”Ÿæˆ</span>ax <span class="token operator">=</span> gca<span class="token punctuation">;</span> <span class="token comment">%å°†axèµ‹å€¼ä¸ºå½“å‰å›¾çª—å¯¹è±¡</span>ax<span class="token punctuation">.</span>XTick <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">]</span><span class="token punctuation">;</span>ax<span class="token punctuation">.</span>YTick <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.95</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1.05</span><span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">%å°†æ¨ªåæ ‡åˆ†åº¦è®¾ç½®ä¸º2Ï€ï¼Œ4Ï€ï¼Œ6Ï€;åŒç†é‡è®¾çºµåæ ‡åˆ†åº¦</span>ax<span class="token punctuation">.</span>XTickLabel <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'2\pi'</span><span class="token punctuation">,</span><span class="token string">'4\pi'</span><span class="token punctuation">,</span><span class="token string">'6\pi'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">%æ¨ªè½´åˆ†åº¦çš„æ ‡è¯†ã€‚'\pi'ä¼šè¾“å‡ºÏ€ã€‚</span>ax<span class="token punctuation">.</span>YTickLabel <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'0.95'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'1.05'</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">%çºµè½´åˆ†åº¦çš„æ ‡è¯†ã€‚num2strå°†æ•°å­—è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</span>grid on<span class="token function">text</span><span class="token punctuation">(</span><span class="token number">13.5</span><span class="token punctuation">,</span><span class="token number">1.2</span><span class="token punctuation">,</span><span class="token string">'\fontsize&#123;12&#125;&#123;\alpha&#125;=0.3'</span><span class="token punctuation">)</span><span class="token comment">%(13.5,1.2)æ˜¯æ–‡å­—åæ ‡ï¼Œ\fontsize&#123;12&#125;å°†æ–‡å­—å¤§å°è®¾å®šä¸º12å·,&#123;\alpha&#125;æ˜¯Î±ï¼Œæœ¬è¡Œä»£ç è¾“å‡º'Î±=0.3'</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token number">13.5</span><span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">,</span><span class="token string">'fontsize&#123;12&#125;&#123;\omega&#125;=0.7'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%(13.5,1.1)æ˜¯æ–‡å­—åæ ‡ï¼Œ\fontsize&#123;12&#125;å°†æ–‡å­—å¤§å°è®¾å®šä¸º12å·,&#123;\omega&#125;æ˜¯Ï‰ï¼Œæœ¬è¡Œä»£ç è¾“å‡º'Î±=0.7'</span><span class="token comment">%æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œtextçš„å‚æ•°å¾ˆé•¿ï¼Œä¸‹é¢ä»‹ç»ä¸€ç§ç¼©å‡é•¿åº¦çš„æ–¹æ³•</span>cell_string<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token string">'\fontsize&#123;12&#125;\uparrow'</span><span class="token punctuation">;</span><span class="token comment">% æœ¬è¡Œä»£ç å°†æŒ‡ä»¤ç”¨åˆ°çš„å­—ç¬¦ä¸²å­˜å…¥ä¸€ä¸ªèƒå…ƒæ•°ç»„ä¸­ï¼Œæœªæ¥è°ƒç”¨çš„æ—¶å€™æ›´ä¸ºä¾¿åˆ©</span><span class="token comment">% uparrowä¼šè¾“å‡ºä¸€ä¸ªå‘ä¸ŠæŒ‡çš„ç®­å¤´</span>cell_string<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token string">'\fontsize&#123;16&#125;\fontname&#123;courier&#125;response'</span><span class="token punctuation">;</span><span class="token comment">%\fontname&#123;courier&#125;å°†å­—ä½“è®¾å®šä¸ºcourier</span>cell_string<span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token string">'\fontsize&#123;6&#125; '</span><span class="token punctuation">;</span>cell_string<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'\fontsize&#123;14&#125;\rmt_&#123;s&#125; = '</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">%\rmä¸ºæ­£ä½“,_&#123;s&#125;ä½¿sæˆä¸ºtçš„ä¸‹æ ‡</span><span class="token function">text</span><span class="token punctuation">(</span>ts<span class="token punctuation">,</span><span class="token number">0.85</span><span class="token punctuation">,</span>cell_string<span class="token punctuation">,</span><span class="token string">'Color'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'HorizontalAlignment'</span><span class="token punctuation">,</span><span class="token string">'Center'</span><span class="token punctuation">)</span><span class="token comment">%HorizontalAlignmentä½¿å››ä¸ªèƒå…ƒä¸­çš„å†…å®¹ç«–ç›´å±…ä¸­å¯¹é½</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'\fontsize&#123;14&#125; \it y = 1 - e^&#123; -\alpha t&#125;cos&#123;\omegat&#125;'</span><span class="token punctuation">)</span><span class="token comment">% \itæŒ‡æ–œä½“</span><span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token string">'\fontsize&#123;14&#125;\bft'</span><span class="token punctuation">)</span><span class="token comment">%\bfæŒ‡é»‘ä½“ï¼Œ\rightarrowåœ¨å­—ç¬¦tä¸Šé¢è¾“å‡ºä¸€ä¸ªå‘å³çš„ç®­å¤´ï¼Œå³å‘é‡t</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'\fontsize&#123;14&#125; \bfy'</span><span class="token punctuation">)</span></code></pre><ul><li>Figure 2</li></ul><p><img src="https://s2.loli.net/2022/02/23/A4t8qo5ePKSWMgn.png" alt="image-20220223201721698"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">close all<span class="token punctuation">;</span>clear<span class="token punctuation">;</span>clc <span class="token comment">% clear</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>y<span class="token operator">=</span>x<span class="token punctuation">;</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">meshgrid</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>Z<span class="token operator">=</span>X<span class="token operator">.^</span><span class="token number">2</span><span class="token operator">+</span>Y<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">surf</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">colormap</span><span class="token punctuation">(</span>summer<span class="token punctuation">)</span>shading interp<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>h <span class="token operator">=</span> <span class="token function">surf</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">set</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span><span class="token string">'FaceColor'</span><span class="token punctuation">,</span><span class="token string">'default'</span><span class="token punctuation">)</span><span class="token comment">%æ¢å¤é»˜è®¤åº•è‰²</span><span class="token function">rotate</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">%rotateçš„å››ä¸ªå‚æ•°ä¾æ¬¡ä¸ºï¼šå›¾å½¢å¯¹è±¡å¥æŸ„ï¼Œæ—‹è½¬è½´æ–¹å‘ï¼Œæ—‹è½¬è§’åº¦ï¼Œæ—‹è½¬è½´æ”¯ç‚¹</span></code></pre><ul><li>Figure 3</li></ul><p><img src="https://s2.loli.net/2022/02/23/9orujxYQX1A8k6L.png" alt="image-20220223201906174"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">close all<span class="token punctuation">;</span>clear<span class="token punctuation">;</span>clcr0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>shg<span class="token punctuation">;</span> <span class="token comment">%ä½¿å½“å‰å›¾çª—å¯è§å¹¶ä½¿å…¶ä½äºå±å¹•ä¸Šæ‰€æœ‰å…¶ä»–å›¾çª—ä¸Šæ–¹</span>a <span class="token operator">=</span> <span class="token number">12</span><span class="token operator">*</span>r0<span class="token punctuation">;</span>b<span class="token operator">=</span><span class="token number">9</span><span class="token operator">*</span>r0<span class="token punctuation">;</span>T0 <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">;</span>T <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">*</span>T0<span class="token punctuation">;</span>dt <span class="token operator">=</span> <span class="token keyword">pi</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>t <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">:</span>dt<span class="token operator">:</span>T<span class="token punctuation">]</span><span class="token operator">'</span><span class="token punctuation">;</span>f <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>a<span class="token operator">^</span><span class="token number">2</span><span class="token operator">-</span>b<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>th <span class="token operator">=</span> <span class="token number">12.5</span> <span class="token operator">*</span> <span class="token keyword">pi</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>E <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>t<span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>x <span class="token operator">=</span> E<span class="token operator">.*</span><span class="token punctuation">(</span>a<span class="token operator">*</span><span class="token function">cos</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token operator">-</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>y <span class="token operator">=</span> E<span class="token operator">.*</span><span class="token punctuation">(</span>b<span class="token operator">*</span><span class="token function">cos</span><span class="token punctuation">(</span>th<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>z<span class="token operator">=</span>E<span class="token operator">.*</span><span class="token punctuation">(</span>b<span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>th<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">plot3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">)</span> <span class="token comment">%ç”»å‡ºç»¿è‰²çš„å…¨ç¨‹è½¨è¿¹çº¿</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sphere</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%[X,Y,Z] = sphere(n) è¿”å›åŠå¾„ç­‰äº 1 ä¸”åŒ…å« nÃ—n ä¸ªé¢çš„çƒé¢çš„ xã€y å’Œ z åæ ‡ã€‚</span><span class="token comment">% è¯¥å‡½æ•°ä»¥ä¸‰ä¸ª (n+1)Ã—(n+1) çŸ©é˜µå½¢å¼è¿”å› xã€y å’Œ z åæ ‡ã€‚</span>X <span class="token operator">=</span> r0<span class="token operator">*</span>X<span class="token punctuation">;</span>Y<span class="token operator">=</span>r0<span class="token operator">*</span>Y<span class="token punctuation">;</span>Z<span class="token operator">=</span>r0<span class="token operator">*</span>Z<span class="token punctuation">;</span>grid on<span class="token punctuation">;</span>hold on<span class="token function">surf</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">)</span>shading interpx1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">18</span><span class="token operator">*</span>r0<span class="token punctuation">;</span>x2 <span class="token operator">=</span> <span class="token number">6</span><span class="token operator">*</span>r0<span class="token punctuation">;</span>y1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">12</span><span class="token operator">*</span>r0<span class="token punctuation">;</span>y2 <span class="token operator">=</span> <span class="token number">12</span><span class="token operator">*</span>r0<span class="token punctuation">;</span>z1<span class="token operator">=</span><span class="token operator">-</span><span class="token number">6</span><span class="token operator">*</span>r0<span class="token punctuation">;</span>z2 <span class="token operator">=</span> <span class="token number">6</span><span class="token operator">*</span>r0<span class="token punctuation">;</span><span class="token function">axis</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x1 x2 y1 y2 z1 y2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">%è®¾å®šåæ ‡è½´èŒƒå›´</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">133</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token function">comet3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token number">0.02</span><span class="token punctuation">)</span></code></pre><ul><li>Figure 4</li></ul><p><img src="https://s2.loli.net/2022/02/23/zmnwPsQS8BGLyZj.png" alt="image-20220223201920255"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">close all<span class="token punctuation">;</span>clear<span class="token punctuation">;</span>clcfunx <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span> u<span class="token operator">.*</span><span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%å®šä¹‰å‡½æ•°å¥æŸ„</span>funy <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token operator">-</span>u<span class="token operator">.*</span><span class="token function">cos</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>funz <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span> v<span class="token punctuation">;</span><span class="token function">fsurf</span><span class="token punctuation">(</span>funx<span class="token punctuation">,</span>funy<span class="token punctuation">,</span>funz<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span> <span class="token number">5</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'--'</span><span class="token punctuation">,</span><span class="token string">'EdgeColor'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token comment">%fsurfçš„å‰ä¸‰ä¸ªå‚æ•°æ˜¯å‡½æ•°å¥æŸ„ï¼Œåé¢çš„çŸ©é˜µæ˜¯xï¼Œyçš„èŒƒå›´</span>hold onC <span class="token operator">=</span> summer<span class="token punctuation">;</span><span class="token comment">%summeræ˜¯ä¸€ä¸ªè‰²å›¾çŸ©é˜µ</span>CC <span class="token operator">=</span> <span class="token punctuation">[</span>C<span class="token punctuation">;</span><span class="token function">flipud</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">%flipudå®ç°çŸ©é˜µçš„ä¸Šä¸‹ç¿»è½¬ï¼Œä½¿CCé€æ¸å˜åŒ–</span><span class="token function">colormap</span><span class="token punctuation">(</span>CC<span class="token punctuation">)</span><span class="token function">spinmap</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">%è‰²å½©å˜æ¢30ç§’ï¼Œæ¯æ¬¡å˜æ¢4è¡Œ</span></code></pre><ul><li>Figure 5</li></ul><p><img src="https://s2.loli.net/2022/02/23/r7CYPdntKq2cVXW.png" alt="image-20220223202353901"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">close all<span class="token punctuation">;</span>clearfigureZ <span class="token operator">=</span> peaks<span class="token punctuation">;</span><span class="token function">surf</span><span class="token punctuation">(</span>Z<span class="token punctuation">)</span>axis tight manualax <span class="token operator">=</span> gca<span class="token punctuation">;</span>ax<span class="token punctuation">.</span>NextPlot <span class="token operator">=</span> <span class="token string">'replaceChildren'</span><span class="token punctuation">;</span>loops <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span><span class="token function">F</span><span class="token punctuation">(</span>loops<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'cdata'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'colormap'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token number">j</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>loopsX <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">*</span>Z<span class="token punctuation">;</span><span class="token function">surf</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Z<span class="token punctuation">)</span>drawnow<span class="token function">F</span><span class="token punctuation">(</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">=</span> getframe<span class="token punctuation">;</span><span class="token comment">%é€šè¿‡getframeï¼Œå°†æ¯ä¸€å¸§å½±ç‰‡å­˜å…¥Fä¸­</span><span class="token keyword">end</span><span class="token function">movie</span><span class="token punctuation">(</span>F<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment">%æ’­æ”¾ä¸¤æ¬¡ï¼Œæ¯ç§’5å¸§</span></code></pre><ul><li>Figure 6</li></ul><p><img src="https://s2.loli.net/2022/02/23/mHK6z9wO7dt2kgM.png" alt="image-20220223202418814"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">close all<span class="token punctuation">;</span>clear<span class="token punctuation">;</span>K<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">%å¾ªç¯æ¬¡æ•°</span><span class="token comment">%ç»˜åˆ¶è½¨è¿¹æ›²çº¿</span>t1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token keyword">pi</span><span class="token punctuation">;</span>x1 <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>y1<span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>z1 <span class="token operator">=</span> <span class="token operator">-</span>t1<span class="token punctuation">;</span>t2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span>x2 <span class="token operator">=</span> <span class="token function">x1</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>y2 <span class="token operator">=</span> <span class="token function">y1</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span>z2 <span class="token operator">=</span> <span class="token function">x1</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>t3 <span class="token operator">=</span> t2<span class="token punctuation">;</span> z3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>t3<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">z1</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>x3 <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>z3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>y3 <span class="token operator">=</span> x3<span class="token punctuation">;</span>t4 <span class="token operator">=</span> t2<span class="token punctuation">;</span>x4 <span class="token operator">=</span> t4<span class="token punctuation">;</span>y4 <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>x4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>z4 <span class="token operator">=</span> y4<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token punctuation">[</span>x1 x2 x3 x4<span class="token punctuation">]</span><span class="token punctuation">;</span>n <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>y <span class="token operator">=</span> <span class="token punctuation">[</span>y1 y2 y3 y4<span class="token punctuation">]</span><span class="token punctuation">;</span> z <span class="token operator">=</span> <span class="token punctuation">[</span>z1 z2 z3 z4<span class="token punctuation">]</span><span class="token punctuation">;</span>shg<span class="token function">plot3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token string">'Color'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.6</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'LineWidth'</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span>axis off<span class="token comment">%åœ¨å›¾ä¸­æ·»åŠ è¿åŠ¨çš„ç‚¹</span>h1 <span class="token operator">=</span> <span class="token function">line</span><span class="token punctuation">(</span><span class="token string">'xdata'</span><span class="token punctuation">,</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'ydata'</span><span class="token punctuation">,</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'zdata'</span><span class="token punctuation">,</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'Color'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'Marker'</span><span class="token punctuation">,</span><span class="token string">'. '</span><span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token string">'MarkerSize'</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>h2 <span class="token operator">=</span> <span class="token function">line</span><span class="token punctuation">(</span><span class="token string">'xdata'</span><span class="token punctuation">,</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'ydata'</span><span class="token punctuation">,</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'zdata'</span><span class="token punctuation">,</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'Color'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">,</span><span class="token string">'Marker'</span><span class="token punctuation">,</span><span class="token string">'. '</span><span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token string">'MarkerSize'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>KK <span class="token operator">=</span> K <span class="token operator">*</span> n<span class="token punctuation">;</span>KK <span class="token operator">=</span> KK <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>htext <span class="token operator">=</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token function">int2str</span><span class="token punctuation">(</span>KK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">i</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token number">j</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token comment">%æ›´æ–°ç‚¹çš„åæ ‡</span><span class="token function">set</span><span class="token punctuation">(</span>h1<span class="token punctuation">,</span><span class="token string">'xdata'</span><span class="token punctuation">,</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'ydata'</span><span class="token punctuation">,</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'zdata'</span><span class="token punctuation">,</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">set</span><span class="token punctuation">(</span>h2<span class="token punctuation">,</span><span class="token string">'xdata'</span><span class="token punctuation">,</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'ydata'</span><span class="token punctuation">,</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'zdata'</span><span class="token punctuation">,</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>drawnow<span class="token punctuation">;</span> <span class="token comment">% æ“¦é™¤åŸå…ˆçš„ç‚¹</span><span class="token keyword">pause</span><span class="token punctuation">(</span><span class="token number">0.0005</span><span class="token punctuation">)</span> <span class="token comment">%æ§åˆ¶é€Ÿåº¦ï¼Œå•ä½ä¸ºç§’</span><span class="token number">i</span> <span class="token operator">=</span> <span class="token number">i</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>KK <span class="token operator">=</span> KK <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">set</span><span class="token punctuation">(</span>htext<span class="token punctuation">,</span><span class="token string">'string'</span><span class="token punctuation">,</span><span class="token function">int2str</span><span class="token punctuation">(</span>KK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token number">i</span> <span class="token operator">></span> n<span class="token number">i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">j</span> <span class="token operator">=</span> <span class="token number">j</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token number">j</span> <span class="token operator">></span> K<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">end</span></code></pre><ul><li>Figure 7</li></ul><p><img src="https://s2.loli.net/2022/02/23/ieT4kdpzSZMAQUh.png" alt="image-20220223202526276"></p><p><img src="https://s2.loli.net/2022/02/23/JPSUKeWrMqjETu2.png" alt="image-20220223202623717"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">close all<span class="token punctuation">;</span>clear<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token function">randn</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>h1 <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">disp</span><span class="token punctuation">(</span>h1<span class="token punctuation">.</span>NumBins<span class="token punctuation">)</span> <span class="token comment">%è®¡ç®—ç›´æ–¹å›¾çš„ bin æ•°é‡</span>nbins <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span> <span class="token comment">%æŒ‡å®šnbinsæ•°é‡</span>hold onh2 <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>nbins<span class="token punctuation">)</span><span class="token punctuation">;</span>counts <span class="token operator">=</span> h2<span class="token punctuation">.</span>Values <span class="token punctuation">;</span><span class="token comment">%ç»Ÿè®¡æ¯ä¸ªbinä¸­çš„æ ·æœ¬ç‚¹æ•°é‡</span>h2<span class="token punctuation">.</span>NumBins <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span> <span class="token comment">%ä¿®æ”¹binæ•°é‡</span>edges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span> <span class="token operator">-</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">0.25</span><span class="token operator">:</span><span class="token number">2</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">%é€šè¿‡å‘é‡æŒ‡å®šbinsçš„èŒƒå›´</span>h1<span class="token punctuation">.</span>Normalization <span class="token operator">=</span> <span class="token string">'probability'</span><span class="token punctuation">;</span><span class="token comment">%é€šè¿‡è¯¥å½’ä¸€åŒ–ï¼Œæ¯ä¸ªæ¡å½¢çš„é«˜åº¦ç­‰äºåœ¨è¯¥ bin é—´éš”å†…é€‰æ‹©è§‚æµ‹å€¼çš„æ¦‚ç‡ï¼Œå¹¶ä¸”æ‰€æœ‰æ¡å½¢çš„é«˜åº¦æ€»å’Œä¸º 1ã€‚</span>h2<span class="token punctuation">.</span>Normalization <span class="token operator">=</span> <span class="token string">'probability'</span>hold offh3 <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>edges<span class="token punctuation">)</span><span class="token punctuation">;</span>h3<span class="token punctuation">.</span>Normalization <span class="token operator">=</span> <span class="token string">'countdensity'</span> <span class="token comment">%å°† Normalization å±æ€§æŒ‡å®šä¸º 'countdensity' ä»¥ä½¿åŒ…å«ç¦»ç¾¤å€¼çš„ bin æ‰å¹³åŒ–ã€‚</span><span class="token comment">%ç°åœ¨ï¼Œæ¯ä¸ª bin çš„åŒºåŸŸï¼ˆè€Œä¸æ˜¯é«˜åº¦ï¼‰è¡¨ç¤ºè¯¥ bin çš„è§‚æµ‹å€¼é¢‘ç‡ã€‚</span>h4 <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'Normalization'</span><span class="token punctuation">,</span><span class="token string">'probability'</span><span class="token punctuation">)</span><span class="token comment">%é€šè¿‡è¯¥å½’ä¸€åŒ–ï¼Œæ¯ä¸ªæ¡å½¢çš„é«˜åº¦ç­‰äºåœ¨è¯¥ bin é—´éš”å†…é€‰æ‹©è§‚æµ‹å€¼çš„æ¦‚ç‡ï¼Œå¹¶ä¸”æ‰€æœ‰æ¡å½¢çš„é«˜åº¦æ€»å’Œä¸º 1ã€‚</span></code></pre><ul><li>Figure 8</li></ul><p><img src="https://s2.loli.net/2022/02/23/uexpWydln8NKMsc.png" alt="image-20220223202642481"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>close all<span class="token punctuation">;</span>clcA <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token keyword">NaN</span> <span class="token keyword">NaN</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">%åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºæŠ•ç¥¨çš„åˆ†ç±»å‘é‡ã€‚è¯¥å‘é‡ä¸­çš„ç±»åˆ«æ˜¯ 'yes'ã€'no' æˆ– 'undecided'ã€‚</span>C <span class="token operator">=</span> <span class="token function">categorical</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">0</span> <span class="token keyword">NaN</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'yes'</span><span class="token punctuation">,</span><span class="token string">'no'</span><span class="token punctuation">,</span><span class="token string">'undecided'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%å°†1,0ï¼ŒNaNåˆ†åˆ«æŒ‡å®šä¸ºyes,no,undecided</span>h <span class="token operator">=</span> <span class="token function">histogram</span><span class="token punctuation">(</span>C<span class="token punctuation">,</span><span class="token string">'BarWidth'</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token comment">%ä½¿ç”¨ç›¸å¯¹æ¡å½¢å®½åº¦ 0.5 ç»˜åˆ¶æŠ•ç¥¨çš„åˆ†ç±»ç›´æ–¹å›¾</span></code></pre><ul><li>Figure 9</li></ul><p><img src="https://s2.loli.net/2022/02/23/kF1nWm4BNpidfvX.png" alt="image-20220223202811936"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>close all<span class="token punctuation">;</span>clcx <span class="token operator">=</span> <span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%åˆ›å»º x ä¸º 0 å’Œ 3Ï€ ä¹‹é—´çš„ 200 ä¸ªç­‰é—´è·å€¼</span>y <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%åˆ›å»º y ä¸ºå¸¦éšæœºå¹²æ‰°çš„ä½™å¼¦å€¼ã€‚ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªæ•£ç‚¹å›¾</span>sz <span class="token operator">=</span> <span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%ä½¿ç”¨å¤§å°ä¸åŒçš„åœ†åœˆåˆ›å»ºä¸€ä¸ªæ•£ç‚¹å›¾</span>c <span class="token operator">=</span> <span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%æ”¹å˜åœ†åœˆçš„é¢œè‰²</span><span class="token function">scatter</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>sz<span class="token punctuation">,</span>c<span class="token punctuation">,</span><span class="token string">'filled'</span><span class="token punctuation">)</span></code></pre><p><img src="https://s2.loli.net/2022/02/23/cOJl7Ty3ZQ2BXak.png" alt="image-20220223202844412"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>close all<span class="token punctuation">;</span>clcx <span class="token operator">=</span> <span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>y <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">tiledlayout</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">%è°ƒç”¨ tiledlayout å‡½æ•°ä»¥åˆ›å»ºä¸€ä¸ª 2Ã—1 å¹³é“ºå›¾å¸ƒå±€</span>ax1 <span class="token operator">=</span> nexttile<span class="token punctuation">;</span><span class="token comment">%è°ƒç”¨ nexttile å‡½æ•°ä»¥åˆ›å»ºåæ ‡åŒºå¯¹è±¡ ax1 å’Œ ax2</span><span class="token function">scatter</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>ax2 <span class="token operator">=</span> nexttile<span class="token punctuation">;</span><span class="token function">scatter</span><span class="token punctuation">(</span>ax2<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">'filled'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">)</span></code></pre><ul><li>Figure 10</li></ul><p><img src="https://s2.loli.net/2022/02/23/9ewAUmLD7aSbcVB.png" alt="image-20220223202916077"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>close all<span class="token punctuation">;</span>clcx <span class="token operator">=</span> <span class="token function">linspace</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">)</span><span class="token punctuation">;</span>y <span class="token operator">=</span> <span class="token function">linspace</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">meshgrid</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>Z <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">cos</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>M<span class="token punctuation">,</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">contour</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">,</span><span class="token string">'ShowText'</span><span class="token punctuation">,</span><span class="token string">'on'</span><span class="token punctuation">)</span> <span class="token comment">%æœ‰æ–‡å­—æ ‡è¯†çš„ç­‰é«˜çº¿</span>c<span class="token punctuation">.</span>LineWidth <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">% æŒ‡å®šçº¿å®½ä¸º3</span></code></pre><ul><li>Figure 11</li></ul><p><img src="https://s2.loli.net/2022/02/23/XcaVhCu3BvFEHZQ.png" alt="image-20220223202935774"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">close all<span class="token punctuation">;</span> clear<span class="token punctuation">;</span>clc<span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">meshgrid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">.2</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Z <span class="token operator">=</span> X<span class="token operator">.*</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>X<span class="token operator">.^</span><span class="token number">2</span> <span class="token operator">-</span> Y<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>DX<span class="token punctuation">,</span>DY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">gradient</span><span class="token punctuation">(</span>Z<span class="token punctuation">,</span><span class="token number">.2</span><span class="token punctuation">,</span><span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%æ±‚æ¢¯åº¦</span>figure<span class="token function">contour</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>Z<span class="token punctuation">)</span>hold on<span class="token function">quiver</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>DX<span class="token punctuation">,</span>DY<span class="token punctuation">)</span></code></pre><ul><li>Figure 12</li></ul><p><img src="https://s2.loli.net/2022/02/23/aNT6eWK7FCISpqs.png" alt="image-20220223203003924"></p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>close all<span class="token punctuation">;</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">meshgrid</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>u <span class="token operator">=</span> x<span class="token punctuation">;</span>v <span class="token operator">=</span> <span class="token operator">-</span>y<span class="token punctuation">;</span>figure<span class="token function">quiver</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span>startx <span class="token operator">=</span> <span class="token number">0.1</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>starty <span class="token operator">=</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>startx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">streamline</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>u<span class="token punctuation">,</span>v<span class="token punctuation">,</span>startx<span class="token punctuation">,</span>starty<span class="token punctuation">)</span></code></pre><h2 id="HW01"><a href="#HW01" class="headerlink" title="HW01"></a>HW01</h2><p>ä¸è®²è§£ç¯‡å¤§ä½“ç›¸åŒï¼Œç•¥å»ã€‚</p><h2 id="HW02"><a href="#HW02" class="headerlink" title="HW02"></a>HW02</h2><ul><li>ç»“æ„ä½“æ•°ç»„çš„ä½¿ç”¨<ul><li>ä¸‹é¢ä¸¤ä¸ªæ•°ç»„ç»™å‡ºäº†å…ƒç´ å‘¨æœŸè¡¨å‰5ä¸ªå…ƒç´ çš„å…ƒç´ ç¬¦å·å’Œç›¸å¯¹åŸå­è´¨é‡ï¼Œå°†å…¶å’ŒåŸå­åºæ•°ä¸€èµ·ä¿å­˜åœ¨ç»“æ„ä½“æ•°ç»„elementä¸­ã€‚</li></ul></li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>symbol <span class="token operator">=</span> <span class="token punctuation">[</span>"H"<span class="token punctuation">,</span>"He"<span class="token punctuation">,</span>"Li"<span class="token punctuation">,</span>"Be"<span class="token punctuation">,</span>"B"<span class="token punctuation">]</span><span class="token punctuation">;</span>ar <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.008</span><span class="token punctuation">,</span><span class="token number">4.003</span><span class="token punctuation">,</span><span class="token number">6.941</span><span class="token punctuation">,</span><span class="token number">9.012</span><span class="token punctuation">,</span><span class="token number">10.81</span><span class="token punctuation">]</span><span class="token punctuation">;</span>atomic_number <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">;</span>symbol <span class="token operator">=</span> <span class="token function">num2cell</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>ar <span class="token operator">=</span> <span class="token function">num2cell</span><span class="token punctuation">(</span>ar<span class="token punctuation">)</span><span class="token punctuation">;</span>atomic_number <span class="token operator">=</span> <span class="token function">num2cell</span><span class="token punctuation">(</span>atomic_number<span class="token punctuation">)</span><span class="token punctuation">;</span>element <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span>"atomic_number"<span class="token punctuation">,</span>atomic_number<span class="token punctuation">,</span>"symbol"<span class="token punctuation">,</span>symbol<span class="token punctuation">,</span>"Ar"<span class="token punctuation">,</span>ar<span class="token punctuation">)</span></code></pre><ul><li>å¸¦å‚æ•°çš„åŒ¿åå‡½æ•°<ul><li>ä»¥åŒ¿åå‡½æ•°çš„æ–¹å¼å®ç°å¸¦å‚æ•°çš„å‡½æ•°ï¼Œå¹¶åœ¨åŒä¸€å¼ å›¾ä¸Šç”»å‡ºå‚æ•° <code>[b,c]=[0,0]</code> å’Œ <code>[b,c]=[2,1]</code> æ—¶ï¼Œè¯¥å‡½æ•°åœ¨ä¸Šçš„å›¾åƒã€‚</li></ul></li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>f0 <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> x<span class="token operator">.^</span><span class="token number">2</span> <span class="token operator">+</span> b<span class="token operator">.*</span>x <span class="token operator">+</span> c<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">0.01</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token function">f0</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>hold on<span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token function">f0</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="HW03"><a href="#HW03" class="headerlink" title="HW03"></a>HW03</h2><p>æ‘†äº† ä¸åšäº† å‘Šè¾</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li>2022 Winter MatPyFly åŸ¹è®­è®²ä¹‰</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤§æ¦‚è®°å½•çš„æ˜¯ MATLAB çš„ç»ƒä¹ ä¹‹è·¯ã€‚åæ­£ã€Šæ•°å€¼åˆ†æã€‹è¯¾ç¨‹ä¹Ÿå¾—ç”¨ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/MATLAB" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-MATLAB/"/>
    
    
    <category term="MATLAB" scheme="https://www.c7w.tech/tags/MATLAB/"/>
    
  </entry>
  
  <entry>
    <title>MATLAB ä»å…¥é—¨åˆ°æ”¾å¼ƒ</title>
    <link href="https://www.c7w.tech/matlab/"/>
    <id>https://www.c7w.tech/matlab/</id>
    <published>2022-02-22T15:39:05.000Z</published>
    <updated>2022-02-23T13:41:19.971Z</updated>
    
    <content type="html"><![CDATA[<p>å¤§æ¦‚è®°å½•çš„æ˜¯ MATLAB çš„å…¥é—¨ä¹‹è·¯ã€‚åæ­£ã€Šæ•°å€¼åˆ†æã€‹è¯¾ç¨‹ä¹Ÿå¾—ç”¨ã€‚</p><a id="more"></a><h1 id="æ•°æ®ç±»å‹ä¸åŸºæœ¬æ“ä½œ"><a href="#æ•°æ®ç±»å‹ä¸åŸºæœ¬æ“ä½œ" class="headerlink" title="æ•°æ®ç±»å‹ä¸åŸºæœ¬æ“ä½œ"></a>æ•°æ®ç±»å‹ä¸åŸºæœ¬æ“ä½œ</h1><h2 id="æ•°å€¼æ•°ç»„"><a href="#æ•°å€¼æ•°ç»„" class="headerlink" title="æ•°å€¼æ•°ç»„"></a>æ•°å€¼æ•°ç»„</h2><p>MATLAB ä¸­æ•°ç»„çš„å­˜å‚¨æ–¹å¼æ˜¯ column-major order. å› æ­¤ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªç»´åº¦æ˜¯åˆ—æ•°ã€‚</p><h3 id="æ•°ç»„çš„åˆ›å»º"><a href="#æ•°ç»„çš„åˆ›å»º" class="headerlink" title="æ•°ç»„çš„åˆ›å»º"></a>æ•°ç»„çš„åˆ›å»º</h3><h4 id="ç­‰è·æ•°ç»„"><a href="#ç­‰è·æ•°ç»„" class="headerlink" title="ç­‰è·æ•°ç»„"></a>ç­‰è·æ•°ç»„</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% Comment</span><span class="token comment">% åœ¨ä»£ç è¡Œçš„ååŠ åˆ†å·ï¼Œè¿è¡Œç»“æœä¸ä¼šæ˜¾ç¤ºåœ¨å‘½ä»¤è¡Œçª—å£ï¼›</span><span class="token comment">% ä¸åŠ åˆ†å·ï¼Œå˜é‡çš„å€¼ä¼šéšç€è¿è¡Œæ˜¾ç¤ºåœ¨å‘½ä»¤è¡Œçª—å£ã€‚ </span>start <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">% Variable assignment  </span>finish <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> <span class="token comment">% Closed this way</span>stride <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>a <span class="token operator">=</span> start<span class="token operator">:</span>stride<span class="token operator">:</span>finish <span class="token comment">% [1, 3, 5, 7, 9, 11]</span>b <span class="token operator">=</span> finish<span class="token operator">:</span><span class="token operator">-</span>stride<span class="token operator">:</span>start <span class="token comment">% [11, 9, 7, 5, 3, 1]</span>c <span class="token operator">=</span> start<span class="token operator">:</span>finish <span class="token comment">% The default value for stride is 1</span>xstart <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> xfinish <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> xpoints <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token function">linspace</span><span class="token punctuation">(</span>xstart<span class="token punctuation">,</span> xfinish<span class="token punctuation">,</span> xpoints<span class="token punctuation">)</span><span class="token comment">% [1, 25.75, 50.5, 75.25, 100]</span>ystart <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> yfinish <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> ypoints <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>y <span class="token operator">=</span> <span class="token function">logspace</span><span class="token punctuation">(</span>ystart<span class="token punctuation">,</span> yfinish<span class="token punctuation">,</span> ypoints<span class="token punctuation">)</span><span class="token comment">% [10, 100, 1000, 10000, 100000]</span></code></pre><h4 id="é€ä¸ªå…ƒç´ è¾“å…¥"><a href="#é€ä¸ªå…ƒç´ è¾“å…¥" class="headerlink" title="é€ä¸ªå…ƒç´ è¾“å…¥"></a>é€ä¸ªå…ƒç´ è¾“å…¥</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">% Shaped 1 x 4</span>b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">% Also shaped 1 x 4</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token comment">% Shaped 2 x 2</span><span class="token comment">% 1 2</span><span class="token comment">% 3 4</span></code></pre><h4 id="éšæœºæ•°äº§ç”Ÿ"><a href="#éšæœºæ•°äº§ç”Ÿ" class="headerlink" title="éšæœºæ•°äº§ç”Ÿ"></a>éšæœºæ•°äº§ç”Ÿ</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token function">rng</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% Random seed</span>a <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">% Uniformly distribution between 0 and 1, shaped 2 x 5</span>b <span class="token operator">=</span> <span class="token function">randn</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token comment">% Normal distribution, shaped 2 x 6</span>upperbound <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>lowerbound <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>c <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span>lowerbound<span class="token punctuation">,</span>upperbound<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">% Random Interger</span></code></pre><h4 id="å…¶ä»–åˆå§‹åŒ–"><a href="#å…¶ä»–åˆå§‹åŒ–" class="headerlink" title="å…¶ä»–åˆå§‹åŒ–"></a>å…¶ä»–åˆå§‹åŒ–</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token function">eye</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>d <span class="token operator">=</span> <span class="token function">diag</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">% Diagonal</span></code></pre><h3 id="å…ƒç´ çš„è®¿é—®å’Œå¯»æ‰¾"><a href="#å…ƒç´ çš„è®¿é—®å’Œå¯»æ‰¾" class="headerlink" title="å…ƒç´ çš„è®¿é—®å’Œå¯»æ‰¾"></a>å…ƒç´ çš„è®¿é—®å’Œå¯»æ‰¾</h3><h4 id="æ•°ç»„çš„ç»´åº¦å’Œå¤§å°"><a href="#æ•°ç»„çš„ç»´åº¦å’Œå¤§å°" class="headerlink" title="æ•°ç»„çš„ç»´åº¦å’Œå¤§å°"></a>æ•°ç»„çš„ç»´åº¦å’Œå¤§å°</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token function">rng</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% Seed 2</span>a <span class="token operator">=</span> <span class="token function">randn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>v <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">% [3, 4], shaped 1 x 2</span>v <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">% ans = 3, get the value of the 1st dim</span>v <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">% ans = 4</span></code></pre><h4 id="æ•°ç»„çš„å¾ªç§©è®¿é—®"><a href="#æ•°ç»„çš„å¾ªç§©è®¿é—®" class="headerlink" title="æ•°ç»„çš„å¾ªç§©è®¿é—®"></a>æ•°ç»„çš„å¾ªç§©è®¿é—®</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token function">rng</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">% namely a[2][3]</span>c <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">:</span><span class="token punctuation">)</span> <span class="token comment">% namely the second row of a</span>d <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>g <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">% NOTICE: column-major order!</span>idx <span class="token operator">=</span> <span class="token number">12</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span>h <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span> <span class="token comment">% Inversed order of a, shaped 1 x 12</span>k <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token comment">% [end] could be viewed as [-1] in Python</span>  <span class="token comment">% end-1, end-2, ... , are also supported</span></code></pre><h4 id="é€»è¾‘å¯»è®¿"><a href="#é€»è¾‘å¯»è®¿" class="headerlink" title="é€»è¾‘å¯»è®¿"></a>é€»è¾‘å¯»è®¿</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token function">rng</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>b <span class="token operator">=</span> a <span class="token operator">></span> <span class="token number">10</span> <span class="token comment">% Boolean, shaped 6 x 8</span><span class="token function">a</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">100</span> <span class="token comment">% Set all those greater than 10 to 100</span>c <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span> a <span class="token operator">></span> <span class="token number">50</span> <span class="token punctuation">)</span> <span class="token comment">% Column vector shaped k x 1, consisting the index of elements != 0</span><span class="token function">a</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">NaN</span></code></pre><h3 id="æ•°ç»„çš„æ‰©å……ã€æ”¶ç¼©ä¸é‡æ’"><a href="#æ•°ç»„çš„æ‰©å……ã€æ”¶ç¼©ä¸é‡æ’" class="headerlink" title="æ•°ç»„çš„æ‰©å……ã€æ”¶ç¼©ä¸é‡æ’"></a>æ•°ç»„çš„æ‰©å……ã€æ”¶ç¼©ä¸é‡æ’</h3><h4 id="æ‰©å……"><a href="#æ‰©å……" class="headerlink" title="æ‰©å……"></a>æ‰©å……</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">;</span> c <span class="token operator">=</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">;</span>a_b <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token comment">% 1 x 10</span>abc <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token punctuation">;</span> b<span class="token punctuation">;</span> c<span class="token punctuation">]</span> <span class="token comment">% 3 x 5</span>AB1 <span class="token operator">=</span> <span class="token function">repmat</span><span class="token punctuation">(</span>a_b<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">% 1 x 20</span>AB2 <span class="token operator">=</span> <span class="token function">repmat</span><span class="token punctuation">(</span>a_b<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">% 2 x 10</span></code></pre><h4 id="æ”¶ç¼©"><a href="#æ”¶ç¼©" class="headerlink" title="æ”¶ç¼©"></a>æ”¶ç¼©</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span>b <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>c <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre><h4 id="å˜å½¢"><a href="#å˜å½¢" class="headerlink" title="å˜å½¢"></a>å˜å½¢</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">24</span>b <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token comment">% 3 x 8, column major</span>c <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span>     <span class="token number">1</span>     <span class="token number">3</span>     <span class="token number">5</span>     <span class="token number">2</span>     <span class="token number">4</span>     <span class="token number">6</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span>     <span class="token number">7</span>     <span class="token number">9</span>    <span class="token number">11</span>     <span class="token number">8</span>    <span class="token number">10</span>    <span class="token number">12</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span>    <span class="token number">13</span>    <span class="token number">15</span>    <span class="token number">17</span>    <span class="token number">14</span>    <span class="token number">16</span>    <span class="token number">18</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">=</span>    <span class="token number">19</span>    <span class="token number">21</span>    <span class="token number">23</span>    <span class="token number">20</span>    <span class="token number">22</span>    <span class="token number">24</span>    </code></pre><h4 id="ç¿»è½¬"><a href="#ç¿»è½¬" class="headerlink" title="ç¿»è½¬"></a>ç¿»è½¬</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token function">flipud</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment">% å°†æ•°ç»„ä»ä¸Šå‘ä¸‹ç¿»è½¬</span>c <span class="token operator">=</span> <span class="token function">fliplr</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment">% å°†æ•°ç»„ä»å·¦å‘å³ç¿»è½¬</span>d <span class="token operator">=</span> <span class="token function">flipdim</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">% å°†æ•°ç»„æ²¿ç¬¬ä¸€ä¸ªç»´åº¦ç¿»è½¬</span>f <span class="token operator">=</span> <span class="token function">flipdim</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">% å°†æ•°ç»„æ²¿ç¬¬äºŒä¸ªç»´åº¦ç¿»è½¬</span>g <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span>h <span class="token operator">=</span> g<span class="token operator">'</span>             <span class="token comment">% è½¬ç½®</span></code></pre><h4 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token function">rot90</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>     <span class="token comment">% å°† a æ—‹è½¬ 90 åº¦</span>c <span class="token operator">=</span> <span class="token function">rot90</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token comment">%å°† a æ—‹è½¬ 180 åº¦</span><span class="token comment">% è¿˜æœ‰ rotx, roty, rotz, rot45 ç­‰å‡½æ•°å¯ä¾›æ¢ç´¢</span></code></pre><h4 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h4><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token function">rng</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token function">randn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>b<span class="token punctuation">,</span> idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>        <span class="token comment">% å¯¹ a çš„æ¯ä¸€åˆ—æŒ‰å‡åºæ’åºï¼Œidx ä¸ºç´¢å¼•ã€‚</span>c <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>             <span class="token comment">% å¯¹ a çš„æ¯ä¸€è¡ŒæŒ‰å‡åºæ’åº</span>d <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token string">'ascend'</span><span class="token punctuation">)</span>      <span class="token comment">% å¯¹ a çš„æ¯ä¸€åˆ—æŒ‰å‡åºæ’åº</span>f <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'descend'</span><span class="token punctuation">)</span>   <span class="token comment">% å¯¹ a çš„ç¬¬ 2 ä¸ªç»´åº¦æŒ‰é™åºæ’åº</span>g <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token string">'ComparisonMethod'</span><span class="token punctuation">,</span><span class="token string">'abs'</span><span class="token punctuation">)</span><span class="token comment">%è¿˜æœ‰ cat,circshift,horzcat,vercat,permute,ipermute,shiftdim,sortrows,squeeze ç­‰å‡½æ•°å¯ä¾›æ¢ç´¢</span></code></pre><h2 id="æ•°ç»„è¿ç®—"><a href="#æ•°ç»„è¿ç®—" class="headerlink" title="æ•°ç»„è¿ç®—"></a>æ•°ç»„è¿ç®—</h2><h3 id="å››åˆ™è¿ç®—"><a href="#å››åˆ™è¿ç®—" class="headerlink" title="å››åˆ™è¿ç®—"></a>å››åˆ™è¿ç®—</h3><p>MATLAB ä¸­çš„è¿ç®—éƒ½æ˜¯çŸ©é˜µä¸çŸ©é˜µçš„è¿ç®—ï¼Œæˆ–è€…æ ‡é‡ä¸çŸ©é˜µçš„è¿ç®—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æ»¡è¶³çŸ©é˜µè¿ç®—çš„è§„åˆ™ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% çŸ©é˜µè¿ç®—</span>a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>b <span class="token operator">=</span> a<span class="token operator">'</span>            <span class="token comment">%å…±è½­è½¬ç½®</span>c <span class="token operator">=</span> b<span class="token operator">*</span>a           <span class="token comment">%çŸ©é˜µä¹˜æ³•ï¼Œæ³¨æ„ç»´åº¦è¦ç¬¦åˆ</span>d <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>     f <span class="token operator">=</span> a<span class="token operator">/</span>d           <span class="token comment">%å¯¹dæ±‚é€†ï¼Œå†å·¦ä¹˜a</span>g <span class="token operator">=</span> d<span class="token operator">\</span>b           <span class="token comment">%å¯¹dæ±‚é€†ï¼Œå†å³ä¹˜b</span>h <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">*</span>a           <span class="token comment">%3æ˜¯æ ‡é‡ï¼Œä¸çŸ©é˜µaç›¸ä¹˜</span>k <span class="token operator">=</span> a<span class="token operator">/</span><span class="token number">3</span>           <span class="token comment">%çŸ©é˜µaé™¤ä»¥æ ‡é‡3</span>l <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">\</span>a           <span class="token comment">%å«ä¹‰åŒä¸Š</span>m <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">^</span>d           <span class="token comment">%4çš„dæ¬¡å¹‚</span>n <span class="token operator">=</span> d<span class="token operator">^</span><span class="token number">4</span>           <span class="token comment">%dçš„4æ¬¡å¹‚</span><span class="token comment">% Elementwise</span>a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>b <span class="token operator">=</span> a<span class="token operator">.'</span>             <span class="token comment">%éå…±è½­è½¬ç½®</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  d <span class="token operator">=</span> a<span class="token operator">.*</span>c            <span class="token comment">%æŒ‰å…ƒç´ ä¹˜ï¼Œè¦æ±‚çŸ©é˜µå½¢çŠ¶å®Œå…¨ç›¸åŒ</span>f <span class="token operator">=</span> c<span class="token operator">./</span>a            <span class="token comment">%æŒ‰å…ƒç´ é™¤ï¼Œcé™¤ä»¥a</span>g <span class="token operator">=</span> a<span class="token operator">.\</span>c            <span class="token comment">%æŒ‰å…ƒç´ é™¤ï¼Œaé™¤ä»¥c</span>h <span class="token operator">=</span> <span class="token number">4.</span><span class="token operator">^</span>a           l <span class="token operator">=</span> a<span class="token operator">.^</span><span class="token number">3</span>    </code></pre><p>ä¸Šæ–‡ç”¨åˆ°äº†å·¦é™¤ï¼ˆ\ï¼‰å’Œå³é™¤ï¼ˆ/ï¼‰ã€‚å·¦é™¤æ˜¯ MATLAB ä¸­ç‹¬æœ‰çš„ï¼Œå…¶é€Ÿåº¦ã€å‡†ç¡®åº¦éƒ½è¿œé«˜äºå³é™¤ã€‚æ­¤å¤–ï¼Œä½¿ç”¨çŸ©é˜µé™¤æ³•æ—¶åº”è¯¥æ³¨æ„ï¼Œå¯¹äºå¥‡å¼‚çŸ©é˜µæˆ–è¿‘ä¼¼äºå¥‡å¼‚çš„çŸ©é˜µï¼ŒMATLAB ä¼šç»™å‡ºè­¦å‘Šã€‚</p><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>MATLAB çš„æ•°æ®ç±»å‹åŒ…æ‹¬ <code>doubleï¼Œuint8ï¼Œuint16ï¼Œbooleanï¼Œcharï¼Œstr</code>ã€‚</p><p>å‰ 3 ç§çš„è½¬æ¢å‡½æ•°åˆ†åˆ«ä¸º <code>double(),uint8(),uint16()</code>ã€‚<br>char æ˜¯å­—ç¬¦ï¼Œchar(x) ä¼šå°† x æŒ‰ ASCII å€¼è½¬å˜æˆç›¸åº”çš„å­—ç¬¦ã€‚str æ˜¯å­—ç¬¦ä¸²ï¼Œè¢«çœ‹åšä¸€ä¸ªè¡Œå‘é‡ã€‚å…·ä½“ç¤ºä¾‹è§å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚</p><p>MATLAB ä¸­è¿˜æœ‰ä¸€äº›ä¿ç•™å…³é”®å­—ï¼Œåˆ—ä¸¾å¦‚ä¸‹ï¼š</p><ul><li>epsï¼šæµ®ç‚¹æ•°ç›¸å¯¹ç²¾åº¦</li><li>i æˆ– jï¼šå¤æ•°å•ä½</li><li>inf æˆ– Infï¼šæ— ç©·å¤§</li><li>intmaxï¼šæœ€å¤§æ­£æ•´æ•°</li><li>intminï¼šæœ€å°è´Ÿæ•´æ•°</li><li>NaN æˆ– nanï¼šéæ•°ã€‚æ³¨æ„ï¼Œä¸èƒ½ç”¨ a==nan åˆ¤æ–­ a æ˜¯å¦ä¸º nanã€‚</li><li>piï¼šÏ€</li><li>realmaxï¼šæœ€å¤§æ­£å®æ•°</li><li>realminï¼šæœ€å°æ­£å®æ•°</li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% Complex numbers</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">2j</span>a_real <span class="token operator">=</span> <span class="token function">real</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment">%açš„å®éƒ¨</span>a_imag <span class="token operator">=</span> <span class="token function">imag</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment">%açš„è™šéƒ¨</span>b <span class="token operator">=</span> <span class="token function">conj</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>         <span class="token comment">%bæ˜¯açš„å…±è½­</span>b_abs <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>      <span class="token comment">%bçš„æ¨¡é•¿</span>b_angle <span class="token operator">=</span> <span class="token function">angle</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>  <span class="token comment">%bçš„è¾…è§’</span><span class="token comment">% NaN</span><span class="token function">rng</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">a</span><span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">NaN</span><span class="token punctuation">;</span>idx1 <span class="token operator">=</span> <span class="token function">isnan</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">% a==NaN ä¸èƒ½æ­£ç¡®åˆ¤åˆ« NaN</span><span class="token comment">% ä¸åŒè¿›åˆ¶çš„è½¬åŒ–</span><span class="token comment">% MATLAB æ”¯æŒ 2 è¿›åˆ¶ï¼ˆbinï¼‰ï¼Œ8 è¿›åˆ¶(oct)ï¼Œ10 è¿›åˆ¶(dec)å’Œ 16 è¿›åˆ¶(hex)</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token function">dec2bin</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token function">bin2dec</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></code></pre><h3 id="ç‰¹æ®Šè¿ç®—"><a href="#ç‰¹æ®Šè¿ç®—" class="headerlink" title="ç‰¹æ®Šè¿ç®—"></a>ç‰¹æ®Šè¿ç®—</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% å’Œä¸ç§¯</span>a <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token function">cumsum</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>            <span class="token comment">%æ²¿ a çš„ç¬¬ä¸€ä¸ª length ä¸ä¸º 1 çš„ç»´åº¦æ±‚ç´¯ç§¯å’Œ</span>c <span class="token operator">=</span> <span class="token function">cumsum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>          <span class="token comment">%æ²¿açš„ç¬¬äºŒä¸ªç»´åº¦æ±‚ç´¯ç§¯å’Œ</span>d <span class="token operator">=</span> <span class="token function">cumsum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token string">'reverse'</span><span class="token punctuation">)</span>  <span class="token comment">%æ²¿açš„ç¬¬ä¸€ä¸ªä¸ä¸º1çš„ç»´åº¦ï¼Œåå‘æ±‚ç´¯ç§¯å’Œ</span>f <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>               <span class="token comment">%æ²¿açš„ç¬¬ä¸€ä¸ªä¸ä¸º1çš„ç»´åº¦æ±‚å’Œï¼Œå…¶ä»–ç”¨æ³•åŒcumsum</span>g <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token string">'all'</span><span class="token punctuation">)</span>         <span class="token comment">%å¯¹açš„æ‰€æœ‰å…ƒç´ æ±‚å’Œ</span>s3 <span class="token operator">=</span> <span class="token function">cumprod</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>          <span class="token comment">%ç´¯ç§¯ç§¯ï¼Œç”¨æ³•åŒä¸Š</span>s4 <span class="token operator">=</span> <span class="token function">prod</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>             <span class="token comment">%æ±‚ç§¯ï¼Œç”¨æ³•åŒä¸Š</span><span class="token comment">% æœ€å¤§å€¼</span><span class="token function">rng</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>                    <span class="token comment">%æ²¿açš„ç¬¬ä¸€ä¸ªä¸ä¸º1çš„ç»´åº¦è®¡ç®—</span>c <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>               <span class="token comment">%æ²¿açš„ç¬¬äºŒä¸ªç»´åº¦è®¡ç®—</span><span class="token punctuation">[</span>d<span class="token punctuation">,</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>              <span class="token comment">%idxæ˜¯æ¯ä¸ªæœ€å¤§å€¼çš„ä½ç½®</span>f <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'all'</span><span class="token punctuation">)</span>           <span class="token comment">%åœ¨açš„æ‰€æœ‰å…ƒç´ ä¸­æ‰¾æœ€å¤§å€¼</span>g <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>           <span class="token comment">%åœ¨açš„ç¬¬1ä¸ªå’Œç¬¬3ä¸ªç»´åº¦ä¸­æ±‚æœ€å¤§å€¼</span><span class="token punctuation">[</span>h<span class="token punctuation">,</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'linear'</span><span class="token punctuation">)</span>  <span class="token comment">%idxæ˜¯æœ€å¤§å€¼çš„çº¿æ€§ç´¢å¼•</span>k <span class="token operator">=</span> <span class="token function">randi</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>              l <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>k<span class="token punctuation">)</span>                  <span class="token comment">%æ±‚aï¼Œkä¸­çš„æœ€å¤§å€¼</span><span class="token comment">% é€»è¾‘æ“ä½œ</span>a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>L1 <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">%æŒ‰ä½å–é</span>L2 <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>a<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">%ä¸</span>L3 <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>a<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">%ä¸,ç¬¬ä¸€é¡¹ä¸ºfalseæ—¶ï¼Œä¸å†è®¡ç®—ç¬¬äºŒé¡¹</span>L4 <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">%æˆ–</span>L5 <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">%æˆ–ï¼Œç¬¬ä¸€é¡¹ä¸ºtrueæ—¶ï¼Œä¸å†è®¡ç®—ç¬¬äºŒé¡¹</span>b<span class="token operator">=</span>a<span class="token punctuation">;</span>c <span class="token operator">=</span> <span class="token function">xor</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">%å¼‚æˆ–</span>d <span class="token operator">=</span> <span class="token function">all</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">%aä¸­å…ƒç´ å…¨ä¸ä¸º0æ—¶ï¼Œdä¸ºçœŸ</span>e <span class="token operator">=</span> <span class="token function">any</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">%aä¸­å…ƒç´ è‡³å°‘æœ‰ä¸€ä¸ªé0æ—¶ï¼Œeä¸ºçœŸ</span>idx <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>f <span class="token operator">=</span> <span class="token function">isempty</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">%æ£€æŸ¥idxæ˜¯å¦ä¸ºç©ºçŸ©é˜µ</span><span class="token comment">% MATLABè¿˜å¯ä»¥è®¡ç®—çŸ©é˜µçš„ç‰¹å¾å€¼ï¼Œå¯¹çŸ©é˜µåšå¥‡å¼‚å€¼åˆ†è§£ã€QRåˆ†è§£ç­‰ã€‚</span></code></pre><h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><pre class="language-matlab" data-language="matlab"><code class="language-matlab">a <span class="token operator">=</span> <span class="token string">'Three-six-nine, hon, the goose drank wine.'</span><span class="token punctuation">;</span><span class="token comment">%å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰å•å¼•å·ï¼Œç”¨ä¸¤ä¸ªè¿ç»­çš„å•å¼•å·è¡¨ç¤ºã€‚</span>b <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>     <span class="token comment">%å¯ä»¥çœ‹å‡ºï¼ŒMATLABå°†å­—ç¬¦ä¸²æ•°ç»„è§†ä¸ºè¡ŒçŸ©é˜µ</span>a <span class="token operator">=</span> <span class="token string">'May you long day and pleasant nights.'</span><span class="token punctuation">;</span>a14 <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>       <span class="token comment">%å–å‡ºå­—ç¬¦ä¸²æ•°ç»„çš„å‰4ä¸ªå…ƒç´    </span>ra <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment">%ç¿»è½¬å­—ç¬¦ä¸²æ•°ç»„</span>a <span class="token operator">=</span> <span class="token string">'May you have twice the number.'</span><span class="token punctuation">;</span>Ua <span class="token operator">=</span> <span class="token function">double</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>          <span class="token comment">%æŸ¥çœ‹açš„ASCIIç å€¼</span>c <span class="token operator">=</span> <span class="token function">char</span><span class="token punctuation">(</span>Ua<span class="token punctuation">)</span>            <span class="token comment">%å°†ASCIIè½¬åŒ–å›å­—ç¬¦ä¸²</span>w <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>a<span class="token operator">>=</span><span class="token string">'a'</span><span class="token operator">&amp;</span>a<span class="token operator">&lt;=</span><span class="token string">'z'</span><span class="token punctuation">)</span> <span class="token comment">%æ‰¾å‡ºæ‰€æœ‰çš„å°å†™å­—æ¯</span><span class="token function">Ua</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">Ua</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">32</span>       <span class="token comment">%å°†å°å†™å­—æ¯å˜ä¸ºå¤§å†™å­—æ¯</span>d <span class="token operator">=</span> <span class="token function">char</span><span class="token punctuation">(</span>Ua<span class="token punctuation">)</span>            <span class="token comment">%å°†ASCIIè½¬åŒ–å›å­—ç¬¦ä¸²</span></code></pre><h2 id="æ§åˆ¶æµè¯­å¥"><a href="#æ§åˆ¶æµè¯­å¥" class="headerlink" title="æ§åˆ¶æµè¯­å¥"></a>æ§åˆ¶æµè¯­å¥</h2><p>MATLAB å¾ˆé€‚å®œå‘é‡åŒ–ç¼–ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–å†™ MATLAB ç¨‹åºçš„æ—¶å€™è¦å°½é‡ç”¨çŸ©é˜µå’Œæ•°ç»„ä»£æ›¿å¾ªç¯ï¼Œå°¤å…¶æ˜¯ 2 å±‚åŠä»¥ä¸Šçš„å¾ªç¯ã€‚</p><p>åœ¨ MATLAB ä¸­ï¼ŒäºŒç»´çŸ©é˜µçš„è¿ç®—é€Ÿåº¦è¦è¿œå¿«äº 2 å±‚å¾ªç¯ã€‚å› æ­¤ï¼Œæœ¬èŠ‚ä»‹ç»çš„æ‰€æœ‰æ•°æ®æµæ§åˆ¶è¯­å¥éƒ½è¦å°½é‡å°‘ç”¨ï¼Œé™¤éä¸‡ä¸å¾—å·²ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% if/else/elseif</span>a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">if</span> a<span class="token operator">&lt;</span><span class="token number">0</span>    a <span class="token operator">=</span> <span class="token operator">-</span>a<span class="token punctuation">;</span><span class="token keyword">elseif</span> a<span class="token operator">></span><span class="token number">10</span>    a <span class="token operator">=</span> a<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">else</span>     a <span class="token operator">=</span> a<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">% while</span>sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">while</span> sum <span class="token operator">&lt;</span> <span class="token number">10</span>    sum <span class="token operator">=</span> sum <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">% for</span>sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span>    sum <span class="token operator">=</span> sum <span class="token operator">+</span> ii<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">% switch</span>a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">switch</span> a    <span class="token keyword">case</span> <span class="token number">1</span>        a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">3</span>        a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">otherwise</span>        a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">% try/catch</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">try</span>     b <span class="token operator">=</span> a<span class="token operator">*</span>a<span class="token punctuation">;</span><span class="token keyword">catch</span> ME    b <span class="token operator">=</span> a<span class="token operator">.*</span>a<span class="token punctuation">;</span><span class="token keyword">end</span></code></pre><h2 id="å®ç”¨æŠ€å·§"><a href="#å®ç”¨æŠ€å·§" class="headerlink" title="å®ç”¨æŠ€å·§"></a>å®ç”¨æŠ€å·§</h2><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% è¯»å†™ mat æ–‡ä»¶</span>cleara <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> c <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>save file1<span class="token punctuation">;</span>                <span class="token comment">%æŠŠå·¥ä½œåŒºä¸­å…¨éƒ¨å˜é‡ä¿å­˜åˆ°åä¸ºfile1.matçš„æ–‡ä»¶ä¸­ã€‚</span>                           <span class="token comment">%å¦‚æœfile1.matåŸå…ˆå­˜åœ¨ï¼Œå®ƒçš„åŸå§‹å†…å®¹ä¼šè¢«åˆ é™¤ã€‚</span>save file2 a b<span class="token punctuation">;</span>            <span class="token comment">%æŠŠå˜é‡aå’Œbä¿å­˜åˆ°file2.matæ–‡ä»¶ä¸­ã€‚</span>save file2 c <span class="token operator">-</span>append       <span class="token comment">%æŠŠå˜é‡cæ·»åŠ åˆ°file2.matä¸­ï¼Œä¸ä¼šåˆ é™¤file2.matä¸­åŸæœ‰çš„å€¼</span>save file3 <span class="token operator">-</span>ascii          <span class="token comment">%æŠŠå˜é‡ä¿å­˜åˆ°8ä½asciiæ–‡ä»¶file3.matä¸­</span>save file4 <span class="token operator">-</span>ascii <span class="token operator">-</span>double  <span class="token comment">%æŠŠå˜é‡ä¿å­˜åˆ°16ä½asciiæ–‡ä»¶file4.matä¸­</span>clearload file1                 <span class="token comment">%æŠŠfile1.matä¸­çš„å…¨éƒ¨å˜é‡åŠ è½½åˆ°å·¥ä½œåŒº</span>clear                      load file1 a b             <span class="token comment">%æŠŠfile1.matä¸­çš„å˜é‡aå’ŒbåŠ è½½åˆ°å·¥ä½œåŒº</span>clearload file3 a <span class="token operator">-</span>ascii        <span class="token comment">%æŠŠasciiæ–‡ä»¶file3.matä¸­çš„å˜é‡aåŠ è½½åˆ°å·¥ä½œåŒº</span><span class="token comment">% ç§‘å­¦è®¡æ•°æ³•</span>a <span class="token operator">=</span> <span class="token number">1.4e3</span>                  <span class="token comment">%a=1400</span><span class="token comment">% è¾“å‡ºæ ¼å¼</span>a <span class="token operator">=</span> format                <span class="token comment">%è¿”å›å½“å‰çš„format</span>format long               <span class="token comment">%å°†è¾“å‡ºæ ¼å¼è®¾å®šä¸ºlong           </span>format short              <span class="token comment">%å°†è¾“å‡ºæ ¼å¼è®¾å®šä¸ºshort</span><span class="token comment">% formatçš„å‚æ•°æœ‰å¤šç§é€‰æ‹©ï¼Œå¯è‡ªè¡Œæ¢ç´¢</span><span class="token comment">% disp</span>name <span class="token operator">=</span> <span class="token string">'Jake'</span><span class="token punctuation">;</span>   chassit <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span>X <span class="token operator">=</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span><span class="token string">', son of Elm, ka-tet of '</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span>chassit<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">disp</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>name <span class="token operator">=</span> <span class="token string">'Edward'</span><span class="token punctuation">;</span>   chassit <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>X <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">'%s Cantor Dean, ka-tet of %d'</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>chassit<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">disp</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></code></pre><h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><h2 id="å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦ä¸²æ•°ç»„"><a href="#å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦ä¸²æ•°ç»„" class="headerlink" title="å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦ä¸²æ•°ç»„"></a>å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦ä¸²æ•°ç»„</h2><p>åœ¨ R2016b ç‰ˆæœ¬ä¹‹åï¼ŒMatlabå¼•å…¥äº†å­—ç¬¦ä¸²æ•°ç»„ stringã€‚åªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²æ•°ç»„ä¹Ÿå¯ç§°ä¸ºå­—ç¬¦ä¸²æ ‡é‡ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">%% åˆ›å»º</span>char_array <span class="token operator">=</span> <span class="token string">'THU EESAST'</span> <span class="token comment">% å­—ç¬¦æ•°ç»„</span>string_array <span class="token operator">=</span> "THU EESAST" <span class="token comment">% å­—ç¬¦ä¸²æ•°ç»„</span><span class="token comment">%% äº’ç›¸è½¬æ¢</span><span class="token comment">% å­—ç¬¦ä¸²æ•°ç»„ -> å­—ç¬¦æ•°ç»„</span>string_array2 <span class="token operator">=</span> "string to char"<span class="token function">strlength</span><span class="token punctuation">(</span>string_array2<span class="token punctuation">)</span> <span class="token comment">% 14</span>char_array2 <span class="token operator">=</span> <span class="token function">char</span><span class="token punctuation">(</span>string_array2<span class="token punctuation">)</span><span class="token function">size</span><span class="token punctuation">(</span>char_array2<span class="token punctuation">)</span> <span class="token comment">% [1, 14]</span><span class="token comment">% å­—ç¬¦ä¸²åˆ—å‘é‡ -> å­—ç¬¦æ•°ç»„</span>string_array3 <span class="token operator">=</span> <span class="token punctuation">[</span>"string1"<span class="token punctuation">;</span>"string2"<span class="token punctuation">;</span>"string3"<span class="token punctuation">]</span> <span class="token comment">% 3 x 1</span>char_array3 <span class="token operator">=</span> <span class="token function">char</span><span class="token punctuation">(</span>string_array3<span class="token punctuation">)</span><span class="token comment">% char_array3 =  % 3 x 7 char</span><span class="token comment">%     'string1'</span><span class="token comment">%     'string2'</span><span class="token comment">%     'string3'</span><span class="token comment">% å­—ç¬¦ä¸²è¡Œå‘é‡ -> å­—ç¬¦æ•°ç»„</span>string_array4 <span class="token operator">=</span> <span class="token punctuation">[</span>"string1"<span class="token punctuation">,</span>"string2"<span class="token punctuation">,</span>"string3"<span class="token punctuation">]</span>char_array4 <span class="token operator">=</span> <span class="token function">char</span><span class="token punctuation">(</span>string_array4<span class="token punctuation">)</span><span class="token comment">% 1 x 7 x 3 char, every page contains a "string\d"</span><span class="token comment">% å­—ç¬¦ä¸²çŸ©é˜µ -> å­—ç¬¦æ•°ç»„</span>string_array5 <span class="token operator">=</span> <span class="token punctuation">[</span>"string1"<span class="token punctuation">,</span>"string2"<span class="token punctuation">,</span>"string3"<span class="token punctuation">;</span>"string4"<span class="token punctuation">,</span>"string5"<span class="token punctuation">,</span>"string6"<span class="token punctuation">]</span>char_array5 <span class="token operator">=</span> <span class="token function">char</span><span class="token punctuation">(</span>string_array5<span class="token punctuation">)</span><span class="token comment">% 2 x 7 x 3 char, every page contains a column</span><span class="token comment">% å­—ç¬¦æ•°ç»„è¡Œå‘é‡ -> å­—ç¬¦ä¸²æ•°ç»„</span>char_array6 <span class="token operator">=</span> <span class="token string">'char'</span> <span class="token comment">% å®Œå…¨ç­‰ä»·äº char_array6 = ['c','h','a','r']</span>string_array6 <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>char_array6<span class="token punctuation">)</span> <span class="token comment">% "char"</span><span class="token comment">% å­—ç¬¦æ•°ç»„åˆ—å‘é‡ -> å­—ç¬¦ä¸²æ•°ç»„</span>char_array7 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">;</span><span class="token string">'b'</span><span class="token punctuation">;</span><span class="token string">'c'</span><span class="token punctuation">;</span><span class="token string">'d'</span><span class="token punctuation">]</span>string_array7 <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>char_array7<span class="token punctuation">)</span> <span class="token comment">% 4 x 1 string</span><span class="token comment">%% ä¸¤è€…çš„è¡Œä¸ºåŒºåˆ«</span><span class="token comment">% å‡å»ä¸€ä¸ªå­—ç¬¦</span>char_array8 <span class="token operator">=</span> <span class="token string">'abcdefg'</span><span class="token punctuation">;</span>string_array8 <span class="token operator">=</span> "abcdefg"<span class="token punctuation">;</span>char_array8 <span class="token operator">-</span> <span class="token string">'a'</span>char_array8 <span class="token operator">-</span> <span class="token number">97</span><span class="token comment">% å¯ä»¥é€æ¡å°è¯•æ‰§è¡Œä¸‹é¢å‡ è¡Œä»£ç </span><span class="token comment">% char_array8 - "a"  </span><span class="token comment">% string_array8 - 'a'</span><span class="token comment">% string_array8 - "a"</span><span class="token comment">% string_array8 - 97 % string ç±»å‹çš„æ“ä½œæ•°ä¸æ”¯æŒ '-'ï¼Œstring ä½œä¸º arg[1] è¿˜æ˜¯ arg[2] éƒ½æŠ¥é”™</span><span class="token comment">% å°†å­—ç¬¦ä¸²æ•°ç»„æˆ–å­—ç¬¦æ•°ç»„ç›¸åŠ </span><span class="token comment">% å­—ç¬¦æ•°ç»„ä¼šå¾—åˆ°Unicodeç ç›¸åŠ çš„ç»“æœï¼š</span>char_array9 <span class="token operator">=</span> <span class="token string">'THU EESAST'</span><span class="token punctuation">;</span>char_array10 <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span>char_array9 <span class="token operator">+</span> char_array10 <span class="token comment">% ans 1 x 10 [117, 105, ...]</span><span class="token comment">% å­—ç¬¦ä¸²æ•°ç»„ä¼šå°†ä¸¤ç«¯å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥ï¼š</span>string_array9 <span class="token operator">=</span> "THU EESAST"<span class="token punctuation">;</span>string_array10 <span class="token operator">=</span> "<span class="token punctuation">!</span>"<span class="token punctuation">;</span>string_array9 <span class="token operator">+</span> string_array10 <span class="token comment">% æ‹¼æ¥</span><span class="token comment">% å°†å†…å®¹ä¸ºæ•°å­—çš„æ–‡æœ¬è½¬æ¢ä¸º double ç­‰ç±»å‹</span><span class="token comment">% å­—ç¬¦æ•°ç»„ä¼šå¾—åˆ°å¯¹åº”å­—ç¬¦çš„Unicodeç¼–ç ï¼š</span>char_array11 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'123'</span><span class="token punctuation">;</span><span class="token string">'1e2'</span><span class="token punctuation">;</span><span class="token string">'1.2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>char_array12 <span class="token operator">=</span> <span class="token string">'123 456 789'</span><span class="token punctuation">;</span><span class="token function">double</span><span class="token punctuation">(</span>char_array11<span class="token punctuation">)</span><span class="token function">double</span><span class="token punctuation">(</span>char_array12<span class="token punctuation">)</span><span class="token comment">% å­—ç¬¦ä¸²æ•°ç»„åˆ™ç›´æ¥å¾—åˆ°æ–‡æœ¬è¡¨ç¤ºçš„æ•°å­—ï¼š</span>string_array11 <span class="token operator">=</span> <span class="token punctuation">[</span>"<span class="token number">123</span>"<span class="token punctuation">;</span>"<span class="token number">1e2</span>"<span class="token punctuation">;</span>"<span class="token number">1.2</span>"<span class="token punctuation">]</span><span class="token punctuation">;</span>string_array12 <span class="token operator">=</span> "<span class="token number">123</span> <span class="token number">456</span> <span class="token number">789</span>"<span class="token punctuation">;</span><span class="token function">double</span><span class="token punctuation">(</span>string_array11<span class="token punctuation">)</span> <span class="token comment">% [123; 100; 1.2]</span><span class="token function">double</span><span class="token punctuation">(</span>string_array12<span class="token punctuation">)</span> <span class="token comment">% 123456789</span><span class="token comment">% æ¬²å°†å­—ç¬¦å‘é‡è½¬æ¢ä¸ºæ–‡æœ¬è¡¨ç¤ºçš„æ•°å­—ï¼Œè¯·ä½¿ç”¨str2doubleå‡½æ•°</span><span class="token comment">% æ­¤å‡½æ•°çš„è¾“å…¥å¯ä»¥ä¸ºå­—ç¬¦å‘é‡ã€å­—ç¬¦å‘é‡å…ƒèƒæ•°ç»„(ä¹‹åä¼šå­¦ä¹ åˆ°)æˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼š</span><span class="token function">str2double</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token function">str2double</span><span class="token punctuation">(</span><span class="token string">'1e5'</span><span class="token punctuation">)</span><span class="token comment">%str2double(string_array11) % 3 x 1 ans</span><span class="token comment">%str2double(string_array12) % NaN</span><span class="token comment">%str2double(char_array11) % NaN</span><span class="token comment">%str2double(char_array12) % NaN</span><span class="token comment">% å¯ä»¥å°è¯•æ‰§è¡Œæœ€åå››è¡Œä»£ç ï¼Œçœ‹çœ‹ä¼šå¾—åˆ°ä»€ä¹ˆç»“æœ</span><span class="token comment">% å…³äºstr2doubleå‡½æ•°çš„è¯¦ç»†å†…å®¹è¯·å‚è€ƒMATLABè¯´æ˜æ–‡æ¡£</span><span class="token comment">% å¦æœ‰str2numå‡½æ•°å¯ä¾›é€‰æ‹©</span><span class="token comment">%% å°†æ•°å­—è½¬æ¢ä¸ºæ–‡æœ¬</span>double_array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">28165</span> <span class="token number">21326</span> <span class="token number">22823</span> <span class="token number">23398</span> <span class="token number">30005</span> <span class="token number">23376</span> <span class="token number">31185</span> <span class="token number">21327</span> <span class="token number">23398</span> <span class="token number">22521</span> <span class="token number">37096</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">% å­—ç¬¦æ•°ç»„ä¼šæŒ‰ç…§Unicodeç¼–ç è¿›è¡Œè½¬æ¢ï¼š</span><span class="token function">char</span><span class="token punctuation">(</span>double_array1<span class="token punctuation">)</span><span class="token comment">% å­—ç¬¦ä¸²æ•°ç»„åˆ™ç›´æ¥è½¬æ¢ä¸ºæ–‡æœ¬ï¼š</span><span class="token function">string</span><span class="token punctuation">(</span>double_array1<span class="token punctuation">)</span><span class="token comment">% æ¬²å°†æ•°å­—è½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦æ•°ç»„ç±»å‹æ–‡æœ¬ï¼Œè¯·ä½¿ç”¨num2strå‡½æ•°ï¼š</span><span class="token function">num2str</span><span class="token punctuation">(</span>double_array1<span class="token punctuation">)</span> <span class="token comment">% '28165 21326 ...'</span><span class="token function">num2str</span><span class="token punctuation">(</span>double_array1<span class="token operator">'</span><span class="token punctuation">)</span> <span class="token comment">% 11x5 char</span><span class="token comment">%% ç´¢å¼•æ“ä½œ</span><span class="token comment">% å­—ç¬¦æ•°ç»„å¯ä»¥åƒæ•°å€¼æ•°ç»„ä¸€æ ·æ­£å¸¸ç´¢å¼•</span><span class="token comment">% è€Œå•ä¸ªå­—ç¬¦ä¸²æ ‡é‡åˆ™æ— æ³•ç´¢å¼•å†…éƒ¨çš„æŸä¸ªå­—ç¬¦</span>char_array13 <span class="token operator">=</span> <span class="token string">'123456789'</span><span class="token punctuation">;</span>string_array13 <span class="token operator">=</span> "<span class="token number">123456789</span>"<span class="token punctuation">;</span><span class="token function">char_array13</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token comment">% string_array13(3:6) % length == 1, error</span></code></pre><h2 id="å…ƒèƒæ•°ç»„"><a href="#å…ƒèƒæ•°ç»„" class="headerlink" title="å…ƒèƒæ•°ç»„"></a>å…ƒèƒæ•°ç»„</h2><p>å…ƒèƒæ•°ç»„æ˜¯åŒ…å«ç§°ä¸ºå…ƒèƒçš„ç´¢å¼•æ•°æ®å®¹å™¨çš„æ•°æ®ç±»å‹ã€‚æ¯ä¸ªå…ƒèƒå¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</p><h3 id="å…ƒèƒæ•°ç»„åˆ›å»º"><a href="#å…ƒèƒæ•°ç»„åˆ›å»º" class="headerlink" title="å…ƒèƒæ•°ç»„åˆ›å»º"></a>å…ƒèƒæ•°ç»„åˆ›å»º</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab">C1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'char'</span><span class="token punctuation">,</span>"str"<span class="token punctuation">;</span><span class="token number">1.2</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token comment">% C1 = </span><span class="token comment">%     &#123;'a'     &#125;    &#123;'char' &#125;    &#123;["str"]&#125;</span><span class="token comment">%     &#123;[1.2000]&#125;    &#123;[1 2 3]&#125;    &#123;[    1]&#125;</span>C2<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token string">'char'</span><span class="token function">C3</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'char'</span><span class="token punctuation">&#125;</span>      <span class="token comment">% æ³¨æ„()ä¸&#123;&#125;çš„åŒºåˆ«</span><span class="token comment">% ä½¿ç”¨cellå‡½æ•°é¢„åˆ†é…å†…å­˜ï¼šåœ¨éœ€è¦é¢‘ç¹æ”¹å˜å…ƒèƒæ•°ç»„å¤§å°çš„æƒ…å†µä¸‹</span><span class="token comment">% æ¨èæå‰é¢„ä¼°éœ€è¦çš„æœ€å¤§å°ºå¯¸ï¼Œé¢„åˆ†é…å†…å­˜ä»¥æé«˜è¿è¡Œæ•ˆç‡</span>C4 <span class="token operator">=</span> <span class="token function">cell</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>C5 <span class="token operator">=</span> <span class="token function">cell</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>C6 <span class="token operator">=</span> <span class="token function">cell</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    </code></pre><h3 id="å…ƒèƒæ•°ç»„çš„ç´¢å¼•"><a href="#å…ƒèƒæ•°ç»„çš„ç´¢å¼•" class="headerlink" title="å…ƒèƒæ•°ç»„çš„ç´¢å¼•"></a>å…ƒèƒæ•°ç»„çš„ç´¢å¼•</h3><p>ç†è§£å…ƒèƒæ•°ç»„çš„ç´¢å¼•æ˜¯ç†è§£å…ƒèƒæ•°ç»„çš„å…³é”®ã€‚</p><p>ä¸ä¸€èˆ¬çš„æ•°ç»„ä¸åŒï¼Œå…ƒèƒæ•°ç»„æœ‰ä¸¤ç§å½¢å¼çš„ç´¢å¼•ï¼š</p><p>ä½¿ç”¨åœ†æ‹¬å· <code>()</code> çš„ç´¢å¼•ä¸ä½¿ç”¨èŠ±æ‹¬å· <code>&#123;&#125;</code> çš„ç´¢å¼•ã€‚</p><ul><li>ä½¿ç”¨åœ†æ‹¬å· <code>()</code> çš„å…ƒèƒç´¢å¼•<ul><li>æ­¤å½¢å¼çš„ç´¢å¼•å¼•ç”¨çš„æ˜¯å…ƒèƒæœ¬èº«ï¼Œæœ€ç›´è§‚çš„ç†è§£æ˜¯ï¼Œè¿”å›å€¼æ˜¯ cell ç±»å‹</li></ul></li><li>ä½¿ç”¨èŠ±æ‹¬å· <code>&#123;&#125;</code> çš„å†…å®¹ç´¢å¼•<ul><li>æ­¤å½¢å¼çš„ç´¢å¼•å¼•ç”¨çš„æ˜¯å…ƒèƒä¸­çš„å†…å®¹ï¼Œè¿”å›å€¼çš„ç±»å‹å–å†³äºè¯¥å†…å®¹</li></ul></li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab">C <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'char'</span><span class="token punctuation">,</span>"str"<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">class</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">% cell</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>C <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'char'</span><span class="token punctuation">,</span>"str"<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>C<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token function">class</span><span class="token punctuation">(</span>C<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">% double</span>C<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">&#125;</span>C <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'c'</span><span class="token punctuation">,</span> "s"<span class="token punctuation">;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>C<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">% C(3,3) = "s" % Cannot convert string to cell</span></code></pre><ul><li>åˆ é™¤å…ƒèƒæ•°ç»„çš„æ•°æ®</li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab">C1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token function">C1</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>C2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>C2<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token comment">% è¿™æ ·ä¸èƒ½åˆ é™¤å…ƒèƒæœ¬èº«ï¼Œåªèƒ½å°†å…¶ä¸­çš„å†…å®¹èµ‹å€¼ä¸ºç©º</span><span class="token comment">% å¦‚æœæ˜¯ä¸‹é¢è¿™æ ·å‘¢ï¼Ÿ</span><span class="token comment">% C3 = &#123;1,2,3;4,5,6;7,8,9&#125;;</span><span class="token comment">% C3(2,2) = []    % err</span></code></pre><ul><li>å¤šçº§ç´¢å¼•</li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab">Num <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>char1 <span class="token operator">=</span> <span class="token string">'char'</span><span class="token punctuation">;</span>C1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>C2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>C <span class="token operator">=</span> <span class="token punctuation">&#123;</span>Num<span class="token punctuation">,</span>char1<span class="token punctuation">;</span>C1<span class="token punctuation">,</span>C2<span class="token punctuation">&#125;</span><span class="token comment">% C = </span><span class="token comment">%     &#123;3Ã—3 double&#125;    &#123;'char'  &#125;</span><span class="token comment">%     &#123;1Ã—3 cell  &#125;    &#123;1Ã—3 cell&#125;</span>C<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>C<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span>C<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>C<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span>C<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre><ul><li>æ•°ç»„åˆå¹¶</li></ul><p>ä¸ä¸€èˆ¬çš„æ•°ç»„ä¸€æ ·ï¼Œä½¿ç”¨æ–¹æ‹¬å· [] åˆå¹¶æ•°ç»„ã€‚</p><p>å¦‚æœä½¿ç”¨èŠ±æ‹¬å· {}ï¼ŒåŸæ•°ç»„å°†è¢«å½“ä½œä¸€ä¸ªå…ƒèƒçš„å†…å®¹ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% å…ƒèƒæ•°ç»„ä¸å…ƒèƒæ•°ç»„åˆå¹¶</span>C1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>C2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>C <span class="token operator">=</span> <span class="token punctuation">[</span>C1<span class="token punctuation">;</span>C2<span class="token punctuation">]</span> <span class="token comment">% 3 x 3 cell</span>C <span class="token operator">=</span> <span class="token punctuation">&#123;</span>C1<span class="token punctuation">;</span>C2<span class="token punctuation">&#125;</span> <span class="token comment">% 2 x 1 cell</span><span class="token comment">% å…ƒèƒæ•°ç»„ä¸éå…ƒèƒæ•°ç»„åˆå¹¶</span>C1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>char1 <span class="token operator">=</span> <span class="token string">'char'</span><span class="token punctuation">;</span>num <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>C <span class="token operator">=</span> <span class="token punctuation">[</span>C1<span class="token punctuation">,</span>char1<span class="token punctuation">,</span>num<span class="token punctuation">]</span> <span class="token comment">% 1 x 5 cell</span>C <span class="token operator">=</span> <span class="token punctuation">&#123;</span>C1<span class="token punctuation">,</span>char1<span class="token punctuation">,</span>num<span class="token punctuation">&#125;</span> <span class="token comment">% 1 x 3 cell</span></code></pre><ul><li>ç±»å‹è½¬æ¢</li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% cell2mat</span>C1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">&#125;</span> <span class="token comment">% 3 x 2 cell</span>A1 <span class="token operator">=</span> <span class="token function">cell2mat</span><span class="token punctuation">(</span>C1<span class="token punctuation">)</span> <span class="token comment">% 3 x 3 number</span>C2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'THU'</span><span class="token punctuation">;</span><span class="token string">' EE'</span><span class="token punctuation">&#125;</span> <span class="token comment">% 2 x 1 cell</span>A2 <span class="token operator">=</span> <span class="token function">cell2mat</span><span class="token punctuation">(</span>C2<span class="token punctuation">)</span> <span class="token comment">% 2 x 3 char</span><span class="token comment">% mat2cell</span>A <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>C <span class="token operator">=</span> <span class="token function">mat2cell</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="ç»“æ„ä½“æ•°ç»„"><a href="#ç»“æ„ä½“æ•°ç»„" class="headerlink" title="ç»“æ„ä½“æ•°ç»„"></a>ç»“æ„ä½“æ•°ç»„</h2><p>ç»“æ„ä½“æ•°ç»„æ˜¯ä½¿ç”¨åä¸ºå­—æ®µçš„æ•°æ®å®¹å™¨å°†ç›¸å…³æ•°æ®ç»„åˆåœ¨ä¸€èµ·çš„æ•°æ®ç±»å‹ï¼Œæ¯ä¸ªå­—æ®µéƒ½å¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„æ•°æ®ã€‚ä½¿ç”¨ <code>structName.fieldName</code> æ ¼å¼çš„åœ†ç‚¹è¡¨ç¤ºæ³•æ¥è®¿é—®ç»“æ„ä½“ä¸­çš„æ•°æ®ã€‚</p><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">%% ç›´æ¥èµ‹å€¼</span><span class="token comment">% æ­¤æ–¹å¼åªèƒ½åˆ›å»ºç»“æ„ä½“æ ‡é‡ï¼Œä¹‹åå¯ä»¥é€šè¿‡ç´¢å¼•çš„æ–¹å¼æ·»åŠ å…ƒç´ </span>clear<span class="token punctuation">;</span>element<span class="token punctuation">.</span>Atomic_Number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>element<span class="token punctuation">.</span>Symbol <span class="token operator">=</span> <span class="token string">'H'</span><span class="token punctuation">;</span>element <span class="token comment">% struct</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Atomic_Number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Symbol <span class="token operator">=</span> <span class="token string">'He'</span><span class="token punctuation">;</span>element <span class="token comment">% 1 x 2 struct</span><span class="token comment">%% ä½¿ç”¨structå‡½æ•°</span><span class="token comment">% æ­¤æ–¹å¼å¯åˆ›å»ºéæ ‡é‡ç»“æ„ä½“</span><span class="token comment">% æ­¤å‡½æ•°ä¸€èˆ¬é‡è½½ä¸º struct(field1,value1,..,fieldN,valueN) çš„å½¢å¼ï¼š</span><span class="token comment">% è‹¥æ‰€æœ‰ value éƒ½ä¸æ˜¯å…ƒèƒæ•°ç»„æˆ–ä¸ºæ ‡é‡å…ƒèƒæ•°ç»„ï¼Œåˆ™åˆ›å»ºç»“æ„ä½“æ ‡é‡ï¼›</span><span class="token comment">% è‹¥ä»»ä¸€ value ä¸ºå…ƒèƒæ•°ç»„ï¼Œåˆ™åˆ›å»ºç»“æ„ä½“æ•°ç»„ï¼Œç»´åº¦åŒå…ƒèƒæ•°ç»„ï¼›</span><span class="token comment">% è‹¥æœ‰ä¸¤ä¸ªåŠä»¥ä¸Š value ä¸ºéæ ‡é‡å…ƒèƒæ•°ç»„ï¼Œåˆ™å…¶ç»´åº¦å¿…é¡»ç›¸åŒã€‚</span>clear<span class="token punctuation">;</span>element <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'Atomic_Number'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Symbol'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">)</span> <span class="token comment">% struct</span>element <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'Atomic_Number'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">'Symbol'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'H'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">% struct</span>element <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'Atomic_Number'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">'Symbol'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'He'</span><span class="token punctuation">,</span><span class="token string">'Li'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">% 1 x 3 struct</span>element <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'Atomic_Number'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">'Symbol'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'He'</span><span class="token punctuation">,</span><span class="token string">'Li'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">% struct</span>element <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'Atomic_Number'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">'Symbol'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'H'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">% broadcasting</span><span class="token comment">%element = struct('Atomic_Number',&#123;1,2,3&#125;,'Symbol',&#123;'H','He'&#125;) % err</span><span class="token comment">% æ³¨ï¼šåŒä¸€å­—æ®µå¯¹åº”çš„å€¼å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„æ•°æ®ã€‚</span><span class="token comment">% æ·»åŠ æ–°çš„å­—æ®µï¼šé€šè¿‡åœ†ç‚¹è¡¨ç¤ºæ³•æ·»åŠ </span>clear<span class="token punctuation">;</span>element <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'Atomic_Number'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">'Symbol'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'He'</span><span class="token punctuation">,</span><span class="token string">'Li'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Ar <span class="token operator">=</span> <span class="token number">1.008</span><span class="token punctuation">;</span>element<span class="token punctuation">[</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Ar<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deal</span><span class="token punctuation">(</span><span class="token number">4.003</span><span class="token punctuation">,</span><span class="token number">6.941</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% Copy Input to Output</span>element</code></pre><h3 id="è®¿é—®"><a href="#è®¿é—®" class="headerlink" title="è®¿é—®"></a>è®¿é—®</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span><span class="token punctuation">[</span>field1<span class="token punctuation">,</span>field2<span class="token punctuation">,</span>field3<span class="token punctuation">,</span>field4<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deal</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span>value3<span class="token punctuation">,</span>value4<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deal</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'char'</span><span class="token punctuation">,</span>"str"<span class="token punctuation">,</span><span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'char'</span><span class="token punctuation">,</span>"str"<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">...</span>    <span class="token punctuation">&#123;</span>"str"<span class="token punctuation">,</span><span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'char'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'char'</span><span class="token punctuation">,</span>"str"<span class="token punctuation">,</span><span class="token function">struct</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%ä»¥ä¸Šéƒ¨åˆ†æ¶‰åŠ"é€—å·åˆ†éš”çš„åˆ—è¡¨"å†…å®¹ï¼Œä¸åœ¨æœ¬æ¬¡æ•™ç¨‹è¦æ±‚ä¹‹å†…</span>s <span class="token operator">=</span> <span class="token function">struct</span><span class="token punctuation">(</span>field1<span class="token punctuation">,</span>value1<span class="token punctuation">,</span>field2<span class="token punctuation">,</span>value2<span class="token punctuation">,</span>field3<span class="token punctuation">,</span>value3<span class="token punctuation">,</span>field4<span class="token punctuation">,</span>value4<span class="token punctuation">)</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>A<span class="token punctuation">&#123;</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>A<span class="token punctuation">&#125;</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">%s(1).A(2)</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>D<span class="token punctuation">.</span>c </code></pre><h3 id="ä¸²è”"><a href="#ä¸²è”" class="headerlink" title="ä¸²è”"></a>ä¸²è”</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% ä½¿ç”¨æ–¹æ‹¬å·[]ä¸²è”ç»“æ„ä½“æ•°ç»„</span><span class="token comment">% è¦ä¸²è”ç»“æ„ä½“ï¼Œä»–ä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„å­—æ®µé›†</span><span class="token comment">% ä½†è¿™äº›å­—æ®µæ— éœ€åŒ…å«ç›¸åŒçš„å¤§å°æˆ–æ•°æ®ç±»å‹</span>clear<span class="token punctuation">;</span>s1<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>s1<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>s2<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>s2<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>s <span class="token operator">=</span> <span class="token punctuation">[</span>s1<span class="token punctuation">,</span>s2<span class="token punctuation">]</span></code></pre><h2 id="å‡½æ•°ä¸å‡½æ•°å¥æŸ„"><a href="#å‡½æ•°ä¸å‡½æ•°å¥æŸ„" class="headerlink" title="å‡½æ•°ä¸å‡½æ•°å¥æŸ„"></a>å‡½æ•°ä¸å‡½æ•°å¥æŸ„</h2><h3 id="å‘½åå‡½æ•°"><a href="#å‘½åå‡½æ•°" class="headerlink" title="å‘½åå‡½æ•°"></a>å‘½åå‡½æ•°</h3><p>MATLAB ä¸­çš„å‡½æ•°é€šå¸¸æŒ‰ç…§å¦‚ä¸‹å½¢å¼å®šä¹‰ï¼š</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token keyword">function</span> <span class="token punctuation">[</span>y1<span class="token punctuation">,</span><span class="token punctuation">...</span><span class="token punctuation">,</span>yN<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">myfun</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span><span class="token punctuation">...</span><span class="token punctuation">,</span>xM<span class="token punctuation">)</span>command<span class="token keyword">end</span></code></pre><p>å…¶ä¸­ y1,â€¦,yN æ˜¯è¾“å‡ºï¼Œx1,â€¦,xM æ˜¯è¾“å…¥ï¼Œmyfun æ˜¯å‡½æ•°åç§°ã€‚å¯ä»¥å°†å‘½åå‡½æ•°ä¿å­˜åœ¨ä»¥ä¸‹ä½ç½®ï¼š</p><ul><li>åªåŒ…å«å‡½æ•°å®šä¹‰çš„å‡½æ•°æ–‡ä»¶ä¸­ã€‚æ–‡ä»¶çš„åç§°é¡»ä¸æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªå‡½æ•°çš„åç§°ä¸€è‡´ï¼›æ–‡ä»¶ä¸­çš„å…¶ä½™å‡½æ•°å¯ä»¥ä½œä¸ºå±€éƒ¨å‡½æ•°ï¼Œä»…èƒ½è¢«è¯¥æ–‡ä»¶ä¸»å‡½æ•°è°ƒç”¨ã€‚</li><li>åŒ…å«å‘½ä»¤å’Œå‡½æ•°å®šä¹‰çš„è„šæœ¬æ–‡ä»¶ä¸­ã€‚å‡½æ•°å¿…é¡»ä½äºè¯¥æ–‡ä»¶çš„æœ«å°¾ã€‚è„šæœ¬æ–‡ä»¶ä¸èƒ½ä¸æ–‡ä»¶ä¸­çš„å‡½æ•°å…·æœ‰ç›¸åŒçš„åç§°ã€‚R2016b æˆ–æ›´é«˜ç‰ˆæœ¬çš„è„šæœ¬ä¸­æ”¯æŒå‡½æ•°ã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">1.111</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1.3</span><span class="token punctuation">,</span><span class="token number">0.51</span><span class="token punctuation">,</span><span class="token number">3.96</span><span class="token punctuation">,</span><span class="token number">1.22</span><span class="token punctuation">]</span><span class="token punctuation">;</span>y <span class="token operator">=</span> <span class="token function">fmax</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">% å‡½æ•°ä¿å­˜åœ¨ ./fmax.m ä¸­</span><span class="token comment">% In ./fmax.m</span><span class="token keyword">function</span> y <span class="token operator">=</span> <span class="token function">fmax</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    B <span class="token operator">=</span> x<span class="token operator">.*</span><span class="token function">exp</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.</span><span class="token operator">/</span><span class="token punctuation">(</span>x<span class="token operator">.^</span><span class="token number">2</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span> x<span class="token operator">.^</span><span class="token number">3</span><span class="token punctuation">;</span>    y <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">end</span></code></pre><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">[</span>y<span class="token punctuation">,</span>f<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token comment">% In ./fun1.m</span><span class="token keyword">function</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span>f<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    temp <span class="token operator">=</span> <span class="token function">fact</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    y <span class="token operator">=</span> <span class="token function">log</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>    f <span class="token operator">=</span> <span class="token operator">@</span>fact<span class="token punctuation">;</span>          <span class="token comment">%è¿”å›è¡¨ç¤ºå‡½æ•°factçš„å‡½æ•°å¥æŸ„f</span><span class="token keyword">end</span><span class="token keyword">function</span> y <span class="token operator">=</span> <span class="token function">fact</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> index <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>x        y <span class="token operator">=</span> y <span class="token operator">*</span> index<span class="token punctuation">;</span>    <span class="token keyword">end</span><span class="token keyword">end</span></code></pre><h3 id="å‡½æ•°å¥æŸ„"><a href="#å‡½æ•°å¥æŸ„" class="headerlink" title="å‡½æ•°å¥æŸ„"></a>å‡½æ•°å¥æŸ„</h3><p>å‡½æ•°å¥æŸ„æ˜¯ä¸€ç§è¡¨ç¤ºå‡½æ•°çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥è¡¨ç¤ºå‘½åå‡½æ•°æˆ–åŒ¿åå‡½æ•°ã€‚ä½¿ç”¨ <code>@</code> è¿ç®—ç¬¦åˆ›å»ºå‡½æ•°å¥æŸ„ã€‚å‡½æ•°å¥æŸ„çš„å…¸å‹ç”¨æ³•æ˜¯å°†ä¸€ä¸ªå‡½æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ã€ä»ä¸»å‡½æ•°å¤–è°ƒç”¨å±€éƒ¨å‡½æ•°ç­‰ã€‚å‡½æ•°å¥æŸ„ä¸èƒ½ç»„æˆä¸€èˆ¬æ•°ç»„ï¼Œä½†å¯ä»¥æ”¶é›†åˆ°ä¸€ä¸ªå…ƒèƒæ•°ç»„æˆ–ç»“æ„ä½“æ•°ç»„ä¸­ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% ä¾‹1ï¼šè¡¨ç¤ºå‘½åå‡½æ•°</span>clear<span class="token punctuation">;</span>f1 <span class="token operator">=</span> <span class="token operator">@</span>fmax<span class="token punctuation">;</span>x1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">1.111</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1.3</span><span class="token punctuation">,</span><span class="token number">0.51</span><span class="token punctuation">,</span><span class="token number">3.96</span><span class="token punctuation">,</span><span class="token number">1.22</span><span class="token punctuation">]</span><span class="token punctuation">;</span>y1 <span class="token operator">=</span> <span class="token function">f1</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token comment">% ä¾‹2ï¼šè¡¨ç¤ºåŒ¿åå‡½æ•°</span>clear<span class="token punctuation">;</span>f2 <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">.^</span><span class="token number">3</span><span class="token punctuation">;</span>     <span class="token comment">%ä»¥xä¸ºè‡ªå˜é‡ï¼Œy = x^3</span>x2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>y2 <span class="token operator">=</span> <span class="token function">f2</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token comment">% ä¾‹3ï¼šå°†ä¸€ä¸ªå‡½æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°</span>clear<span class="token punctuation">;</span>f3 <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">;</span>         <span class="token comment">%ä»¥xä¸ºè‡ªå˜é‡ï¼Œy = x^2</span><span class="token function">integral</span><span class="token punctuation">(</span>f3<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>       <span class="token comment">%f3ä½œä¸ºå‡½æ•°integral()çš„å‚æ•°</span><span class="token comment">% ä¾‹4ï¼šä»ä¸»å‡½æ•°å¤–è°ƒç”¨å±€éƒ¨å‡½æ•°(1)</span>clear<span class="token punctuation">;</span>x4 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">[</span>y4<span class="token punctuation">,</span>f4<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span>x4<span class="token punctuation">)</span>y4_1 <span class="token operator">=</span> <span class="token function">f4</span><span class="token punctuation">(</span>x4<span class="token punctuation">)</span>       <span class="token comment">%è°ƒç”¨äº†å±€éƒ¨å‡½æ•°fact()</span><span class="token function">log</span><span class="token punctuation">(</span>y4_1<span class="token punctuation">)</span><span class="token function">log</span><span class="token punctuation">(</span>y4_1<span class="token punctuation">)</span> <span class="token operator">-</span> y4<span class="token comment">% ä¾‹5ï¼šä»ä¸»å‡½æ•°å¤–è°ƒç”¨å±€éƒ¨å‡½æ•°(2)/å‡½æ•°å¥æŸ„ç»„æˆçš„æ•°ç»„</span>clear<span class="token punctuation">;</span><span class="token punctuation">[</span>f5<span class="token punctuation">,</span>f6<span class="token punctuation">]</span> <span class="token operator">=</span> circle<span class="token punctuation">;</span>f5<span class="token punctuation">.</span><span class="token function">Area</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>f5<span class="token punctuation">.</span><span class="token function">Cirumference</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>f5<span class="token punctuation">.</span><span class="token function">Curvature</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>f6<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>f6<span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>f6<span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment">% In circle.m</span><span class="token keyword">function</span> <span class="token punctuation">[</span>f<span class="token punctuation">,</span>f1<span class="token punctuation">]</span> <span class="token operator">=</span> circle    f<span class="token punctuation">.</span>Curvature <span class="token operator">=</span> <span class="token operator">@</span>Curvature<span class="token punctuation">;</span>    f<span class="token punctuation">.</span>Area <span class="token operator">=</span> <span class="token operator">@</span>Area<span class="token punctuation">;</span>    f<span class="token punctuation">.</span>Cirumference <span class="token operator">=</span> <span class="token operator">@</span>Circumference<span class="token punctuation">;</span>            <span class="token comment">%fä»¥ç»“æ„ä½“å½¢å¼è¿”å›</span>    f1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">@</span>Curvature<span class="token punctuation">,</span><span class="token operator">@</span>Area<span class="token punctuation">,</span><span class="token operator">@</span>Circumference<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>     <span class="token comment">%f1ä»¥å…ƒèƒæ•°ç»„å½¢å¼è¿”å›</span>    enda<span class="token comment">%è®¡ç®—åœ†çš„æ›²ç‡</span><span class="token keyword">function</span> y <span class="token operator">=</span> <span class="token function">Curvature</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span>    y <span class="token operator">=</span> <span class="token number">1.</span><span class="token operator">/</span>R<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">%è®¡ç®—åœ†çš„é¢ç§¯</span><span class="token keyword">function</span> y <span class="token operator">=</span> <span class="token function">Area</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span>    y <span class="token operator">=</span> <span class="token keyword">pi</span> <span class="token operator">.*</span> R<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment">%è®¡ç®—åœ†çš„å‘¨é•¿</span><span class="token keyword">function</span> y <span class="token operator">=</span> <span class="token function">Circumference</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span>    y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">.*</span> <span class="token keyword">pi</span> <span class="token operator">.*</span> R<span class="token punctuation">;</span><span class="token keyword">end</span></code></pre><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><p>åŒ¿åå‡½æ•°æ˜¯ä¸å­˜å‚¨åœ¨ç¨‹åºæ–‡ä»¶ä¸­ã€ä½†ä¸æ•°æ®ç±»å‹æ˜¯å‡½æ•°å¥æŸ„çš„å˜é‡ç›¸å…³çš„å‡½æ•°ã€‚åŒ¿åå‡½æ•°å¯ä»¥æ¥å—å¤šä¸ªè¾“å…¥å¹¶è¿”å›ä¸€ä¸ªè¾“å‡ºã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% ä¾‹1ï¼šå¤šä¸ªè¾“å…¥çš„åŒ¿åå‡½æ•°</span>clear<span class="token punctuation">;</span>f <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> x<span class="token operator">.^</span><span class="token number">2</span> <span class="token operator">+</span> y<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">% ä¾‹2ï¼šå‚æ•°åŒ–å‡½æ•°</span>clear<span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>f <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">.^</span><span class="token number">2</span> <span class="token operator">+</span> a <span class="token operator">.*</span> x <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>clear a b<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>            <span class="token comment">%å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°å¥æŸ„fä¹Ÿä¿å­˜äº†aå’Œbçš„å€¼ï¼Œå³ä¾¿æ¸…é™¤æ‰aå’Œbä¹Ÿæ²¡æœ‰å½±å“</span><span class="token comment">% ä¾‹3ï¼šåŒ¿åå‡½æ•°çš„åµŒå¥—ï¼Œä»¥ç§¯åˆ†å‡½æ•°ä¸ºä¾‹</span>F <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token function">integral</span><span class="token punctuation">(</span><span class="token operator">@</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> t<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">F</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">% ä¾‹4ï¼šå¯¹äºå¤šè¾“å…¥å‡½æ•°ï¼Œåœ¨åˆ›å»ºå‡½æ•°å¥æŸ„æ—¶å¯ä»¥åªå°†éƒ¨åˆ†è¾“å…¥ä½œä¸ºè‡ªå˜é‡ï¼Œå…¶ä½™è¾“å…¥ä½œä¸ºå‚æ•°</span>f <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>z<span class="token punctuation">)</span> x<span class="token operator">.^</span><span class="token number">2</span><span class="token operator">+</span>y<span class="token operator">.^</span><span class="token number">2</span><span class="token operator">+</span>z<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">;</span>f1 <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="ç¬¦å·å˜é‡"><a href="#ç¬¦å·å˜é‡" class="headerlink" title="ç¬¦å·å˜é‡"></a>ç¬¦å·å˜é‡</h2><h3 id="åˆ›å»º-1"><a href="#åˆ›å»º-1" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% ç”¨symså‡½æ•°åˆ›å»ºç¬¦å·æ ‡é‡ã€æ•°ç»„ã€çŸ©é˜µ</span>clear<span class="token punctuation">;</span>syms asyms b csyms e <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>syms <span class="token string">'d_%da'</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>syms g h <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>syms f <span class="token number">4</span><span class="token comment">% ç”¨symså‡½æ•°åˆ›å»ºç¬¦å·å‡½æ•°</span>clear<span class="token punctuation">;</span>syms <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>syms <span class="token function">m</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>syms <span class="token function">a</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token function">b</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token comment">% ç”¨symå‡½æ•°åˆ›å»ºç¬¦å·æ ‡é‡ã€æ•°ç»„ã€çŸ©é˜µ</span>clear<span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>b <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>c <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>d <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'d_%da'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>e <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>f <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'f_a_%d_%d'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>g <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'g_a%d%d'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span></code></pre><h3 id="è¿ç®—"><a href="#è¿ç®—" class="headerlink" title="è¿ç®—"></a>è¿ç®—</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% ä¾‹1ï¼šæ ‡é‡è¿ç®—</span>syms a bf <span class="token operator">=</span> a <span class="token operator">+</span> bg <span class="token operator">=</span> f<span class="token operator">^</span><span class="token number">2</span>h <span class="token operator">=</span> g<span class="token operator">/</span>aF <span class="token operator">=</span> <span class="token punctuation">[</span>a<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">,</span>b<span class="token punctuation">;</span>g<span class="token punctuation">,</span>a<span class="token operator">-</span>b<span class="token punctuation">]</span>G <span class="token operator">=</span> F<span class="token operator">.*</span>F<span class="token comment">% ä¾‹2ï¼šçŸ©é˜µè¿ç®—</span>clear<span class="token punctuation">;</span>A <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>B <span class="token operator">=</span> <span class="token function">sym</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>A <span class="token operator">+</span> BA<span class="token operator">*</span>BA<span class="token operator">/</span>B<span class="token function">diag</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>A<span class="token operator">.'</span>A<span class="token operator">'</span><span class="token comment">% ä¾‹3ï¼šç¬¦å·å‡½æ•°</span>clear<span class="token punctuation">;</span>syms <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> a b<span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span> x<span class="token operator">^</span><span class="token number">2</span><span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token operator">^</span><span class="token number">3</span><span class="token function">f</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">g</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token function">cos</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token function">exp</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">%double(exp(g(1,1)))</span><span class="token comment">% ä¾‹4ï¼šæ•°å€¼è®¡ç®—</span>clear<span class="token punctuation">;</span>syms a b <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>h <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>A <span class="token operator">=</span> <span class="token function">subs</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token function">double</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>B <span class="token operator">=</span> <span class="token function">subs</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span><span class="token punctuation">&#123;</span>a<span class="token punctuation">,</span>b<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token number">2.1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token number">3.25</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">double</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token comment">%è¯·å¯¹æ¯”</span><span class="token number">1</span><span class="token operator">/</span><span class="token function">sym</span><span class="token punctuation">(</span><span class="token number">1234567</span><span class="token punctuation">)</span>    <span class="token comment">%ç²¾ç¡®è®¡ç®—</span><span class="token function">sym</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">1234567</span><span class="token punctuation">)</span>    <span class="token comment">%éç²¾ç¡®è®¡ç®—</span><span class="token comment">% ä¾‹5ï¼šä¸€äº›å‡½æ•°</span>clear<span class="token punctuation">;</span>syms a b <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">=</span> a<span class="token operator">^</span><span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token operator">*</span>b<span class="token operator">*</span>a<span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span>D1 <span class="token operator">=</span> <span class="token function">diff</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>                <span class="token comment">%ä¸€é˜¶å¯¼æ•°</span>D2 <span class="token operator">=</span> <span class="token function">diff</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>              <span class="token comment">%äºŒé˜¶å¯¼æ•°</span><span class="token function">D1</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                       <span class="token comment">%ä»£å…¥a=2</span>D1 <span class="token operator">=</span> <span class="token function">subs</span><span class="token punctuation">(</span>D1<span class="token punctuation">,</span>b<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>           <span class="token comment">%å°†å‚æ•°bæ›¿æ¢ä¸º3</span><span class="token function">double</span><span class="token punctuation">(</span><span class="token function">D1</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>               <span class="token comment">%ç±»å‹è½¬æ¢</span>e <span class="token operator">=</span> <span class="token function">subs</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>g <span class="token operator">=</span> <span class="token function">fourier</span><span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">%Fourierå˜æ¢</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span>              LF <span class="token operator">=</span> <span class="token function">laplace</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>             <span class="token comment">%Laplaceå˜åŒ–</span></code></pre><h2 id="æ–‡ä»¶è¯»å†™"><a href="#æ–‡ä»¶è¯»å†™" class="headerlink" title="æ–‡ä»¶è¯»å†™"></a>æ–‡ä»¶è¯»å†™</h2><h3 id="äº¤äº’æ–¹å¼"><a href="#äº¤äº’æ–¹å¼" class="headerlink" title="äº¤äº’æ–¹å¼"></a>äº¤äº’æ–¹å¼</h3><p>MATLABé€‰é¡¹å¡ â€”â€” ä¸»é¡µ â€”â€” å˜é‡ â€”â€” å¯¼å…¥æ•°æ®/ä¿å­˜å·¥ä½œåŒº</p><h3 id="ä½¿ç”¨å‡½æ•°"><a href="#ä½¿ç”¨å‡½æ•°" class="headerlink" title="ä½¿ç”¨å‡½æ•°"></a>ä½¿ç”¨å‡½æ•°</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% saveï¼šå°†å·¥ä½œåŒºå˜é‡ä¿å­˜ä¸ºMATæ–‡ä»¶</span>clear<span class="token punctuation">;</span>A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">'./data/data1.mat'</span><span class="token punctuation">,</span>"A"<span class="token punctuation">)</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">'./data/data1.mat'</span><span class="token punctuation">,</span>"B"<span class="token punctuation">,</span><span class="token string">'-append'</span><span class="token punctuation">)</span><span class="token comment">%save('./data/data1.mat',"B")</span><span class="token comment">% loadï¼šè¯»å–MATæ–‡ä»¶(æˆ–ASCIIæ–‡ä»¶ï¼Œè¯·è‡ªè¡ŒæŸ¥é˜…è¯´æ˜æ–‡æ¡£)ä¸­ä¿å­˜çš„å˜é‡</span>clear<span class="token punctuation">;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./data/data1.mat'</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%load('./data/data1.mat');</span>b <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'./data/data1.mat'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token comment">% filereadï¼šä»¥æ–‡æœ¬æ ¼å¼è¯»å–å†…å®¹</span>clear<span class="token punctuation">;</span>charA <span class="token operator">=</span> <span class="token function">fileread</span><span class="token punctuation">(</span><span class="token string">'./data/data2.txt'</span><span class="token punctuation">)</span><span class="token comment">% writetable(é€‰å­¦)ï¼šå°†è¡¨(table)å†™å…¥æœ‰åˆ†éš”ç¬¦çš„æ–‡æœ¬æ–‡ä»¶</span>clear<span class="token punctuation">;</span>Age <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">;</span><span class="token number">20</span><span class="token punctuation">;</span><span class="token number">21</span><span class="token punctuation">;</span><span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">;</span>Name <span class="token operator">=</span> <span class="token punctuation">[</span>"Alice"<span class="token punctuation">;</span>"Bob"<span class="token punctuation">;</span>"Carol"<span class="token punctuation">;</span>"Dave"<span class="token punctuation">]</span><span class="token punctuation">;</span>Weight <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">71</span><span class="token punctuation">;</span><span class="token number">69</span><span class="token punctuation">;</span><span class="token number">64</span><span class="token punctuation">;</span><span class="token number">67</span><span class="token punctuation">]</span><span class="token punctuation">;</span>Height <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">176</span><span class="token punctuation">;</span><span class="token number">163</span><span class="token punctuation">;</span><span class="token number">181</span><span class="token punctuation">;</span><span class="token number">173</span><span class="token punctuation">]</span><span class="token punctuation">;</span>T <span class="token operator">=</span> <span class="token function">table</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span>Age<span class="token punctuation">,</span>Height<span class="token punctuation">,</span>Weight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">writetable</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span><span class="token string">'./data/data3.xlsx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">% readtableï¼šåŸºäºæ‰©å±•åç¡®å®šæ–‡ä»¶æ ¼å¼ï¼›ä»å¸¦åˆ†éš”ç¬¦çš„æ–‡æœ¬æ–‡ä»¶(å¦‚txtï¼Œcsvï¼Œdat)æˆ–ç”µå­è¡¨æ ¼æ–‡ä»¶(å¦‚xlsï¼Œxlsx)è¯»å–åˆ—å‘æ•°æ®æ¥åˆ›å»ºè¡¨(table)</span>clear<span class="token punctuation">;</span>T <span class="token operator">=</span> <span class="token function">readtable</span><span class="token punctuation">(</span>"data<span class="token operator">\</span>data3<span class="token punctuation">.</span>xlsx"<span class="token punctuation">)</span>Name <span class="token operator">=</span> T<span class="token punctuation">.</span>NameAge <span class="token operator">=</span> T<span class="token punctuation">.</span>AgeHeight <span class="token operator">=</span> T<span class="token punctuation">.</span><span class="token function">Height</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>Weight <span class="token operator">=</span> T<span class="token punctuation">.</span>Weight<span class="token comment">% imreadï¼šä»æŒ‡å®šæ–‡ä»¶è¯»å–å›¾åƒæ•°æ®ï¼Œç”±äºæ–‡ä»¶æ ¼å¼è¾ƒå¤šï¼Œåœ¨æ­¤ä¸ä¸€ä¸€åˆ—å‡ºï¼Œä»…ä»¥bmpæ ¼å¼ä¸ºä¾‹ï¼Œæ›´è¯¦ç»†çš„è¯´æ˜å‚é˜…è¯´æ˜æ–‡æ¡£â€œimreadâ€é¡µé¢ã€‚</span>clear<span class="token punctuation">;</span>image1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>"<span class="token operator">./</span>data<span class="token operator">/</span>image1<span class="token punctuation">.</span>bmp"<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">image</span><span class="token punctuation">(</span>image1<span class="token punctuation">)</span><span class="token comment">% imwriteï¼šå°†æ•°ç»„ä¿å­˜ä¸ºå›¾åƒ(ç°åº¦å›¾æˆ–RGBå½©è‰²å›¾åƒ)ï¼Œæ•°æ®ç±»å‹ä¸ºuint8æˆ–uint16ã€‚</span>clear<span class="token punctuation">;</span><span class="token function">load</span><span class="token punctuation">(</span>"<span class="token operator">./</span>data<span class="token operator">/</span>image2<span class="token punctuation">.</span>mat"<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">imwrite</span><span class="token punctuation">(</span>image2<span class="token punctuation">,</span>"<span class="token operator">./</span>data<span class="token operator">/</span>image2<span class="token punctuation">.</span>jpg"<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">%å¦‚æœimage2.jpgå·²ç»å­˜åœ¨ï¼Œå¯ä»¥åˆ é™¤åé‡æ–°è¿è¡Œ</span></code></pre><h2 id="æ•°æ®å¤„ç†å…¥é—¨"><a href="#æ•°æ®å¤„ç†å…¥é—¨" class="headerlink" title="æ•°æ®å¤„ç†å…¥é—¨"></a>æ•°æ®å¤„ç†å…¥é—¨</h2><h3 id="cftoolå·¥å…·"><a href="#cftoolå·¥å…·" class="headerlink" title="cftoolå·¥å…·"></a>cftoolå·¥å…·</h3><ul><li>è¿›å…¥å·¥å…·ç®±ç•Œé¢ï¼šMATLABé€‰é¡¹æ  â€”â€” APP â€”â€” Curve Fittingï¼ˆæˆ–ç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å…¥ cftoolï¼‰</li><li>åŠ è½½æ•°æ®ï¼šåœ¨ä¸€ä¸ªæ‰“å¼€çš„ .m æ–‡ä»¶ä¸­å¯¼å…¥æ•°æ®ï¼Œä¾‹å¦‚ï¼š</li></ul><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">447.1</span><span class="token punctuation">,</span> <span class="token number">471.3</span><span class="token punctuation">,</span> <span class="token number">492.2</span><span class="token punctuation">,</span> <span class="token number">501.6</span><span class="token punctuation">,</span> <span class="token number">587.6</span><span class="token punctuation">,</span> <span class="token number">667.8</span><span class="token punctuation">,</span> <span class="token number">706.6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.6694</span><span class="token punctuation">,</span> <span class="token number">1.6638</span><span class="token punctuation">,</span> <span class="token number">1.6604</span><span class="token punctuation">,</span> <span class="token number">1.6577</span><span class="token punctuation">,</span> <span class="token number">1.6477</span><span class="token punctuation">,</span> <span class="token number">1.6411</span><span class="token punctuation">,</span> <span class="token number">1.6389</span><span class="token punctuation">]</span><span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">;</span></code></pre><ul><li>é€‰æ‹©æ‹Ÿåˆæ›²çº¿ç±»å‹(åœ¨æ­¤é€‰æ‹©çº¿æ€§æ‹Ÿåˆï¼ŒåŸºå‡½æ•°ä¸º $1, x, x^2$)</li></ul><p><img src="https://s2.loli.net/2022/02/23/OW8wGC7LTXdcnu4.png" alt="image-20220223213053229"></p><ul><li>æŸ¥çœ‹æ‹Ÿåˆç»“æœ(Resultæ )</li><li>å¯¼å‡ºæ‹Ÿåˆç»“æœï¼šcftoolç•Œé¢é€‰é¡¹æ  â€”â€” æ–‡ä»¶(F) â€”â€” Generate Code å³å¯å¯¼å‡ºä»£ç æ–‡ä»¶ã€‚</li></ul><h3 id="ç›´æ–¹å›¾"><a href="#ç›´æ–¹å›¾" class="headerlink" title="ç›´æ–¹å›¾"></a>ç›´æ–¹å›¾</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>data <span class="token operator">=</span> <span class="token function">readtable</span><span class="token punctuation">(</span>"<span class="token operator">./</span>data<span class="token operator">/</span>data4<span class="token punctuation">.</span>csv"<span class="token punctuation">)</span><span class="token punctuation">;</span>data <span class="token operator">=</span> data<span class="token punctuation">.</span>Close<span class="token punctuation">;</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">histogram</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%ç”¨åç§°-å€¼å¯¹ç»„å‚æ•°è®¾ç½®ç›´æ–¹å›¾çš„å„ç§å±æ€§ï¼Œå¦‚binçš„é¢œè‰²ã€é€æ˜åº¦ã€å½’ä¸€åŒ–æ–¹å¼ç­‰</span><span class="token comment">%åœ¨æ­¤å°†'Normalization'è®¾ç½®ä¸º'probability'è¿›è¡Œå½’ä¸€åŒ–ï¼Œä½¿å¾—å„binçš„é«˜åº¦ä¸ºæ¦‚ç‡å€¼ï¼Œå„biné«˜åº¦ä¹‹å’Œä¸º1</span><span class="token comment">%æ›´è¯¦ç»†çš„è¯´æ˜è¯·å‚é˜…è¯´æ˜æ–‡æ¡£é¡µé¢"histogram"</span><span class="token function">histogram</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'Normalization'</span><span class="token punctuation">,</span><span class="token string">'probability'</span><span class="token punctuation">)</span>     <span class="token comment">%æŒ‡å®šæ ‡é‡nbinsï¼Œç¡®å®šç›´æ–¹å›¾çš„binæ•°</span>edges <span class="token operator">=</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">;</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%åœ¨æ­¤å°†'FaceColor'è®¾ç½®ä¸º[0.9,0.5,0.2]</span><span class="token function">histogram</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>edges<span class="token punctuation">,</span><span class="token string">'FaceColor'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.9</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">%æŒ‡å®šå‘é‡edgesï¼Œç¡®å®šç›´æ–¹å›¾binçš„è¾¹ç•Œ(å·¦é—­å³å¼€)</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%åœ¨æ­¤å°†'Normalization'è®¾ç½®ä¸º'pdf'è¿›è¡Œå½’ä¸€åŒ–ï¼Œä½¿å¾—binçš„é«˜åº¦ä¸ºæ¦‚ç‡å¯†åº¦çš„ä¼°è®¡å€¼ï¼Œä½¿å¾—å„biné¢ç§¯å’Œä¸º1</span><span class="token function">histogram</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'Normalization'</span><span class="token punctuation">,</span><span class="token string">'pdf'</span><span class="token punctuation">)</span>    <span class="token comment">%æŒ‡å®šæ ‡é‡nbinsï¼Œç¡®å®šç›´æ–¹å›¾çš„binæ•°</span></code></pre><h1 id="å¯è§†åŒ–ä¸ä¼˜åŒ–é—®é¢˜"><a href="#å¯è§†åŒ–ä¸ä¼˜åŒ–é—®é¢˜" class="headerlink" title="å¯è§†åŒ–ä¸ä¼˜åŒ–é—®é¢˜"></a>å¯è§†åŒ–ä¸ä¼˜åŒ–é—®é¢˜</h1><h2 id="å›¾å½¢å¯¹è±¡"><a href="#å›¾å½¢å¯¹è±¡" class="headerlink" title="å›¾å½¢å¯¹è±¡"></a>å›¾å½¢å¯¹è±¡</h2><p>å›¾å½¢å¯¹è±¡æ˜¯ç”¨æ¥åˆ›å»ºå¯è§†åŒ–æ•°æ®çš„ç»„ä»¶ã€‚æ¯ä¸ªå¯¹è±¡åœ¨å›¾å½¢æ˜¾ç¤ºä¸­éƒ½å…·æœ‰ç‰¹å®šè§’è‰²ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿å›¾åŒ…å«ä¸€ä¸ªå›¾çª—å¯¹è±¡ã€ä¸€ä¸ªåæ ‡åŒºå¯¹è±¡å’Œä¸€ä¸ªå›¾å½¢çº¿æ¡å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡è®¾ç½®å®ƒä»¬çš„å±æ€§æ¥è‡ªå®šä¹‰å›¾å½¢å¯¹è±¡ã€‚ è¦è®¾ç½®å±æ€§ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºè¯¥å¯¹è±¡çš„å‡½æ•°å°†å…¶ä»¥è¾“å‡ºå‚æ•°çš„å½¢å¼è¿”å›ã€‚ä¾‹å¦‚ï¼Œplot å‡½æ•°è¿”å›å›¾å½¢çº¿æ¡å¯¹è±¡ã€‚ç„¶åï¼Œä½¿ç”¨åœ†ç‚¹è¡¨ç¤ºæ³•æŸ¥çœ‹å’Œè®¾ç½®å±æ€§ï¼Œæˆ–è€…ä½¿ç”¨ <code>get()</code> å’Œ <code>set()</code> å‡½æ•°æŸ¥çœ‹å’Œè®¾ç½®å±æ€§ã€‚</p><h3 id="Line"><a href="#Line" class="headerlink" title="Line"></a>Line</h3><pre class="language-matlab" data-language="matlab"><code class="language-matlab">x <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">;</span>y <span class="token operator">=</span> x<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">;</span>p <span class="token operator">=</span> <span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token comment">% å¯ä½¿ç”¨ get() å‡½æ•°æŸ¥è¯¢ç‰¹å®šå±æ€§</span><span class="token function">get</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">'LineStyle'</span><span class="token punctuation">)</span><span class="token comment">% å¯ç”¨åŸç‚¹è¡¨ç¤ºæ³•ä¿®æ”¹è®¾ç½®å±æ€§</span>p<span class="token punctuation">.</span>LineWidth <span class="token operator">=</span> <span class="token number">3</span><span class="token comment">% ä¹Ÿå¯ç”¨ set() å‡½æ•°è®¾ç½®å±æ€§</span><span class="token function">set</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token string">'LineWidth'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">% è¿˜å¯ä»¥åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä½¿ç”¨åç§°-å€¼å¯¹ç»„å‚æ•°è®¾ç½®å±æ€§ã€‚ä¾‹å¦‚</span><span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token string">'LineWidth'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="Axes"><a href="#Axes" class="headerlink" title="Axes"></a>Axes</h3><p>Axes å±æ€§æ§åˆ¶ Axes å¯¹è±¡çš„å¤–è§‚å’Œè¡Œä¸ºã€‚é€šè¿‡æ›´æ”¹å±æ€§å€¼ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹åæ ‡åŒºçš„ç‰¹å®šæ–¹é¢ã€‚ä½¿ç”¨åœ†ç‚¹è¡¨ç¤ºæ³•æŸ¥è¯¢å’Œè®¾ç½®å±æ€§ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">ax <span class="token operator">=</span> gca <span class="token comment">% get current axes</span>ax<span class="token punctuation">.</span>Color <span class="token operator">=</span> <span class="token string">'yellow'</span><span class="token punctuation">;</span>ax<span class="token punctuation">.</span>XLim <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">% ä¿®æ”¹åæ ‡è½´èŒƒå›´</span><span class="token comment">% å¯ä»¥æ›´æ”¹ Axes å±æ€§ç»™ç»˜å›¾å¢åŠ æ ‡ç­¾</span>ax<span class="token punctuation">.</span>Title<span class="token punctuation">.</span>String <span class="token operator">=</span> <span class="token string">'My Title'</span><span class="token punctuation">;</span>ax<span class="token punctuation">.</span>Title<span class="token punctuation">.</span>FontSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>ax<span class="token punctuation">.</span>XLabel<span class="token punctuation">.</span>String <span class="token operator">=</span> <span class="token string">'My x-Axis Label'</span><span class="token punctuation">;</span>ax<span class="token punctuation">.</span>YLabel<span class="token punctuation">.</span>String <span class="token operator">=</span> <span class="token string">'My y-Axis Label'</span><span class="token punctuation">;</span><span class="token comment">% ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‡½æ•°æ·»åŠ æ ‡ç­¾</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'My Title'</span><span class="token punctuation">,</span> <span class="token string">'FontSize'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token string">'My x-Axis Label'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'My y-Axis Label'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="çŸ©é˜µå¯è§†åŒ–"><a href="#çŸ©é˜µå¯è§†åŒ–" class="headerlink" title="çŸ©é˜µå¯è§†åŒ–"></a>çŸ©é˜µå¯è§†åŒ–</h2><h3 id="meshgrid"><a href="#meshgrid" class="headerlink" title="meshgrid"></a>meshgrid</h3><p>meshgrid å‡½æ•°å¯ç”¨äºåˆ›å»ºäºŒç»´è¡¨æ ¼ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">;</span>y <span class="token operator">=</span> x<span class="token punctuation">;</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">meshgrid</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>F <span class="token operator">=</span> X<span class="token operator">.*</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span>X<span class="token operator">.^</span><span class="token number">2</span><span class="token operator">-</span>Y<span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">surf</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span>F<span class="token punctuation">)</span></code></pre><h3 id="contour"><a href="#contour" class="headerlink" title="contour"></a>contour</h3><p>ä½¿ç”¨ contour å‡½æ•°ç»˜åˆ¶ç­‰é«˜çº¿ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token function">contour</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> F<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="streamline"><a href="#streamline" class="headerlink" title="streamline"></a>streamline</h3><p>ä½¿ç”¨ streamline å‡½æ•°ç»˜åˆ¶æµçº¿ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">meshgrid</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>u <span class="token operator">=</span> x<span class="token punctuation">;</span>    <span class="token comment">% xæ–¹å‘é€Ÿåº¦</span>v <span class="token operator">=</span> <span class="token operator">-</span>y<span class="token punctuation">;</span>   <span class="token comment">% yæ–¹å‘é€Ÿåº¦</span>startx <span class="token operator">=</span> <span class="token number">0.1</span><span class="token operator">:</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">% xèµ·å§‹ç‚¹</span>starty <span class="token operator">=</span> <span class="token function">ones</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>startx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">% yèµ·å§‹ç‚¹</span>figure<span class="token punctuation">;</span><span class="token function">streamline</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>u<span class="token punctuation">,</span>v<span class="token punctuation">,</span>startx<span class="token punctuation">,</span>starty<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="æœ€ä¼˜åŒ–é—®é¢˜"><a href="#æœ€ä¼˜åŒ–é—®é¢˜" class="headerlink" title="æœ€ä¼˜åŒ–é—®é¢˜"></a>æœ€ä¼˜åŒ–é—®é¢˜</h2><p>å®‰è£… Optimization Toolboxï¼Œåœ¨å®æ—¶è„šæœ¬ä¸­ï¼Œé€‰æ‹©<strong>æ’å…¥â€”â€”ä»»åŠ¡â€”â€”ä¼˜åŒ–</strong>æˆ–è€…<strong>å®æ—¶ç¼–è¾‘å™¨â€”â€”ä»»åŠ¡â€”â€”ä¼˜åŒ–</strong>ã€‚</p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªæ±‚è§£æœ‰çº¦æŸéçº¿æ€§é—®é¢˜çš„ç¤ºä¾‹ï¼š</p><p>é—®é¢˜ä¸ºåœ¨å•ä½åœ†ç›˜ä¸Šæœ€å°åŒ– Rosenbrock å‡½æ•° <code>f(x,y)=100(yâˆ’x^2)^2+(1âˆ’x)^2</code>ï¼Œçº¦æŸæ¡ä»¶ä¸º <code>x^2+y^2&lt;=1</code>ã€‚</p><p>é¦–å…ˆæ‰§è¡Œä¸‹é¢ä¸€è¡Œä»£ç æŠŠåˆå€¼å†™å…¥å·¥ä½œåŒºã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab">x0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">% è¿­ä»£åˆå§‹ç‚¹(x, y) = (0, 0)</span></code></pre><p>ä¸‹é¢ä½¿ç”¨æ±‚è§£å™¨æ±‚è§£è¯¥é—®é¢˜ï¼Œç»“æœæ”¾å…¥ solution å’Œ objectiveValue å˜é‡ä¸­ã€‚å¯¹äºä¸åŒçš„é—®é¢˜ï¼Œå¯å‚ç…§ objectiveFcn å’Œ unitdisk å‡½æ•°è‡ªè¡Œä¿®æ”¹ã€‚</p><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token keyword">function</span> f <span class="token operator">=</span> <span class="token function">objectiveFcn</span><span class="token punctuation">(</span>optimInput<span class="token punctuation">)</span>    <span class="token comment">% ç¤ºä¾‹:</span>    <span class="token comment">% æœ€å°åŒ– Rosenbrock å‡½æ•°</span>    <span class="token comment">% f = 100*(y - x^2)^2 + (1 - x)^2</span>    <span class="token comment">% ç¼–è¾‘ä»¥ä¸‹è¡Œä»¥æ·»åŠ æ‚¨çš„è®¡ç®—æ–¹æ³•</span>    x <span class="token operator">=</span> <span class="token function">optimInput</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    y <span class="token operator">=</span> <span class="token function">optimInput</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    f <span class="token operator">=</span> <span class="token number">100</span><span class="token operator">*</span><span class="token punctuation">(</span>y <span class="token operator">-</span> x<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">end</span><span class="token keyword">function</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span>ceq<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">unitdisk</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    <span class="token comment">% ç¤ºä¾‹ï¼š</span>    <span class="token comment">% å•ä½åœ†ç›˜</span>    <span class="token comment">% ç¼–è¾‘ä»¥ä¸‹è¡Œä»¥æ·»åŠ æ‚¨çš„è®¡ç®—æ–¹æ³•</span>    <span class="token comment">% æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰ä¸ç­‰å¼çº¦æŸï¼Œè¯·æŒ‡å®š c = []</span>    <span class="token comment">% æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰ç­‰å¼çº¦æŸï¼Œè¯·æŒ‡å®š ceq = []</span>    c <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    ceq <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">end</span></code></pre><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% ä½¿ç”¨ dispå‡½æ•°æŸ¥çœ‹è¿è¡Œç»“æœ</span><span class="token function">disp</span><span class="token punctuation">(</span>solution<span class="token punctuation">)</span><span class="token function">disp</span><span class="token punctuation">(</span>objectiveValue<span class="token punctuation">)</span></code></pre><h1 id="æ›´å¤šåº”ç”¨"><a href="#æ›´å¤šåº”ç”¨" class="headerlink" title="æ›´å¤šåº”ç”¨"></a>æ›´å¤šåº”ç”¨</h1><h2 id="æ±‚è§£é»„é‡‘åˆ†å‰²æ¯”"><a href="#æ±‚è§£é»„é‡‘åˆ†å‰²æ¯”" class="headerlink" title="æ±‚è§£é»„é‡‘åˆ†å‰²æ¯”"></a>æ±‚è§£é»„é‡‘åˆ†å‰²æ¯”</h2><pre class="language-matlab" data-language="matlab"><code class="language-matlab"><span class="token comment">% è§£æ–¹ç¨‹</span>p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">% é™æ¬¡æ’åˆ—</span>r <span class="token operator">=</span> <span class="token function">roots</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token comment">% è§£æå­—ç¬¦ä¸²åè§£æ–¹ç¨‹</span>r <span class="token operator">=</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token string">'x-1=1/x'</span><span class="token punctuation">)</span>phi <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">% ç¬¦å·å˜é‡è§£æ–¹ç¨‹</span>syms x<span class="token punctuation">;</span>r <span class="token operator">=</span> <span class="token function">solve</span><span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token operator">/</span>x<span class="token punctuation">)</span>phi <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">% æ•°å€¼æ±‚è§£éçº¿æ€§æ–¹ç¨‹</span>f <span class="token operator">=</span> <span class="token operator">@</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1.</span><span class="token operator">/</span>x<span class="token function">ezplot</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>phi <span class="token operator">=</span> <span class="token function">fzero</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>hold on<span class="token function">plot</span><span class="token punctuation">(</span>phi<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">)</span><span class="token comment">% .m çš„ä¸¤ç§åŠŸèƒ½ï¼šè„šæœ¬æˆ–å‡½æ•°</span><span class="token comment">% In goldrect.m</span><span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span>u<span class="token punctuation">,</span>v<span class="token punctuation">,</span><span class="token string">'b--'</span><span class="token punctuation">)</span><span class="token function">text</span><span class="token punctuation">(</span>phi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1.05</span><span class="token punctuation">,</span> <span class="token string">'\phi'</span><span class="token punctuation">)</span>â€¦axis equalaxis off<span class="token function">set</span><span class="token punctuation">(</span>gcf<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span> <span class="token comment">% get current figure</span></code></pre><h2 id="Fibonacci"><a href="#Fibonacci" class="headerlink" title="Fibonacci"></a>Fibonacci</h2><pre class="language-matlab" data-language="matlab"><code class="language-matlab">f <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>tic<span class="token punctuation">,</span> <span class="token function">fibnum</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  toc <span class="token comment">% tic toc è®¡æ—¶å‘½ä»¤</span></code></pre><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li>æ— ç³» 2021-2022 å†¬ MatPyFly åŸ¹è®­çš„ MATLAB éƒ¨åˆ†è®²ä¹‰</li><li>ã€Šæ•°å€¼åˆ†æã€‹MATLAB ç®€ä»‹åŠå…¥é—¨.pptx</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¤§æ¦‚è®°å½•çš„æ˜¯ MATLAB çš„å…¥é—¨ä¹‹è·¯ã€‚åæ­£ã€Šæ•°å€¼åˆ†æã€‹è¯¾ç¨‹ä¹Ÿå¾—ç”¨ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/MATLAB" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-MATLAB/"/>
    
    
    <category term="MATLAB" scheme="https://www.c7w.tech/tags/MATLAB/"/>
    
  </entry>
  
  <entry>
    <title>ESLint é…ç½®æŒ‡åŒ—</title>
    <link href="https://www.c7w.tech/eslint/"/>
    <id>https://www.c7w.tech/eslint/</id>
    <published>2022-02-17T13:35:32.000Z</published>
    <updated>2022-02-17T16:49:46.534Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»ä»£ç è§„èŒƒè¯´èµ·"><a href="#ä»ä»£ç è§„èŒƒè¯´èµ·" class="headerlink" title="ä»ä»£ç è§„èŒƒè¯´èµ·"></a>ä»ä»£ç è§„èŒƒè¯´èµ·</h2><p>ç”±äºæˆ‘ä»¬æ¯ä¸ªäººå¯¹ JavaScript çš„ç†è§£ä¸åŒï¼Œç¼–å†™ä»£ç çš„ä¹ æƒ¯ä¹Ÿä¸åŒï¼Œæ‰€ä»¥åœ¨åˆä½œç¼–å†™é¡¹ç›®æ—¶ï¼Œéš¾å…ä¼šå‡ºç°ä»£ç é£æ ¼çš„ä¸åŒã€‚è¿™ç§å·®å¼‚æ€§å¯¼è‡´äº†å›¢é˜Ÿåä½œçš„æ•ˆç‡ä½ä¸‹ï¼Œä¹Ÿå½±å“äº†é¡¹ç›®çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä»£ç é£æ ¼è¿›è¡Œè§„èŒƒã€‚è¿™ç§è§„èŒƒä¸ä»…å¯ä»¥ä½¿ä»£ç é£æ ¼ä¿æŒç»Ÿä¸€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»£ç è¿è¡Œä¹‹å‰å°±æ£€æµ‹å‡ºä¸€äº›é”™è¯¯å’Œ Bugï¼Œæé«˜åä½œå¼€å‘æ•ˆç‡ã€‚</p><p>lint æ˜¯æœ€è‘—åçš„ C è¯­è¨€å·¥å…·ä¹‹ä¸€ï¼Œä½œç”¨æ˜¯é™æ€ä»£ç åˆ†æï¼Œå®ƒè¢«ç”¨äºæ£€æŸ¥ C ç¨‹åºä¸­æ½œåœ¨çš„é”™è¯¯ï¼ŒåŒ…æ‹¬ï¼ˆä½†ä¸é™äºï¼‰å¯ç–‘çš„ç±»å‹ç»„åˆã€æœªä½¿ç”¨çš„å˜é‡ã€ä¸å¯è¾¾çš„ä»£ç ä»¥åŠä¸å¯ç§»æ¤çš„ä»£ç ç­‰ç­‰ã€‚</p><p>è€Œ ESLint åˆ™æ˜¯ 2013 å¹´æ¨å‡ºçš„ JavaScript çš„ lint å·¥å…·ã€‚å‘½åå‰ç¼€çš„æ¥æºæ˜¯ç”±äº JavaScript ä¹Ÿè¢«ç§°ä¸º ECMAScriptï¼ˆESï¼‰ã€‚</p><p>ESLint æ˜¯åœ¨ ECMAScript/JavaScript ä»£ç ä¸­è¯†åˆ«å’ŒæŠ¥å‘Šæ¨¡å¼åŒ¹é…çš„å·¥å…·ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ä¿è¯ä»£ç çš„ä¸€è‡´æ€§å’Œé¿å…é”™è¯¯ã€‚</p><p>ESLint å¯ä»¥åœ¨è¿è¡Œä»£ç å‰å°±å‘ç°ä¸€äº›è¯­æ³•é”™è¯¯å’Œæ½œåœ¨çš„ Bugï¼Œæå¤§åœ°å‡è½»æµ‹è¯•äººå‘˜çš„å‹åŠ›ï¼Œå‡å°‘è½¯ä»¶é¡¹ç›®çš„é™¤é”™æˆæœ¬ã€‚åŒæ—¶ï¼ŒESLint å…è®¸å¼€å‘è€…é€šè¿‡ rules å®šä¹‰è‡ªå·±çš„ä»£ç è§„èŒƒï¼Œæ‰€ä»¥éå¸¸é€‚åˆç”¨äºåˆ¶å®šå›¢é˜Ÿä»£ç è§„èŒƒã€‚</p><a id="more"></a><h2 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h2><ul><li>å¼•å…¥ ESLintï¼šæ³¨æ„åªéœ€è¦å°†ä¾èµ–å®‰è£…åˆ°å¼€å‘ç¯å¢ƒ</li></ul><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> eslint --save-dev<span class="token comment"># or</span><span class="token function">yarn</span> <span class="token function">add</span> eslint --dev</code></pre><p>ç„¶åæˆ‘ä»¬è¾“å…¥ <code>npm init @eslint/config</code> æˆ– <code>yarn create @eslint/config</code> å›ç­”é—®é¢˜è¿›è¡Œé…ç½®ã€‚</p><p><img src="https://s2.loli.net/2022/02/17/nWjZaQvTKLcgdVm.png" alt="image-20220217215148544"></p><p>ä¹‹åå†ä½¿ç”¨ <code>yarn install</code> è¿›è¡Œä¾èµ–è¡¥å…¨ã€‚</p><p>ä»€ä¹ˆæ˜¯ <code>airbnb</code>ï¼Ÿä¸”å¬ä¸‹èŠ‚åˆ†è§£ã€‚</p><h2 id="å¸¸è§çš„æ ‡å‡†è§„èŒƒ"><a href="#å¸¸è§çš„æ ‡å‡†è§„èŒƒ" class="headerlink" title="å¸¸è§çš„æ ‡å‡†è§„èŒƒ"></a>å¸¸è§çš„æ ‡å‡†è§„èŒƒ</h2><p>æˆ‘ä»¬åœ¨ <code>eslintrc.js</code> ä¸­ä»¥ CommonJS æ ¼å¼è§„å®šæˆ‘ä»¬çš„æ ‡å‡†è§„èŒƒã€‚</p><pre class="language-json" data-language="json"><code class="language-json">module.exports = <span class="token punctuation">&#123;</span>  env<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    es2021<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  extends<span class="token operator">:</span> <span class="token punctuation">[</span>    'plugin<span class="token operator">:</span>react/recommended'<span class="token punctuation">,</span>    'airbnb'<span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  parser<span class="token operator">:</span> '@typescript-eslint/parser'<span class="token punctuation">,</span>  parserOptions<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    ecmaFeatures<span class="token operator">:</span> <span class="token punctuation">&#123;</span>      jsx<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    ecmaVersion<span class="token operator">:</span> 'latest'<span class="token punctuation">,</span>    sourceType<span class="token operator">:</span> 'module'<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>    'react'<span class="token punctuation">,</span>    '@typescript-eslint'<span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  rules<span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>;</code></pre><h3 id="eslint-recommended"><a href="#eslint-recommended" class="headerlink" title="eslint:recommended"></a><code>eslint:recommended</code></h3><ul><li>å‚è€ƒ <a href="https://eslint.org/docs/rules/ã€‚">https://eslint.org/docs/rules/ã€‚</a></li></ul><h3 id="eslint-standard"><a href="#eslint-standard" class="headerlink" title="eslint:standard"></a><code>eslint:standard</code></h3><p>standard æ˜¯åŸºäº recommended è¡ç”Ÿå‡ºæ¥çš„æ›´ä¸¥æ ¼çš„è§„èŒƒã€‚å…¶ä¸åè€…çš„ä¸åŒä¹‹å¤„ä¸»è¦æ˜¯ recommended å¾ˆå¤šéƒ½æ˜¯ off, standard æ˜¯ error, æ¯”å¦‚ <code>å•è¡Œä»£ç å—ä¸¤è¾¹åŠ ç©ºæ ¼</code>ã€<code>ç¦æ­¢ä½¿ç”¨åˆ†å·ç»“å°¾</code>ã€‚</p><p>å…ˆä½¿ç”¨ <code>npm i standard eslint-plugin-standard eslint-config-standard -D</code> å‘½ä»¤å®‰è£… <code>standard</code> æ’ä»¶ï¼Œç„¶ååœ¨ <code>eslintrc.js</code> æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹åï¼Œå°†ä¼šå¯ç”¨ standard è§„èŒƒï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  root<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'standard'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre><p>standard ä¼šæ¯” recommended æ›´åŠ ä¸¥æ ¼ï¼Œåœ¨ä»£ç é£æ ¼ä¸Šä¹Ÿåšäº†ä¸€äº›é™åˆ¶ã€‚ä¸è¿‡å®ƒçš„ç”¨æˆ·ç¾¤ä½“ä¹Ÿæ˜¯æ¯”è¾ƒå¤šçš„ï¼Œä¹Ÿä¸ä¹ä¸€äº›å¤§å®¶è€³ç†Ÿèƒ½è¯¦çš„ã€‚</p><p><img src="https://s2.loli.net/2022/02/17/cQrWjvtLeORM5AG.jpg" alt="image"></p><ul><li>å‚è€ƒï¼š<a href="https://standardjs.com/rules-zhcn.html">https://standardjs.com/rules-zhcn.html</a></li></ul><h3 id="Airbnb"><a href="#Airbnb" class="headerlink" title="Airbnb"></a><code>Airbnb</code></h3><p>Airbnb è§„èŒƒæ˜¯æœ€ä¸¥æ ¼çš„ ESLint è§„èŒƒï¼Œåˆ—å‡ºä¸‹é¢å‡ ç‚¹æ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«ï¼š</p><ol><li>é»˜è®¤å¿…é¡»è¦åˆ†å·ï¼Œè€Œ ESLint é»˜è®¤ä¸æ·»åŠ åˆ†å·</li><li>ä¸èƒ½ä½¿ç”¨ for å¾ªç¯ï¼Œæ¨èä½¿ç”¨æ•°ç»„è‡ªå¸¦çš„ API å®Œæˆéå†å·¥ä½œã€‚</li><li>å½“ä½ å¿…é¡»ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼ï¼ˆæˆ–ä¼ é€’ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼‰æ—¶ï¼Œä½¿ç”¨ç®­å¤´å‡½æ•°ç¬¦å·ã€‚</li></ol><p>é™¤äº†è¿™äº›ä»¥å¤–ï¼Œè¿˜æœ‰æ›´å¤šä¸¥æ ¼çš„è§„åˆ™ï¼Œå¯ä»¥å‚è€ƒï¼š</p><ul><li><a href="https://link.segmentfault.com/?enc=cUG%2BYxm078373Ai4Zl7xzg%3D%3D.mQwuT8A0xwjTxWnJCQBguM5%2BsxTvj%2FcbfNrhYRoEuzlOAiIikVMfCqL4fFnglX%2FQ">Airbnb è§„èŒƒ</a></li></ul><blockquote><ul><li>è¡¥å……ï¼š<strong>Babel-eslint</strong> ?</li></ul><p><a href="https://www.npmjs.com/package/@babel/eslint-parser">https://www.npmjs.com/package/@babel/eslint-parser</a></p><p>ESLintâ€™s default parser and core rules <a href="https://github.com/eslint/eslint/blob/a675c89573836adaf108a932696b061946abf1e6/README.md#what-about-experimental-features">only support the latest final ECMAScript standard</a> and do not support experimental (such as new features) and non-standard (such as Flow or TypeScript types) syntax provided by Babel. @babel/eslint-parser is a parser that allows ESLint to run on source code that is transformed by Babel.</p><p><strong>Note:</strong> You only need to use @babel/eslint-parser <strong>if you are using Babel to transform your code</strong>. If this is not the case, please use the relevant parser for your chosen flavor of ECMAScript (note that the default parser supports all non-experimental syntax as well as JSX).</p></blockquote><h2 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h2><p>ç›´æ¥è¯´ç»“è®ºï¼Œä½¿ç”¨ä»¥ä¸‹æ’ä»¶ï¼š</p><ul><li>@typescript-eslint/parser</li><li>@typescript-eslint/eslint-plugin</li></ul><p>åœ¨ä¸Šè¿°å›ç­”é—®é¢˜çš„è¿‡ç¨‹ä¸­ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è¡¥å…¨åœ¨ <code>package.json</code> ä¸­ã€‚</p><h2 id="å¯¹ç…§ï¼šPrettier"><a href="#å¯¹ç…§ï¼šPrettier" class="headerlink" title="å¯¹ç…§ï¼šPrettier"></a>å¯¹ç…§ï¼šPrettier</h2><blockquote><ul><li>ä»€ä¹ˆæ˜¯ Prettier</li></ul><p>Prettier åœ¨è‡ªå·±å®˜ç½‘é¦–é¡µåˆ—å‡ºè¿™ä¹ˆä¸‰ç‚¹ï¼š</p><ul><li>An opinionated code formatter</li><li>Supports many languages</li><li>Integrates with most editors</li><li>Has few options</li></ul><p>å®˜æ–¹é¦–å…ˆå‘Šè¯‰ä½ ï¼ŒPrettier æ˜¯ä¸€ä¸ª <strong>Opinionated</strong> çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚æ‰€ä»¥è¦æŒæ¡ Prettier çš„ç²¾é«“å°±æ˜¯è¦ç†è§£è¿™ä¸ªå•è¯ã€‚</p><p>å¯¹æ¯” Angular, ExpressJS å’Œ SpringBoot çš„ Unopinionatedï¼ŒPrettier è¯´è‡ªå·±æ˜¯ä¸€ä¸ª Opinionated code formatterï¼Œå°±æ˜¯è¯´ï¼šä½ å¿…é¡»è®¤åŒæˆ‘çš„è§‚ç‚¹ï¼ŒæŒ‰ç…§æˆ‘è¯´çš„åšã€‚å¦åˆ™ä½ å°±åˆ«ç”¨æˆ‘ï¼Œç¡¬ç€å¤´çš®ç”¨å°±ä¼šå¤„å¤„ä¸çˆ½ï¼</p><p>Has few optionsï¼Œå…¶å®å°±æ˜¯ Opinionated çš„æœ€ç›´æ¥ä½“ç°ã€‚é™¤äº†å¿…è¦çš„è®¾ç½®é¡¹ï¼Œä¸ä¼šå†ç»™ä½ ä»¬æ›´å¤šã€‚ç»™ä½ è®¾ç½®é¡¹è¶Šå¤šï¼Œä½ ä»¬è¶Šä¹±ï¼Œä½ ä»¬å°±ä¼šç»§ç»­äº‰åµï¼</p><p>Prettier çš„åŸç†éå¸¸ç®€å•ï¼š</p><p>ä¸ç®¡ä½ å†™çš„ä»£ç æ˜¯ä¸ªä»€ä¹ˆé¬¼æ ·å­ï¼ŒPrettier ä¼šå»æ‰ä½ ä»£ç é‡Œçš„æ‰€æœ‰æ ·å¼é£æ ¼ï¼Œç„¶åç”¨ç»Ÿä¸€å›ºå®šçš„æ ¼å¼é‡æ–°è¾“å‡ºã€‚è¾“å‡ºæ—¶åŸºæœ¬ä¸Šåªè€ƒè™‘ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯ line lengthã€‚</p></blockquote><p>è€Œ Prettier ä¸ Linters æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><blockquote><ul><li>Formatting rules</li></ul><p>å½“ ESLint é‡åˆ°ä¸Šé¢çš„ incorrect code çš„æ—¶å€™ï¼Œä¼šæç¤ºä½ è¿åè§„åˆ™ï¼Œè®©ä½ ä¿®æ”¹ä»£ç ä»¥ç¬¦åˆè§„åˆ™ã€‚</p><p>è€Œ Prettier åˆ™ä¸ä¼šè¿™ä¹ˆéº»çƒ¦ï¼Œå®ƒæ ¹æœ¬ä¸ç®¡ä½ ä¹‹å‰ç¬¦ä¸ç¬¦åˆä»€ä¹ˆè§„åˆ™ï¼Œéƒ½å…ˆæŠŠä½ çš„ä»£ç è§£ææˆ ASTï¼Œç„¶åæŒ‰ç…§å®ƒè‡ªå·±çš„é£æ ¼ç»™ä½ é‡æ–°è¾“å‡ºä»£ç ã€‚</p><p>æ¢å¥è¯è¯´ï¼ŒPrettier å¯¹åº”çš„æ˜¯å„ç§ Linters çš„ Formatting rules è¿™ä¸€ç±»è§„åˆ™ã€‚è€Œä¸”ä½ ç”¨äº† Prettier ä¹‹åï¼Œå°±ä¸ä¼šå†è¿åè¿™ç±»è§„åˆ™äº†ï¼ä¸éœ€è¦ä½ è‡ªå·±æ‰‹åŠ¨ä¿®æ”¹ä»£ç ã€‚</p><ul><li>Code-quality rules</li></ul><p>Prettier å¯¹è¿™ç±»è§„åˆ™æŸæ‰‹æ— ç­–ã€‚è€Œä¸”è¿™ç±»è§„åˆ™ä¹Ÿæ­£æ˜¯å„ç§ Linters çš„é‡ç‚¹ï¼Œå› ä¸ºå®ƒä»¬çœŸçš„èƒ½å¸®ä½ å‘ç°å¾ˆå¤šä½çº§çš„ Bugã€‚</p><p>æ‰€ä»¥ï¼ŒPrettier å¹¶ä¸ä¼šå–ä»£å„ç§ Lintersï¼Œè€Œæ˜¯èƒ½é¿å…ä½ çš„ä»£ç å’Œè¿™äº› Linters å®šä¹‰çš„ Formatting rules å†²çªã€‚Linters æ£€æŸ¥å‡ºæ¥è¿å Code-quality rules çš„æƒ…å†µåè¿˜éœ€è¦ä½ è‡ªå·±æ ¹æ®ä¸šåŠ¡é€»è¾‘å’Œè¯­æ³•æ‰‹åŠ¨ä¿®æ”¹ã€‚Prettier å¸®ä½ æ ¼å¼åŒ–ä»£ç ï¼Œä½†æ˜¯ä¸ä¼šå¸®ä½ æŒ‘å‡ºæ½œåœ¨çš„é”™è¯¯ã€‚</p><p>é‚£ä¹ˆæ—¢è¦è®© Prettier å¸®ä½ æ ¼å¼åŒ–ä»£ç ï¼Œè¿˜æƒ³è®© Linters å¸®ä½ æŒ‘å‡ºæ½œåœ¨çš„ Code-quality ç±»é”™è¯¯ï¼Œæ€ä¹ˆåŠï¼Ÿå°±éœ€è¦ Prettier å’Œ Linters é…åˆä½¿ç”¨ã€‚</p></blockquote><p>ä»¥ä¸Šæ‘˜è‡ªï¼šå‚è€ƒèµ„æ–™ä¸­çš„ã€ŠPrettierã€‹æ–‡</p><p>ç°åœ¨ ESLint ä¹Ÿæœ‰äº† <code>--fix</code> åŠŸèƒ½ï¼Œæš‚ä¸”æç½®ä¸€ä¸‹ Prettier çš„å­¦ä¹ ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>// TODO</p><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="husky"><a href="#husky" class="headerlink" title="husky"></a><code>husky</code></h3><p>åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–å¹¶ä¸æ€»æ˜¯è®©äººå®‰å¿ƒçš„ï¼Œå› ä¸ºå¹¶ä¸æ˜¯é¡¹ç›®ç»„çš„æ‰€æœ‰æˆå‘˜éƒ½ä¼šä½¿ç”¨æ’ä»¶æ¥åšè‡ªåŠ¨æ ¼å¼åŒ–ã€‚</p><p>è¿™æ ·çš„æƒ…å†µä¼šå¯¼è‡´æœ‰ä¸€äº›ä¸è§„èŒƒçš„ä»£ç è¢«æäº¤åˆ°æœåŠ¡ç«¯ï¼Œä¾ç„¶ä¼šé€ æˆå›¢é˜Ÿè§„èŒƒä¸ä¸€è‡´çš„é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°æäº¤æ—¶è‡ªåŠ¨æ£€æµ‹å’Œæ ¼å¼åŒ–ä»£ç çš„åŠŸèƒ½ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>husky</code> Hook æ¥è¿›è¡Œä»£ç æäº¤æ—¶çš„è‡ªåŠ¨æ£€æµ‹å·¥ä½œã€‚</p><p>å…ˆä½¿ç”¨ <code>npm i husky -D</code> å®‰è£…ä¾èµ–ï¼Œåœ¨ä¾èµ–å®Œæˆå®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤åˆå§‹åŒ– <code>husky</code>ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">husky <span class="token function">install</span>npx husky <span class="token function">add</span> .husky/pre-commit <span class="token string">"npm pre-commit"</span></code></pre><p>æˆ‘ä»¬è¿˜éœ€è¦åœ¨é¡¹ç›®çš„ <code>package.json</code> ä¸­ï¼Œæ·»åŠ  <code>pre-commit</code>ï¼Œè¿™ä¸ªå‘½ä»¤è¿è¡Œæ—¶è¿›è¡Œ <code>eslint</code> æ£€æµ‹ï¼ˆå¦‚ä¸‹ï¼‰ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token property">"pre-commit"</span><span class="token operator">:</span> <span class="token string">"eslint src"</span><span class="token punctuation">&#125;</span></code></pre><h3 id="lint-staged"><a href="#lint-staged" class="headerlink" title="lint-staged"></a><code>lint-staged</code></h3><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨æ£€æµ‹é”™è¯¯çš„åŒæ—¶ï¼Œè‡ªåŠ¨ä¿®å¤ <code>eslint</code> è¯­æ³•é”™è¯¯ï¼Œåˆ™éœ€è¦ç”¨åˆ° <code>lint-staged</code>ï¼Œä½¿ç”¨ <code>npm i lint-staged -D</code> å…ˆè¿›è¡Œå®‰è£…ï¼Œç„¶ååœ¨ <code>package.json</code> ä¸­ä¿®æ”¹ <code>pre-commit</code> å‘½ä»¤ï¼Œå†æ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token property">"pre-commit"</span><span class="token operator">:</span> <span class="token string">"lint-staged"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"lint-staged"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token property">"src/**"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"eslint --fix"</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span></code></pre><p><code>lint-staged</code> Repo åœ°å€ï¼š<a href="https://github.com/okonet/lint-staged">https://github.com/okonet/lint-staged</a></p><p><code>lint-staged</code> é’ˆå¯¹æš‚å­˜çš„ git æ–‡ä»¶è¿è¡Œ lintersï¼Œä¸è¦è®©ä¸ç¬¦åˆè§„åˆ™çš„ä»£ç æºœè¿›ä»£ç åº“ã€‚<code>lint-staged</code>æ€»æ˜¯å°† <strong>æ‰€æœ‰æš‚å­˜æ–‡ä»¶çš„åˆ—è¡¨ä¼ é€’ç»™ä»»åŠ¡</strong>ï¼Œå¿½ç•¥ä»»ä½•æ–‡ä»¶éƒ½åº”è¯¥åœ¨ä»»åŠ¡æœ¬èº«ä¸­é…ç½®ï¼Œæ¯”å¦‚ï¼š<code>.prettierignore</code> / <code>.eslintignore</code> ã€‚lint-stage æ€»æ˜¯é…åˆ husky ä¸€èµ·ä½¿ç”¨ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://segmentfault.com/a/1190000016626739">åœ¨Reacté¡¹ç›®ä¸­ä½¿ç”¨Eslintä»£ç æ£€æŸ¥å·¥å…·</a></li><li><a href="https://eslint.org/docs/user-guide/getting-started">Getting Started with ESLint</a></li><li><a href="https://segmentfault.com/a/1190000039880312">ä»é¡¹ç›®è§„èŒƒï¼ˆeslint + prettierï¼‰åˆ°è‡ªåŠ¨åŒ–é…ç½®</a></li><li><a href="https://zhuanlan.zhihu.com/p/81764012">Prettier</a></li><li><a href="https://zhuanlan.zhihu.com/p/62401626">ä½¿ç”¨ESLint+Prettierè§„èŒƒReact+Typescripté¡¹ç›®</a></li><li><a href="https://juejin.cn/post/6844903901292920846">æ·±å…¥ç†è§£ ESlint</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ä»ä»£ç è§„èŒƒè¯´èµ·&quot;&gt;&lt;a href=&quot;#ä»ä»£ç è§„èŒƒè¯´èµ·&quot; class=&quot;headerlink&quot; title=&quot;ä»ä»£ç è§„èŒƒè¯´èµ·&quot;&gt;&lt;/a&gt;ä»ä»£ç è§„èŒƒè¯´èµ·&lt;/h2&gt;&lt;p&gt;ç”±äºæˆ‘ä»¬æ¯ä¸ªäººå¯¹ JavaScript çš„ç†è§£ä¸åŒï¼Œç¼–å†™ä»£ç çš„ä¹ æƒ¯ä¹Ÿä¸åŒï¼Œæ‰€ä»¥åœ¨åˆä½œç¼–å†™é¡¹ç›®æ—¶ï¼Œéš¾å…ä¼šå‡ºç°ä»£ç é£æ ¼çš„ä¸åŒã€‚è¿™ç§å·®å¼‚æ€§å¯¼è‡´äº†å›¢é˜Ÿåä½œçš„æ•ˆç‡ä½ä¸‹ï¼Œä¹Ÿå½±å“äº†é¡¹ç›®çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä»£ç é£æ ¼è¿›è¡Œè§„èŒƒã€‚è¿™ç§è§„èŒƒä¸ä»…å¯ä»¥ä½¿ä»£ç é£æ ¼ä¿æŒç»Ÿä¸€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»£ç è¿è¡Œä¹‹å‰å°±æ£€æµ‹å‡ºä¸€äº›é”™è¯¯å’Œ Bugï¼Œæé«˜åä½œå¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;lint æ˜¯æœ€è‘—åçš„ C è¯­è¨€å·¥å…·ä¹‹ä¸€ï¼Œä½œç”¨æ˜¯é™æ€ä»£ç åˆ†æï¼Œå®ƒè¢«ç”¨äºæ£€æŸ¥ C ç¨‹åºä¸­æ½œåœ¨çš„é”™è¯¯ï¼ŒåŒ…æ‹¬ï¼ˆä½†ä¸é™äºï¼‰å¯ç–‘çš„ç±»å‹ç»„åˆã€æœªä½¿ç”¨çš„å˜é‡ã€ä¸å¯è¾¾çš„ä»£ç ä»¥åŠä¸å¯ç§»æ¤çš„ä»£ç ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ ESLint åˆ™æ˜¯ 2013 å¹´æ¨å‡ºçš„ JavaScript çš„ lint å·¥å…·ã€‚å‘½åå‰ç¼€çš„æ¥æºæ˜¯ç”±äº JavaScript ä¹Ÿè¢«ç§°ä¸º ECMAScriptï¼ˆESï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ESLint æ˜¯åœ¨ ECMAScript/JavaScript ä»£ç ä¸­è¯†åˆ«å’ŒæŠ¥å‘Šæ¨¡å¼åŒ¹é…çš„å·¥å…·ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ä¿è¯ä»£ç çš„ä¸€è‡´æ€§å’Œé¿å…é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ESLint å¯ä»¥åœ¨è¿è¡Œä»£ç å‰å°±å‘ç°ä¸€äº›è¯­æ³•é”™è¯¯å’Œæ½œåœ¨çš„ Bugï¼Œæå¤§åœ°å‡è½»æµ‹è¯•äººå‘˜çš„å‹åŠ›ï¼Œå‡å°‘è½¯ä»¶é¡¹ç›®çš„é™¤é”™æˆæœ¬ã€‚åŒæ—¶ï¼ŒESLint å…è®¸å¼€å‘è€…é€šè¿‡ rules å®šä¹‰è‡ªå·±çš„ä»£ç è§„èŒƒï¼Œæ‰€ä»¥éå¸¸é€‚åˆç”¨äºåˆ¶å®šå›¢é˜Ÿä»£ç è§„èŒƒã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/JavaScript" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-JavaScript/"/>
    
    
    <category term="JavaScript" scheme="https://www.c7w.tech/tags/JavaScript/"/>
    
    <category term="ESLint" scheme="https://www.c7w.tech/tags/ESLint/"/>
    
  </entry>
  
  <entry>
    <title>ElasticSearch å®ç°æœç´¢ç½‘ç«™çºªå®</title>
    <link href="https://www.c7w.tech/elasticsearch/"/>
    <id>https://www.c7w.tech/elasticsearch/</id>
    <published>2022-02-15T13:56:16.000Z</published>
    <updated>2022-03-03T14:24:58.613Z</updated>
    
    <content type="html"><![CDATA[<p>äº‹å®ä¸Šæ˜¯æŒ‘æˆ˜æ¯è¦æ­ä¸€ä¸ªæ–‡ä¹¦æœç´¢ç½‘ç«™â€¦æš‚æ—¶éœ€è¦ç”¨ BM25 ç®—æ³•é¡¶ä¸€ä¸‹ã€‚</p><p>Elasticsearch çš„é»˜è®¤ç›¸ä¼¼åº¦ç®—æ³•å°±æ˜¯ BM25ï¼Œå˜›å˜›ï¼Œå¤§èƒœåˆ©ã€‚</p><p>æœç´¢çš„å¯¹è±¡æ˜¯â€¦æ•°ç›®çº¦åœ¨ $10^8$ è§„æ¨¡å·¦å³çš„æ–‡æ¡£â€¦</p><p>å˜›å˜›ï¼Œåæ­£éƒ½æ˜¯å¤§è°ƒåº“ã€‚ç¼åˆå°±å®Œäº‹äº†ã€‚</p><p>// WIP: åº”è¯¥ä¸ä¼šå’•</p><a id="more"></a><h2 id="ç´¢å¼•ç®—æ³•"><a href="#ç´¢å¼•ç®—æ³•" class="headerlink" title="ç´¢å¼•ç®—æ³•"></a>ç´¢å¼•ç®—æ³•</h2><p>æˆ‘ä»¬é¦–å…ˆä»‹ç»ä¸‹ Sparse Retrieval çš„ä¸»è¦ç®—æ³•ï¼ŒTF-IDF ç®—æ³•å’Œ BM25 ç®—æ³•ã€‚</p><h3 id="TF-IDF"><a href="#TF-IDF" class="headerlink" title="TF-IDF"></a>TF-IDF</h3><p>TF æ˜¯æŒ‡å½’ä¸€åŒ–çš„è¯é¢‘ï¼ŒIDF æ˜¯æŒ‡é€†æ–‡æ¡£é¢‘ç‡ã€‚ç»™å®šæ–‡æ¡£é›†åˆ $D$ï¼Œæœ‰ $d_i \in D, 1 \le i \le n$. </p><p>æ–‡æ¡£é›†åˆæ€»å…±åŒ…å« $m$â€‹ ä¸ªè¯ï¼Œå»é™¤ä¸€äº›ååˆ†å¸¸è§çš„è¯ä½œä¸ºåœç”¨è¯ï¼ˆStop Wordsï¼‰ï¼Œæœ‰ $w_i \in W, 1 \le i \le m$â€‹.</p><p>å®šä¹‰ TF å¦‚ä¸‹ï¼Œå³ä¸€ç¯‡æ–‡æ¡£ä¸­æŸä¸ªè¯å‡ºç°çš„é¢‘ç‡ï¼š</p><script type="math/tex; mode=display">\text{TF}(q_i, d_j) = \dfrac {f_{i, d_j}}{ |d_j| }</script><p>TF åªèƒ½æè¿°è¯åœ¨æ–‡æ¡£ä¸­çš„é¢‘ç‡ï¼Œä½†å‡è®¾ç°åœ¨æœ‰ä¸ªè¯ä¸ºâ€œæˆ‘ä»¬â€ï¼Œè¿™ä¸ªè¯å¯èƒ½åœ¨æ–‡æ¡£é›† $D$ ä¸­æ¯ç¯‡æ–‡æ¡£ä¸­éƒ½ä¼šå‡ºç°ï¼Œå¹¶ä¸”æœ‰è¾ƒé«˜çš„é¢‘ç‡ã€‚é‚£ä¹ˆè¿™ä¸€ç±»è¯å°±ä¸å…·æœ‰å¾ˆå¥½çš„åŒºåˆ†æ–‡æ¡£çš„èƒ½åŠ›ï¼Œä¸ºäº†é™ä½è¿™ç§é€šç”¨è¯çš„ä½œç”¨ï¼Œå¼•å…¥äº† IDFï¼š</p><script type="math/tex; mode=display">\text{IDF}(q_i) = \ln \dfrac {|D|}{|\{d_i  : q_i \in d_i \}|}</script><p>äºæ˜¯æˆ‘ä»¬ç»¼åˆè¿™ä¸¤éƒ¨åˆ†ï¼Œ ä¾¿å¯ä»¥å¾—åˆ° TF-IDFï¼š</p><script type="math/tex; mode=display">\text{TF-IDF} = \text{TF} * \text{IDF}</script><p>TF å¯ä»¥è®¡ç®—åœ¨ä¸€ç¯‡æ–‡æ¡£ä¸­è¯å‡ºç°çš„é¢‘ç‡ï¼Œè€Œ IDF å¯ä»¥é™ä½ä¸€äº›é€šç”¨è¯çš„ä½œç”¨ã€‚å› æ­¤å¯¹äºä¸€ç¯‡æ–‡æ¡£æˆ‘ä»¬å¯ä»¥ç”¨æ–‡æ¡£ä¸­æ¯ä¸ªè¯çš„ TFâˆ’IDF ç»„æˆçš„å‘é‡æ¥è¡¨ç¤ºè¯¥æ–‡æ¡£ï¼Œå†æ ¹æ®ä½™å¼¦ç›¸ä¼¼åº¦è¿™ç±»çš„æ–¹æ³•æ¥è®¡ç®—æ–‡æ¡£ä¹‹é—´çš„ç›¸å…³æ€§ã€‚</p><h3 id="BM25"><a href="#BM25" class="headerlink" title="BM25"></a>BM25</h3><p>BM25 æ˜¯ä¿¡æ¯ç´¢å¼•é¢†åŸŸç”¨æ¥è®¡ç®— query ä¸æ–‡æ¡£ç›¸ä¼¼åº¦å¾—åˆ†çš„ç»å…¸ç®—æ³•ã€‚</p><p>ä¸åŒäº TF-IDFï¼ŒBM25 çš„å…¬å¼ä¸»è¦ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ol><li>query ä¸­æ¯ä¸ªå•è¯ $q_i$ ä¸æ–‡æ¡£ $d$ ä¹‹é—´çš„ç›¸å…³æ€§</li><li>å•è¯ $q_i$ ä¸ query ä¹‹é—´çš„ç›¸ä¼¼æ€§</li><li>æ¯ä¸ªå•è¯çš„æƒé‡</li></ol><p>BM25 ç®—æ³•çš„ä¸€èˆ¬å…¬å¼ï¼š</p><script type="math/tex; mode=display">score(Q,d) = \sum_i^n W_i R(q_i, d)</script><p>å…¶ä¸­ $Q$ è¡¨ç¤º queryï¼Œ$q_i \in Q$ï¼Œ$d$â€‹ è¡¨ç¤º document.</p><p>ä¸‹å±•å¼€ä»‹ç»å„éƒ¨åˆ†å…¬å¼ï¼š</p><ul><li><strong>$W_i$</strong></li></ul><script type="math/tex; mode=display">W_i = IDF(q_i) = \ln \dfrac {N-df_i+0.5}{df_i+0.5}</script><p>å…¶ä¸­ $N$â€‹â€‹ æ˜¯ document æ€»æ•°ï¼Œ$df_i$â€‹ è¡¨ç¤ºå«æœ‰ $q_i$â€‹ çš„æ–‡æ¡£æ€»æ•°ã€‚</p><p>ä¾æ® IDF çš„ä½œç”¨ï¼Œå¯¹äºæŸä¸ª $q_i$â€‹ ï¼ŒåŒ…å« $q_i$ çš„æ–‡æ¡£æ•°è¶Šå¤šï¼Œè¯´æ˜ $q_i$ é‡è¦æ€§è¶Šå°ï¼Œæˆ–è€…åŒºåˆ†åº¦è¶Šä½ï¼ŒIDF è¶Šå°ï¼Œå› æ­¤ IDF å¯ä»¥ç”¨æ¥åˆ»ç”» $q_i$ ä¸æ–‡æ¡£çš„ç›¸ä¼¼æ€§ã€‚</p><ul><li><strong>$R(q_i, d)$â€‹</strong></li></ul><p>BM25 çš„è®¾è®¡ä¾æ®ä¸€ä¸ªé‡è¦çš„å‘ç°ï¼š<strong>è¯é¢‘å’Œç›¸å…³æ€§ä¹‹é—´çš„å…³ç³»æ˜¯éçº¿æ€§çš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªè¯å¯¹äºæ–‡æ¡£çš„ç›¸å…³æ€§åˆ†æ•°ä¸ä¼šè¶…è¿‡ä¸€ä¸ªç‰¹å®šçš„é˜ˆå€¼ï¼Œå½“è¯å‡ºç°çš„æ¬¡æ•°è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼åï¼Œå…¶å½±å“å°±ä¸åœ¨çº¿æ€§å¢åŠ äº†ï¼Œè€Œè¿™ä¸ªé˜ˆå€¼ä¼šè·Ÿæ–‡æ¡£æœ¬èº«æœ‰å…³ã€‚</p><script type="math/tex; mode=display">R(q_i, d) = \dfrac {f_i \cdot (k_1+1)}{f_i+K} \cdot \dfrac {qf_i \cdot(k_2+1)}{qf_i+k_2}</script><p>æˆ‘ä»¬å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†æ¥çœ‹å¾…ä¸Šè¿°å…¬å¼ï¼Œå…¶ä¸­ $f_i$â€‹ ä¸º $q_i$â€‹ åœ¨ $d$â€‹ ä¸­å‡ºç°çš„æ¬¡æ•°ï¼Œ$k_1, k_2, K$â€‹ æ˜¯å¸¸æ•°ã€‚</p><p>åä¸€éƒ¨åˆ† $\dfrac {qf_i \cdot(k_2+1)}{qf_i+k_2}$ åœ¨æ§åˆ¶ $q_i$â€‹ å’Œ Query çš„ç›¸ä¼¼åº¦ã€‚</p><p>å‰ä¸€éƒ¨åˆ†åœ¨è®¡ç®— $q_i$ ä¸ $d$â€‹ çš„ç›¸ä¼¼åº¦ï¼Œå…¶ä¸­ $K = k_1 \cdot (1-b+b\cdot \dfrac {|d|}{AVG_n(|d|)})$ï¼Œå‚æ•° $b$ åœ¨è°ƒèŠ‚æ–‡æœ¬é•¿åº¦å¯¹ç›¸å…³æ€§çš„å½±å“ã€‚</p><p>ä¸å¤±ä¸€èˆ¬æ€§åœ°æˆ‘ä»¬å¯ä»¥å– $k_1 = 2, k_2 = 0, b = 0.75$â€‹.</p><p>åæ­£åœ¨æ¥ä¸‹æ¥çš„è¿ç”¨ä¹Ÿæ˜¯å¤§è°ƒåº“ï¼Œè°ƒå‚æ•°å¯ä»¥é€šè¿‡æ›´æ”¹é…ç½®æ–‡ä»¶æ¥è¿›è¡Œã€‚</p><h2 id="ç½‘ç«™æ­å»ºçºªå®ï¼šElasticsearch"><a href="#ç½‘ç«™æ­å»ºçºªå®ï¼šElasticsearch" class="headerlink" title="ç½‘ç«™æ­å»ºçºªå®ï¼šElasticsearch"></a>ç½‘ç«™æ­å»ºçºªå®ï¼šElasticsearch</h2><blockquote><p><strong>Elasticsearch</strong> is the distributed <strong>search and analytics engine</strong> at the heart of the Elastic Stack. <em>Logstash</em> and <em>Beats</em> facilitate collecting, aggregating, and enriching your data and storing it in Elasticsearch. <em>Kibana</em> enables you to interactively explore, visualize, and share insights into your data and manage and monitor the stack. <strong>Elasticsearch is where the indexing, search, and analysis magic happens.</strong></p><p>Elasticsearch æ˜¯ä¸€ä¸ªå¼€æºçš„æœç´¢å¼•æ“ï¼Œå»ºç«‹åœ¨ä¸€ä¸ªå…¨æ–‡æœç´¢å¼•æ“åº“ Apache Luceneâ„¢ åŸºç¡€ä¹‹ä¸Šã€‚</p><p>é‚£ Lucene åˆæ˜¯ä»€ä¹ˆï¼ŸLucene å¯èƒ½æ˜¯ç›®å‰å­˜åœ¨çš„ï¼Œä¸è®ºå¼€æºè¿˜æ˜¯ç§æœ‰çš„ï¼Œæ‹¥æœ‰æœ€å…ˆè¿›ï¼Œé«˜æ€§èƒ½å’Œå…¨åŠŸèƒ½æœç´¢å¼•æ“åŠŸèƒ½çš„åº“ï¼Œä½†ä¹Ÿä»…ä»…åªæ˜¯ä¸€ä¸ªåº“ã€‚</p><p>è¦ç”¨ä¸Š Luceneï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ Java å¹¶å¼•ç”¨ Lucene åŒ…æ‰å¯ä»¥ï¼Œè€Œä¸”æˆ‘ä»¬éœ€è¦å¯¹ä¿¡æ¯æ£€ç´¢æœ‰ä¸€å®šç¨‹åº¦çš„ç†è§£æ‰èƒ½æ˜ç™½ Lucene æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œåæ­£ç”¨èµ·æ¥æ²¡é‚£ä¹ˆç®€å•ã€‚</p><p>é‚£ä¹ˆä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒElasticsearch å°±è¯ç”Ÿäº†ã€‚Elasticsearch ä¹Ÿæ˜¯ä½¿ç”¨ Java ç¼–å†™çš„ï¼Œå®ƒçš„å†…éƒ¨ä½¿ç”¨ Lucene åšç´¢å¼•ä¸æœç´¢ï¼Œä½†æ˜¯å®ƒçš„ç›®æ ‡æ˜¯ä½¿å…¨æ–‡æ£€ç´¢å˜å¾—ç®€å•ï¼Œç›¸å½“äº Lucene çš„ä¸€å±‚å°è£…ï¼Œå®ƒæä¾›äº†ä¸€å¥—ç®€å•ä¸€è‡´çš„ RESTful API æ¥å¸®åŠ©æˆ‘ä»¬å®ç°å­˜å‚¨å’Œæ£€ç´¢ã€‚</p><p>æ‰€ä»¥ Elasticsearch ä»…ä»…å°±æ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Lucene å°è£…å—ï¼Ÿé‚£å°±å¤§é”™ç‰¹é”™äº†ï¼ŒElasticsearch ä¸ä»…ä»…æ˜¯ Luceneï¼Œå¹¶ä¸”ä¹Ÿä¸ä»…ä»…åªæ˜¯ä¸€ä¸ªå…¨æ–‡æœç´¢å¼•æ“ã€‚å®ƒå¯ä»¥è¢«ä¸‹é¢è¿™æ ·å‡†ç¡®çš„å½¢å®¹ï¼š</p><ul><li>ä¸€ä¸ªåˆ†å¸ƒå¼çš„å®æ—¶æ–‡æ¡£å­˜å‚¨ï¼Œæ¯ä¸ªå­—æ®µå¯ä»¥è¢«ç´¢å¼•ä¸æœç´¢</li><li>ä¸€ä¸ªåˆ†å¸ƒå¼å®æ—¶åˆ†ææœç´¢å¼•æ“</li><li>èƒ½èƒœä»»ä¸Šç™¾ä¸ªæœåŠ¡èŠ‚ç‚¹çš„æ‰©å±•ï¼Œå¹¶æ”¯æŒ PB çº§åˆ«çš„ç»“æ„åŒ–æˆ–è€…éç»“æ„åŒ–æ•°æ®</li></ul><p>æ€»ä¹‹ï¼Œæ˜¯ä¸€ä¸ªç›¸å½“ç‰›é€¼çš„æœç´¢å¼•æ“ï¼Œç»´åŸºç™¾ç§‘ã€Stack Overflowã€GitHub éƒ½çº·çº·é‡‡ç”¨å®ƒæ¥åšæœç´¢ã€‚</p></blockquote><p>æ€»ä¹‹æˆ‘ä»¬å…ˆæ¥åˆ°äº†ä¸‹è½½ç½‘ç«™çœ‹çœ‹ï¼š<a href="https://www.elastic.co/cn/downloads/elasticsearchã€‚ç„¶åé€‰æ‹©äº†é€‚ç”¨">https://www.elastic.co/cn/downloads/elasticsearchã€‚ç„¶åé€‰æ‹©äº†é€‚ç”¨</a> Linux çš„å®‰è£…æ–¹å¼ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/targz.htmlã€‚ç„¶åå°±æ˜¯æŠŠ">https://www.elastic.co/guide/en/elasticsearch/reference/current/targz.htmlã€‚ç„¶åå°±æ˜¯æŠŠ</a> <code>./config/elasticsearch.yml</code> çš„å…³äºå®‰å…¨çš„è®¾å®šå…¨éƒ¨è®¾ç½®æˆ <code>false</code>ï¼ˆæ¯•ç«Ÿè¿˜è¦è¿‡ä¸€å±‚ Django è½¬æ¥ï¼‰ã€‚ç„¶åæ‰§è¡Œ <code>curl localhost:9200</code>ï¼Œè¿”å›ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"thunlp-3"</span><span class="token punctuation">,</span>  <span class="token property">"cluster_name"</span> <span class="token operator">:</span> <span class="token string">"elasticsearch"</span><span class="token punctuation">,</span>  <span class="token property">"cluster_uuid"</span> <span class="token operator">:</span> <span class="token string">"7O7KbQ6hQGOUieAXeKm10g"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"number"</span> <span class="token operator">:</span> <span class="token string">"8.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"build_flavor"</span> <span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>    <span class="token property">"build_type"</span> <span class="token operator">:</span> <span class="token string">"tar"</span><span class="token punctuation">,</span>    <span class="token property">"build_hash"</span> <span class="token operator">:</span> <span class="token string">"1b6a7ece17463df5ff54a3e1302d825889aa1161"</span><span class="token punctuation">,</span>    <span class="token property">"build_date"</span> <span class="token operator">:</span> <span class="token string">"2022-02-03T16:47:57.507843096Z"</span><span class="token punctuation">,</span>    <span class="token property">"build_snapshot"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"lucene_version"</span> <span class="token operator">:</span> <span class="token string">"9.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"minimum_wire_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"7.17.0"</span><span class="token punctuation">,</span>    <span class="token property">"minimum_index_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"7.0.0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"tagline"</span> <span class="token operator">:</span> <span class="token string">"You Know, for Search"</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>è§‚å‰æç¤ºï¼šå®˜æ–¹çš„ä¸­æ–‡ Doc å·²ç»è¿‡æ—¶äº†ï¼Œä¸å°‘æ¥å£å’Œæ ¼å¼éƒ½å·²ç»æ”¹äº†ï¼Œè¯·é˜…è¯»æœ€æ–°ç‰ˆçš„æ–‡æ¡£ã€‚<s>å¥½å¤§çš„å‘</s></p><p>2022-2-17 00:23:38ï¼šå§‘ä¸”æ˜¯æŠŠåç«¯è°ƒé€šäº†ï¼Œä¸è¿‡è¿™ä»½å­¦ä¹ ç¬”è®°æˆ‘è§‰å¾—å¯ä»¥è¿‘ä¼¼ä½œåºŸäº†ï¼Œæ‰¾æ—¶é—´å†æ”¹å§ã€‚ä¸‹é¢çš„æ•™ç¨‹å¹¶ä¸é€‚ç”¨ ES æœ€æ–°ç‰ˆæœ¬ï¼Œè™½ç„¶å¤§å¤šæ•°æ€æƒ³æ˜¯ç›¸åŒçš„ï¼Œæ¯”è¾ƒä¾¿äºè¿ç§»å­¦ä¹ ã€‚</p></blockquote><h3 id="Node-ä¸-Cluster"><a href="#Node-ä¸-Cluster" class="headerlink" title="Node ä¸ Cluster"></a>Node ä¸ Cluster</h3><p>Elastic æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼</strong>æ•°æ®åº“ï¼Œå…è®¸å¤šå°æœåŠ¡å™¨ååŒå·¥ä½œï¼Œæ¯å°æœåŠ¡å™¨å¯ä»¥è¿è¡Œå¤šä¸ª Elastic å®ä¾‹ã€‚</p><p>å•ä¸ª Elastic å®ä¾‹ç§°ä¸ºä¸€ä¸ª<strong>èŠ‚ç‚¹</strong>ï¼ˆnodeï¼‰ã€‚ä¸€ç»„èŠ‚ç‚¹æ„æˆä¸€ä¸ª<strong>é›†ç¾¤</strong>ï¼ˆclusterï¼‰ã€‚</p><h4 id="é›†ç¾¤ä¸åˆ†å¸ƒå¼"><a href="#é›†ç¾¤ä¸åˆ†å¸ƒå¼" class="headerlink" title="é›†ç¾¤ä¸åˆ†å¸ƒå¼"></a>é›†ç¾¤ä¸åˆ†å¸ƒå¼</h4><p>ï¼ˆåªæ˜¯è¶ç€è¿™æ¬¡æœºä¼šé¡ºä¾¿å°±æŠŠ Elasticsearch ä¸Šæ‰‹å­¦ä¸€éï¼Œè¿™æ¬¡æ¯•ç«Ÿåªæœ‰å•èŠ‚ç‚¹ï¼ˆxï¼‰</p><blockquote><p>äº‹å®ä¸Šï¼ŒElasticsearch è¢«è®¾è®¡å‡ºæ¥å°±æ˜¯ä»¥é›†ç¾¤è¿ä½œä¸ºåŸºç¡€çš„ã€‚</p><p>ElasticSearch çš„ä¸»æ—¨æ˜¯éšæ—¶å¯ç”¨å’ŒæŒ‰éœ€æ‰©å®¹ã€‚ è€Œæ‰©å®¹å¯ä»¥é€šè¿‡è´­ä¹°æ€§èƒ½æ›´å¼ºå¤§ï¼ˆå‚ç›´æ‰©å®¹ï¼Œæˆ–çºµå‘æ‰©å®¹ï¼‰æˆ–è€…æ•°é‡æ›´å¤šçš„æœåŠ¡å™¨ï¼ˆæ°´å¹³æ‰©å®¹ï¼Œæˆ–æ¨ªå‘æ‰©å®¹ï¼‰æ¥å®ç°ã€‚è™½ç„¶ Elasticsearch å¯ä»¥è·ç›Šäºæ›´å¼ºå¤§çš„ç¡¬ä»¶è®¾å¤‡ï¼Œä½†æ˜¯å‚ç›´æ‰©å®¹æ˜¯æœ‰æé™çš„ã€‚ çœŸæ­£çš„æ‰©å®¹èƒ½åŠ›æ˜¯æ¥è‡ªäºæ°´å¹³æ‰©å®¹â€”ä¸ºé›†ç¾¤æ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”å°†è´Ÿè½½å‹åŠ›å’Œç¨³å®šæ€§åˆ†æ•£åˆ°è¿™äº›èŠ‚ç‚¹ä¸­ã€‚</p></blockquote><ul><li>ç»“ç‚¹ä¸é›†ç¾¤ï¼šä¸€ä¸ªè¿è¡Œä¸­çš„ Elasticsearch å®ä¾‹ç§°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œé›†ç¾¤æ˜¯ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ‹¥æœ‰ç›¸åŒ <code>cluster.name</code> é…ç½®çš„èŠ‚ç‚¹ç»„æˆï¼Œ å®ƒä»¬å…±åŒæ‰¿æ‹…æ•°æ®å’Œè´Ÿè½½çš„å‹åŠ›ã€‚å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­æˆ–è€…ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹æ—¶ï¼Œé›†ç¾¤å°†ä¼šé‡æ–°å¹³å‡åˆ†å¸ƒæ‰€æœ‰çš„æ•°æ®ã€‚</li><li>ä¸»èŠ‚ç‚¹ï¼šç®¡ç†é›†ç¾¤èŒƒå›´å†…çš„æ‰€æœ‰å˜æ›´ï¼Œä¾‹å¦‚å¢åŠ ã€åˆ é™¤ç´¢å¼•ï¼Œæˆ–è€…å¢åŠ ã€åˆ é™¤èŠ‚ç‚¹ç­‰ã€‚ç”¨æˆ·å¯ä»¥å°†è¯·æ±‚å‘é€åˆ°ä»»æ„ç»“ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“ä»»æ„æ–‡æ¡£æ‰€å¤„çš„ä½ç½®ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†æˆ‘ä»¬çš„è¯·æ±‚ç›´æ¥è½¬å‘åˆ°å­˜å‚¨æˆ‘ä»¬æ‰€éœ€æ–‡æ¡£çš„èŠ‚ç‚¹ã€‚</li><li>é›†ç¾¤å¥åº·çŠ¶æ€ï¼šé€šè¿‡ <code>[GET] /_cluster/health</code> å¯ä»¥æŸ¥è¯¢å½“å‰èŠ‚ç‚¹æ‰€åœ¨é›†ç¾¤çš„çŠ¶æ€ã€‚å…¶ä¸­è¿”å›å€¼çš„ <code>status</code> å­—æ®µå¦‚æœä¸º <code>green</code>ï¼Œä»£è¡¨æ‰€æœ‰ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½åœ¨æ­£å¸¸è¿è¡Œï¼›å¦‚æœä¸º <code>yellow</code>ï¼Œä»£è¡¨æ‰€æœ‰ä¸»åˆ†ç‰‡éƒ½åœ¨æ­£å¸¸è¿è¡Œï¼Œå‰¯æœ¬åˆ†ç‰‡å¹¶ä¸æ˜¯éƒ½åœ¨æ­£å¸¸è¿è¡Œï¼›å¦‚æœä¸º <code>red</code>ï¼Œè¯´æ˜æœ‰ä¸»åˆ†ç‰‡æ²¡èƒ½æ­£å¸¸è¿è¡Œã€‚</li><li>ä¸»åˆ†ç‰‡ä¸å‰¯æœ¬åˆ†ç‰‡ï¼š<ul><li>åˆ†ç‰‡ï¼šç´¢å¼•å®é™…ä¸Šæ˜¯æŒ‡å‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰©ç†<strong>åˆ†ç‰‡</strong>çš„é€»è¾‘å‘½åç©ºé—´ã€‚ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ªåº•å±‚çš„å·¥ä½œå•å…ƒï¼Œå®ƒä¿å­˜äº†å…¨éƒ¨æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€çŸ¥é“ä¸€ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸ª Lucene çš„å®ä¾‹ï¼Œä»¥åŠå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æœç´¢å¼•æ“ã€‚ æˆ‘ä»¬çš„æ–‡æ¡£è¢«å­˜å‚¨å’Œç´¢å¼•åˆ°åˆ†ç‰‡å†…ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºæ˜¯ç›´æ¥ä¸ç´¢å¼•è€Œä¸æ˜¯ä¸åˆ†ç‰‡è¿›è¡Œäº¤äº’ã€‚</li><li>ä¸»åˆ†ç‰‡ï¼šç´¢å¼•å†…ä»»æ„ä¸€ä¸ªæ–‡æ¡£éƒ½å½’å±äºä¸€ä¸ªä¸»åˆ†ç‰‡ï¼Œæ‰€ä»¥ä¸»åˆ†ç‰‡çš„æ•°ç›®å†³å®šç€ç´¢å¼•èƒ½å¤Ÿä¿å­˜çš„æœ€å¤§æ•°æ®é‡ã€‚</li><li>å‰¯æœ¬åˆ†ç‰‡ï¼šä¸€ä¸ªå‰¯æœ¬åˆ†ç‰‡åªæ˜¯ä¸€ä¸ªä¸»åˆ†ç‰‡çš„æ‹·è´ã€‚å‰¯æœ¬åˆ†ç‰‡ä½œä¸ºç¡¬ä»¶æ•…éšœæ—¶ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±çš„å†—ä½™å¤‡ä»½ï¼Œå¹¶ä¸ºæœç´¢å’Œè¿”å›æ–‡æ¡£ç­‰è¯»æ“ä½œæä¾›æœåŠ¡ã€‚å‰¯æœ¬åˆ†ç‰‡çš„å­˜åœ¨ç›®çš„æ˜¯ä¸ºäº†åœ¨æ•…éšœçš„æƒ…å†µä¸‹ä¸è‡³äºä¸¢å¤±æ•°æ®ã€‚å¦‚åœ¨ä¸‹å›¾è¿™ä¸ªå…·æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œ$P_i$ ä»£è¡¨ä¸»åˆ†ç‰‡ï¼Œ$R_i$ ä»£è¡¨å‰¯æœ¬åˆ†ç‰‡ï¼Œæ¯ä¸ªä¸»åˆ†ç‰‡æ‹¥æœ‰ 2 ä¸ªå…¶å¯¹åº”çš„å‰¯æœ¬åˆ†ç‰‡ã€‚</li></ul></li></ul><p><img src="https://www.elastic.co/guide/cn/elasticsearch/guide/current/images/elas_0205.png" alt="æ‹¥æœ‰2ä»½å‰¯æœ¬åˆ†ç‰‡3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤"></p><h3 id="Document"><a href="#Document" class="headerlink" title="Document"></a>Document</h3><p>Index é‡Œé¢å•æ¡çš„è®°å½•ç§°ä¸º Documentï¼ˆ<strong>æ–‡æ¡£</strong>ï¼‰ã€‚è®¸å¤šæ¡ Document æ„æˆäº†ä¸€ä¸ª Indexã€‚</p><p>Document ä½¿ç”¨ JSON æ ¼å¼è¡¨ç¤ºï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span>  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"å·¥ç¨‹å¸ˆ"</span><span class="token punctuation">,</span>  <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"æ•°æ®åº“ç®¡ç†"</span><span class="token punctuation">&#125;</span></code></pre><p>åŒä¸€ä¸ª Index é‡Œé¢çš„ Documentï¼Œ<strong>ä¸è¦æ±‚æœ‰ç›¸åŒçš„ç»“æ„</strong>ï¼ˆschemeï¼‰ï¼Œä½†æ˜¯æœ€å¥½ä¿æŒç›¸åŒï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æœç´¢æ•ˆç‡ã€‚</p><p>æ–‡æ¡£çš„å…ƒæ•°æ®ï¼š</p><ul><li><p><strong><code>_id</code></strong>ï¼šæ–‡æ¡£çš„ ID å­—ç¬¦ä¸²</p></li><li><p><strong><code>_type</code></strong>ï¼šæ–‡æ¡£çš„ç±»å‹å</p></li><li><p><strong><code>_index</code></strong>ï¼šæ–‡æ¡£æ‰€åœ¨çš„ç´¢å¼•</p></li><li><p><strong><code>_uid</code></strong>ï¼š<code>_type</code> å’Œ <code>_id</code> è¿æ¥åœ¨ä¸€èµ·æ„é€ æˆ <code>type#id</code></p></li><li><strong><code>_source</code></strong>ï¼šåŸæ¨¡åŸæ ·çš„ JSON æ–‡ä»¶</li><li><strong><code>_all</code></strong>ï¼šå…¨æ–‡æ‹¼æ¥</li></ul><p>æ–‡æ¡£è·¯ç”±åˆ°åˆ†ç‰‡ä¸­çš„æ–¹å¼ä¸ºï¼š<code>shard = hash(routing) % number_of_primary_shards</code>ï¼Œå…¶ä¸­é»˜è®¤ <code>routing</code> æ˜¯ä¸€ä¸ªå¯å˜å€¼ï¼Œé»˜è®¤æ˜¯æ–‡æ¡£çš„ <code>_id</code>ã€‚æ‰€æœ‰çš„æ–‡æ¡£ APIï¼ˆ<code>get</code>ã€<code>index</code>ã€<code>delete</code>ã€<code>bulk</code>ã€<code>update</code> ä»¥åŠ <code>mget</code>ï¼‰éƒ½æ¥å—ä¸€ä¸ªå«åš <code>routing</code> çš„è·¯ç”±å‚æ•° ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ–‡æ¡£åˆ°åˆ†ç‰‡çš„æ˜ å°„ã€‚</p><h3 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h3><p>Elastic ä¼šç´¢å¼•æ‰€æœ‰å­—æ®µï¼Œç»è¿‡å¤„ç†åå†™å…¥ä¸€ä¸ª<strong>å€’æ’ç´¢å¼•</strong>ï¼ˆInverted Indexï¼‰ã€‚æŸ¥æ‰¾æ•°æ®çš„æ—¶å€™ï¼Œç›´æ¥æŸ¥æ‰¾è¯¥ç´¢å¼•ã€‚</p><p>æ‰€ä»¥ï¼ŒElastic æ•°æ®ç®¡ç†çš„é¡¶å±‚å•ä½å°±å«åš<strong>ç´¢å¼•</strong>ï¼ˆIndexï¼‰ã€‚å®ƒæ˜¯å•ä¸ªæ•°æ®åº“çš„åŒä¹‰è¯ã€‚æ¯ä¸ª Index ï¼ˆå³æ•°æ®åº“ï¼‰çš„åå­—å¿…é¡»æ˜¯å°å†™ã€‚</p><h4 id="ç´¢å¼•ä¸ä¸­æ–‡åˆ†æå™¨"><a href="#ç´¢å¼•ä¸ä¸­æ–‡åˆ†æå™¨" class="headerlink" title="ç´¢å¼•ä¸ä¸­æ–‡åˆ†æå™¨"></a>ç´¢å¼•ä¸ä¸­æ–‡åˆ†æå™¨</h4><ul><li>ç´¢å¼•çš„åˆ›å»º</li></ul><pre class="language-json" data-language="json"><code class="language-json">PUT /my_index<span class="token punctuation">&#123;</span>    <span class="token property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"number_of_shards"</span> <span class="token operator">:</span>   <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// ä¸»åˆ†ç‰‡æ•°</span>        <span class="token property">"number_of_replicas"</span> <span class="token operator">:</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"type_one"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> ... any mappings ... <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"type_two"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> ... any mappings ... <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        ...    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ul><li>ç´¢å¼•çš„åˆ é™¤ï¼š<code>[DELETE] /my_index</code></li></ul><h5 id="åˆ†æå™¨-Analysis"><a href="#åˆ†æå™¨-Analysis" class="headerlink" title="åˆ†æå™¨ Analysis"></a>åˆ†æå™¨ Analysis</h5><ul><li><p>ç´¢å¼•çš„è®¾ç½®ï¼šåˆ†æå™¨ï¼ˆ<code>analysis</code>ï¼‰ï¼Œç”¨äºå°†å…¨æ–‡å­—ç¬¦ä¸²è½¬æ¢ä¸ºé€‚åˆæœç´¢çš„å€’æ’ç´¢å¼•çš„å·¥å…·ã€‚</p></li><li><p>ä½•ä¸º<strong>åˆ†æ</strong>ï¼Ÿ</p></li></ul><p><strong>Exact Values ä¸ Full Text</strong></p><p>Elasticsearch ä¸­çš„æ•°æ®å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šç²¾ç¡®å€¼ï¼ˆExact Valuesï¼‰å’Œå…¨æ–‡æœ¬ï¼ˆFull Textï¼‰ã€‚</p><p>ç²¾ç¡®å€¼æ˜¯æŒ‡ä¸€äº›ç²¾ç¡®çš„æ•°æ®ï¼Œæ¯”å¦‚æ—¥æœŸæˆ–è€…ç”¨æˆ· IDã€‚ç›¸æ¯”è¾ƒèµ·æ¥ï¼Œç²¾ç¡®å€¼ç±»å‹çš„æ•°æ®å¾ˆå®¹æ˜“æŸ¥è¯¢ã€‚ç»“æœæ˜¯äºŒè¿›åˆ¶çš„ï¼šè¦ä¹ˆåŒ¹é…æŸ¥è¯¢ï¼Œè¦ä¹ˆä¸åŒ¹é…ã€‚</p><p>å…¨æ–‡æœ¬æ•°æ®æŒ‡çš„æ˜¯é•¿æ–‡æœ¬æ•°æ®ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¨æ–‡çš„å†…å®¹æˆ–è€…ä¸€å°é‚®ä»¶çš„å†…å®¹ã€‚æŸ¥è¯¢å…¨æ–‡æ•°æ®è¦å¾®å¦™çš„å¤šã€‚æˆ‘ä»¬é—®çš„ä¸åªæ˜¯â€œè¿™ä¸ªæ–‡æ¡£åŒ¹é…æŸ¥è¯¢å—â€ï¼Œè€Œæ˜¯â€œè¯¥æ–‡æ¡£åŒ¹é…æŸ¥è¯¢çš„ç¨‹åº¦æœ‰å¤šå¤§ï¼Ÿâ€æ¢å¥è¯è¯´ï¼Œè¯¥æ–‡æ¡£ä¸ç»™å®šæŸ¥è¯¢çš„ç›¸å…³æ€§å¦‚ä½•ï¼Ÿ</p><p>ä¸ºäº†ä¿ƒè¿›è¿™ç±»åœ¨å…¨æ–‡æœ¬åŸŸä¸­çš„æŸ¥è¯¢ï¼ŒElasticsearch é¦–å…ˆ <strong>åˆ†æ</strong> æ–‡æ¡£ï¼Œä¹‹åæ ¹æ®ç»“æœåˆ›å»º <strong>å€’æ’ç´¢å¼•</strong> ã€‚åœ¨æ¥ä¸‹æ¥çš„ä¸¤èŠ‚ï¼Œæˆ‘ä»¬ä¼šè®¨è®ºå€’æ’ç´¢å¼•å’Œåˆ†æè¿‡ç¨‹ã€‚</p><p><strong>å€’æ’ç´¢å¼•</strong></p><p>Elasticsearch ä½¿ç”¨ä¸€ç§ç§°ä¸º <strong>å€’æ’ç´¢å¼•</strong> çš„ç»“æ„ï¼Œå®ƒé€‚ç”¨äºå¿«é€Ÿçš„å…¨æ–‡æœç´¢ã€‚ä¸€ä¸ªå€’æ’ç´¢å¼•ç”±æ–‡æ¡£ä¸­æ‰€æœ‰ä¸é‡å¤è¯çš„åˆ—è¡¨æ„æˆï¼Œå¯¹äºå…¶ä¸­æ¯ä¸ªè¯ï¼Œæœ‰ä¸€ä¸ªåŒ…å«å®ƒçš„æ–‡æ¡£åˆ—è¡¨ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£çš„ <code>content</code> åŸŸåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š</p><ol><li>The quick brown fox jumped over the lazy dog</li><li>Quick brown foxes leap over lazy dogs in summer</li></ol><p>ä¸ºäº†åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æ¯ä¸ªæ–‡æ¡£çš„ <code>content</code> åŸŸæ‹†åˆ†æˆå•ç‹¬çš„è¯ï¼ˆæˆ‘ä»¬ç§°å®ƒä¸º <code>è¯æ¡</code> æˆ– <code>tokens</code> ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¸é‡å¤è¯æ¡çš„æ’åºåˆ—è¡¨ï¼Œç„¶ååˆ—å‡ºæ¯ä¸ªè¯æ¡å‡ºç°åœ¨å“ªä¸ªæ–‡æ¡£ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-none"><code class="language-none">Term      Doc_1  Doc_2-------------------------Quick   |       |  XThe     |   X   |brown   |   X   |  Xdog     |   X   |dogs    |       |  Xfox     |   X   |foxes   |       |  Xin      |       |  Xjumped  |   X   |lazy    |   X   |  Xleap    |       |  Xover    |   X   |  Xquick   |   X   |summer  |       |  Xthe     |   X   |------------------------</code></pre><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœç´¢ <code>quick brown</code> ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£ï¼š</p><pre class="language-none"><code class="language-none">Term      Doc_1  Doc_2-------------------------brown   |   X   |  Xquick   |   X   |------------------------Total   |   2   |  1</code></pre><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ç›®å‰çš„å€’æ’ç´¢å¼•æœ‰ä¸€äº›é—®é¢˜ï¼š</p><ul><li><code>Quick</code> å’Œ <code>quick</code> ä»¥ç‹¬ç«‹çš„è¯æ¡å‡ºç°ï¼Œç„¶è€Œç”¨æˆ·å¯èƒ½è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„è¯ã€‚</li><li><code>fox</code> å’Œ <code>foxes</code> éå¸¸ç›¸ä¼¼, å°±åƒ <code>dog</code> å’Œ <code>dogs</code> ï¼›ä»–ä»¬æœ‰ç›¸åŒçš„è¯æ ¹ã€‚</li><li><code>jumped</code> å’Œ <code>leap</code>, å°½ç®¡æ²¡æœ‰ç›¸åŒçš„è¯æ ¹ï¼Œä½†ä»–ä»¬çš„æ„æ€å¾ˆç›¸è¿‘ã€‚ä»–ä»¬æ˜¯åŒä¹‰è¯ã€‚</li></ul><p>å¦‚æœæˆ‘ä»¬å°†è¯æ¡å’Œç”¨æˆ·æŸ¥è¯¢éƒ½è§„èŒƒä¸ºæ ‡å‡†æ¨¡å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸ç”¨æˆ·æœç´¢çš„è¯æ¡ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†å…·æœ‰è¶³å¤Ÿç›¸å…³æ€§çš„æ–‡æ¡£ã€‚</p><p>è¿™ç§<strong>åˆ†è¯</strong>å’Œ<strong>æ ‡å‡†åŒ–</strong>çš„è¿‡ç¨‹å°±ç§°ä¸ºæ˜¯<strong>åˆ†æ</strong>ã€‚</p><p><strong>åˆ†æå’Œåˆ†æå™¨</strong></p><p><strong>åˆ†æ</strong>åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p><ul><li>é¦–å…ˆï¼Œå°†ä¸€å—æ–‡æœ¬åˆ†æˆé€‚åˆäºå€’æ’ç´¢å¼•çš„ç‹¬ç«‹çš„ <strong>Tokens</strong></li><li>ä¹‹åï¼Œå°†è¿™äº›è¯æ¡ç»Ÿä¸€åŒ–ä¸ºæ ‡å‡†æ ¼å¼ä»¥æé«˜å®ƒä»¬çš„â€œå¯æœç´¢æ€§â€</li></ul><p><strong>åˆ†æå™¨</strong>æ‰§è¡Œä¸Šé¢çš„å·¥ä½œã€‚ <strong>åˆ†æå™¨</strong> å®é™…ä¸Šæ˜¯å°†ä¸‰ä¸ªåŠŸèƒ½å°è£…åˆ°äº†ä¸€ä¸ªåŒ…é‡Œï¼š</p><ul><li><p><strong>å­—ç¬¦è¿‡æ»¤å™¨</strong></p><p>é¦–å…ˆï¼Œå­—ç¬¦ä¸²æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª <strong>å­—ç¬¦è¿‡æ»¤å™¨</strong> ã€‚ä»–ä»¬çš„ä»»åŠ¡æ˜¯åœ¨åˆ†è¯å‰æ•´ç†å­—ç¬¦ä¸²ã€‚ä¸€ä¸ªå­—ç¬¦è¿‡æ»¤å™¨å¯ä»¥ç”¨æ¥å»æ‰ HTMLï¼Œæˆ–è€…å°† <code>&amp;</code> è½¬åŒ–æˆ <code>and</code>ã€‚</p></li><li><p><strong>åˆ†è¯å™¨</strong></p><p>å…¶æ¬¡ï¼Œå­—ç¬¦ä¸²è¢« <strong>åˆ†è¯å™¨</strong> åˆ†ä¸ºå•ä¸ªçš„è¯æ¡ã€‚ä¸€ä¸ªç®€å•çš„åˆ†è¯å™¨é‡åˆ°ç©ºæ ¼å’Œæ ‡ç‚¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå°†æ–‡æœ¬æ‹†åˆ†æˆè¯æ¡ã€‚</p></li><li><p><strong>Token è¿‡æ»¤å™¨</strong></p><p>æœ€åï¼Œè¯æ¡æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª <strong>token è¿‡æ»¤å™¨</strong> ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ”¹å˜è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œå°å†™åŒ– <code>Quick</code> ï¼‰ï¼Œåˆ é™¤è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œ åƒ <code>a</code>ï¼Œ <code>and</code>ï¼Œ <code>the</code> ç­‰æ— ç”¨è¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸ºåœç”¨è¯ï¼ŒStop Wordï¼‰ï¼Œæˆ–è€…å¢åŠ è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œåƒ <code>jump</code> å’Œ <code>leap</code> è¿™ç§åŒä¹‰è¯ï¼‰ã€‚</p></li></ul><p><strong>å†…ç½®çš„åˆ†æå™¨</strong></p><ul><li>Standard analyzerï¼šå¯¹äºè¥¿æ–¹è¯­ç§è¡¨ç°è¾ƒå¥½ï¼Œæ ‡å‡†åˆ†æå™¨</li><li>Simple analyzerï¼šåœ¨ä»»ä½•ä¸æ˜¯å­—æ¯çš„åœ°æ–¹åˆ†éš”æ–‡æœ¬ï¼Œå°†è¯æ¡å°å†™</li><li>Whitespace analyzerï¼šåœ¨ç©ºæ ¼çš„åœ°æ–¹åˆ’åˆ†æ–‡æœ¬</li><li>Language analyzersï¼šè€ƒè™‘æŒ‡å®šè¯­è¨€çš„ç‰¹ç‚¹çš„åˆ†æå™¨</li></ul><p><strong>æµ‹è¯•åˆ†æå™¨</strong></p><pre class="language-json" data-language="json"><code class="language-json">GET /_analyze<span class="token punctuation">&#123;</span>  <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"standard"</span><span class="token punctuation">,</span>  <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Text to analyze"</span><span class="token punctuation">&#125;</span></code></pre><p><strong>ä¸­æ–‡åˆ†æå™¨</strong></p><p>åœ¨æœ¬èŠ‚çš„æœ€åä¼šä»‹ç»ä¸€ä¸ªä¸­æ–‡åˆ†æå™¨æ’ä»¶ IK Analysis for Elasticsearchï¼š</p><ul><li><a href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></li></ul><p>æä¾›çš„åˆ†æå™¨ï¼š</p><ul><li><code>ik_smart</code>ï¼šå°†éœ€è¦åˆ†è¯çš„æ–‡æœ¬åšæœ€å¤§ç²’åº¦çš„æ‹†åˆ†ã€‚</li><li><code>ik_max_word</code>ï¼šå°†éœ€è¦åˆ†è¯çš„æ–‡æœ¬åšæœ€å°ç²’åº¦çš„æ‹†åˆ†ï¼Œå°½é‡åˆ†æ›´å¤šçš„è¯ã€‚</li></ul><p>å®‰è£…ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">./elasticsearch-plugin -v <span class="token function">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.0.0/elasticsearch-analysis-ik-8.0.0.zip</code></pre><h4 id="Type-amp-Mappings"><a href="#Type-amp-Mappings" class="headerlink" title="Type &amp; Mappings"></a>Type &amp; Mappings</h4><p>Document å¯ä»¥åˆ†ç»„ï¼Œæ¯”å¦‚ <code>weather</code> è¿™ä¸ª Index é‡Œé¢ï¼Œå¯ä»¥æŒ‰åŸå¸‚åˆ†ç»„ï¼ˆåŒ—äº¬å’Œä¸Šæµ·ï¼‰ï¼Œä¹Ÿå¯ä»¥æŒ‰æ°”å€™åˆ†ç»„ï¼ˆæ™´å¤©å’Œé›¨å¤©ï¼‰ã€‚è¿™ç§åˆ†ç»„å°±å«åš Typeï¼Œå®ƒæ˜¯è™šæ‹Ÿçš„é€»è¾‘åˆ†ç»„ï¼Œç”¨æ¥è¿‡æ»¤ Documentã€‚</p><p>ä¸åŒçš„ Type åº”è¯¥æœ‰ç›¸ä¼¼çš„ç»“æ„ï¼ˆschemaï¼‰ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œ<code>id</code> å­—æ®µä¸èƒ½åœ¨è¿™ä¸ªç»„æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨å¦ä¸€ä¸ªç»„æ˜¯æ•°å€¼ã€‚è¿™æ˜¯ä¸å…³ç³»å‹æ•°æ®åº“çš„è¡¨çš„<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html">ä¸€ä¸ªåŒºåˆ«</a>ã€‚æ€§è´¨å®Œå…¨ä¸åŒçš„æ•°æ®ï¼ˆæ¯”å¦‚ <code>products</code> å’Œ <code>logs</code>ï¼‰åº”è¯¥å­˜æˆä¸¤ä¸ª Indexï¼Œè€Œä¸æ˜¯ä¸€ä¸ª Index é‡Œé¢çš„ä¸¤ä¸ª Typeï¼ˆè™½ç„¶å¯ä»¥åšåˆ°ï¼‰ã€‚</p><p>ç±»å‹ï¼ˆTypeï¼‰ç”±åç§°ï¼ˆNameï¼‰å’Œæ˜ å°„ï¼ˆMappingï¼‰ç»„æˆã€‚<strong>æ˜ å°„</strong>ï¼Œå°±åƒæ•°æ®åº“ä¸­çš„ schemaï¼Œæè¿°äº†æ–‡æ¡£å¯èƒ½å…·æœ‰çš„å­—æ®µæˆ–å±æ€§ä»¥åŠæ¯ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ â€”â€” æ¯”å¦‚ <code>string</code>ï¼Œ<code>integer</code> æˆ– <code>date</code> â€”â€” ä»¥åŠ Lucene æ˜¯å¦‚ä½•ç´¢å¼•å’Œå­˜å‚¨è¿™äº›å­—æ®µçš„ã€‚</p><h5 id="æ˜ å°„-Mappings"><a href="#æ˜ å°„-Mappings" class="headerlink" title="æ˜ å°„ Mappings"></a>æ˜ å°„ Mappings</h5><p>ä¸ºäº†èƒ½å¤Ÿå°†æ—¶é—´åŸŸè§†ä¸ºæ—¶é—´ï¼Œæ•°å­—åŸŸè§†ä¸ºæ•°å­—ï¼Œå­—ç¬¦ä¸²åŸŸè§†ä¸ºå…¨æ–‡æœ¬æˆ–ç²¾ç¡®å€¼å­—ç¬¦ä¸²ï¼Œ Elasticsearch éœ€è¦çŸ¥é“æ¯ä¸ªåŸŸä¸­æ•°æ®çš„ç±»å‹ã€‚è¿™ä¸ªä¿¡æ¯åŒ…å«åœ¨æ˜ å°„ä¸­ã€‚</p><p>ç´¢å¼•ä¸­æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ <strong>ç±»å‹</strong>ï¼Œæ¯ç§ç±»å‹éƒ½æœ‰å®ƒè‡ªå·±çš„ <strong>æ˜ å°„</strong>ã€‚æ˜ å°„å®šä¹‰äº†ç±»å‹ä¸­çš„åŸŸï¼Œæ¯ä¸ªåŸŸçš„æ•°æ®ç±»å‹ï¼Œä»¥åŠ Elasticsearch å¦‚ä½•å¤„ç†è¿™äº›åŸŸã€‚æ˜ å°„ä¹Ÿç”¨äºé…ç½®ä¸ç±»å‹æœ‰å…³çš„å…ƒæ•°æ®ã€‚</p><p>æ‰€æœ‰å¯ç”¨çš„åŸŸç±»å‹æšä¸¾å¦‚ä¸‹ï¼š</p><ul><li>å­—ç¬¦ä¸²: <code>string</code></li><li>æ•´æ•°: <code>byte</code>, <code>short</code>, <code>integer</code>, <code>long</code></li><li>æµ®ç‚¹æ•°: <code>float</code>, <code>double</code></li><li>å¸ƒå°”å‹: <code>boolean</code></li><li>æ—¥æœŸ: <code>date</code></li><li>å¤šå±‚çº§å¯¹è±¡: <code>object</code></li></ul><p><strong>è‡ªå®šä¹‰åŸŸæ˜ å°„</strong></p><p>é’ˆå¯¹äºç®€å•åŸŸç±»å‹ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"number_of_clicks"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"integer"</span><span class="token punctuation">,</span> <span class="token comment">// æŒ‡å®šç±»å‹</span>                <span class="token comment">// analyzed ä½œä¸ºå…¨æ–‡æœ¬åŸŸç´¢å¼•; </span>        <span class="token comment">// not_analyzed ä½œä¸ºç²¾ç¡®å€¼ç´¢å¼•;</span>        <span class="token comment">// no ä¸ç´¢å¼•.</span>        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"not_analyzed"</span><span class="token punctuation">,</span>                 <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"whitespace"</span> <span class="token comment">// åˆ†æå™¨ é»˜è®¤ä¸º standard</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>é’ˆå¯¹äºå¤šå±‚çº§å¯¹è±¡ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"gb"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"tweet"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>       <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"tweet"</span><span class="token operator">:</span>            <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"user"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>           <span class="token property">"type"</span><span class="token operator">:</span>             <span class="token string">"object"</span><span class="token punctuation">,</span>          <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"id"</span><span class="token operator">:</span>           <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"gender"</span><span class="token operator">:</span>       <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"age"</span><span class="token operator">:</span>          <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"long"</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span>   <span class="token punctuation">&#123;</span>               <span class="token property">"type"</span><span class="token operator">:</span>         <span class="token string">"object"</span><span class="token punctuation">,</span>              <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"full"</span><span class="token operator">:</span>     <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token property">"first"</span><span class="token operator">:</span>    <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token property">"last"</span><span class="token operator">:</span>     <span class="token punctuation">&#123;</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span> <span class="token punctuation">&#125;</span>              <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>äº‹å®ä¸Šè¿™å°†è¢«ç´¢å¼•ä¸ºï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"tweet"</span><span class="token operator">:</span>            <span class="token punctuation">[</span>elasticsearch<span class="token punctuation">,</span> flexible<span class="token punctuation">,</span> very<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"user.id"</span><span class="token operator">:</span>          <span class="token punctuation">[</span>@johnsmith<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"user.gender"</span><span class="token operator">:</span>      <span class="token punctuation">[</span>male<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"user.age"</span><span class="token operator">:</span>         <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"user.name.full"</span><span class="token operator">:</span>   <span class="token punctuation">[</span>john<span class="token punctuation">,</span> smith<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"user.name.first"</span><span class="token operator">:</span>  <span class="token punctuation">[</span>john<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"user.name.last"</span><span class="token operator">:</span>   <span class="token punctuation">[</span>smith<span class="token punctuation">]</span><span class="token punctuation">&#125;</span></code></pre><p>æ€»ç»“èµ·æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>[PUT] /my_index</code> æ—¶ä½¿ç”¨ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"tweet"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ç±»å‹å</span>      <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"tweet"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"type"</span> <span class="token operator">:</span>    <span class="token string">"string"</span><span class="token punctuation">,</span>          <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"english"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"date"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"type"</span> <span class="token operator">:</span>   <span class="token string">"date"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"type"</span> <span class="token operator">:</span>   <span class="token string">"string"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"user_id"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"type"</span> <span class="token operator">:</span>   <span class="token string">"long"</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><h4 id="æ–°å¢è®°å½•"><a href="#æ–°å¢è®°å½•" class="headerlink" title="æ–°å¢è®°å½•"></a>æ–°å¢è®°å½•</h4><ul><li><code>[PUT] /Index/Type/Id</code></li></ul><p>æ¯”å¦‚ï¼Œå‘<code>/accounts/person</code>å‘é€è¯·æ±‚ï¼Œå°±å¯ä»¥æ–°å¢ä¸€æ¡äººå‘˜è®°å½•ã€‚æœåŠ¡å™¨è¿”å›çš„ JSON å¯¹è±¡ï¼Œä¼šç»™å‡º Indexã€Typeã€Idã€Version ç­‰ä¿¡æ¯ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"accounts"</span><span class="token punctuation">,</span>  <span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"person"</span><span class="token punctuation">,</span>  <span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span>  <span class="token property">"_version"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token property">"result"</span><span class="token operator">:</span><span class="token string">"created"</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"total"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">"successful"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"failed"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"created"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span></code></pre><ul><li><code>[POST] /Index/Type</code></li></ul><p>æ–°å¢è®°å½•çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®š Idï¼Œè¿™æ—¶è¦æ”¹æˆ POST è¯·æ±‚ã€‚è¿™æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›çš„ JSON å¯¹è±¡é‡Œé¢ï¼Œ<code>_id</code>å­—æ®µå°±æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"accounts"</span><span class="token punctuation">,</span>  <span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"person"</span><span class="token punctuation">,</span>  <span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"AV3qGfrC6jMbsbXb6k1p"</span><span class="token punctuation">,</span>  <span class="token property">"_version"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token property">"result"</span><span class="token operator">:</span><span class="token string">"created"</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"total"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">"successful"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"failed"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"created"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span></code></pre><p>æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰å…ˆåˆ›å»º Indexï¼ˆè¿™ä¸ªä¾‹å­æ˜¯<code>accounts</code>ï¼‰ï¼Œç›´æ¥æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼ŒElastic ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯ç›´æ¥ç”ŸæˆæŒ‡å®šçš„ Indexã€‚</p><h4 id="æŸ¥çœ‹è®°å½•"><a href="#æŸ¥çœ‹è®°å½•" class="headerlink" title="æŸ¥çœ‹è®°å½•"></a>æŸ¥çœ‹è®°å½•</h4><ul><li><code>[GET] /Index/Type/Id</code></li></ul><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">curl</span> <span class="token string">'localhost:9200/accounts/person/1?pretty=true'</span></code></pre><p>ä¸Šé¢ä»£ç è¯·æ±‚æŸ¥çœ‹<code>/accounts/person/1</code>è¿™æ¡è®°å½•ï¼ŒURL çš„å‚æ•°<code>pretty=true</code>è¡¨ç¤ºä»¥æ˜“è¯»çš„æ ¼å¼è¿”å›ã€‚</p><p>è¿”å›çš„æ•°æ®ä¸­ï¼Œ<code>found</code>å­—æ®µè¡¨ç¤ºæŸ¥è¯¢æˆåŠŸï¼Œ<code>_source</code>å­—æ®µè¿”å›åŸå§‹è®°å½•ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"accounts"</span><span class="token punctuation">,</span>  <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"person"</span><span class="token punctuation">,</span>  <span class="token property">"_id"</span> <span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>  <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token property">"found"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"user"</span> <span class="token operator">:</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"å·¥ç¨‹å¸ˆ"</span><span class="token punctuation">,</span>    <span class="token property">"desc"</span> <span class="token operator">:</span> <span class="token string">"æ•°æ®åº“ç®¡ç†"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœ Id ä¸æ­£ç¡®ï¼Œå°±æŸ¥ä¸åˆ°æ•°æ®ï¼Œ<code>found</code>å­—æ®µå°±æ˜¯<code>false</code>ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">curl</span> <span class="token string">'localhost:9200/weather/beijing/abc?pretty=true'</span><span class="token punctuation">&#123;</span>  <span class="token string">"_index"</span> <span class="token builtin class-name">:</span> <span class="token string">"accounts"</span>,  <span class="token string">"_type"</span> <span class="token builtin class-name">:</span> <span class="token string">"person"</span>,  <span class="token string">"_id"</span> <span class="token builtin class-name">:</span> <span class="token string">"abc"</span>,  <span class="token string">"found"</span> <span class="token builtin class-name">:</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span></code></pre><h4 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h4><ul><li><code>[PUT] /Index/Type/Id</code></li></ul><p>æ›´æ–°è®°å½•å°±æ˜¯ä½¿ç”¨ PUT è¯·æ±‚ï¼Œé‡æ–°å‘é€ä¸€æ¬¡æ•°æ®ã€‚æ¯”å¦‚æˆ‘ä»¬å°†åŸå§‹æ•°æ®ä»â€æ•°æ®åº“ç®¡ç†â€æ”¹æˆâ€æ•°æ®åº“ç®¡ç†ï¼Œè½¯ä»¶å¼€å‘â€ã€‚ è¿”å›ç»“æœé‡Œé¢ï¼Œæœ‰å‡ ä¸ªå­—æ®µå‘ç”Ÿäº†å˜åŒ–ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token property">"result"</span> <span class="token operator">:</span> <span class="token string">"updated"</span><span class="token punctuation">,</span><span class="token property">"created"</span> <span class="token operator">:</span> <span class="token boolean">false</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè®°å½•çš„ Id æ²¡å˜ï¼Œä½†æ˜¯ç‰ˆæœ¬ï¼ˆversionï¼‰ä» <code>1</code> å˜æˆ <code>2</code>ï¼Œæ“ä½œç±»å‹ï¼ˆresultï¼‰ä» <code>created</code> å˜æˆ <code>updated</code>ï¼Œ<code>created</code> å­—æ®µå˜æˆ <code>false</code>ï¼Œå› ä¸ºè¿™æ¬¡ä¸æ˜¯æ–°å»ºè®°å½•ã€‚</p><h4 id="éƒ¨åˆ†æ›´æ–°è®°å½•"><a href="#éƒ¨åˆ†æ›´æ–°è®°å½•" class="headerlink" title="éƒ¨åˆ†æ›´æ–°è®°å½•"></a>éƒ¨åˆ†æ›´æ–°è®°å½•</h4><p>ä½¿ç”¨ <code>update</code> API æˆ‘ä»¬è¿˜å¯ä»¥éƒ¨åˆ†æ›´æ–°æ–‡æ¡£ï¼Œä¾‹å¦‚åœ¨æŸä¸ªè¯·æ±‚æ—¶å¯¹è®¡æ•°å™¨è¿›è¡Œç´¯åŠ ã€‚</p><ul><li><code>[POST] /Index/Type/Id/_update</code></li></ul><p><code>update</code> è¯·æ±‚æœ€ç®€å•çš„ä¸€ç§å½¢å¼æ˜¯æ¥æ”¶æ–‡æ¡£çš„ä¸€éƒ¨åˆ†ä½œä¸º <code>doc</code> çš„å‚æ•°ï¼Œ å®ƒåªæ˜¯ä¸ç°æœ‰çš„æ–‡æ¡£è¿›è¡Œåˆå¹¶ã€‚å¯¹è±¡è¢«åˆå¹¶åˆ°ä¸€èµ·ï¼Œè¦†ç›–ç°æœ‰çš„å­—æ®µï¼Œå¢åŠ æ–°çš„å­—æ®µã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¢åŠ å­—æ®µ <code>tags</code> å’Œ <code>views</code> åˆ°æˆ‘ä»¬çš„åšå®¢æ–‡ç« ï¼š</p><pre class="language-json" data-language="json"><code class="language-json">POST /website/blog/<span class="token number">1</span>/_update<span class="token punctuation">&#123;</span>   <span class="token property">"doc"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token property">"tags"</span> <span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"testing"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token property">"views"</span><span class="token operator">:</span> <span class="token number">0</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœè¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬çœ‹åˆ°ç±»ä¼¼äº <code>index</code> è¯·æ±‚çš„å“åº”ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>   <span class="token property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span>   <span class="token property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"1"</span><span class="token punctuation">,</span>   <span class="token property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span>   <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span></code></pre><h4 id="åˆ é™¤è®°å½•"><a href="#åˆ é™¤è®°å½•" class="headerlink" title="åˆ é™¤è®°å½•"></a>åˆ é™¤è®°å½•</h4><ul><li><code>[DELETE] /Index/Type/Id</code></li></ul><h4 id="å–å›å¤šä¸ªæ–‡æ¡£"><a href="#å–å›å¤šä¸ªæ–‡æ¡£" class="headerlink" title="å–å›å¤šä¸ªæ–‡æ¡£"></a>å–å›å¤šä¸ªæ–‡æ¡£</h4><p>å°†å¤šä¸ªè¯·æ±‚åˆå¹¶æˆä¸€ä¸ªï¼Œé¿å…å•ç‹¬å¤„ç†æ¯ä¸ªè¯·æ±‚èŠ±è´¹çš„ç½‘ç»œå»¶æ—¶å’Œå¼€é”€ã€‚å¦‚æœä½ éœ€è¦ä» Elasticsearch æ£€ç´¢å¾ˆå¤šæ–‡æ¡£ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>mget</code> API æ¥å°†è¿™äº›æ£€ç´¢è¯·æ±‚æ”¾åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œå°†æ¯”é€ä¸ªæ–‡æ¡£è¯·æ±‚æ›´å¿«åœ°æ£€ç´¢åˆ°å…¨éƒ¨æ–‡æ¡£ã€‚<strong>æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯å•ç‹¬æ£€ç´¢å’ŒæŠ¥å‘Šçš„ã€‚</strong>è¦æƒ³çŸ¥é“è¯·æ±‚æ•°ç»„ä¸­æŸä¸ªè¯·æ±‚æ˜¯å¦ç¡®å®æ‰¾åˆ°ï¼Œæ£€æŸ¥ <code>found</code> å­—æ®µã€‚</p><pre class="language-json" data-language="json"><code class="language-json">GET /_mget<span class="token punctuation">&#123;</span>   <span class="token property">"docs"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>         <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span>         <span class="token property">"_type"</span> <span class="token operator">:</span>  <span class="token string">"blog"</span><span class="token punctuation">,</span>         <span class="token property">"_id"</span> <span class="token operator">:</span>    <span class="token number">2</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>         <span class="token property">"_index"</span> <span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span>         <span class="token property">"_type"</span> <span class="token operator">:</span>  <span class="token string">"pageviews"</span><span class="token punctuation">,</span>         <span class="token property">"_id"</span> <span class="token operator">:</span>    <span class="token number">1</span><span class="token punctuation">,</span>         <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token string">"views"</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">]</span><span class="token punctuation">&#125;</span></code></pre><p>è¿”å›å€¼ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>   <span class="token property">"docs"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>         <span class="token property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span>         <span class="token property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"2"</span><span class="token punctuation">,</span>         <span class="token property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span>         <span class="token property">"found"</span> <span class="token operator">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span>         <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"text"</span> <span class="token operator">:</span>  <span class="token string">"This is a piece of cake..."</span><span class="token punctuation">,</span>            <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"My first external blog entry"</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>         <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">10</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>         <span class="token property">"_index"</span> <span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span>         <span class="token property">"_id"</span> <span class="token operator">:</span>      <span class="token string">"1"</span><span class="token punctuation">,</span>         <span class="token property">"_type"</span> <span class="token operator">:</span>    <span class="token string">"pageviews"</span><span class="token punctuation">,</span>         <span class="token property">"found"</span> <span class="token operator">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span>         <span class="token property">"_version"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>         <span class="token property">"_source"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"views"</span> <span class="token operator">:</span> <span class="token number">2</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>   <span class="token punctuation">]</span><span class="token punctuation">&#125;</span></code></pre><h4 id="æ‰¹é‡æ“ä½œ"><a href="#æ‰¹é‡æ“ä½œ" class="headerlink" title="æ‰¹é‡æ“ä½œ"></a>æ‰¹é‡æ“ä½œ</h4><p>ä¸ <code>mget</code> å¯ä»¥ä½¿æˆ‘ä»¬ä¸€æ¬¡å–å›å¤šä¸ªæ–‡æ¡£åŒæ ·çš„æ–¹å¼ï¼Œ <code>bulk</code> API å…è®¸åœ¨å•ä¸ªæ­¥éª¤ä¸­è¿›è¡Œå¤šæ¬¡ <code>create</code> ã€ <code>index</code> ã€ <code>update</code> æˆ– <code>delete</code> è¯·æ±‚ã€‚ å¦‚æœä½ éœ€è¦ç´¢å¼•ä¸€ä¸ªæ•°æ®æµæ¯”å¦‚æ—¥å¿—äº‹ä»¶ï¼Œå®ƒå¯ä»¥æ’é˜Ÿå’Œç´¢å¼•æ•°ç™¾æˆ–æ•°åƒæ‰¹æ¬¡ã€‚</p><p><code>bulk</code> ä¸å…¶ä»–çš„è¯·æ±‚ä½“æ ¼å¼ç¨æœ‰ä¸åŒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span> action<span class="token operator">:</span> <span class="token punctuation">&#123;</span> metadata <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#123;</span> request body1        <span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#123;</span> action<span class="token operator">:</span> <span class="token punctuation">&#123;</span> metadata <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>\n<span class="token punctuation">&#123;</span> request body2        <span class="token punctuation">&#125;</span>\n...</code></pre><p>è¿™ç§æ ¼å¼å°±æ˜¯æ¯è¡Œå†™ä¸€ä¸ª JSON æ ¼å¼çš„æ•°æ®ï¼Œé€šè¿‡æ¢è¡Œç¬¦(<code>\n</code>)è¿æ¥åˆ°ä¸€èµ·ã€‚æ³¨æ„ä¸¤ä¸ªè¦ç‚¹ï¼š</p><ul><li>æ¯è¡Œä¸€å®šè¦ä»¥æ¢è¡Œç¬¦(<code>\n</code>)ç»“å°¾ï¼Œ<strong>åŒ…æ‹¬æœ€åä¸€è¡Œ</strong>ã€‚è¿™äº›æ¢è¡Œç¬¦è¢«ç”¨ä½œä¸€ä¸ªæ ‡è®°ï¼Œå¯ä»¥æœ‰æ•ˆåˆ†éš”è¡Œã€‚</li><li>è¿™äº›è¡Œä¸èƒ½åŒ…å«æœªè½¬ä¹‰çš„æ¢è¡Œç¬¦ï¼Œå› ä¸ºä»–ä»¬å°†ä¼šå¯¹è§£æé€ æˆå¹²æ‰°ã€‚è¿™æ„å‘³ç€è¿™ä¸ª JSONä¸èƒ½ä½¿ç”¨ pretty å‚æ•°æ‰“å°ã€‚</li></ul><p><code>action</code> å¿…é¡»æ˜¯ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€:</p><ul><li><strong><code>create</code></strong>ï¼šå¦‚æœæ–‡æ¡£ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åˆ›å»ºå®ƒã€‚</li><li><strong><code>index</code></strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°æ–‡æ¡£æˆ–è€…æ›¿æ¢ä¸€ä¸ªç°æœ‰çš„æ–‡æ¡£ã€‚</li><li><strong><code>update</code></strong>ï¼šéƒ¨åˆ†æ›´æ–°ä¸€ä¸ªæ–‡æ¡£ã€‚</li><li><strong><code>delete</code></strong>ï¼šåˆ é™¤ä¸€ä¸ªæ–‡æ¡£ã€‚ä¸éœ€è¦å†å¦é™„ä¸€è¡Œè¯·æ±‚ä½“ã€‚</li></ul><p><code>metadata</code> åº”è¯¥æŒ‡å®šè¢«ç´¢å¼•ã€åˆ›å»ºã€æ›´æ–°æˆ–è€…åˆ é™¤çš„æ–‡æ¡£çš„ <code>_index</code> ã€ <code>_type</code> å’Œ <code>_id</code> ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><pre class="language-json" data-language="json"><code class="language-json">POST /_bulk<span class="token punctuation">&#123;</span> <span class="token property">"delete"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span> <span class="token property">"create"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"title"</span><span class="token operator">:</span>    <span class="token string">"My first blog post"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"index"</span><span class="token operator">:</span>  <span class="token punctuation">&#123;</span> <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"title"</span><span class="token operator">:</span>    <span class="token string">"My second blog post"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"update"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"website"</span><span class="token punctuation">,</span> <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"blog"</span><span class="token punctuation">,</span> <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span> <span class="token property">"_retry_on_conflict"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"doc"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"My updated blog post"</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> </code></pre><p>è¿”å›å€¼ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>   <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>   <span class="token property">"errors"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>  <span class="token property">"delete"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"_index"</span><span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span>            <span class="token property">"_type"</span><span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span>            <span class="token property">"_id"</span><span class="token operator">:</span>      <span class="token string">"123"</span><span class="token punctuation">,</span>            <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"status"</span><span class="token operator">:</span>   <span class="token number">200</span><span class="token punctuation">,</span>            <span class="token property">"found"</span><span class="token operator">:</span>    <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>  <span class="token property">"create"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"_index"</span><span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span>            <span class="token property">"_type"</span><span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span>            <span class="token property">"_id"</span><span class="token operator">:</span>      <span class="token string">"123"</span><span class="token punctuation">,</span>            <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>            <span class="token property">"status"</span><span class="token operator">:</span>   <span class="token number">201</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>  <span class="token property">"create"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"_index"</span><span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span>            <span class="token property">"_type"</span><span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span>            <span class="token property">"_id"</span><span class="token operator">:</span>      <span class="token string">"EiwfApScQiiy7TIKFxRCTw"</span><span class="token punctuation">,</span>            <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token property">"status"</span><span class="token operator">:</span>   <span class="token number">201</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>  <span class="token property">"update"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"_index"</span><span class="token operator">:</span>   <span class="token string">"website"</span><span class="token punctuation">,</span>            <span class="token property">"_type"</span><span class="token operator">:</span>    <span class="token string">"blog"</span><span class="token punctuation">,</span>            <span class="token property">"_id"</span><span class="token operator">:</span>      <span class="token string">"123"</span><span class="token punctuation">,</span>            <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>            <span class="token property">"status"</span><span class="token operator">:</span>   <span class="token number">200</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>   <span class="token punctuation">]</span><span class="token punctuation">&#125;</span></code></pre><p>æ‰¹é‡å¤§å°é€‰æ‹©ï¼šä¸€ä¸ªå¥½çš„åŠæ³•æ˜¯å¼€å§‹æ—¶å°† 1,000 åˆ° 5,000 ä¸ªæ–‡æ¡£ä½œä¸ºä¸€ä¸ªæ‰¹æ¬¡, å¦‚æœä½ çš„æ–‡æ¡£éå¸¸å¤§ï¼Œé‚£ä¹ˆå°±å‡å°‘æ‰¹é‡çš„æ–‡æ¡£ä¸ªæ•°ã€‚ä¸€ä¸ªå¥½çš„æ‰¹é‡å¤§å°åœ¨å¼€å§‹å¤„ç†åæ‰€å ç”¨çš„ç‰©ç†å¤§å°çº¦ä¸º <strong>5-15 MB</strong>ã€‚</p><h3 id="æ•°æ®æŸ¥è¯¢"><a href="#æ•°æ®æŸ¥è¯¢" class="headerlink" title="æ•°æ®æŸ¥è¯¢"></a>æ•°æ®æŸ¥è¯¢</h3><h4 id="è¿”å›æ‰€æœ‰è®°å½•"><a href="#è¿”å›æ‰€æœ‰è®°å½•" class="headerlink" title="è¿”å›æ‰€æœ‰è®°å½•"></a>è¿”å›æ‰€æœ‰è®°å½•</h4><ul><li><code>[GET] /Index/Type/_search</code></li></ul><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"took"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>  <span class="token property">"timed_out"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token property">"_shards"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"total"</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">"successful"</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">"failed"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"hits"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>    <span class="token property">"total"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>    <span class="token property">"max_score"</span><span class="token operator">:</span><span class="token number">1.0</span><span class="token punctuation">,</span>    <span class="token property">"hits"</span><span class="token operator">:</span><span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"accounts"</span><span class="token punctuation">,</span>        <span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"person"</span><span class="token punctuation">,</span>        <span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"AV3qGfrC6jMbsbXb6k1p"</span><span class="token punctuation">,</span>        <span class="token property">"_score"</span><span class="token operator">:</span><span class="token number">1.0</span><span class="token punctuation">,</span>        <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"user"</span><span class="token operator">:</span> <span class="token string">"æå››"</span><span class="token punctuation">,</span>          <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"å·¥ç¨‹å¸ˆ"</span><span class="token punctuation">,</span>          <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"ç³»ç»Ÿç®¡ç†"</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token property">"_index"</span><span class="token operator">:</span><span class="token string">"accounts"</span><span class="token punctuation">,</span>        <span class="token property">"_type"</span><span class="token operator">:</span><span class="token string">"person"</span><span class="token punctuation">,</span>        <span class="token property">"_id"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span>        <span class="token property">"_score"</span><span class="token operator">:</span><span class="token number">1.0</span><span class="token punctuation">,</span>        <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"user"</span> <span class="token operator">:</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">,</span>          <span class="token property">"title"</span> <span class="token operator">:</span> <span class="token string">"å·¥ç¨‹å¸ˆ"</span><span class="token punctuation">,</span>          <span class="token property">"desc"</span> <span class="token operator">:</span> <span class="token string">"æ•°æ®åº“ç®¡ç†ï¼Œè½¯ä»¶å¼€å‘"</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ä¸Šé¢ä»£ç ä¸­ï¼Œè¿”å›ç»“æœçš„ <code>took</code> å­—æ®µè¡¨ç¤ºè¯¥æ“ä½œçš„è€—æ—¶ï¼ˆå•ä½ä¸ºæ¯«ç§’ï¼‰ï¼Œ<code>timed_out</code> å­—æ®µè¡¨ç¤ºæ˜¯å¦è¶…æ—¶ï¼Œ<code>hits</code> å­—æ®µè¡¨ç¤ºå‘½ä¸­çš„è®°å½•ï¼Œé‡Œé¢å­å­—æ®µçš„å«ä¹‰å¦‚ä¸‹ã€‚</p><ul><li><code>total</code>ï¼šè¿”å›è®°å½•æ•°ï¼Œæœ¬ä¾‹æ˜¯ 2 æ¡ã€‚</li><li><code>max_score</code>ï¼šæœ€é«˜çš„åŒ¹é…ç¨‹åº¦ï¼Œæœ¬ä¾‹æ˜¯ <code>1.0</code>ã€‚</li><li><code>hits</code>ï¼šè¿”å›çš„è®°å½•ç»„æˆçš„æ•°ç»„ã€‚</li></ul><p>è¿”å›çš„è®°å½•ä¸­ï¼Œæ¯æ¡è®°å½•éƒ½æœ‰ä¸€ä¸ª<code>_score</code>å­—æ®µï¼Œè¡¨ç¤ºåŒ¹é…çš„ç¨‹åºï¼Œé»˜è®¤æ˜¯æŒ‰ç…§è¿™ä¸ªå­—æ®µé™åºæ’åˆ—ã€‚</p><h4 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h4><ul><li><code>[GET] /Index/Type?size=10&amp;from=10</code></li></ul><p>åˆ†é¡µå®ç°çš„é€»è¾‘ï¼š</p><p>å½“æˆ‘ä»¬è¯·æ±‚ç»“æœçš„ç¬¬ä¸€é¡µï¼ˆç»“æœä» 1 åˆ° 10ï¼‰ï¼Œæ¯ä¸€ä¸ªåˆ†ç‰‡äº§ç”Ÿå‰ 10 çš„ç»“æœï¼Œå¹¶ä¸”è¿”å›ç»™ <strong>åè°ƒèŠ‚ç‚¹</strong> ï¼Œåè°ƒèŠ‚ç‚¹å¯¹ 50 ä¸ªç»“æœæ’åºå¾—åˆ°å…¨éƒ¨ç»“æœçš„å‰ 10 ä¸ªã€‚</p><p>ç°åœ¨å‡è®¾æˆ‘ä»¬è¯·æ±‚ç¬¬ 1000 é¡µ â€”â€” ç»“æœä» 10001 åˆ° 10010ã€‚æ‰€æœ‰éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œé™¤äº†æ¯ä¸ªåˆ†ç‰‡ä¸å¾—ä¸äº§ç”Ÿå‰ 10010 ä¸ªç»“æœä»¥å¤–ã€‚ç„¶ååè°ƒèŠ‚ç‚¹å¯¹å…¨éƒ¨ 50050 ä¸ªç»“æœæ’åºæœ€åä¸¢å¼ƒæ‰è¿™äº›ç»“æœä¸­çš„ 50040 ä¸ªç»“æœã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯¹ç»“æœæ’åºçš„æˆæœ¬éšåˆ†é¡µçš„æ·±åº¦æˆæŒ‡æ•°ä¸Šå‡ã€‚è¿™å°±æ˜¯ Web æœç´¢å¼•æ“å¯¹ä»»ä½•æŸ¥è¯¢éƒ½ä¸è¦è¿”å›è¶…è¿‡ 1000 ä¸ªç»“æœçš„åŸå› ã€‚</p><h4 id="æœç´¢-APIï¼šè½»é‡ç‰ˆ"><a href="#æœç´¢-APIï¼šè½»é‡ç‰ˆ" class="headerlink" title="æœç´¢ APIï¼šè½»é‡ç‰ˆ"></a>æœç´¢ APIï¼šè½»é‡ç‰ˆ</h4><p>æœ‰ä¸¤ç§å½¢å¼çš„ <code>æœç´¢</code> APIï¼šä¸€ç§æ˜¯ â€œè½»é‡çš„â€ <strong>æŸ¥è¯¢å­—ç¬¦ä¸²</strong> ç‰ˆæœ¬ï¼Œè¦æ±‚åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­ä¼ é€’æ‰€æœ‰çš„å‚æ•°ï¼Œå¦ä¸€ç§æ˜¯æ›´å®Œæ•´çš„ <strong>è¯·æ±‚ä½“</strong> ç‰ˆæœ¬ï¼Œè¦æ±‚ä½¿ç”¨ JSON æ ¼å¼å’Œæ›´ä¸°å¯Œçš„æŸ¥è¯¢è¡¨è¾¾å¼ä½œä¸ºæœç´¢è¯­è¨€ã€‚</p><p>åœ¨ <code>name</code> å­—æ®µä¸­åŒ…å« <code>john</code> å¹¶ä¸”åœ¨ <code>tweet</code> å­—æ®µä¸­åŒ…å« <code>mary</code> çš„æ–‡æ¡£ã€‚å®é™…çš„æŸ¥è¯¢å°±æ˜¯è¿™æ ·ï¼š</p><pre class="language-none"><code class="language-none">+name:john +tweet:mary</code></pre><p>ä½†æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°æ‰€éœ€è¦çš„ URL ç¼–ç å®é™…ä¸Šæ›´åŠ éš¾æ‡‚ï¼š</p><p><code>[GET] /_search?q=%2Bname%3Ajohn+%2Btweet%3Amary</code></p><p>ä¸‹é¢çš„æŸ¥è¯¢ä½¿ç”¨ä»¥ä¸‹çš„æ¡ä»¶ï¼š</p><ul><li><code>name</code> å­—æ®µä¸­åŒ…å« <code>mary</code> æˆ–è€… <code>john</code></li><li><code>date</code> å€¼å¤§äº <code>2014-09-10</code></li><li><code>_all</code> å­—æ®µåŒ…å« <code>aggregations</code> æˆ–è€… <code>geo</code>ï¼ˆé™¤éè®¾ç½®ç‰¹å®šå­—æ®µï¼Œå¦åˆ™æŸ¥è¯¢å­—ç¬¦ä¸²å°±ä½¿ç”¨ <code>_all</code> å­—æ®µè¿›è¡Œæœç´¢ï¼‰</li></ul><pre class="language-sense" data-language="sense"><code class="language-sense">+name:(mary john) +date:&gt;2014-09-10 +(aggregations geo)</code></pre><p>ä»ä¹‹å‰çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ç§ <strong>è½»é‡</strong> çš„æŸ¥è¯¢å­—ç¬¦ä¸²æœç´¢æ•ˆæœè¿˜æ˜¯æŒºè®©äººæƒŠå–œçš„ã€‚ å®ƒçš„æŸ¥è¯¢è¯­æ³•åœ¨ç›¸å…³å‚è€ƒæ–‡æ¡£ä¸­æœ‰è¯¦ç»†è§£é‡Šï¼Œä»¥ä¾¿ç®€æ´çš„è¡¨è¾¾å¾ˆå¤æ‚çš„æŸ¥è¯¢ã€‚å¯¹äºé€šè¿‡å‘½ä»¤åšä¸€æ¬¡æ€§æŸ¥è¯¢ï¼Œæˆ–è€…æ˜¯åœ¨å¼€å‘é˜¶æ®µï¼Œéƒ½éå¸¸æ–¹ä¾¿ã€‚</p><p>ä½†åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§ç²¾ç®€è®©è°ƒè¯•æ›´åŠ æ™¦æ¶©å’Œå›°éš¾ã€‚è€Œä¸”å¾ˆè„†å¼±ï¼Œä¸€äº›æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­å¾ˆå°çš„è¯­æ³•é”™è¯¯ï¼Œåƒ <code>-</code>ï¼Œ<code>:</code>ï¼Œ<code>/</code> æˆ–è€… <code>&quot;</code> ä¸åŒ¹é…ç­‰ï¼Œå°†ä¼šè¿”å›é”™è¯¯è€Œä¸æ˜¯æœç´¢ç»“æœã€‚</p><p>æœ€åï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²æœç´¢å…è®¸ä»»ä½•ç”¨æˆ·åœ¨ç´¢å¼•çš„ä»»æ„å­—æ®µä¸Šæ‰§è¡Œå¯èƒ½è¾ƒæ…¢ä¸”é‡é‡çº§çš„æŸ¥è¯¢ï¼Œè¿™å¯èƒ½ä¼šæš´éœ²éšç§ä¿¡æ¯ï¼Œç”šè‡³å°†é›†ç¾¤æ‹–å®ã€‚</p><p>ç›¸åï¼Œæˆ‘ä»¬ç»å¸¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ›´å¤šåœ°ä½¿ç”¨åŠŸèƒ½å…¨é¢çš„ <strong>request body</strong> æŸ¥è¯¢ APIï¼Œé™¤äº†èƒ½å®Œæˆä»¥ä¸Šæ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€äº›é™„åŠ åŠŸèƒ½ã€‚</p><h4 id="æœç´¢-APIï¼šè¯·æ±‚ä½“"><a href="#æœç´¢-APIï¼šè¯·æ±‚ä½“" class="headerlink" title="æœç´¢ APIï¼šè¯·æ±‚ä½“"></a>æœç´¢ APIï¼šè¯·æ±‚ä½“</h4><h5 id="è¿”å›æ‰€æœ‰è®°å½•ä¸åˆ†é¡µ"><a href="#è¿”å›æ‰€æœ‰è®°å½•ä¸åˆ†é¡µ" class="headerlink" title="è¿”å›æ‰€æœ‰è®°å½•ä¸åˆ†é¡µ"></a>è¿”å›æ‰€æœ‰è®°å½•ä¸åˆ†é¡µ</h5><p><code>[GET/POST] /Index/Type/_search</code></p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"from"</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>  <span class="token property">"size"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">&#125;</span></code></pre><h5 id="æŸ¥è¯¢è¯­å¥"><a href="#æŸ¥è¯¢è¯­å¥" class="headerlink" title="æŸ¥è¯¢è¯­å¥"></a>æŸ¥è¯¢è¯­å¥</h5><p><strong>æŸ¥è¯¢è¯­å¥ï¼ˆQuery clausesï¼‰</strong>å°±åƒä¸€äº›ç®€å•çš„ç»„åˆå—ï¼Œè¿™äº›ç»„åˆå—å¯ä»¥å½¼æ­¤ä¹‹é—´åˆå¹¶ç»„æˆæ›´å¤æ‚çš„æŸ¥è¯¢ã€‚è¿™äº›è¯­å¥å¯ä»¥æ˜¯å¦‚ä¸‹å½¢å¼ï¼š</p><ul><li><strong>å¶å­è¯­å¥ï¼ˆLeaf clausesï¼‰</strong>(æ¯”å¦‚ <code>match</code> è¯­å¥) è¢«ç”¨äºå°†æŸ¥è¯¢å­—ç¬¦ä¸²å’Œä¸€ä¸ªå­—æ®µï¼ˆæˆ–è€…å¤šä¸ªå­—æ®µï¼‰å¯¹æ¯”ã€‚</li><li><strong>å¤åˆ(Compound)</strong> è¯­å¥ä¸»è¦ç”¨äºåˆå¹¶å…¶å®ƒæŸ¥è¯¢è¯­å¥ã€‚ æ¯”å¦‚ï¼Œä¸€ä¸ª <code>bool</code> è¯­å¥å…è®¸åœ¨ä½ éœ€è¦çš„æ—¶å€™ç»„åˆå…¶å®ƒè¯­å¥ï¼Œæ— è®ºæ˜¯ <code>must</code> åŒ¹é…ã€ <code>must_not</code> åŒ¹é…è¿˜æ˜¯ <code>should</code> åŒ¹é…ï¼ŒåŒæ—¶å®ƒå¯ä»¥åŒ…å«ä¸è¯„åˆ†çš„è¿‡æ»¤å™¨ï¼ˆfiltersï¼‰ï¼š</li></ul><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"must"</span><span class="token operator">:</span>     <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"tweet"</span><span class="token operator">:</span> <span class="token string">"elasticsearch"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"name"</span><span class="token operator">:</span>  <span class="token string">"mary"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"should"</span><span class="token operator">:</span>   <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"tweet"</span><span class="token operator">:</span> <span class="token string">"full text"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"filter"</span><span class="token operator">:</span>   <span class="token punctuation">&#123;</span> <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"age"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"gt"</span> <span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="æŸ¥è¯¢ä¸è¿‡æ»¤"><a href="#æŸ¥è¯¢ä¸è¿‡æ»¤" class="headerlink" title="æŸ¥è¯¢ä¸è¿‡æ»¤"></a>æŸ¥è¯¢ä¸è¿‡æ»¤</h5><p>æˆ‘ä»¬çš„æœç´¢ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼šè¿‡æ»¤æƒ…å†µï¼ˆfiltering contextï¼‰å’ŒæŸ¥è¯¢æƒ…å†µï¼ˆquery contextï¼‰ã€‚</p><p>å½“ä½¿ç”¨äº <strong>è¿‡æ»¤æƒ…å†µ</strong> æ—¶ï¼ŒæŸ¥è¯¢è¢«è®¾ç½®æˆä¸€ä¸ªâ€œä¸è¯„åˆ†â€æˆ–è€…â€œè¿‡æ»¤â€æŸ¥è¯¢ã€‚å³ï¼Œè¿™ä¸ªæŸ¥è¯¢åªæ˜¯ç®€å•çš„é—®ä¸€ä¸ªé—®é¢˜ï¼šâ€œè¿™ç¯‡æ–‡æ¡£æ˜¯å¦åŒ¹é…ï¼Ÿâ€ã€‚å›ç­”ä¹Ÿæ˜¯éå¸¸çš„ç®€å•ï¼Œyes æˆ–è€… no ï¼ŒäºŒè€…å¿…å±…å…¶ä¸€ã€‚</p><p>å½“ä½¿ç”¨äº <strong>æŸ¥è¯¢æƒ…å†µ</strong> æ—¶ï¼ŒæŸ¥è¯¢å°±å˜æˆäº†ä¸€ä¸ªâ€œè¯„åˆ†â€çš„æŸ¥è¯¢ã€‚å’Œä¸è¯„åˆ†çš„æŸ¥è¯¢ç±»ä¼¼ï¼Œä¹Ÿè¦å»åˆ¤æ–­è¿™ä¸ªæ–‡æ¡£æ˜¯å¦åŒ¹é…ï¼ŒåŒæ—¶å®ƒè¿˜éœ€è¦åˆ¤æ–­è¿™ä¸ªæ–‡æ¡£åŒ¹é…çš„æœ‰ <strong>å¤šå¥½</strong>ï¼ˆåŒ¹é…ç¨‹åº¦å¦‚ä½•ï¼‰ã€‚ä¸€ä¸ªè¯„åˆ†æŸ¥è¯¢è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£ä¸æ­¤æŸ¥è¯¢çš„ <strong>ç›¸å…³ç¨‹åº¦</strong>ï¼ŒåŒæ—¶å°†è¿™ä¸ªç›¸å…³ç¨‹åº¦åˆ†é…ç»™è¡¨ç¤ºç›¸å…³æ€§çš„å­—æ®µ <code>_score</code>ï¼Œå¹¶ä¸”æŒ‰ç…§ç›¸å…³æ€§å¯¹åŒ¹é…åˆ°çš„æ–‡æ¡£è¿›è¡Œæ’åºã€‚è¿™ç§ç›¸å…³æ€§çš„æ¦‚å¿µæ˜¯éå¸¸é€‚åˆå…¨æ–‡æœç´¢çš„æƒ…å†µï¼Œå› ä¸ºå…¨æ–‡æœç´¢å‡ ä¹æ²¡æœ‰å®Œå…¨ â€œæ­£ç¡®â€ çš„ç­”æ¡ˆã€‚</p><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ª filter ä¼šæ¯”ä¸€ä¸ª query æ€§èƒ½æ›´ä¼˜å¼‚ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½è¡¨ç°çš„å¾ˆç¨³å®šã€‚</p><p>é€šå¸¸çš„è§„åˆ™æ˜¯ï¼Œä½¿ç”¨æŸ¥è¯¢ï¼ˆqueryï¼‰è¯­å¥æ¥è¿›è¡Œ <strong>å…¨æ–‡</strong> æœç´¢æˆ–è€…å…¶å®ƒä»»ä½•éœ€è¦å½±å“ <strong>ç›¸å…³æ€§å¾—åˆ†</strong> çš„æœç´¢ã€‚é™¤æ­¤ä»¥å¤–çš„æƒ…å†µéƒ½ä½¿ç”¨è¿‡æ»¤ï¼ˆfilters)ã€‚</p><h5 id="Leaf-Clauses"><a href="#Leaf-Clauses" class="headerlink" title="Leaf Clauses"></a>Leaf Clauses</h5><ul><li><code>match_all</code></li></ul><p><code>match_all</code> æŸ¥è¯¢ç®€å•çš„åŒ¹é…æ‰€æœ‰æ–‡æ¡£ã€‚åœ¨æ²¡æœ‰æŒ‡å®šæŸ¥è¯¢æ–¹å¼æ—¶ï¼Œå®ƒæ˜¯é»˜è®¤çš„æŸ¥è¯¢ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span> <span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å®ƒç»å¸¸ä¸ filter ç»“åˆä½¿ç”¨â€”ä¾‹å¦‚ï¼Œæ£€ç´¢æ”¶ä»¶ç®±é‡Œçš„æ‰€æœ‰é‚®ä»¶ã€‚æ‰€æœ‰é‚®ä»¶è¢«è®¤ä¸ºå…·æœ‰ç›¸åŒçš„ç›¸å…³æ€§ï¼Œæ‰€ä»¥éƒ½å°†è·å¾—åˆ†å€¼ä¸º <code>1</code> çš„ä¸­æ€§ <code>_score</code>ã€‚</p><ul><li><code>match</code></li></ul><p>æ— è®ºä½ åœ¨ä»»ä½•å­—æ®µä¸Šè¿›è¡Œçš„æ˜¯å…¨æ–‡æœç´¢è¿˜æ˜¯ç²¾ç¡®æŸ¥è¯¢ï¼Œ<code>match</code> æŸ¥è¯¢æ˜¯ä½ å¯ç”¨çš„æ ‡å‡†æŸ¥è¯¢ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªå…¨æ–‡å­—æ®µä¸Šä½¿ç”¨ <code>match</code> æŸ¥è¯¢ï¼Œ<strong>åœ¨æ‰§è¡ŒæŸ¥è¯¢å‰ï¼Œå®ƒå°†ç”¨æ­£ç¡®çš„åˆ†æå™¨å»åˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç²¾ç¡®å€¼çš„å­—æ®µä¸Šä½¿ç”¨å®ƒï¼Œä¾‹å¦‚æ•°å­—ã€æ—¥æœŸã€å¸ƒå°”æˆ–è€…ä¸€ä¸ª <code>not_analyzed</code> å­—ç¬¦ä¸²å­—æ®µï¼Œé‚£ä¹ˆå®ƒå°†ä¼šç²¾ç¡®åŒ¹é…ç»™å®šçš„å€¼ã€‚</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"tweet"</span><span class="token operator">:</span> <span class="token string">"About Search"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ul><li><code>multi_match</code></li></ul><p><code>multi_match</code> æŸ¥è¯¢å¯ä»¥åœ¨å¤šä¸ªå­—æ®µä¸Šæ‰§è¡Œç›¸åŒçš„ <code>match</code> æŸ¥è¯¢ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"multi_match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"query"</span><span class="token operator">:</span>    <span class="token string">"full text search"</span><span class="token punctuation">,</span>        <span class="token property">"fields"</span><span class="token operator">:</span>   <span class="token punctuation">[</span> <span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">"body"</span> <span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ul><li><code>range</code></li></ul><p><code>range</code> æŸ¥è¯¢æ‰¾å‡ºé‚£äº›è½åœ¨æŒ‡å®šåŒºé—´å†…çš„æ•°å­—æˆ–è€…æ—¶é—´ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"age"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"gte"</span><span class="token operator">:</span>  <span class="token number">20</span><span class="token punctuation">,</span>            <span class="token property">"lt"</span><span class="token operator">:</span>   <span class="token number">30</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¢«å…è®¸çš„æ“ä½œç¬¦å¦‚ä¸‹ï¼š</p><ul><li><strong><code>gt</code></strong>ï¼šå¤§äº</li><li><strong><code>gte</code></strong>ï¼šå¤§äºç­‰äº</li><li><strong><code>lt</code></strong>ï¼šå°äº</li><li><strong><code>lte</code></strong>ï¼šå°äºç­‰äº</li></ul><ul><li><code>term</code></li></ul><p><code>term</code> æŸ¥è¯¢è¢«ç”¨äºç²¾ç¡®å€¼åŒ¹é…ï¼Œè¿™äº›ç²¾ç¡®å€¼å¯èƒ½æ˜¯æ•°å­—ã€æ—¶é—´ã€å¸ƒå°”æˆ–è€…é‚£äº› <code>not_analyzed</code> çš„å­—ç¬¦ä¸²ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span> <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"age"</span><span class="token operator">:</span>    <span class="token number">26</span>           <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"date"</span><span class="token operator">:</span>   <span class="token string">"2014-09-01"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"public"</span><span class="token operator">:</span> <span class="token boolean">true</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span> <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"tag"</span><span class="token operator">:</span>    <span class="token string">"full_text"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><code>term</code> æŸ¥è¯¢å¯¹äºè¾“å…¥çš„æ–‡æœ¬ä¸åˆ†æï¼Œæ‰€ä»¥å®ƒå°†ç»™å®šçš„å€¼è¿›è¡Œç²¾ç¡®æŸ¥è¯¢ã€‚</p><ul><li><code>terms</code></li></ul><p><code>terms</code> æŸ¥è¯¢å’Œ <code>term</code> æŸ¥è¯¢ä¸€æ ·ï¼Œä½†å®ƒå…è®¸ä½ æŒ‡å®šå¤šå€¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœè¿™ä¸ªå­—æ®µåŒ…å«äº†æŒ‡å®šå€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡æ¡£æ»¡è¶³æ¡ä»¶ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span> <span class="token property">"terms"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"tag"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"search"</span><span class="token punctuation">,</span> <span class="token string">"full_text"</span><span class="token punctuation">,</span> <span class="token string">"nosql"</span> <span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ul><li><code>exists / missing</code></li></ul><p><code>exists</code> æŸ¥è¯¢å’Œ <code>missing</code> æŸ¥è¯¢è¢«ç”¨äºæŸ¥æ‰¾é‚£äº›æŒ‡å®šå­—æ®µä¸­æœ‰å€¼ (<code>exists</code>) æˆ–æ— å€¼ (<code>missing</code>) çš„æ–‡æ¡£ã€‚è¿™ä¸SQLä¸­çš„ <code>IS_NULL</code> (<code>missing</code>) å’Œ <code>NOT IS_NULL</code> (<code>exists</code>) åœ¨æœ¬è´¨ä¸Šå…·æœ‰å…±æ€§ï¼š</p><pre class="language-sense" data-language="sense"><code class="language-sense">&#123;    &quot;exists&quot;:   &#123;        &quot;field&quot;:    &quot;title&quot;    &#125;&#125;</code></pre><h5 id="Compound-Clauses"><a href="#Compound-Clauses" class="headerlink" title="Compound Clauses"></a>Compound Clauses</h5><p>ç°å®çš„æŸ¥è¯¢éœ€æ±‚ä»æ¥éƒ½æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼›å®ƒä»¬éœ€è¦åœ¨å¤šä¸ªå­—æ®µä¸ŠæŸ¥è¯¢å¤šç§å¤šæ ·çš„æ–‡æœ¬ï¼Œå¹¶ä¸”æ ¹æ®ä¸€ç³»åˆ—çš„æ ‡å‡†æ¥è¿‡æ»¤ã€‚ä¸ºäº†æ„å»ºç±»ä¼¼çš„é«˜çº§æŸ¥è¯¢ï¼Œä½ éœ€è¦ä¸€ç§èƒ½å¤Ÿå°†å¤šæŸ¥è¯¢ç»„åˆæˆå•ä¸€æŸ¥è¯¢çš„æŸ¥è¯¢æ–¹æ³•ã€‚</p><p>ä½ å¯ä»¥ç”¨ <code>bool</code> æŸ¥è¯¢æ¥å®ç°ä½ çš„éœ€æ±‚ã€‚è¿™ç§æŸ¥è¯¢å°†å¤šæŸ¥è¯¢ç»„åˆåœ¨ä¸€èµ·ï¼Œæˆä¸ºç”¨æˆ·è‡ªå·±æƒ³è¦çš„å¸ƒå°”æŸ¥è¯¢ã€‚å®ƒæ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li><strong><code>must</code></strong>ï¼šæ–‡æ¡£ <strong>å¿…é¡»</strong> åŒ¹é…è¿™äº›æ¡ä»¶æ‰èƒ½è¢«åŒ…å«è¿›æ¥ã€‚</li><li><strong><code>must_not</code></strong>ï¼šæ–‡æ¡£ <strong>å¿…é¡»ä¸</strong> åŒ¹é…è¿™äº›æ¡ä»¶æ‰èƒ½è¢«åŒ…å«è¿›æ¥ã€‚</li><li><strong><code>should</code></strong>ï¼šå¦‚æœæ»¡è¶³è¿™äº›è¯­å¥ä¸­çš„ä»»æ„è¯­å¥ï¼Œå°†å¢åŠ  <code>_score</code> ï¼Œå¦åˆ™ï¼Œæ— ä»»ä½•å½±å“ã€‚å®ƒä»¬ä¸»è¦ç”¨äºä¿®æ­£æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§å¾—åˆ†ã€‚</li><li><strong><code>filter</code></strong>ï¼š<strong>å¿…é¡»</strong> åŒ¹é…ï¼Œä½†å®ƒä»¥ä¸è¯„åˆ†ã€è¿‡æ»¤æ¨¡å¼æ¥è¿›è¡Œã€‚è¿™äº›è¯­å¥å¯¹è¯„åˆ†æ²¡æœ‰è´¡çŒ®ï¼Œåªæ˜¯æ ¹æ®è¿‡æ»¤æ ‡å‡†æ¥æ’é™¤æˆ–åŒ…å«æ–‡æ¡£ã€‚</li></ul><p>ä¾‹å­ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"must"</span><span class="token operator">:</span>     <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"how to make millions"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"tag"</span><span class="token operator">:</span>   <span class="token string">"spam"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"should"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"tag"</span><span class="token operator">:</span> <span class="token string">"starred"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"filter"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>               <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                  <span class="token punctuation">&#123;</span> <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"date"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"gte"</span><span class="token operator">:</span> <span class="token string">"2014-01-01"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                  <span class="token punctuation">&#123;</span> <span class="token property">"range"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"price"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"lte"</span><span class="token operator">:</span> <span class="token number">29.99</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token property">"must_not"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                  <span class="token punctuation">&#123;</span> <span class="token property">"term"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"ebooks"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>              <span class="token punctuation">]</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"bool"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token property">"must"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"è½¯ä»¶"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span> <span class="token property">"match"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"desc"</span><span class="token operator">:</span> <span class="token string">"ç³»ç»Ÿ"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>      <span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="ç½‘ç«™æ­å»ºçºªå®ï¼šå‰ç«¯"><a href="#ç½‘ç«™æ­å»ºçºªå®ï¼šå‰ç«¯" class="headerlink" title="ç½‘ç«™æ­å»ºçºªå®ï¼šå‰ç«¯"></a>ç½‘ç«™æ­å»ºçºªå®ï¼šå‰ç«¯</h2><p>æ²¡å•¥å¥½è®²çš„ï¼Œç”¨çš„æ˜¯è‡ªå·±æœ€ç†Ÿæ‚‰çš„ React+Redux æ¡†æ¶åŠå¤©è‚äº†ä¸ª Prototypeâ€¦</p><p>å˜›å˜›ï¼Œåæ­£å‰ç«¯ä¸æ˜¯ä¸»è¦éƒ¨åˆ†å•¦x</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://www.cnblogs.com/jiangxinyang/p/10516302.html">https://www.cnblogs.com/jiangxinyang/p/10516302.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/79202151">https://zhuanlan.zhihu.com/p/79202151</a></li><li><a href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></li><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a></li><li><a href="https://cuiqingcai.com/6214.html">https://cuiqingcai.com/6214.html</a></li><li><a href="https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html">https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;äº‹å®ä¸Šæ˜¯æŒ‘æˆ˜æ¯è¦æ­ä¸€ä¸ªæ–‡ä¹¦æœç´¢ç½‘ç«™â€¦æš‚æ—¶éœ€è¦ç”¨ BM25 ç®—æ³•é¡¶ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Elasticsearch çš„é»˜è®¤ç›¸ä¼¼åº¦ç®—æ³•å°±æ˜¯ BM25ï¼Œå˜›å˜›ï¼Œå¤§èƒœåˆ©ã€‚&lt;/p&gt;
&lt;p&gt;æœç´¢çš„å¯¹è±¡æ˜¯â€¦æ•°ç›®çº¦åœ¨ $10^8$ è§„æ¨¡å·¦å³çš„æ–‡æ¡£â€¦&lt;/p&gt;
&lt;p&gt;å˜›å˜›ï¼Œåæ­£éƒ½æ˜¯å¤§è°ƒåº“ã€‚ç¼åˆå°±å®Œäº‹äº†ã€‚&lt;/p&gt;
&lt;p&gt;// WIP: åº”è¯¥ä¸ä¼šå’•&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/åç«¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="ElasticSearch" scheme="https://www.c7w.tech/tags/ElasticSearch/"/>
    
  </entry>
  
  <entry>
    <title>LaTeX ä»å…¥å‘åˆ°é€€å‘</title>
    <link href="https://www.c7w.tech/latex/"/>
    <id>https://www.c7w.tech/latex/</id>
    <published>2022-02-13T08:43:16.000Z</published>
    <updated>2022-02-13T17:12:26.296Z</updated>
    
    <content type="html"><![CDATA[<p>è™½ç„¶ Markdown å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯ç”Ÿæˆçš„ pdf æ–‡æ¡£çœ‹èµ·æ¥å°±æ˜¯<s>æ²¡æœ‰èŒƒ</s>ä¸å¤Ÿæ­£å¼ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ LaTeX ä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹åå†™è®ºæ–‡çš„å¿…å¤‡æŠ€èƒ½ã€‚</p><p>æœ¬æ•™ç¨‹ä¸»è¦æ¶‰åŠå·²å¯¹ Markdown è¾ƒä¸ºç†Ÿè¯†ä¹‹åçš„è¿ç§»å­¦ä¹ ã€‚</p><a id="more"></a><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><ul><li>Markdown å…¥é—¨</li><li>Markdown ç¼–å†™æ•°å­¦å…¬å¼çš„æ–¹æ³•</li></ul><h2 id="LaTeX-ç®€ä»‹"><a href="#LaTeX-ç®€ä»‹" class="headerlink" title="LaTeX ç®€ä»‹"></a>LaTeX ç®€ä»‹</h2><p>æˆ‘ä»¬é¦–å…ˆè§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>LaTeX æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>LaTeX æ€æ ·è¿ä½œï¼Ÿ</li><li>æˆ‘è¯¥åœ¨å“ªé‡Œå†™ LaTexï¼Ÿ</li></ul><p>åœ¨è§£å†³ä¸Šè¿°å‡ ä¸ªé—®é¢˜ä¹‹åï¼Œæˆ‘ä»¬å†è¯¦ç»†ä»‹ç»è¯¥æ€ä¹ˆå†™ LaTeX çš„é—®é¢˜ã€‚</p><h3 id="LaTeX-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#LaTeX-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="LaTeX æ˜¯ä»€ä¹ˆï¼Ÿ"></a>LaTeX æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç›¸ä¿¡ä½ è¯»åˆ°è¿™é‡Œå·²ç»åšå¥½è§‰æ‚Ÿè¦è¢«çŒè¾“ä¸€ç³»åˆ—å…³é”®è¯å’Œå…¶å¯¹åº”æ¦‚å¿µäº†ã€‚è®©æˆ‘ä»¬å¼€å§‹ï¼š</p><blockquote><p>å†å²å›æº¯åˆ° Knuth æ•™æˆçš„å·¨è‘— The Art of Computer Programming å°†è¦å‡ºç‰ˆä¹‹é™…ï¼Œå½“å‡ºç‰ˆå•†å°†ä»–ä»¬æ’ç‰ˆçš„ä¹¦ç¨¿è‰æ ·äº¤ç»™ Knuth æ•™æˆçš„æ—¶å€™ï¼Œä»–å¯¹äºå…¶ä¸­å¤æ‚æ•°å­¦å…¬å¼çš„æ’ç‰ˆå¤„ç†ååˆ†ä¸æ»¡ã€‚å…¶æ’ç‰ˆä¹‹ç²—ç³™ï¼Œå·²è¾¾åˆ°äº†ä¼šå½±å“äººä»¬ç†è§£åŸä¹¦å†…å®¹çš„ç¨‹åº¦ã€‚å› æ­¤ï¼Œå¯¹äºå¤æ‚çš„æ•°å­¦å’Œç‰©ç†å…¬å¼ï¼Œæˆ‘ä»¬æ€¥éœ€ä¸€ç§èƒ½å¤Ÿå°†å…¶åœ¨äº’è”ç½‘ä¸Šä¼ è¾“çš„ç¼–ç æ ¼å¼ï¼Œä½¿å¾—äººèƒ½é˜…è¯»çš„å…¬å¼å’Œæœºå™¨èƒ½å­˜å‚¨çš„å…¬å¼ä¹‹é—´è¾¾åˆ°ä¸€ç§äº’ç›¸è½¬åŒ–ã€‚</p></blockquote><ul><li><strong>TeX</strong>ï¼šä¸€ç§æ’ç‰ˆå¼•æ“ï¼Œä¹Ÿæ˜¯è¯¥å¼•æ“ä½¿ç”¨çš„æ ‡è®°è¯­è¨€çš„åç§°ã€‚å¼•æ“æ˜¯æŒ‡èƒ½å¤Ÿæ–­è¡Œã€åˆ†é¡µçš„ç¨‹åºï¼Œæ ‡è®°è¯­è¨€æ˜¯æ§åˆ¶å‘½ä»¤å’Œæ–‡æœ¬ç»“åˆçš„æ ¼å¼ã€‚å¯ä»¥ç±»æ¯”ç†è§£æˆä½ å†™çš„ C++ æºä»£ç æˆ–è€…æ›´åº•å±‚çš„æœºå™¨æŒ‡ä»¤ç ï¼Œå¦‚è¾“å…¥ <script type="math/tex">2^6</script>ã€‚</li><li><strong>LaTeX</strong>ï¼šæ˜¯ä¸€ä¸ªåŸºäº TeX çš„æ’ç‰ˆç³»ç»Ÿï¼Œå°†ç”¨æˆ·æŒ‰ç…§å®ƒçš„æ ¼å¼ç¼–å†™çš„æ–‡æ¡£è§£é‡Šæˆ TeX å¼•æ“èƒ½ç†è§£çš„å½¢å¼å¹¶äº¤ä»˜ç»™ TeX å¼•æ“å¤„ç†ï¼Œå†å°†æœ€ç»ˆç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚å¯ä»¥ç±»æ¯”ç†è§£æˆ g++ ç¼–è¯‘å™¨ï¼Œå°†ä¸Šè¿°ä»£ç æ¸²æŸ“ä¸º $2^6$ã€‚</li><li><strong>pdfTeX</strong> ä¸ <strong>pdfLaTeX</strong>ï¼šåŸç‰ˆ TeX ç³»ç»Ÿç”Ÿæˆçš„æ–‡ä»¶æ˜¯ <code>dvi</code> æ ¼å¼ï¼Œè€Œ pdfTeX ç³»ç»Ÿä¸‹ç”Ÿæˆçš„æ–‡ä»¶æ˜¯ <code>pdf</code> æ ¼å¼ã€‚</li><li><strong>XeTeX</strong> ä¸ <strong>XeLaTeX</strong>ï¼šä¸Šè¿° TeX ç³»ç»Ÿç”Ÿæˆçš„å­—ç¬¦é›†åªæ”¯æŒ ASCII å­—ç¬¦ã€‚åœ¨ XeTeX å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬æ›¾ä½¿ç”¨è¿‡å¼•ç”¨å¼•å…¥ CJK å®åº“ï¼ˆè§£å†³ä¸æ”¯æŒä¸­æ—¥éŸ©å­—ç¬¦é—®é¢˜çš„ä¸€ä¸ªåº“ï¼‰æ‰‹æ®µæ¥å¤„ç†ä¸­æ–‡å­—ç¬¦çš„é—®é¢˜ã€‚ä½†æ˜¯è¿™ä¸ªæ’ç‰ˆç³»ç»Ÿå¯¹æ‰€æœ‰ Unicode å­—ç¬¦éƒ½å®ç°äº†æ”¯æŒã€‚</li><li><strong>LuaTeX</strong> ä¸ <strong>LuaLaTeX</strong>ï¼š<code>pdfTeX</code> ç³»ç»Ÿçš„ç»§æ‰¿è€…ï¼Œæ”¯æŒä½¿ç”¨ä¸€äº›ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬æ¥å®ç°ä¹‹å‰éœ€è¦å†™æˆ TeX çš„åŠŸèƒ½ã€‚æ”¯æŒ Unicodeï¼Œå†…è” luaï¼Œæ”¯æŒ OpenTypeã€‚</li></ul><p>è¿™é‡Œæˆ‘ä»¬æ¨èä½¿ç”¨ <code>XeTeX</code> ç³»ç»Ÿæ¥è¿›è¡Œæˆ‘ä»¬æ—¥å¸¸çš„å·¥ä½œï¼Œæˆ‘ä»¬åç»­çš„æ•™ç¨‹ä¹Ÿå›´ç»•è¿™ä¸ªæ’ç‰ˆç³»ç»Ÿå±•å¼€ã€‚ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä»¬åç»­ä¸å†åŒºåˆ†ä¸Šè¿°æ¦‚å¿µï¼Œç»Ÿä¸€ä½¿ç”¨ <code>TeX</code>ï¼Œ<code>LaTeX</code> æ¥è¡¨è¿°æˆ‘ä»¬åœ¨è¯´çš„è¿™ä¸ªè¯é¢˜ã€‚</p><h3 id="LaTeX-æ€æ ·è¿ä½œï¼Ÿ"><a href="#LaTeX-æ€æ ·è¿ä½œï¼Ÿ" class="headerlink" title="LaTeX æ€æ ·è¿ä½œï¼Ÿ"></a>LaTeX æ€æ ·è¿ä½œï¼Ÿ</h3><p>LaTeX æ’ç‰ˆç³»ç»Ÿçš„è¾“å…¥æ˜¯å«æœ‰æˆ‘ä»¬æ•²çš„æ–‡æœ¬å’Œæ§åˆ¶å‘½ä»¤çš„ <code>tex</code> æ–‡ä»¶ï¼Œè¾“å‡ºæ˜¯ä¸€ä»½ <code>pdf</code> æ–‡ä»¶ã€‚æˆ‘ä»¬åªéœ€è¦è´Ÿè´£åœ¨ <code>tex</code> æ–‡ä»¶ä¸­å†™ä¸‹æºç ï¼Œç„¶åå‰©ä¸‹çš„ç¼–è¯‘å’Œç”Ÿæˆå·¥ä½œå…¨éƒ¨äº¤ç»™ LaTeX å³å¯ã€‚</p><p>æœ‰æ—¶æˆ‘ä»¬è¿˜å¯ä»¥æŠŠä¸€ä¸ª LaTeX é¡¹ç›®ç»„ç»‡æˆä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ­¤æ—¶è¿˜æ˜¯ä¸€ä»½ <code>tex</code> æ–‡ä»¶å†³å®šä¸€ä¸ª <code>pdf</code> çš„ç”Ÿæˆï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å¼•å…¥å…¶ä»–ä¸€äº›æ–‡ä»¶ï¼Œå¦‚å­—ä½“æ–‡ä»¶ï¼Œå›¾ç‰‡æ–‡ä»¶ï¼Œ<code>.cls</code> æ–‡ä»¶ï¼ˆæ–‡æ¡£æ¨¡æ¿ç±»æ–‡ä»¶ï¼‰ç­‰ç­‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ç¼–å†™å¤šä¸ª <code>tex</code> æ–‡ä»¶ï¼Œä»¥å…±äº«æ–‡ä»¶å¤¹ä¸­çš„å…¶ä»–èµ„æºã€‚æ­¤æ—¶ä¸åŒçš„ <code>tex</code> æ–‡ä»¶ä¹‹é—´ç”šè‡³å¯ä»¥é¡¹ç›®åŒ…å«ï¼ˆç±»æ¯”äº C++ çš„ <code>#include</code> åŒ…å«ï¼‰ã€‚</p><h3 id="åœ¨å“ªé‡Œç¼–å†™-LaTeXï¼Ÿ"><a href="#åœ¨å“ªé‡Œç¼–å†™-LaTeXï¼Ÿ" class="headerlink" title="åœ¨å“ªé‡Œç¼–å†™ LaTeXï¼Ÿ"></a>åœ¨å“ªé‡Œç¼–å†™ LaTeXï¼Ÿ</h3><p>æˆ‘ä»¬æœ‰ç¦»çº¿å’Œåœ¨çº¿ä¸¤ç§æ¨¡å¼æ¥æ’°å†™ LaTeXã€‚</p><p>ç¦»çº¿æ¨¡å¼å°±æ˜¯å®‰è£…ä¸€ä¸ª LaTeX æ’ç‰ˆç³»ç»Ÿï¼Œç±»æ¯”æˆ‘ä»¬æƒ³å†™ Markdown çš„æ—¶å€™è£…äº†ä¸€ä¸ª Typora è½¯ä»¶ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…ç›¸åº”çš„è½¯ä»¶æ¥è¾…åŠ©æˆ‘ä»¬å·¥ä½œï¼Œå¦‚ï¼š</p><ul><li>TeXworks</li><li>TeXstudio</li></ul><p>è€Œä½¿ç”¨è¿™ç§æ–¹å¼å®‰è£…å¸¦æ¥çš„é—®é¢˜æ˜¯å¯èƒ½å®‰è£…åŒ…è¿‡äºè‡ƒè‚¿ï¼Œä¼˜ç‚¹æ˜¯ä¸ç”¨å—åˆ°ç½‘ç»œç¯å¢ƒç­‰ç­‰å› ç´ çš„å¹²æ‰°ï¼Œä¹Ÿä¸ç”¨å—åˆ°ç½‘ç»œç¯å¢ƒå­˜å‚¨å®¹é‡æˆ–è¿è¡Œæ—¶ç¯å¢ƒçš„é™åˆ¶ã€‚å…¶å®‰è£…æ–¹å¼åœ¨ç½‘ç»œä¸Šæœç´¢â€œLaTeX å…¥é—¨â€ä¾¿å¯æ‰¾åˆ°å †ç§¯å¦‚å±±çš„<a href="https://www.zhihu.com/question/62943097">æ•™ç¨‹</a>ã€‚</p><p>è€Œæˆ‘ä»¬è¿™é‡Œæ¨å´‡çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨åœ¨çº¿æ–¹å¼æ¥ç¼–å†™ã€‚å¦‚ <code>Overleaf</code> åœ¨å†…çš„æ‰˜ç®¡ç½‘ç«™ä¼šå°†ä½ çš„æ¯ä¸ª TeX é¡¹ç›®ç»„ç»‡æˆä¸€ä¸ªä»“åº“çš„å½¢å¼ï¼Œå¹¶å…è®¸ä½ åœ¨å…¶ä¸­è¿›è¡Œåœ¨çº¿ç¼–è¾‘ï¼š</p><p><img src="https://s2.loli.net/2022/02/14/JcqCKNfs31vxm2u.png" alt="image-20220213203750216"></p><p><img src="https://s2.loli.net/2022/02/13/IKAPDlYTmFEu5S1.png" alt="image-20220213204115880"></p><p>å·¦ä¸Šè§’æ˜¯æˆ‘ä»¬å½“å‰ä»“åº“çš„æ–‡ä»¶æ¸…å•ï¼Œè¾ƒå·¦ä¾§çª—å£æ˜¯ç¼–è¾‘å™¨ï¼Œå³ä¾§çª—å£æ˜¯å³æ—¶é¢„è§ˆçª—å£ã€‚ç±»ä¼¼äº <code>Overleaf</code> çš„ç½‘ç«™ç”šè‡³è¿˜æä¾›äº†ä»“åº“æƒé™ç®¡ç†ç³»ç»Ÿï¼Œä½ å¯ä»¥é‚€è¯·å…¶ä»–äººä¸€èµ·ç¼–è¾‘ï¼Œæˆ–æ˜¯å¯¼å…¥åˆ«äººç¼–è¾‘å¥½çš„æ¨¡æ¿ç»§ç»­ä½ çš„ç¼–è¾‘ç­‰ç­‰ã€‚å€¼å¾—ä¸€æçš„æ˜¯è®¸å¤šå­¦æœ¯ä¼šè®®éƒ½ä¼šç»™å‡ºä»–ä»¬æ¥å—çš„è®ºæ–‡çš„æ¨¡æ¿ã€‚</p><p>é‰´äº <code>Overleaf</code> éœ€è¦ç§‘å­¦ä¸Šç½‘æ‰èƒ½è®¿é—®ï¼š</p><ul><li>è´µæ ¡ TUNA åä¼šç»´æŠ¤äº†ä¸€ä»½ <a href="https://overleaf.tsinghua.edu.cn/login">Tsinghua Overleaf</a>ï¼Œéœ€è¦ä½¿ç”¨æ¸…åç»Ÿä¸€è®¤è¯ç™»å½•; </li><li>è´µæ ¡è´µç³»è´µåç½‘ç»œéƒ¨ç»´æŠ¤äº†ä¸€ä»½è‡ªå·±çš„åŸºäº <code>Overleaf</code>  çš„ LaTeX åœ¨çº¿ç¼–è¾‘ç½‘ç«™ <a href="https://stu.cs.tsinghua.edu.cn/tex9/">TeX9</a>ï¼Œ<u>éœ€è¦ä½¿ç”¨é…’äº• ID æ‰èƒ½è¿›è¡Œç™»å½•</u>ã€‚</li></ul><p>æˆ‘ä»¬æ¥ä¸‹æ¥çš„æ¼”ç¤ºä¾¿æ˜¯åŸºäº TeX9ã€‚</p><h2 id="LaTeX-ç¼–å†™åŸºç¡€"><a href="#LaTeX-ç¼–å†™åŸºç¡€" class="headerlink" title="LaTeX ç¼–å†™åŸºç¡€"></a>LaTeX ç¼–å†™åŸºç¡€</h2><p>è¯´æ˜¯ç¼–å†™åŸºç¡€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦åƒä»‹ç» Markdown ä¸€æ ·ï¼Œå…ˆç®€å•ç½—åˆ—ä¸€äº›ç®€å•çš„æ–‡æ¡£æ§åˆ¶å‘½ä»¤ã€‚åœ¨åŸºç¡€ç¯‡ä¸­æˆ‘ä»¬å…ˆä»…ä»…ä»‹ç»æ€æ ·å®ç°ä» Markdown åˆ° LaTeX çš„è¿ç§»ã€‚å¯¹äºå…¶ä¸­ä¸€äº›æ–‡æ¡£æ§åˆ¶å‘½ä»¤ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨åç»­æ•™ç¨‹è¯¦ç»†è¯´æ˜ã€‚</p><p>è¿™é‡Œæä¾› CheatSheet ä¾›æŸ¥é˜…ï¼š</p><p><img src="https://s2.loli.net/2022/02/14/KP5yeuotcJhTlVO.png" alt="image-20220214004156979"></p><p><img src="https://s2.loli.net/2022/02/14/j3EHglvqhoetRi4.png" alt="image-20220214004207594"></p><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello, World!"></a>Hello, World!</h3><p><img src="https://s2.loli.net/2022/02/13/HPCaZJUtNOj74uF.png" alt="image-20220213205714169"></p><p>ä¸Šè¿°ä¾¿æ˜¯ä¸€ä»½ <code>tex</code> æ–‡ä»¶çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ¨èä½ æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç„¶åå°†ä¸‹é¢æˆ‘ä»¬è¦ä»‹ç»çš„å†…å®¹ä¸€ä¸€å°è¯•ã€‚</p><h3 id="æ”¯æŒä¸­æ–‡å­—ç¬¦"><a href="#æ”¯æŒä¸­æ–‡å­—ç¬¦" class="headerlink" title="æ”¯æŒä¸­æ–‡å­—ç¬¦"></a>æ”¯æŒä¸­æ–‡å­—ç¬¦</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸Šè¿°å·²ç»ä»‹ç»è¿‡ï¼Œæ”¯æŒä¸­æ–‡å­—ç¬¦çš„æ–¹å¼æœ‰äºŒï¼Œä¸€ç§æ˜¯å¼•å…¥ <code>CJK</code> å®åŒ…ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ XeLaTeX ç¼–è¯‘å™¨å¹¶å¯¹æºç åšé€‚å½“ä¿®æ”¹ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚</p><p>é¦–å…ˆï¼ŒæŒ‰ä¸‹ä½ é¡¹ç›®å·¦ä¸Šè§’çš„ Menu æŒ‰é’®ï¼Œç„¶ååœ¨ Compiler é€‰é¡¹ä¸­é€‰æ‹© XeLaTeX é€‰é¡¹ã€‚</p><p>ç„¶åï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>UTF8<span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">ctexart</span><span class="token punctuation">&#125;</span><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span>ä½ å¥½ï¼Œworld!<span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ä¸­æ–‡å­—ç¬¦çš„å¼•å…¥ã€‚è‡³äº <code>documentclass</code> æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å°†åœ¨åç»­ä»‹ç»ã€‚</p><h3 id="å¯¼è¨€ä¸æ–‡æ¡£ä¿¡æ¯"><a href="#å¯¼è¨€ä¸æ–‡æ¡£ä¿¡æ¯" class="headerlink" title="å¯¼è¨€ä¸æ–‡æ¡£ä¿¡æ¯"></a>å¯¼è¨€ä¸æ–‡æ¡£ä¿¡æ¯</h3><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>UTF8<span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">ctexart</span><span class="token punctuation">&#125;</span><span class="token function selector">\title</span><span class="token punctuation">&#123;</span>Sample Document<span class="token punctuation">&#125;</span><span class="token function selector">\author</span><span class="token punctuation">&#123;</span>c7w<span class="token punctuation">&#125;</span><span class="token function selector">\date</span><span class="token punctuation">&#123;</span><span class="token function selector">\today</span><span class="token punctuation">&#125;</span><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span><span class="token comment">% è¿™æ¡æ§åˆ¶å‘½ä»¤ä¼šè¯»å–å¯¼è¨€éƒ¨åˆ†çš„æ–‡æ¡£ç›¸å…³ä¿¡æ¯</span><span class="token comment">% å¹¶å°†å…¶æ¸²æŸ“åˆ°æ–‡æ¡£ä¸­</span><span class="token comment">% äº‹å®ä¸Šå¯ä»¥å‚è€ƒç›¸å…³å®åŒ…çš„ Docï¼š</span><span class="token comment">% http://texdoc.net/texmf-dist/doc/latex/titling/titling.pdf</span><span class="token function selector">\maketitle</span> ä½ å¥½ï¼Œworld!<span class="token punctuation">[</span>åœ¨è¿™é‡Œä½ å°±å¼€å§‹å†™ä½ çš„ä½œä¸šç¬¬ä¸€é¢˜äº†<span class="token punctuation">]</span><span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/02/13/IbNdaCD2wFXVlAq.png" alt="image-20220213210910831"></p><h3 id="ç« èŠ‚ä¸æ®µè½"><a href="#ç« èŠ‚ä¸æ®µè½" class="headerlink" title="ç« èŠ‚ä¸æ®µè½"></a>ç« èŠ‚ä¸æ®µè½</h3><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>UTF8<span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">ctexart</span><span class="token punctuation">&#125;</span><span class="token function selector">\title</span><span class="token punctuation">&#123;</span>Sample Document<span class="token punctuation">&#125;</span><span class="token function selector">\author</span><span class="token punctuation">&#123;</span>c7w<span class="token punctuation">&#125;</span><span class="token function selector">\date</span><span class="token punctuation">&#123;</span><span class="token function selector">\today</span><span class="token punctuation">&#125;</span><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span><span class="token function selector">\maketitle</span><span class="token function selector">\section</span><span class="token punctuation">&#123;</span><span class="token headline class-name">æˆ‘æ˜¯ Section æ ‡é¢˜</span><span class="token punctuation">&#125;</span>æˆ‘æ˜¯ Section ä»‹ç»ã€‚<span class="token function selector">\subsection</span><span class="token punctuation">&#123;</span><span class="token headline class-name">æˆ‘æ˜¯ Subsection æ ‡é¢˜</span><span class="token punctuation">&#125;</span>æˆ‘æ˜¯ Subsection ä»‹ç»ã€‚<span class="token function selector">\subsubsection</span><span class="token punctuation">&#123;</span><span class="token headline class-name">æˆ‘æ˜¯ Subsubsection æ ‡é¢˜</span><span class="token punctuation">&#125;</span>æˆ‘æ˜¯ Subsubsection ä»‹ç»ã€‚<span class="token comment">% \subsubsubsection&#123;ä¸èƒ½ç»§ç»­å¥— sub äº†ï¼Œåˆ°åº•äº†&#125;</span><span class="token function selector">\paragraph</span><span class="token punctuation">&#123;</span><span class="token headline class-name">æˆ‘æ˜¯ Paragraph æ ‡é¢˜</span><span class="token punctuation">&#125;</span>æˆ‘æ˜¯ Paragraph åé¢è·Ÿç€å†™çš„ä¸œè¥¿ã€‚æœ¬äººä¹Ÿæ˜¯ç»è¿‡äº†æ·±æ€ç†Ÿè™‘ï¼Œåœ¨æ¯ä¸ªæ—¥æ—¥å¤œå¤œæ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåªè¦æœ‰æ„ä¹‰ï¼Œé‚£ä¹ˆå°±å¿…é¡»æ…é‡è€ƒè™‘ã€‚è¿™ç§äº‹å®å¯¹æœ¬äººæ¥è¯´æ„ä¹‰é‡å¤§ï¼Œç›¸ä¿¡å¯¹è¿™ä¸ªä¸–ç•Œä¹Ÿæ˜¯æœ‰ä¸€å®šæ„ä¹‰çš„ã€‚è¦æƒ³æ¸…æ¥šï¼Œä¸€å¤©æ‰å¤šå°‘æ ¹å¤´å‘ï¼Œåˆ°åº•æ˜¯ä¸€ç§æ€ä¹ˆæ ·çš„å­˜åœ¨ã€‚è´å¤šèŠ¬æ›¾ç»è¯´è¿‡ï¼Œå“è¶Šçš„äººä¸€å¤§ä¼˜ç‚¹æ˜¯ï¼šåœ¨ä¸åˆ©ä¸è‰°éš¾çš„é­é‡é‡Œç™¾æŠ˜ä¸é¥¶ã€‚<span class="token function selector">\subparagraph</span><span class="token punctuation">&#123;</span><span class="token headline class-name">æˆ‘æ˜¯ Subparagraph æ ‡é¢˜</span><span class="token punctuation">&#125;</span>æˆ‘æ˜¯ Subparagraph åé¢è·Ÿç€å†™çš„ä¸œè¥¿ã€‚è¿™ä¸ç¦ä»¤æˆ‘æ·±æ€æ—¢ç„¶å¦‚ä½•ï¼Œä¸€å¤©æ‰å¤šå°‘æ ¹å¤´å‘çš„å‘ç”Ÿï¼Œåˆ°åº•éœ€è¦å¦‚ä½•åšåˆ°ï¼Œä¸ä¸€å¤©æ‰å¤šå°‘æ ¹å¤´å‘çš„å‘ç”Ÿï¼Œåˆä¼šå¦‚ä½•äº§ç”Ÿã€‚ æ€»ç»“çš„æ¥è¯´ï¼Œ æ‰€è°“ä¸€å¤©æ‰å¤šå°‘æ ¹å¤´å‘ï¼Œå…³é”®æ˜¯ä¸€å¤©æ‰å¤šå°‘æ ¹å¤´å‘éœ€è¦å¦‚ä½•å†™ã€‚ ç”Ÿæ´»ä¸­ï¼Œè‹¥ä¸€å¤©æ‰å¤šå°‘æ ¹å¤´å‘å‡ºç°äº†ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸è€ƒè™‘å®ƒå‡ºç°äº†çš„äº‹å®ã€‚ éƒ­æ²«è‹¥æ›¾ç»è¯´è¿‡ï¼Œå½¢æˆå¤©æ‰çš„å†³å®šå› ç´ åº”è¯¥æ˜¯å‹¤å¥‹ã€‚è¿™ä¸ç¦ä»¤æˆ‘æ·±æ€è¿™ç§äº‹å®å¯¹æœ¬äººæ¥è¯´æ„ä¹‰é‡å¤§ï¼Œç›¸ä¿¡å¯¹è¿™ä¸ªä¸–ç•Œä¹Ÿæ˜¯æœ‰ä¸€å®šæ„ä¹‰çš„ã€‚ æˆ‘ä»¬ä¸€èˆ¬è®¤ä¸ºï¼ŒæŠ“ä½äº†é—®é¢˜çš„å…³é”®ï¼Œå…¶ä»–ä¸€åˆ‡åˆ™ä¼šè¿åˆƒè€Œè§£ã€‚<span class="token function selector">\subsection</span><span class="token punctuation">&#123;</span><span class="token headline class-name">è¿™æ˜¯ç¬¬äºŒèŠ‚</span><span class="token punctuation">&#125;</span><span class="token function selector">\paragraph</span><span class="token punctuation">&#123;</span><span class="token headline class-name">ç¬¬äºŒèŠ‚</span><span class="token punctuation">&#125;</span> çš„é¦–æ®µã€‚<span class="token function selector">\subparagraph</span><span class="token punctuation">&#123;</span><span class="token headline class-name">ç¬¬äºŒèŠ‚</span><span class="token punctuation">&#125;</span>çš„ç¬¬äºŒæ®µã€‚<span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/02/13/kIeOlBjF7uzJ5ZH.png" alt="image-20220213211528785"></p><p>åœ¨æ–‡æ¡£ç±» <code>article</code>/<code>ctexart</code> ä¸­ï¼ˆæ–‡æ¡£ç±»çš„æ¦‚å¿µæˆ‘ä»¬ä¼šåœ¨è¿›é˜¶ç¯‡ä¸­æä¾›æŒ‡å¯¼ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›æ§åˆ¶åºåˆ—æ¥è°ƒæ•´è¡Œæ–‡ç»„ç»‡ç»“æ„ã€‚ä»–ä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>\section&#123;Â·&#125;</code></li><li><code>\subsection&#123;Â·&#125;</code></li><li><code>\subsubsection&#123;Â·&#125;</code></li><li><code>\paragraph&#123;Â·&#125;</code></li><li><code>\subparagraph&#123;Â·&#125;</code></li></ul><h3 id="æ–‡æ¡£ç›®å½•"><a href="#æ–‡æ¡£ç›®å½•" class="headerlink" title="æ–‡æ¡£ç›®å½•"></a>æ–‡æ¡£ç›®å½•</h3><p>æˆ‘ä»¬å°è¯•åœ¨æ¸²æŸ“åŒº <code>\maketitle</code> ååŠ å…¥å¦‚ä¸‹æ§åˆ¶å‘½ä»¤ï¼š</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\tableofcontents</span></code></pre><p>æ²¡é”™ï¼Œæ­£å¦‚ä½ æ‰€æƒ³çš„ï¼Œè¿™å°±ä¼šç”Ÿæˆæ–‡æ¡£çš„ TOCï¼š</p><p><img src="https://s2.loli.net/2022/02/13/sSI8byUWJjYLkPw.png" alt="image-20220213211830033"></p><h3 id="æ•°å­¦å…¬å¼"><a href="#æ•°å­¦å…¬å¼" class="headerlink" title="æ•°å­¦å…¬å¼"></a>æ•°å­¦å…¬å¼</h3><h4 id="è¡Œå†…å…¬å¼ä¸è¡Œé—´å…¬å¼"><a href="#è¡Œå†…å…¬å¼ä¸è¡Œé—´å…¬å¼" class="headerlink" title="è¡Œå†…å…¬å¼ä¸è¡Œé—´å…¬å¼"></a>è¡Œå†…å…¬å¼ä¸è¡Œé—´å…¬å¼</h4><p>é¦–å…ˆå¼•å…¥ç›¸åº”åŒ… <strong>amsmath</strong>ï¼Œç„¶åæˆ‘ä»¬ç®€å•ä»‹ç»å…¬å¼çš„å¼•å…¥ï¼š</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>UTF8<span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">ctexart</span><span class="token punctuation">&#125;</span><span class="token function selector">\usepackage</span><span class="token punctuation">&#123;</span><span class="token keyword">amsmath</span><span class="token punctuation">&#125;</span> <span class="token comment">% æ³¨æ„è¿™é‡Œå¼•å…¥ç›¸åº”åŒ…</span><span class="token function selector">\title</span><span class="token punctuation">&#123;</span>Sample Document<span class="token punctuation">&#125;</span><span class="token function selector">\author</span><span class="token punctuation">&#123;</span>c7w<span class="token punctuation">&#125;</span><span class="token function selector">\date</span><span class="token punctuation">&#123;</span><span class="token function selector">\today</span><span class="token punctuation">&#125;</span><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span><span class="token function selector">\maketitle</span><span class="token function selector">\tableofcontents</span><span class="token function selector">\section</span><span class="token punctuation">&#123;</span><span class="token headline class-name">æˆ‘æ˜¯ Section æ ‡é¢˜</span><span class="token punctuation">&#125;</span>æˆ‘æ˜¯ Section ä»‹ç»ã€‚<span class="token function selector">\subsection</span><span class="token punctuation">&#123;</span><span class="token headline class-name">è¿™ä¸ª Section æˆ‘ä»¬ä»‹ç»æ•°å­¦å…¬å¼çš„å†™æ³•</span><span class="token punctuation">&#125;</span><span class="token function selector">\subsubsection</span><span class="token punctuation">&#123;</span><span class="token headline class-name">è¡Œå†…å…¬å¼</span><span class="token punctuation">&#125;</span><span class="token comment">% è¡Œå†…å…¬å¼åŸºæœ¬å¯ä»¥ç…§æ¬ Markdown çš„æ¨¡å¼ã€‚</span>åˆå§‹å¤„ç† 1 - 5 ä½çš„åˆå§‹å­—ç¬¦ä¸²é›†åˆéœ€è¦å¤„ç† <span class="token equation string">$18 + 18^2 + 18^3 + 18^4 + 18^5 = 2*10^6$</span> çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦ <span class="token equation string">$O(T)$</span> çš„æ—¶é—´ï¼Œè¿™é‡Œ <span class="token equation string">$T=2*10^6$</span>ã€‚<span class="token function selector">\subsubsection</span><span class="token punctuation">&#123;</span><span class="token headline class-name">è¡Œé—´å…¬å¼</span><span class="token punctuation">&#125;</span><span class="token comment">% è¡Œé—´å…¬å¼ç”¨ $$ $$ æˆ–è€… \[ \] æ¥æ¡†ä½éƒ½å¯ä»¥ï¼Œä½†åœ¨ LaTeX ä¸­å‰è€…ä¼šæ”¹å˜è¡Œæ–‡çš„é»˜è®¤è¡Œé—´è·ï¼Œå› æ­¤ä¸æ¨èé‡‡ç”¨ã€‚</span><span class="token equation string">\[<span class="token equation-command regex">\text</span>&#123;dp&#125;[i] = <span class="token equation-command regex">\text</span>&#123;dp&#125;[next[i]]+1, next[i] > 0.\]</span><span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/02/13/CI2hzmUEwluDp6s.png" alt="image-20220213213336585"></p><h4 id="ä¸Šä¸‹æ ‡ã€æ ¹å¼ä¸åˆ†å¼"><a href="#ä¸Šä¸‹æ ‡ã€æ ¹å¼ä¸åˆ†å¼" class="headerlink" title="ä¸Šä¸‹æ ‡ã€æ ¹å¼ä¸åˆ†å¼"></a>ä¸Šä¸‹æ ‡ã€æ ¹å¼ä¸åˆ†å¼</h4><ul><li>ä¸Šä¸‹æ ‡è¯·ä½¿ç”¨ <code>^</code> ä¸ <code>_</code></li><li>æ ¹å¼ä¸åˆ†å¼è¯·ä½¿ç”¨ <code>\sqrt&#123;Â·&#125;</code> ä¸ <code>\frac&#123;Â·&#125;&#123;Â·&#125;</code><ul><li>åœ¨è¡Œé—´å…¬å¼å’Œè¡Œå†…å…¬å¼ä¸­ï¼Œåˆ†å¼çš„è¾“å‡ºæ•ˆæœæ˜¯æœ‰å·®å¼‚çš„ã€‚å¦‚æœè¦å¼ºåˆ¶è¡Œå†…æ¨¡å¼çš„åˆ†å¼æ˜¾ç¤ºä¸ºè¡Œé—´æ¨¡å¼çš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨ <code>\dfrac</code>, åä¹‹å¯ä»¥ä½¿ç”¨ <code>\tfrac</code></li></ul></li></ul><h4 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h4><p>ä¸€äº›å°çš„è¿ç®—ç¬¦ï¼Œå¯ä»¥åœ¨æ•°å­¦æ¨¡å¼ä¸‹ç›´æ¥è¾“å…¥ï¼›å¦ä¸€äº›éœ€è¦ç”¨æ§åˆ¶åºåˆ—ç”Ÿæˆï¼Œå¦‚</p><pre class="language-none"><code class="language-none">\[ \pm\; \times \; \div\; \cdot\; \cap\; \cup\;\geq\; \leq\; \neq\; \approx \; \equiv \]</code></pre><p>è¿åŠ ã€è¿ä¹˜ã€æé™ã€ç§¯åˆ†ç­‰å¤§å‹è¿ç®—ç¬¦åˆ†åˆ«ç”¨ <code>\sum</code>, <code>\prod</code>, <code>\lim</code>, <code>\int</code> ç”Ÿæˆã€‚ä»–ä»¬çš„ä¸Šä¸‹æ ‡åœ¨è¡Œå†…å…¬å¼ä¸­è¢«å‹ç¼©ï¼Œä»¥é€‚åº”è¡Œé«˜ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ <code>\limits</code> å’Œ <code>\nolimits</code> æ¥å¼ºåˆ¶æ˜¾å¼åœ°æŒ‡å®šæ˜¯å¦å‹ç¼©è¿™äº›ä¸Šä¸‹æ ‡ã€‚ä¾‹å¦‚ï¼š</p><pre class="language-none"><code class="language-none">$ \sum_&#123;i&#x3D;1&#125;^n i\quad \prod_&#123;i&#x3D;1&#125;^n $$ \sum\limits _&#123;i&#x3D;1&#125;^n i\quad \prod\limits _&#123;i&#x3D;1&#125;^n $\[ \lim_&#123;x\to0&#125;x^2 \quad \int_a^b x^2 dx \]\[ \lim\nolimits _&#123;x\to0&#125;x^2\quad \int\nolimits_a^b x^2 dx \]</code></pre><p>å¤šé‡ç§¯åˆ†å¯ä»¥ä½¿ç”¨ <code>\iint</code>, <code>\iiint</code>, <code>\iiiint</code>, <code>\idotsint</code> ç­‰å‘½ä»¤è¾“å…¥ã€‚</p><pre class="language-none"><code class="language-none">\[ \iint\quad \iiint\quad \iiiint\quad \idotsint \]</code></pre><p><img src="https://s2.loli.net/2022/02/13/VeI1zToC3JfAyK9.png" alt="image-20220213214301901"></p><h4 id="å®šç•Œç¬¦"><a href="#å®šç•Œç¬¦" class="headerlink" title="å®šç•Œç¬¦"></a>å®šç•Œç¬¦</h4><p>å„ç§æ‹¬å·ç”¨ <code>()</code>, <code>[]</code>, <code>\&#123;\&#125;</code>, <code>\langle\rangle</code> ç­‰å‘½ä»¤è¡¨ç¤ºï¼›æ³¨æ„èŠ±æ‹¬å·é€šå¸¸ç”¨æ¥è¾“å…¥å‘½ä»¤å’Œç¯å¢ƒçš„å‚æ•°ï¼Œæ‰€ä»¥åœ¨æ•°å­¦å…¬å¼ä¸­å®ƒä»¬å‰é¢è¦åŠ  <code>\</code>ã€‚</p><p>å› ä¸º LaTeX ä¸­ <code>|</code> å’Œ <code>\|</code> çš„åº”ç”¨è¿‡äºéšæ„ï¼Œamsmath å®åŒ…æ¨èç”¨ <code>\lvert\rvert</code> å’Œ <code>\lVert\rVert</code> å–è€Œä»£ä¹‹ã€‚</p><p>ä¸ºäº†è°ƒæ•´è¿™äº›å®šç•Œç¬¦çš„å¤§å°ï¼Œamsmath å®åŒ…æ¨èä½¿ç”¨ <code>\big</code>, <code>\Big</code>, <code>\bigg</code>, <code>\Bigg</code> ç­‰ä¸€ç³»åˆ—å‘½ä»¤æ”¾åœ¨ä¸Šè¿°æ‹¬å·å‰é¢è°ƒæ•´å¤§å°ã€‚</p><h4 id="çœç•¥å·"><a href="#çœç•¥å·" class="headerlink" title="çœç•¥å·"></a>çœç•¥å·</h4><p>çœç•¥å·ç”¨ <code>\dots</code>, <code>\cdots</code>, <code>\vdots</code>, <code>\ddots</code> ç­‰å‘½ä»¤è¡¨ç¤ºã€‚<code>\dots</code> å’Œ <code>\cdots</code> çš„çºµå‘ä½ç½®ä¸åŒï¼Œå‰è€…ä¸€èˆ¬ç”¨äºæœ‰ä¸‹æ ‡çš„åºåˆ—ã€‚</p><h4 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h4><p><code>amsmath</code> çš„ <code>pmatrix</code>, <code>bmatrix</code>, <code>Bmatrix</code>, <code>vmatrix</code>, <code>Vmatrix</code> ç­‰ç¯å¢ƒå¯ä»¥åœ¨çŸ©é˜µä¸¤è¾¹åŠ ä¸Šå„ç§åˆ†éš”ç¬¦ã€‚</p><pre class="language-none"><code class="language-none">\[ \begin&#123;pmatrix&#125; a&amp;b\\c&amp;d \end&#123;pmatrix&#125; \quad\begin&#123;bmatrix&#125; a&amp;b\\c&amp;d \end&#123;bmatrix&#125; \quad\begin&#123;Bmatrix&#125; a&amp;b\\c&amp;d \end&#123;Bmatrix&#125; \quad\begin&#123;vmatrix&#125; a&amp;b\\c&amp;d \end&#123;vmatrix&#125; \quad\begin&#123;Vmatrix&#125; a&amp;b\\c&amp;d \end&#123;Vmatrix&#125; \]</code></pre><p><img src="https://s2.loli.net/2022/02/14/uix67cYI4UaXvK9.jpg" alt="img"></p><h4 id="å¤šè¡Œå…¬å¼"><a href="#å¤šè¡Œå…¬å¼" class="headerlink" title="å¤šè¡Œå…¬å¼"></a>å¤šè¡Œå…¬å¼</h4><p>å¯ä»¥ç”¨ <code>aligned</code> ç¯å¢ƒæ¥å®ç°ï¼Œç”¨ <code>&amp;</code> å®ç°ä½ç½®å¯¹é½ã€‚</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token equation string">\[<span class="token equation-command regex">\begin</span>&#123;aligned&#125;x = a+b+c+ <span class="token equation-command regex">\\</span>+d+e+f+g+d+d+d+d+d+d+d+d+d+d+d+d <span class="token equation-command regex">\\</span>+h+i <span class="token equation-command regex">\\</span>+1 <span class="token equation-command regex">\\</span><span class="token equation-command regex">\end</span>&#123;aligned&#125;\]</span><span class="token equation string">\[<span class="token equation-command regex">\begin</span>&#123;aligned&#125;x &amp;= a+b+c+ <span class="token equation-command regex">\\</span>&amp; +d+e+f+g+d+d+d+d+d+d+d+d+d+d+d+d <span class="token equation-command regex">\\</span>&amp; +h+i <span class="token equation-command regex">\\</span>&amp; +1 <span class="token equation-command regex">\\</span><span class="token equation-command regex">\end</span>&#123;aligned&#125;\]</span></code></pre><p>æ•ˆæœï¼š</p><p><img src="https://s2.loli.net/2022/02/14/oZugGY2MF78Lk9t.png" alt="image-20220214001008550"></p><p>è‹¥æƒ³è¦å…¬å¼è‡ªå¸¦ç¼–å·ï¼Œå¯ä»¥ç”¨ <code>gather</code> å’Œ <code>align</code> ç¯å¢ƒï¼Œå…¶ä¸­ <code>gather</code> ç¯å¢ƒå°†å…¬å¼åˆ†è¡Œæ¸²æŸ“ï¼Œ<code>align</code> åŒä¸Šè¿° <code>aligned</code>ï¼Œå¯ä»¥æ§åˆ¶å¯¹é½ï¼š</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">gather</span><span class="token punctuation">&#125;</span><span class="token equation string">a = b+c+d <span class="token equation-command regex">\\</span>x = y+z <span class="token equation-command regex">\\</span> p = a_1 + a_2 + a_3 + <span class="token equation-command regex">\dots</span> + a_&#123;200&#125;</span><span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">gather</span><span class="token punctuation">&#125;</span><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">align</span><span class="token punctuation">&#125;</span><span class="token equation string">a &amp;= b+c+d <span class="token equation-command regex">\\</span>x &amp;= y+z <span class="token equation-command regex">\\</span>p &amp;= a_1 + a_2 + a_3 + <span class="token equation-command regex">\dots</span> + a_&#123;200&#125;</span><span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">align</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/02/14/5tZcTngyKSIsWxV.png" alt="image-20220214001355079"></p><p>è‹¥æƒ³ä½¿ç”¨åˆ†æ®µå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ <code>cases</code> ç¯å¢ƒï¼š</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token equation string">\[y= <span class="token equation-command regex">\begin</span>&#123;cases&#125;-x,<span class="token equation-command regex">\quad</span> x<span class="token equation-command regex">\leq</span> 0 <span class="token equation-command regex">\\</span>x,<span class="token equation-command regex">\quad</span> x>0<span class="token equation-command regex">\end</span>&#123;cases&#125; \]</span></code></pre><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>æ•°å­¦å…¬å¼æ˜¯åœ¨å¼•å…¥äº† <strong>amsmath</strong> åŒ…ä¹‹åï¼Œåˆ©ç”¨å…¶æä¾›çš„å„ç§å„æ ·æ¬¡ç¯å¢ƒæ¥å®ç°äº†è¾ƒä¸ºå¤æ‚çš„å…¬å¼çš„ç¼–è¾‘ã€‚æ•´ä½“æ¥è¯´ï¼Œä¸ Mathjax çš„é£æ ¼ç›¸å·®ä¸å¤§ï¼Œå› æ­¤è¿ç§»å­¦ä¹ èµ·æ¥ä¹Ÿååˆ†æ–¹ä¾¿ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å†æä¾›è¾…åŠ©å·¥å…·ï¼š</p><ul><li><a href="https://mathpix.com/">https://mathpix.com/</a> èƒ½å¤Ÿ OCR æ‰‹å†™ä½“æˆ–æ˜¯å°åˆ·ä½“å…¬å¼ï¼Œè€Œåå°†å›¾ç‰‡ä¸­çš„å…¬å¼è½¬æ¢æˆ LaTeX æ•°å­¦å…¬å¼çš„ä»£ç ã€‚</li></ul><h3 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h3><p><code>tabular</code> ç¯å¢ƒæä¾›äº†æœ€ç®€å•çš„è¡¨æ ¼åŠŸèƒ½ã€‚å®ƒç”¨ <code>\hline</code> å‘½ä»¤è¡¨ç¤ºæ¨ªçº¿ï¼Œåœ¨åˆ—æ ¼å¼ä¸­ç”¨ <code>|</code> è¡¨ç¤ºç«–çº¿ï¼›ç”¨ <code>&amp;</code> æ¥åˆ†åˆ—ï¼Œç”¨ <code>\\</code> æ¥æ¢è¡Œï¼›æ¯åˆ—å¯ä»¥é‡‡ç”¨å±…å·¦ã€å±…ä¸­ã€å±…å³ç­‰æ¨ªå‘å¯¹é½æ–¹å¼ï¼Œåˆ†åˆ«ç”¨ <code>l</code>ã€<code>c</code>ã€<code>r</code> æ¥è¡¨ç¤ºã€‚</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">tabular</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>|l|c|r|<span class="token punctuation">&#125;</span> <span class="token function selector">\hline</span>æ“ä½œç³»ç»Ÿ<span class="token punctuation">&amp;</span> å‘è¡Œç‰ˆ<span class="token punctuation">&amp;</span> ç¼–è¾‘å™¨<span class="token function selector">\\</span> <span class="token function selector">\hline</span>Windows <span class="token punctuation">&amp;</span> MikTeX <span class="token punctuation">&amp;</span> TexMakerX <span class="token function selector">\\</span> <span class="token function selector">\hline</span>Unix/Linux <span class="token punctuation">&amp;</span> teTeX <span class="token punctuation">&amp;</span> Kile <span class="token function selector">\\</span> <span class="token function selector">\hline</span>Mac OS <span class="token punctuation">&amp;</span> MacTeX <span class="token punctuation">&amp;</span> TeXShop <span class="token function selector">\\</span> <span class="token function selector">\hline</span>é€šç”¨<span class="token punctuation">&amp;</span> TeX Live <span class="token punctuation">&amp;</span> TeXworks <span class="token function selector">\\</span> <span class="token function selector">\hline</span><span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">tabular</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/02/14/ytG5hReFbjWClwg.jpg" alt="img"></p><h3 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h3><p>åœ¨ LaTeX ä¸­æ’å…¥å›¾ç‰‡ï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ã€‚æœ€å¥½ç”¨çš„åº”å½“å±åˆ©ç”¨ <code>graphicx</code> å®åŒ…æä¾›çš„ <code>\includegraphics</code> å‘½ä»¤ã€‚æ¯”å¦‚ä½ åœ¨ä½ çš„ TeX æºæ–‡ä»¶åŒç›®å½•ä¸‹ï¼Œæœ‰åä¸º <code>a.jpg</code> çš„å›¾ç‰‡ï¼Œä½ å¯ä»¥ç”¨è¿™æ ·çš„æ–¹å¼å°†å®ƒæ’å…¥åˆ°è¾“å‡ºæ–‡æ¡£ä¸­ï¼š</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">&#123;</span><span class="token keyword">article</span><span class="token punctuation">&#125;</span><span class="token function selector">\usepackage</span><span class="token punctuation">&#123;</span><span class="token keyword">graphicx</span><span class="token punctuation">&#125;</span><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span><span class="token function selector">\includegraphics</span><span class="token punctuation">&#123;</span>a.jpg<span class="token punctuation">&#125;</span><span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span></code></pre><p>æƒ³è¦äº†è§£æ›´å¤šï¼Œå‚è§ <code>graphicx</code> çš„æ–‡æ¡£ï¼š<a href="http://texdoc.net/texmf-dist/doc/latex/graphics/graphicx.pdfã€‚">http://texdoc.net/texmf-dist/doc/latex/graphics/graphicx.pdfã€‚</a></p><blockquote><p><strong>æµ®åŠ¨ä½“ç¯å¢ƒ</strong></p><p>ä»€ä¹ˆæ˜¯æµ®åŠ¨ä½“ç¯å¢ƒï¼š<code>table</code> ä¸ <code>figure</code>ï¼Œä¸¤ç§æµ®åŠ¨ä½“ç¯å¢ƒå¯ä»¥æ›¿ä»£ä¸Šè¿°çš„è¡¨æ ¼å’Œå›¾ç‰‡ç¯å¢ƒï¼Œå®ç°ä¸ºè¡¨æ ¼æˆ–å›¾ç‰‡è‡ªåŠ¨å®‰æ’ä½ç½®ã€‚</p><p>æƒ³äº†è§£æ›´å¤šæœ‰å…³æµ®åŠ¨ä½“ç¯å¢ƒçš„å†…å®¹ï¼Œè¯¦è§<a href="https://liam.page/series/#LaTeX-%E4%B8%AD%E7%9A%84%E6%B5%AE%E5%8A%A8%E4%BD%93">è¿™é‡Œ</a>ã€‚</p></blockquote><h3 id="é¡µé¢è®¾ç½®"><a href="#é¡µé¢è®¾ç½®" class="headerlink" title="é¡µé¢è®¾ç½®"></a>é¡µé¢è®¾ç½®</h3><h4 id="é¡µè¾¹è·"><a href="#é¡µè¾¹è·" class="headerlink" title="é¡µè¾¹è·"></a>é¡µè¾¹è·</h4><p>è®¾ç½®é¡µè¾¹è·ï¼Œæ¨èä½¿ç”¨ <code>geometry</code> å®åŒ…ã€‚å¯ä»¥åœ¨<a href="http://texdoc.net/texmf-dist/doc/latex/geometry/geometry.pdf">è¿™é‡Œ</a>æŸ¥çœ‹å®ƒçš„è¯´æ˜æ–‡æ¡£ã€‚</p><p>æ¯”å¦‚æˆ‘å¸Œæœ›ï¼Œå°†çº¸å¼ çš„é•¿åº¦è®¾ç½®ä¸º 20cmã€å®½åº¦è®¾ç½®ä¸º 15cmã€å·¦è¾¹è· 1cmã€å³è¾¹è· 2cmã€ä¸Šè¾¹è· 3cmã€ä¸‹è¾¹è· 4cmï¼Œå¯ä»¥åœ¨å¯¼è¨€åŒºåŠ ä¸Šè¿™æ ·å‡ è¡Œï¼š</p><pre class="language-none"><code class="language-none">\usepackage&#123;geometry&#125;\geometry&#123;papersize&#x3D;&#123;20cm,15cm&#125;&#125;\geometry&#123;left&#x3D;1cm,right&#x3D;2cm,top&#x3D;3cm,bottom&#x3D;4cm&#125;</code></pre><h4 id="é¡µçœ‰é¡µè„š"><a href="#é¡µçœ‰é¡µè„š" class="headerlink" title="é¡µçœ‰é¡µè„š"></a>é¡µçœ‰é¡µè„š</h4><p>è®¾ç½®é¡µçœ‰é¡µè„šï¼Œæ¨èä½¿ç”¨ <code>fancyhdr</code> å®åŒ…ã€‚å¯ä»¥åœ¨<a href="http://texdoc.net/texmf-dist/doc/latex/fancyhdr/fancyhdr.pdf">è¿™é‡Œ</a>æŸ¥çœ‹å®ƒçš„è¯´æ˜æ–‡æ¡£ã€‚</p><p>æ¯”å¦‚æˆ‘å¸Œæœ›ï¼Œè®¾ç½®è‡ªå®šä¹‰é¡µçœ‰ï¼›é¡µè„šçš„æ­£ä¸­å†™ä¸Šé¡µç ï¼›é¡µçœ‰å’Œæ­£æ–‡ä¹‹é—´æœ‰ä¸€é“å®½ä¸º 0.4pt çš„æ¨ªçº¿åˆ†å‰²ï¼Œå¯ä»¥åœ¨å¯¼è¨€åŒºåŠ ä¸Šå¦‚ä¸‹å‡ è¡Œï¼š</p><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\usepackage</span><span class="token punctuation">&#123;</span><span class="token keyword">fancyhdr</span><span class="token punctuation">&#125;</span><span class="token function selector">\pagestyle</span><span class="token punctuation">&#123;</span>fancy<span class="token punctuation">&#125;</span><span class="token function selector">\lhead</span><span class="token punctuation">&#123;</span>é¡µçœ‰å·¦ä¾§<span class="token punctuation">&#125;</span><span class="token function selector">\chead</span><span class="token punctuation">&#123;</span>é¡µçœ‰ä¸­é—´<span class="token punctuation">&#125;</span><span class="token function selector">\rhead</span><span class="token punctuation">&#123;</span>é¡µçœ‰å³ä¾§<span class="token punctuation">&#125;</span><span class="token function selector">\lfoot</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token function selector">\cfoot</span><span class="token punctuation">&#123;</span><span class="token function selector">\thepage</span><span class="token punctuation">&#125;</span><span class="token function selector">\rfoot</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token function selector">\renewcommand</span><span class="token punctuation">&#123;</span><span class="token function selector">\headrulewidth</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>0.4pt<span class="token punctuation">&#125;</span><span class="token function selector">\renewcommand</span><span class="token punctuation">&#123;</span><span class="token function selector">\headwidth</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token function selector">\textwidth</span><span class="token punctuation">&#125;</span><span class="token function selector">\renewcommand</span><span class="token punctuation">&#123;</span><span class="token function selector">\footrulewidth</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>0pt<span class="token punctuation">&#125;</span></code></pre><h4 id="æ®µé—´è·"><a href="#æ®µé—´è·" class="headerlink" title="æ®µé—´è·"></a>æ®µé—´è·</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹é•¿åº¦ <code>\parskip</code> çš„å€¼æ¥è°ƒæ•´æ®µé—´è·ã€‚ä¾‹å¦‚åœ¨å¯¼è¨€åŒºæ·»åŠ ä»¥ä¸‹å†…å®¹</p><pre class="language-none"><code class="language-none">\addtolength&#123;\parskip&#125;&#123;.4em&#125;</code></pre><p>åˆ™å¯ä»¥åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šï¼Œå¢åŠ æ®µé—´è· 0.4emã€‚å¦‚æœéœ€è¦å‡å°æ®µé—´è·ï¼Œåªéœ€å°†è¯¥æ•°å€¼æ”¹ä¸ºè´Ÿå€¼å³å¯ã€‚</p><h3 id="å¼•ç”¨ä¸å°¾æ³¨è„šæ³¨"><a href="#å¼•ç”¨ä¸å°¾æ³¨è„šæ³¨" class="headerlink" title="å¼•ç”¨ä¸å°¾æ³¨è„šæ³¨"></a>å¼•ç”¨ä¸å°¾æ³¨è„šæ³¨</h3><h4 id="äº¤å‰å¼•ç”¨"><a href="#äº¤å‰å¼•ç”¨" class="headerlink" title="äº¤å‰å¼•ç”¨"></a>äº¤å‰å¼•ç”¨</h4><p>äº¤å‰å¼•ç”¨è®¾ç½®æ–¹æ³•ï¼š</p><ul><li>ç»™å¯¹è±¡å‘½åï¼š<code>\label&#123;name&#125;</code></li><li>å¼•ç”¨å¯¹è±¡ï¼š<code>\ref&#123;name&#125;</code></li></ul><p>æ³¨æ„ï¼Œåœ¨å¼•ç”¨å¯¹è±¡æ—¶ï¼Œ<code>\ref&#123;name&#125;</code> ä¼šè¢«æ›¿æ¢ä¼šè¢«å¼•ç”¨å¯¹è±¡çš„ç¼–å·ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè¢«å¼•ç”¨å¯¹è±¡åœ¨æ–‡æ¡£ä¸­æ˜¯ç¬¬ 5 ä¸ªè¢«å‘½åçš„ï¼Œé‚£ä¹ˆè¿™é‡Œå°±ä¼šè¢«æ›¿æ¢ä¸º 5.</p><p>è¦æƒ³é¿å…å›¾/è¡¨/è®ºæ–‡ç­‰ç­‰å¼•ç”¨åœ¨è®¡æ•°ä¸Šäº’ç›¸å½±å“ï¼Œä½ å¯ä»¥åœ¨å‘½åæ—¶å‘½åä¸º <code>tag:name</code> çš„æ ¼å¼ï¼Œå¼•ç”¨æ—¶ä½¿ç”¨ <code>tag:name</code> çš„æ ¼å¼æ¥å¼•ç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™äº› tag æœ‰ï¼š</p><div class="table-container"><table><thead><tr><th>Tag</th><th>Description</th></tr></thead><tbody><tr><td><strong><code>ch:</code></strong></td><td>chapter</td></tr><tr><td><strong><code>sec:</code></strong></td><td>section</td></tr><tr><td><strong><code>subsec:</code></strong></td><td>subsection</td></tr><tr><td><strong><code>fig:</code></strong></td><td>figure</td></tr><tr><td><strong><code>tab:</code></strong></td><td>table</td></tr><tr><td><strong><code>eq:</code></strong></td><td>equation</td></tr><tr><td><strong><code>lst:</code></strong></td><td>code listing</td></tr><tr><td><strong><code>itm:</code></strong></td><td>enumerated list item</td></tr><tr><td><strong><code>alg:</code></strong></td><td>algorithm</td></tr><tr><td><strong><code>app:</code></strong></td><td>appendix subsection</td></tr></tbody></table></div><h4 id="å°¾æ³¨è„šæ³¨"><a href="#å°¾æ³¨è„šæ³¨" class="headerlink" title="å°¾æ³¨è„šæ³¨"></a>å°¾æ³¨è„šæ³¨</h4><p>å°¾æ³¨ç›´æ¥åœ¨æœ€åå†™å°±è¡Œï¼Œè®°å¾—è®¾ç½®å¼•ç”¨ã€‚</p><p>è„šæ³¨å¯ä»¥ä½¿ç”¨ <code>\footnote&#123;è§’æ³¨å†…å®¹&#125;</code> æ¥å£°æ˜ã€‚</p><blockquote><p>æƒ³äº†è§£è¯¥å¦‚ä½•æ›´å¥½åœ°å¼•å…¥å‚è€ƒæ–‡çŒ®ï¼Œè¯·å­¦ä¹  BibTeX å®åŒ…ã€‚</p><ul><li><a href="https://zh.wikipedia.org/wiki/BibTeX">https://zh.wikipedia.org/wiki/BibTeX</a></li></ul></blockquote><h3 id="åˆ—è¡¨ä¸æšä¸¾"><a href="#åˆ—è¡¨ä¸æšä¸¾" class="headerlink" title="åˆ—è¡¨ä¸æšä¸¾"></a>åˆ—è¡¨ä¸æšä¸¾</h3><pre class="language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">enumerate</span><span class="token punctuation">&#125;</span>    <span class="token function selector">\item</span> <span class="token function selector">\LaTeX</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> å¥½ å¤„ éƒ½ æœ‰ å•¥        <span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">description</span><span class="token punctuation">&#125;</span>            <span class="token function selector">\item</span><span class="token punctuation">[</span>å¥½ ç”¨<span class="token punctuation">]</span> ä½“ éªŒ å¥½ æ‰ æ˜¯ çœŸ çš„ å¥½            <span class="token function selector">\item</span><span class="token punctuation">[</span>å¥½ çœ‹<span class="token punctuation">]</span> å¼º è¿« ç—‡ çš„ ç¦ éŸ³            <span class="token function selector">\item</span><span class="token punctuation">[</span>å¼€ æº<span class="token punctuation">]</span> ä¼— äºº æ‹¾ æŸ´ ç« ç„° é«˜        <span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">description</span><span class="token punctuation">&#125;</span>    <span class="token function selector">\item</span> è¿˜ æœ‰ å‘¢?        <span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">itemize</span><span class="token punctuation">&#125;</span>            <span class="token function selector">\item</span> å¥½ å¤„ 1            <span class="token function selector">\item</span> å¥½ å¤„ 2    <span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">itemize</span><span class="token punctuation">&#125;</span><span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">enumerate</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/02/14/U3E8uCBy4RKxfSL.png" alt="image-20220214004408507"></p><h2 id="LaTeX-åç»­å­¦ä¹ "><a href="#LaTeX-åç»­å­¦ä¹ " class="headerlink" title="LaTeX åç»­å­¦ä¹ "></a>LaTeX åç»­å­¦ä¹ </h2><h3 id="æ›´å¤šå®åŒ…"><a href="#æ›´å¤šå®åŒ…" class="headerlink" title="æ›´å¤šå®åŒ…"></a>æ›´å¤šå®åŒ…</h3><p>å®åŒ…ä¸€èˆ¬éƒ½ä¼šæä¾›ç›¸åº”çš„æ–‡æ¡£ä¾›æˆ‘ä»¬é˜…è¯»ä½¿ç”¨ã€‚</p><p>è¿™é‡Œæä¾›æŸ¥è¯¢å®åŒ…å¯¹åº”æ–‡æ¡£çš„ç½‘ç«™ï¼š</p><ul><li><a href="https://texdoc.org/index.html">https://texdoc.org/index.html</a></li></ul><p><img src="https://s2.loli.net/2022/02/14/jkVbA8vBeY9FsUR.png" alt="image-20220214003834121"></p><h3 id="åˆ¶ä½œè‡ªå·±çš„æ¨¡æ¿"><a href="#åˆ¶ä½œè‡ªå·±çš„æ¨¡æ¿" class="headerlink" title="åˆ¶ä½œè‡ªå·±çš„æ¨¡æ¿"></a>åˆ¶ä½œè‡ªå·±çš„æ¨¡æ¿</h3><p>è¯¦è§å‚è€ƒèµ„æ–™ä¸­ <code>.cls</code> æ–‡ä»¶è¯¦è§£éƒ¨åˆ†ã€‚æˆ‘ä»¬åŒæ—¶æ¨èè¯»è€…å¯ä»¥å»å¤šè¯»ä¸€è¯»å…¶ä»–å·²å­˜åœ¨çš„ Template çš„ <code>.cls</code> å†…å®¹ã€‚</p><h3 id="åˆ¶ä½œå¹»ç¯ç‰‡"><a href="#åˆ¶ä½œå¹»ç¯ç‰‡" class="headerlink" title="åˆ¶ä½œå¹»ç¯ç‰‡"></a>åˆ¶ä½œå¹»ç¯ç‰‡</h3><p>ä½¿ç”¨ Beamer å®åŒ…å¯ä»¥åˆ¶ä½œå¹»ç¯ç‰‡ã€‚è¯¦è§ï¼š</p><ul><li><a href="https://www.overleaf.com/learn/latex/Beamer">https://www.overleaf.com/learn/latex/Beamer</a></li></ul><p>åŒæ—¶ï¼Œæ ¡å†…ä¹Ÿæä¾›äº†ä¸€äº›é€‚ç”¨äºå„ç§ pre çš„ Beamer æ¨¡æ¿ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li>ï¼ˆæ¨èï¼‰ä¸€ä»½å…¶å®å¾ˆçŸ­çš„ LaTeX å…¥é—¨æ–‡æ¡£ï¼š<a href="https://liam.page/2014/09/08/latex-introduction/">https://liam.page/2014/09/08/latex-introduction/</a></li><li>ï¼ˆæ¨èï¼‰å¦‚ä½•ä½¿ç”¨ LaTeX æ’ç‰ˆè®ºæ–‡ï¼š<a href="https://github.com/tuna/thulib-latex-talk">https://github.com/tuna/thulib-latex-talk</a></li><li>ï¼ˆ<code>.cls</code> æ–‡ä»¶è¯¦è§£ï¼‰How to write a LaTeX class file and design your own CVï¼š <a href="https://www.overleaf.com/learn/latex/How_to_write_a_LaTeX_class_file_and_design_your_own_CV_(Part_1">https://www.overleaf.com/learn/latex/How_to_write_a_LaTeX_class_file_and_design_your_own_CV_(Part_1</a>)</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;è™½ç„¶ Markdown å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯ç”Ÿæˆçš„ pdf æ–‡æ¡£çœ‹èµ·æ¥å°±æ˜¯&lt;s&gt;æ²¡æœ‰èŒƒ&lt;/s&gt;ä¸å¤Ÿæ­£å¼ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ LaTeX ä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹åå†™è®ºæ–‡çš„å¿…å¤‡æŠ€èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ•™ç¨‹ä¸»è¦æ¶‰åŠå·²å¯¹ Markdown è¾ƒä¸ºç†Ÿè¯†ä¹‹åçš„è¿ç§»å­¦ä¹ ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/ç»¼åˆ" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-%E7%BB%BC%E5%90%88/"/>
    
    
    <category term="Latex" scheme="https://www.c7w.tech/tags/Latex/"/>
    
  </entry>
  
  <entry>
    <title>Docker ä½¿ç”¨æŒ‡åŒ—</title>
    <link href="https://www.c7w.tech/docker/"/>
    <id>https://www.c7w.tech/docker/</id>
    <published>2022-02-11T14:00:29.000Z</published>
    <updated>2022-02-11T15:03:07.659Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2022/02/11/MbaA67dgptL9YBc.png" alt="img"></p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>è½¯ä»¶å¼€å‘æœ€å¤§çš„éº»çƒ¦äº‹ä¹‹ä¸€ï¼Œå°±æ˜¯ç¯å¢ƒé…ç½®ã€‚ç”¨æˆ·è®¡ç®—æœºçš„ç¯å¢ƒä¸åŒï¼Œå¯èƒ½å¯¼è‡´è½¯ä»¶åœ¨å¼€å‘ç¯å¢ƒä¸­èƒ½è¿è¡Œï¼Œè€Œåˆ°äº†ç”Ÿäº§ç¯å¢ƒæ— æ³•è¿è¡Œçš„æƒ…å†µã€‚</p><p>ç”¨æˆ·å¿…é¡»ä¿è¯ä¸¤ä»¶äº‹ï¼šæ“ä½œç³»ç»Ÿçš„è®¾ç½®ï¼Œå„ç§åº“å’Œç»„ä»¶çš„å®‰è£…ã€‚åªæœ‰å®ƒä»¬éƒ½æ­£ç¡®ï¼Œè½¯ä»¶æ‰èƒ½è¿è¡Œã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå®‰è£…ä¸€ä¸ª Python åº”ç”¨ï¼Œè®¡ç®—æœºå¿…é¡»æœ‰ Python å¼•æ“ï¼Œè¿˜å¿…é¡»æœ‰å„ç§ä¾èµ–ï¼Œå¯èƒ½è¿˜è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚</p><p>ç¯å¢ƒé…ç½®å¦‚æ­¤éº»çƒ¦ï¼Œæ¢ä¸€å°æœºå™¨ï¼Œå°±è¦é‡æ¥ä¸€æ¬¡ï¼Œæ—·æ—¥è´¹æ—¶ã€‚å¾ˆå¤šäººæƒ³åˆ°ï¼Œèƒ½ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œè½¯ä»¶å¯ä»¥å¸¦ç¯å¢ƒå®‰è£…ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å®‰è£…çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹ç¯å¢ƒä¸€æ¨¡ä¸€æ ·åœ°å¤åˆ¶è¿‡æ¥</strong>ã€‚</p><p>è¿™ä¸ªé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹å¼æ˜¯ä½¿ç”¨<strong>è™šæ‹Ÿæœº</strong>ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ WSLï¼Œå°±æ˜¯åœ¨ Windows ç³»ç»Ÿä¸­è¿è¡Œ Linux è™šæ‹Ÿç³»ç»Ÿçš„ä¾‹å­ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšçš„èµ„æºå ç”¨å¤šï¼Œè¦é‡æ–°é…ç½®ä¸€ä¸ªå…¨æ–°æ“ä½œç³»ç»Ÿçš„å†—ä½™æ­¥éª¤å¤šï¼Œå¯åŠ¨èµ·æ¥ä¹Ÿååˆ†ç¼“æ…¢ã€‚äºæ˜¯ï¼ŒLinux å‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼š<strong>è™šæ‹Ÿå®¹å™¨</strong>ã€‚</p><p><strong>Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚</strong>æˆ–è€…è¯´ï¼Œåœ¨æ­£å¸¸è¿›ç¨‹çš„å¤–é¢å¥—äº†ä¸€ä¸ªä¿æŠ¤å±‚ã€‚å¯¹äºå®¹å™¨é‡Œé¢çš„è¿›ç¨‹æ¥è¯´ï¼Œå®ƒæ¥è§¦åˆ°çš„å„ç§èµ„æºéƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œä»è€Œå®ç°ä¸åº•å±‚ç³»ç»Ÿçš„éš”ç¦»ã€‚</p><p><strong>Docker å±äº Linux å®¹å™¨çš„ä¸€ç§å°è£…ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„å®¹å™¨ä½¿ç”¨æ¥å£ã€‚</strong>å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Linux å®¹å™¨è§£å†³æ–¹æ¡ˆã€‚</p><p>Docker å°†åº”ç”¨ç¨‹åºä¸è¯¥ç¨‹åºçš„ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨ã€‚ç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œè¿è¡Œï¼Œå°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œä¸€æ ·ã€‚æœ‰äº† Dockerï¼Œå°±ä¸ç”¨æ‹…å¿ƒç¯å¢ƒé—®é¢˜ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼ŒDocker çš„æ¥å£ç›¸å½“ç®€å•ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œä½¿ç”¨å®¹å™¨ï¼ŒæŠŠè‡ªå·±çš„åº”ç”¨æ”¾å…¥å®¹å™¨ã€‚å®¹å™¨è¿˜å¯ä»¥è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€å¤åˆ¶ã€åˆ†äº«ã€ä¿®æ”¹ï¼Œå°±åƒç®¡ç†æ™®é€šçš„ä»£ç ä¸€æ ·ã€‚</p><a id="more"></a><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><ul><li>Windows <a href="https://docs.docker.com/desktop/windows/install/">https://docs.docker.com/desktop/windows/install/</a></li><li>Linux <a href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></li></ul><h2 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h2><ol><li>é•œåƒï¼ˆImageï¼‰ï¼šç±»ä¼¼äºè™šæ‹Ÿæœºä¸­çš„é•œåƒï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ–‡ä»¶ç³»ç»Ÿçš„é¢å‘ Docker å¼•æ“çš„åªè¯»æ¨¡æ¿ã€‚ä»»ä½•åº”ç”¨ç¨‹åºè¿è¡Œéƒ½éœ€è¦ç¯å¢ƒï¼Œè€Œé•œåƒå°±æ˜¯ç”¨æ¥æä¾›è¿™ç§è¿è¡Œç¯å¢ƒçš„ã€‚ä¾‹å¦‚ä¸€ä¸ª Ubuntu é•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å« Ubuntu æ“ä½œç³»ç»Ÿç¯å¢ƒçš„æ¨¡æ¿ï¼ŒåŒç†åœ¨è¯¥é•œåƒä¸Šè£…ä¸Š Apache è½¯ä»¶ï¼Œå°±å¯ä»¥ç§°ä¸º Apache é•œåƒã€‚</li><li>å®¹å™¨ï¼ˆContainerï¼‰ï¼šç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç›’ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæç®€çš„ Linux ç³»ç»Ÿç¯å¢ƒï¼ˆåŒ…æ‹¬ root æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰ï¼Œä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚Docker å¼•æ“åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œã€éš”ç¦»å„ä¸ªåº”ç”¨ã€‚å®¹å™¨æ˜¯é•œåƒåˆ›å»ºçš„åº”ç”¨å®ä¾‹ï¼Œå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å®¹å™¨ï¼Œå„ä¸ªå®¹å™¨ä¹‹é—´æ˜¯æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œäº’ä¸å½±å“ã€‚æ³¨æ„ï¼š<strong>é•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œå®¹å™¨ä»é•œåƒå¯åŠ¨æ—¶ï¼ŒDocker åœ¨é•œåƒçš„ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ï¼Œé•œåƒæœ¬èº«ä¸å˜ã€‚</strong></li><li>ä»“åº“ï¼ˆRepositoryï¼‰ï¼šç±»ä¼¼äºä»£ç ä»“åº“ï¼Œè¿™é‡Œæ˜¯é•œåƒä»“åº“ï¼Œæ˜¯ Docker ç”¨æ¥é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœ°æ–¹ã€‚æ³¨æ„ä¸æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰çš„åŒºåˆ«ï¼šæ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªä»“åº“ï¼›è€Œä»“åº“æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œä¸€èˆ¬æ¯ä¸ªä»“åº“å­˜æ”¾ä¸€ç±»é•œåƒï¼Œæ¯ä¸ªé•œåƒåˆ©ç”¨ tag è¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚ Ubuntu ä»“åº“å­˜æ”¾æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆ12.04ã€14.04 ç­‰ï¼‰çš„ Ubuntu é•œåƒã€‚</li></ol><h2 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h2><p>å¯¹é•œåƒçš„åŸºæœ¬æ“ä½œæ€»ç»“ï¼š</p><ul><li>å®˜æ–¹æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰ï¼š<a href="https://hub.docker.com/">https://hub.docker.com/</a></li><li>æœç´¢æŸä¸ªé•œåƒï¼š<code>docker search &lt;image&gt;</code></li><li>å°†æŸä¸ªé•œåƒä¸‹è½½åˆ°æœ¬åœ°ï¼š<ul><li><code>docker pull &lt;image&gt;</code>// å¦‚æœä¸åŠ  tag é»˜è®¤ä½¿ç”¨ latest é•œåƒ</li><li><code>docker pull &lt;image&gt;:&lt;tag&gt;</code></li></ul></li><li>æŸ¥çœ‹å½“å‰ä¸‹è½½çš„é•œåƒä¿¡æ¯ï¼š<code>docker images</code></li><li>æ–°å»ºè‡ªå®šä¹‰é•œåƒçš„æ–¹æ³•</li></ul><p><strong>æ–¹æ³• 1ï¼šåˆ©ç”¨é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨åä¿®æ”¹ï¼Œå†è¿›è¡Œ commit</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@xxx ~<span class="token punctuation">]</span><span class="token comment"># docker run -it centos:latest /bin/bash    # å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span><span class="token punctuation">[</span>root@72f1a8a0e394 /<span class="token punctuation">]</span><span class="token comment">#    # è¿™é‡Œå‘½ä»¤è¡Œå½¢å¼å˜äº†ï¼Œè¡¨ç¤ºå·²ç»è¿›å…¥äº†ä¸€ä¸ªæ–°ç¯å¢ƒ</span><span class="token punctuation">[</span>root@72f1a8a0e394 /<span class="token punctuation">]</span><span class="token comment"># git --version    # æ­¤æ—¶çš„å®¹å™¨ä¸­æ²¡æœ‰ git</span>bash: git: <span class="token builtin class-name">command</span> not found<span class="token punctuation">[</span>root@72f1a8a0e394 /<span class="token punctuation">]</span><span class="token comment"># yum install git    # åˆ©ç”¨ yum å®‰è£… git</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">[</span>root@72f1a8a0e394 /<span class="token punctuation">]</span><span class="token comment"># git --version   # æ­¤æ—¶çš„å®¹å™¨ä¸­å·²ç»è£…æœ‰ git äº†</span><span class="token function">git</span> version <span class="token number">1.8</span>.3.1</code></pre><p>ç„¶åæŒ‰ä¸‹ Ctrl+D æˆ–è€…è¾“å…¥ exit é€€å‡ºå®¹å™¨ï¼Œç„¶åæŸ¥çœ‹å½“å‰æ‰€æœ‰å®¹å™¨ï¼š<code>docker ps -a</code>ã€‚è¿™é‡Œå°†å®¹å™¨è½¬åŒ–ä¸ºä¸€ä¸ªé•œåƒï¼Œå³æ‰§è¡Œ commit æ“ä½œï¼Œå®Œæˆåå¯ä½¿ç”¨ docker images æŸ¥çœ‹ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@xxx ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a</span>CONTAINER ID  IMAGE    COMMAND      CREATED   STATUS   PORTS    NAMES72f1a8a0e394  centos:latest <span class="token string">"/bin/bash"</span>  <span class="token number">9</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">3</span> minutes ago      angry_hodgkin<span class="token punctuation">[</span>root@xxx ~<span class="token punctuation">]</span><span class="token comment"># docker commit -m "Commit Message" -a "UserInfo" &lt;Container ID> &lt;user>/&lt;repo>:&lt;tag></span><span class="token punctuation">[</span>root@xxx ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>REPOSITORY       TAG    IMAGE ID         CREATED             SIZE<span class="token operator">&lt;</span>user<span class="token operator">></span>/<span class="token operator">&lt;</span>repo<span class="token operator">></span>    <span class="token function">git</span>    52166e4475ed     <span class="token number">5</span> seconds ago       <span class="token number">358.1</span> MBcentos           latest 0584b3d2cf6d     <span class="token number">9</span> days ago          <span class="token number">196.5</span> MB</code></pre><p>æ­¤æ—¶ Docker å¼•æ“ä¸­å°±æœ‰äº†æˆ‘ä»¬æ–°å»ºçš„é•œåƒ <code>&lt;user&gt;/&lt;repo&gt;:&lt;tag&gt;</code>ï¼Œæ­¤é•œåƒå’ŒåŸæœ‰çš„ CentOS é•œåƒåŒºåˆ«åœ¨äºå¤šäº†ä¸ª Git å·¥å…·ã€‚æ­¤æ—¶æˆ‘ä»¬åˆ©ç”¨æ–°é•œåƒåˆ›å»ºçš„å®¹å™¨ï¼Œæœ¬èº«å°±è‡ªå¸¦ Git äº†ã€‚</p><p><strong>æ–¹æ³• 2ï¼šä½¿ç”¨ <code>Dockerfile</code></strong></p><p>Dockerfile å¯ä»¥ç†è§£ä¸ºä¸€ç§é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥å‘Šè¯‰ <code>docker build</code> å‘½ä»¤åº”è¯¥æ‰§è¡Œå“ªäº›æ“ä½œã€‚ä¸€ä¸ªç®€æ˜“çš„ <code>Dockerfile</code> æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># è¯´æ˜è¯¥é•œåƒä»¥å“ªä¸ªé•œåƒä¸ºåŸºç¡€FROM centos:latest# æ„å»ºè€…çš„åŸºæœ¬ä¿¡æ¯MAINTAINER &lt;user&gt;# åœ¨ build è¿™ä¸ªé•œåƒæ—¶æ‰§è¡Œçš„æ“ä½œ RUN yum updateRUN yum install -y git# æ‹·è´æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒä¸­COPY .&#x2F;* &#x2F;usr&#x2F;share&#x2F;gitdir&#x2F;# Expose å¯¹åº”ç«¯å£ï¼Œå…è®¸å¤–éƒ¨è¿æ¥EXPOSE 3000</code></pre><p>å®˜æ–¹æ•™ç¨‹é“¾æ¥ï¼š<a href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p><p>æœ‰äº† <code>Dockerfile</code> ä¹‹åï¼Œå°±å¯ä»¥åˆ©ç”¨ <code>build</code> å‘½ä»¤<strong>æ„å»ºé•œåƒ</strong>äº†ï¼š</p><pre class="language-text" data-language="text"><code class="language-text">[root@xxx ~]# docker build -t="&lt;user>/&lt;repo>:&lt;tag>" .</code></pre><p>å…¶ä¸­ -t ç”¨æ¥æŒ‡å®šæ–°é•œåƒçš„ç”¨æˆ·ä¿¡æ¯ã€tag ç­‰ã€‚æœ€åçš„ç‚¹è¡¨ç¤ºåœ¨å½“å‰ç›®å½•å¯»æ‰¾ <code>Dockerfile</code>ã€‚</p><ul><li><p>åˆ é™¤å®¹å™¨æˆ–é•œåƒ</p><ul><li>åˆ é™¤å®¹å™¨ï¼š<code>docker rm container_name/container_id</code></li><li>åˆ é™¤é•œåƒï¼š<code>docker rmi image_name/image_id</code></li><li>åˆ é™¤é•œåƒå‰å¿…é¡»å…ˆåˆ é™¤ä»¥æ­¤é•œåƒä¸ºåŸºç¡€çš„å®¹å™¨ã€‚</li></ul></li><li><p>é•œåƒçš„ä¿å­˜ä¸åŠ è½½</p><ul><li>ä¿å­˜é•œåƒï¼š<code>docker save -o centos.tar &lt;user&gt;/&lt;repo&gt;:&lt;tag&gt;</code></li><li>åŠ è½½é•œåƒï¼š<code>docker load -i centos.tar</code></li></ul></li></ul><h2 id="Containers"><a href="#Containers" class="headerlink" title="Containers"></a>Containers</h2><ul><li>å¯åŠ¨å®¹å™¨ï¼š<code>docker run [Options] &lt;Image&gt; [Command]</code><ul><li><code>-d</code>ï¼šRun container in background and print container ID</li><li><code>-e</code>ï¼šSet environment variables</li><li><code>-i</code>ï¼šKeep STDIN open even if not attached</li><li><code>-p &lt;host&gt;:&lt;container&gt;</code>ï¼šPublish a containerâ€™s port to the host</li><li><code>-t</code>ï¼šAllocate a pseudo-TTY</li><li><code>--name</code>ï¼šAssign a name to the container</li><li><code>-v &lt;host&gt;:&lt;container&gt;</code>ï¼šMount host_path to container_path </li><li>å¸¸ç”¨å‘½ä»¤ï¼š<code>docker run -itd centos:latest /bin/bash</code></li><li>å¦‚æœæƒ³è®©å®¹å™¨ä¸€ç›´è¿è¡Œï¼Œè€Œä¸æ˜¯åœæ­¢ï¼Œå¯ä»¥ä½¿ç”¨å¿«æ·é”® Ctrl+P Ctrl+Q é€€å‡ºï¼Œæ­¤æ—¶å®¹å™¨çš„çŠ¶æ€ä¸º Upã€‚</li></ul></li><li>å¯åŠ¨å®¹å™¨ï¼š<code>docker start &lt;container&gt;</code></li><li>åœæ­¢å®¹å™¨ï¼š<code>docker stop container&gt;</code></li><li>é‡å¯å®¹å™¨ï¼š<code>docker restart &lt;container&gt;</code></li><li>è¿›å…¥å·²å¯åŠ¨çš„å®¹å™¨ï¼š<code>docker attach &lt;container&gt;</code></li><li>å¤åˆ¶æ–‡ä»¶ï¼š<code>docker cp &lt;container&gt;:&lt;path&gt; &lt;host_path&gt;</code></li></ul><h2 id="Repositories"><a href="#Repositories" class="headerlink" title="Repositories"></a>Repositories</h2><ul><li>å®˜æ–¹é•œåƒæœåŠ¡å™¨ï¼š<a href="https://hub.docker.com">https://hub.docker.com</a></li><li>ç™»å½• DockerHubï¼š<code>docker login</code></li><li>æ¨é€æœ¬åœ°é•œåƒï¼š<code>docker push &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt;</code><ul><li><code>username</code> å¿…é¡»ä¸ä½  Docker Hub ä¸­çš„ç”¨æˆ·åä¸€è‡´</li></ul></li><li>æ‹‰å–è¿œç«¯é•œåƒï¼š<code>docker pull &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt;</code></li></ul><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/23599229">https://zhuanlan.zhihu.com/p/23599229</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2022/02/11/MbaA67dgptL9YBc.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;è½¯ä»¶å¼€å‘æœ€å¤§çš„éº»çƒ¦äº‹ä¹‹ä¸€ï¼Œå°±æ˜¯ç¯å¢ƒé…ç½®ã€‚ç”¨æˆ·è®¡ç®—æœºçš„ç¯å¢ƒä¸åŒï¼Œå¯èƒ½å¯¼è‡´è½¯ä»¶åœ¨å¼€å‘ç¯å¢ƒä¸­èƒ½è¿è¡Œï¼Œè€Œåˆ°äº†ç”Ÿäº§ç¯å¢ƒæ— æ³•è¿è¡Œçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·å¿…é¡»ä¿è¯ä¸¤ä»¶äº‹ï¼šæ“ä½œç³»ç»Ÿçš„è®¾ç½®ï¼Œå„ç§åº“å’Œç»„ä»¶çš„å®‰è£…ã€‚åªæœ‰å®ƒä»¬éƒ½æ­£ç¡®ï¼Œè½¯ä»¶æ‰èƒ½è¿è¡Œã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå®‰è£…ä¸€ä¸ª Python åº”ç”¨ï¼Œè®¡ç®—æœºå¿…é¡»æœ‰ Python å¼•æ“ï¼Œè¿˜å¿…é¡»æœ‰å„ç§ä¾èµ–ï¼Œå¯èƒ½è¿˜è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚&lt;/p&gt;
&lt;p&gt;ç¯å¢ƒé…ç½®å¦‚æ­¤éº»çƒ¦ï¼Œæ¢ä¸€å°æœºå™¨ï¼Œå°±è¦é‡æ¥ä¸€æ¬¡ï¼Œæ—·æ—¥è´¹æ—¶ã€‚å¾ˆå¤šäººæƒ³åˆ°ï¼Œèƒ½ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œè½¯ä»¶å¯ä»¥å¸¦ç¯å¢ƒå®‰è£…ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œ&lt;strong&gt;å®‰è£…çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹ç¯å¢ƒä¸€æ¨¡ä¸€æ ·åœ°å¤åˆ¶è¿‡æ¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹å¼æ˜¯ä½¿ç”¨&lt;strong&gt;è™šæ‹Ÿæœº&lt;/strong&gt;ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ WSLï¼Œå°±æ˜¯åœ¨ Windows ç³»ç»Ÿä¸­è¿è¡Œ Linux è™šæ‹Ÿç³»ç»Ÿçš„ä¾‹å­ã€‚ä½†æ˜¯ï¼Œè¿™æ ·åšçš„èµ„æºå ç”¨å¤šï¼Œè¦é‡æ–°é…ç½®ä¸€ä¸ªå…¨æ–°æ“ä½œç³»ç»Ÿçš„å†—ä½™æ­¥éª¤å¤šï¼Œå¯åŠ¨èµ·æ¥ä¹Ÿååˆ†ç¼“æ…¢ã€‚äºæ˜¯ï¼ŒLinux å‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼š&lt;strong&gt;è™šæ‹Ÿå®¹å™¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚&lt;/strong&gt;æˆ–è€…è¯´ï¼Œåœ¨æ­£å¸¸è¿›ç¨‹çš„å¤–é¢å¥—äº†ä¸€ä¸ªä¿æŠ¤å±‚ã€‚å¯¹äºå®¹å™¨é‡Œé¢çš„è¿›ç¨‹æ¥è¯´ï¼Œå®ƒæ¥è§¦åˆ°çš„å„ç§èµ„æºéƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œä»è€Œå®ç°ä¸åº•å±‚ç³»ç»Ÿçš„éš”ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Docker å±äº Linux å®¹å™¨çš„ä¸€ç§å°è£…ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„å®¹å™¨ä½¿ç”¨æ¥å£ã€‚&lt;/strong&gt;å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Linux å®¹å™¨è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;Docker å°†åº”ç”¨ç¨‹åºä¸è¯¥ç¨‹åºçš„ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨ã€‚ç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œè¿è¡Œï¼Œå°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œä¸€æ ·ã€‚æœ‰äº† Dockerï¼Œå°±ä¸ç”¨æ‹…å¿ƒç¯å¢ƒé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä½“æ¥è¯´ï¼ŒDocker çš„æ¥å£ç›¸å½“ç®€å•ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œä½¿ç”¨å®¹å™¨ï¼ŒæŠŠè‡ªå·±çš„åº”ç”¨æ”¾å…¥å®¹å™¨ã€‚å®¹å™¨è¿˜å¯ä»¥è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€å¤åˆ¶ã€åˆ†äº«ã€ä¿®æ”¹ï¼Œå°±åƒç®¡ç†æ™®é€šçš„ä»£ç ä¸€æ ·ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/åç«¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="Docker" scheme="https://www.c7w.tech/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Solving Wordle Using Information Theory å­—å¹•åŠæˆªå›¾</title>
    <link href="https://www.c7w.tech/solving-wordle-using-infomation-theory/"/>
    <id>https://www.c7w.tech/solving-wordle-using-infomation-theory/</id>
    <published>2022-02-09T07:35:22.000Z</published>
    <updated>2022-02-09T08:29:03.579Z</updated>
    
    <content type="html"><![CDATA[<p>è§†é¢‘é“¾æ¥ï¼š<a href="https://www.youtube.om/watch?v=v68zYyaEmEA">https://www.youtube.om/watch?v=v68zYyaEmEA</a></p><p>The game Wordle has gone pretty viral in the last month or two, and never one to overlook an opportunity for a math lesson, it occurs to me that this game makes for a very good central example in a lesson about information theory, and in particular a topic known as entropy.</p><p><img src="https://s2.loli.net/2022/02/09/qEurwPIfFleZXxH.png" alt="image-20220209153901098"></p><p>You see like a lot of people I got kind of sucked into the puzzle, and like a lot of programmers I also got sucked into trying to write an algorithm that would play the game as optimally as it could.</p><a id="more"></a><p>What I thought Iâ€™d do here is just talk through with you some of my process in that, and explain some of the math that went into it, since the whole algorithm centers on this idea of entropy.</p><p><img src="https://s2.loli.net/2022/02/09/ZRVUzqtEAgydulF.png" alt="image-20220209153936071"></p><h2 id="What-is-Wordle"><a href="#What-is-Wordle" class="headerlink" title="What is Wordle?"></a>What is Wordle?</h2><p>First things first, in case you havenâ€™t heard of it, what is Wordle? And to kill two birds with one stone here while we go through the rules of the game, let me also preview where weâ€™re going with this, which is to develop a little algorithm that will basically play the game for us.</p><p>I havenâ€™t done todayâ€™s Wordle, this is February 4th, and weâ€™ll see how the bot does.</p><p><strong>The goal of Wordle is to guess a mystery five-letter word, and youâ€™re given six different chances to guess.</strong></p><p>For example, my wordlebot suggests that I start with the guess â€œcraneâ€.</p><p><strong>Each time that you make a guess, you get some information about how close your guess is to the true answer.</strong></p><p><img src="https://s2.loli.net/2022/02/09/VcihA67oex9HlEK.png" alt="image-20220209154123515"></p><p><strong>Here the gray box is telling me thereâ€™s no c in the actual answer, the yellow box is telling me there is an r but itâ€™s not in that position. The green box is telling me that the secret word does have an a and itâ€™s in the third position. And then thereâ€™s no â€˜nâ€™ and thereâ€™s no â€˜eâ€™.</strong></p><p>Let me just go in and tell the wordlebot about that informationâ€¦ we started with â€œcraneâ€, we got gray yellow green grey greyâ€¦</p><p><img src="https://s2.loli.net/2022/02/09/yYrJl2hP39o8kMV.png" alt="image-20220209154314214"></p><p>Donâ€™t worry about all the data that itâ€™s showing right now, Iâ€™ll explain that in due time. Its top suggestion for our second pick is â€œshtikâ€. Your guess does have to be an actual five-letter word, but as youâ€™ll see itâ€™s pretty liberal with what it will actually let you guess.</p><p>In this case we try stick andâ€¦all right! Things are looking pretty good.</p><p>We hit the â€˜sâ€™ and the â€˜hâ€™, so we know the first three letters, and we know that thereâ€™s an â€˜râ€™.</p><p>So itâ€™s going to be like s-h-a something r or s-h-a-r-something.</p><p>And it looks like the Wordle-bot knows that itâ€™s down to just two possibilities, either â€œshardâ€ or â€œsharpâ€.</p><p><img src="https://s2.loli.net/2022/02/09/K2LFqOyxtXe1njI.png" alt="image-20220209154423328"></p><p>Iâ€™s kind of a toss-up between them at this point, so I guess probably just because itâ€™s alphabetical it goes with shard, whichâ€¦hooray! It is the actual answer.</p><p><img src="https://s2.loli.net/2022/02/09/Nk1zK8PglIqtGno.png" alt="image-20220209154457213"></p><p>So we got it in three. If youâ€™re wondering if thatâ€™s any good, the way I heard one person phrase it is that with Wordle, four is par and three is birdie, which I think is a pretty apt analogy.</p><p>You have to be consistently on your game to be getting four but itâ€™s certainly not crazy. But when you get it in three, it just feels great. </p><h2 id="Initial-Ideas"><a href="#Initial-Ideas" class="headerlink" title="Initial Ideas"></a>Initial Ideas</h2><p>If youâ€™re down for it what Iâ€™d like to do here is just talk through my thought process from the beginning for how I approach the wordlebot. And like I said really itâ€™s an excuse for an information theory lesson, <strong>the main goal is to explain what is information and what is entropy</strong>. </p><p>My first thought in approaching this was to take a look at the relative frequencies of different letters in the english language.</p><p><img src="https://s2.loli.net/2022/02/09/tTjM6GAB5wrPKmV.png" alt="image-20220209154730755"></p><p>I thought, okay, is there an opening guess or an opening pair of guesses that hits a lot of these most frequent letters.</p><p>Once that I was pretty fond of was doing â€œotherâ€ followed by â€œnailsâ€.</p><p><img src="https://s2.loli.net/2022/02/09/gYUZmdHpfyucPz6.png" alt="image-20220209154803058"></p><p>The thought is that if you hit a letter, you know you get a green or a yellow, that always feels good, it feels like youâ€™re getting information.But in these cases even if you donâ€™t hit and you always get greys, thatâ€™s still giving you a lot of information, since itâ€™s pretty rare to find a word that doesnâ€™t have any of these letters.</p><p>But even still that doesnâ€™t feel super systematic, because for example it does nothing to consider the order of the letters.</p><p>Why type â€œnailsâ€ when I could type â€œsnailâ€.</p><p>Is it better to have that s at the end? Iâ€™m not really sure. Now a friend of mine said that he liked to open with the word â€œwearyâ€, which kind of surprised me because it has some uncommon letters in there like the â€˜wâ€™ and the â€˜yâ€™.</p><p>But who knows, maybe that is a better opener.</p><p><strong>Is there some kind of quantitative score that we can give to judge the quality of a potential guess?</strong> To set up for the way that weâ€™re going to rank possible guesses, letâ€™s go back and add a little clarity to how exactly the game is set up.</p><p>Thereâ€™s a list of words that it will allow you to enter, that are considered valid guesses, thatâ€™s just about 13,000 words long.</p><p>But when you look at it thereâ€™s a lot of really uncommon things things like â€œaahedâ€ or â€œaaliiâ€ and â€œaarghâ€.</p><p>The kind of words that bring about family arguments in a game of Scrabble.</p><p>But the vibe of the game is that the answer is always going to be a decently common word, and in fact thereâ€™s another list of around 2,300 words that are the possible answers.</p><p><img src="https://s2.loli.net/2022/02/09/KrcWQZMwJhz73mq.png" alt="image-20220209154934933"></p><p>This is a human-curated list, I think specifically by the game creatorâ€™s girlfriend which is kind of fun. <strong>But what I would like to do, our challenge for this project, is to see if we can write a program solving Wordle that doesnâ€™t incorporate previous knowledge about this list (Answer list).</strong></p><p>For one thing thereâ€™s plenty of pretty common five letter words that you wonâ€™t find in that list, so it would be better to write a program thatâ€™s a little more resilient and would play Wordle against anyone, not just what happens to be the official website.</p><p>And also, the reason that we know what this list of possible answers is is because itâ€™s visible in the source code, but the way that itâ€™s visible in the source code is in the specific order in which answers come up from day to day, so you could always just look up what tomorrowâ€™s answer will be.</p><p>So clearly thereâ€™s some sense in which using the list is cheating, and what makes for a more interesting puzzle and a richer information theory lesson is to instead use some more universal data, like relative word frequencies in general, to capture this intuition of having a preference for more common words.</p><p>So! Of these 13,000 possibilities, how should we choose the opening guess? For example if my friend proposes â€œwearyâ€, how should we analyze its quality? Well the reason he said he likes that unlikely â€˜wâ€™ is that he likes the long shot nature of just how good it feels if you do hit that â€˜wâ€™.</p><p>For example if the first pattern revealed was something like this, then it turns out there are only 58 words in this giant lexicon that match that pattern, so thatâ€™s a huge reduction from 13,000.</p><p>But the flip side of that, of course, is that itâ€™s very uncommon to get a pattern like this.</p><p>Specifically, if each word was equally likely to be the answer, the probability of hitting this pattern would be 58 divided by around 13,000. Of course, theyâ€™re not equally likely to be answers, most of these are very obscure and even questionable words, but at least for our first pass at all of this letâ€™s assume that theyâ€™re all equally likely, then refine that a bit later.</p><p>The point is the pattern with a lot of information is by its very nature unlikely to occur.</p><p><strong>In fact what it means to be informative is that itâ€™s unlikely.</strong></p><p>A much more probable pattern to see with this opening would be something like this, where of course thereâ€™s not a â€˜wâ€™ in it, maybe thereâ€™s an â€˜eâ€™ and maybe thereâ€™s no â€˜aâ€™, thereâ€™s no â€˜râ€™, and thereâ€™s no â€˜yâ€™.</p><p>In this case there are 1,400 possible matches.</p><p>So if all were equally likely, it works out to be a probability of about 11% that this is the pattern you would see.</p><p><strong>So the most likely outcomes are also the least informative.</strong> To get a more global view here, let me show you the full distribution of probabilities across all of the different patterns that you might see.</p><p><img src="https://s2.loli.net/2022/02/09/Wf9udeVOsp76Phm.png" alt="image-20220209155232751"></p><p>Each bar that youâ€™re looking at corresponds to a possible pattern of colors that could be revealed, of which there are 3^5 possibilities. And theyâ€™re organized from left to right, most common to least common.</p><p>So the most common possibility here is that you get all grays, that happens about 14% of the time.</p><p>What youâ€™re hoping for when you make a guess is that you end up somewhere out in this long tail, like over here where thereâ€™s only 18 possibilities for what matches this pattern, that evidently look like this.</p><p>Or if we venture a little farther to the leftâ€¦you know maybe we go all the way over hereâ€¦okay hereâ€™s a good puzzle for you.</p><p>What are the three words in the english language that start with a â€˜wâ€™ end with a â€˜yâ€™ and have an â€˜râ€™ somewhere in them? It turns out the answers areâ€¦</p><p>letâ€™s seeâ€¦â€wordyâ€ â€œwormyâ€ and â€œwrilyâ€. </p><p>To judge how good this word is overall, we want some kind of measure of the expected amount of information that youâ€™re going to get from this distribution.</p><p>If we go through each pattern and we multiply its probability of occurring times something that measures how informative it is, that can maybe give us an objective score.</p><p><img src="https://s2.loli.net/2022/02/09/Av92qkau3UCL5Vn.png" alt="image-20220209155405454"></p><p>Now your first instinct for what that something should be might be the number of matches, you know you want a lower average number of matches, but instead Iâ€™d like to use a more universal measurement that we often ascribe to information, and one that will be more flexible once we have a different probability assigned to each of these 13,000 words for whether or not theyâ€™re actually the answer.</p><h2 id="Information-Theory-Basics"><a href="#Information-Theory-Basics" class="headerlink" title="Information Theory Basics"></a>Information Theory Basics</h2><p>The standard unit of information is the bit, which has a little bit of a funny formula, but itâ€™s really intuitive if we just look at examples.</p><p>If you have an observation that cuts your space of possibilities in half, we say that it has one bit of information. In our example the space of possibilities is all possible words, and it turns out about half of the five letter words have an â€˜sâ€™, a little less than that but about half.</p><p><img src="https://s2.loli.net/2022/02/09/pnDBUbVrWLX87zO.png" alt="image-20220209155501486"></p><p>So that observation would give you one bit of information.</p><p>If instead a new fact chops down that space of possibilities by a factor of four, we say that it has two bits of information.</p><p>For example it turns out about a quarter of these words have a â€˜tâ€™.</p><p>If the observation cuts that space by a factor of eight, we say it has three bits of information, and so on and so forth.</p><p>Four bits cuts it into a sixteenth, five bits cuts it into a 32nd.</p><p><img src="https://s2.loli.net/2022/02/09/EZtzMDXKNHLu1bj.png" alt="image-20220209155530333"></p><p>So now is when you might want to take a moment to pause and ask for yourself, what is the formula for information, for the number of bits in terms of the probability of an occurrence? Well, what weâ€™re saying here is basically that when you take one half to the number of bits, thatâ€™s the same thing as the probability, which is the same thing as saying 2 to the power of the number of bits is 1 over the probability, which rearranges further to saying the information is the log base 2 of 1 divided by the probability.</p><p><img src="https://s2.loli.net/2022/02/09/r9mxnBdh6Kv7tpQ.png" alt="image-20220209155601625"></p><p>And sometimes you see this with one more rearrangement still, where the information is the negative log base 2 of the probability.</p><script type="math/tex; mode=display">I = - \log_2(p)</script><p>Expressed like this it can look a little bit weird to the uninitiated, but it really is just the very intuitive idea of asking how many times youâ€™ve cut down your possibilities in half.</p><p>Now if youâ€™re wondering, you know, I thought we were just playing a fun word game why are logarithms entering the picture? One reason this is a nicer unit is it just a lot easier to talk about very unlikely events.</p><p>Much easier to say that an observation has 20 bits of information than it is to say that the probability of such and such occurring is 0.00000095.</p><p>But a more substantive reason that this logarithmic expression turned out to be a very useful addition to the theory of probability is the way that <strong>information adds together</strong>.</p><p>For example if one observation gives you two bits of information, cutting your space down by four, and then a second observation, like your second guess in Wordle, gives you another three bits of information, chopping you down further by another factor of eight, the two together give you five bits of information.</p><p><img src="https://s2.loli.net/2022/02/09/26ZwfmLz4W7CDIE.png" alt="image-20220209155733905"></p><p>In the same way that probabilities like to multiply, Information likes to add.</p><p>So as soon as weâ€™re in the realm of something like an expected value, where weâ€™re adding a bunch of numbers up, the logs make it a lot nicer to deal with.Letâ€™s go back to our distribution for weary and add another little tracker on here showing us how much information there is for each pattern.</p><p>The main thing I want you to notice is that <strong>the higher the probability, as we get to those more likely patterns, the lower the information, the fewer bits you gain.</strong></p><p><img src="https://s2.loli.net/2022/02/09/Jj7mgwP2xGFpV8d.png" alt="image-20220209155818230"></p><p>The way we measure the quality of this guess will be to take the expected value of this information, where we go through each pattern, we say how probable is it, and then we multiply that by how many bits of information do we get.</p><p><img src="https://s2.loli.net/2022/02/09/obpnzMEUHyArOs6.png" alt="image-20220209155839919"></p><p>And in the example of weary, that turns out to be 4.9 bits. So on average, the information you get from this opening guess is as good as chopping your space of possibilities in half about five times.</p><p>By contrast, an example of a guess with a higher expected information value would be something like â€œslateâ€.</p><p>In this case youâ€™ll notice the distribution looks a lot flatter, in particular the most probable occurrence of all grays only has about a 6% chance of occurring.</p><p><img src="https://s2.loli.net/2022/02/09/rnp6IsjAbRkEHae.png" alt="image-20220209155905333"></p><p>So at minimum youâ€™re getting, evidently, 3.9 bits of information. But thatâ€™s a minimum, more typically youâ€™d get something better than that.</p><p>And it turns out when you crunch the numbers on this one and you add up all of the relevant terms, the average information is about 5.8.</p><p><img src="https://s2.loli.net/2022/02/09/jq79CUDv3tNucnp.png" alt="image-20220209160058972"></p><p>So in contrast with weary your space of possibilities will be about half as big after this first guess, on average. Thereâ€™s actually a fun story about the name for this expected value of information quantity.</p><p>You see information theory was developed by Claude Shannon, who was working at Bell labs in the 1940s.</p><p>He was talking about some of his yet-to-be-published ideas with John von Neumann, who was this intellectual giant of the time, a very prominent in math and physics and the beginnings of what was becoming computer science.</p><p>And when he mentioned that he didnâ€™t really have a good name for this expected value of information quantity, von Neumann supposedly said, so the story goes, â€œwell you should call it <strong>Entropy</strong>, and for two reasons.</p><p>In the first place your uncertainty function has been used in statistical mechanics under that name, so it already has a name.</p><p>And in the second place, and more important, nobody knows what entropy really is, so in a debate youâ€™ll always have the advantage.â€So if the name seems a little bit mysterious, and if this story is to be believed, thatâ€™s kind of by design.</p><p>Also, if youâ€™re wondering about its relation to all of that second law of thermodynamics stuff from physics, there definitely is a connection, but in its origins Shannon was just dealing with pure probability theory.</p><p>And for our purposes here, when I use the word entropy, I just want you to think the expected information value of a particular guess.You can think of entropy as measuring two things simultaneously.</p><p>The first one is how flat is the distribution. The closer a distribution is to uniform, the higher that entropy will be.</p><p>In our case, where there are 3^5 total patterns, for a uniform distribution, observing any one of them would have information log_2(3^5), which happens to be 7.92.</p><p>So that is the absolute maximum that you could possibly have for this entropy.</p><p><img src="https://s2.loli.net/2022/02/09/nA6pmjhPRetwYLD.png" alt="image-20220209160237737"></p><p>But entropy is also kind of a measure of how many possibilities there are in the first place.</p><p>For example if you happen to have some word where thereâ€™s only 16 possible patterns, and each one is equally likely, this entropy, this expected information, would be four bits.</p><p>But if you have another word where there are 64 possible patterns that could come up, and theyâ€™re all equally likely, then the entropy would work out to be six bits.</p><p>So if you see some distribution out in the wild that has an entropy of six bits, itâ€™s sort of like itâ€™s saying thereâ€™s as much variation and uncertainty in whatâ€™s about to happen as if there were 64 equally likely outcomes.</p><p>For my first pass at the worldbot, I basically had it just do this. It goes through all of the different possible guesses that you could have, all 13,000 words.</p><p><strong>It computes the entropy for each one, or more specifically the entropy of the distribution across all patterns that you might see for each one, and then it picks the highest, since thatâ€™s the one thatâ€™s likely to chop down your space of possibilities as much as possible. And even though Iâ€™ve only been talking about the first guess here it does the same thing for the next few guesses.</strong></p><p>For example, after you see some pattern on that first guess, which would restrict you to a smaller number of possible words based on what matches with that, you just play the same game with respect to that smaller set of words.</p><p>For a proposed second guess, you look at the distribution of all patterns that could occur from that more restricted set of words.</p><p>You search through all 13,000 possibilities, and you find the one that maximizes that entropy. To show you how this works in action let me just pull up a little variant of Wordle that I wrote that shows the highlights of this analysis in the margins.</p><p>So after doing all its entropy calculations, on the right here itâ€™s showing us which ones have the highest expected information.</p><p><img src="https://s2.loli.net/2022/02/09/psOiFTtw4RazxgV.png" alt="image-20220209160445358"></p><p>It turns out the top answer, at least at the moment weâ€™ll refine this later, is â€œtaresâ€, which meansâ€¦umâ€¦of course, a vetch the most common vetch.Each time we make a guess here, where maybe I kind of ignore its recommendations and go with slate, because I like slate, we can see how much expected information it had.</p><p>But then on the right of the word here itâ€™s showing us how much actual information we got given this particular pattern.</p><p>So here it looks like we were a little unlucky.</p><p>We were expected to get 5.8, but we happened to get something with less than that.</p><p>And then on the left side here itâ€™s showing us all of the different possible words given where we are now.</p><p>The blue bars are telling us how likely it thinks each word is, so at the moment itâ€™s assuming each word is equally likely to occur, but weâ€™ll refine that in a moment.</p><p><img src="https://s2.loli.net/2022/02/09/p1UQW4CPo7uyMLD.png" alt="image-20220209160549360"></p><p>And then this uncertainty measurement is telling us the entropy of this distribution across the possible words, which right now, because itâ€™s a uniform distribution, is just a needlessly complicated way to count the number of possibilities.</p><p>For example, if we were to take 2 to the power of 13.66, that should be around the 13,000 possibilities.</p><p>Itâ€™ a little bit off here, but only because Iâ€™m not showing all the decimal places.At the moment that might feel redundant, and like itâ€™s overly complicating things, but youâ€™ll see why itâ€™s useful to have both numbers in a minute. Here it looks like itâ€™s suggesting the highest entropy for our second guess is â€œraminâ€, which againâ€¦just really doesnâ€™t feel like a word.</p><p>So to take the moral high ground here Iâ€™m going to go ahead and type in â€œrainsâ€.</p><p>Again it looks like we were a little unlucky, we were expecting 4.3 bits and we only got 3.39 bits of information.</p><p>So that takes us down to 55 possibilities. And here maybe Iâ€™ll just actually go with what itâ€™s suggesting, which is â€œkombuâ€, whatever that means.</p><p>Okay! This is actually a good chance for a puzzle.</p><p>Itâ€™s telling us this pattern gives us 4.78 bits of information, but over on the left before we see that pattern there were 5.78 bits of uncertainty.</p><p><img src="https://s2.loli.net/2022/02/09/JlVRyZmhEcN7g9K.png" alt="image-20220209160719833"></p><p>So as a quiz for you, what does that mean about the number of remaining possibilities? Well it means that weâ€™re reduced down to 1 bit of uncertainty, which is the same thing as saying that thereâ€™s two possible answers, itâ€™s a 50/50 choice.</p><p>And from here, because you and I know which words are more common, we know that the answer should be â€œabyssâ€.</p><p>But as itâ€™s written right now the program doesnâ€™t know that, so it just keeps going trying to gain as much information as it can until thereâ€™s only one possibility left, and then it guesses it.</p><p>So obviously we need a better endgame strategy, but letâ€™s say we call this version one of our Wordle solver and then we go and run some simulations to see how it does.</p><p>The way this is working is itâ€™s playing every possible Wordle game, itâ€™s going through all of those 2,315 words that are the actual Wordle answers, itâ€™s basically using that as a testing set, and with this naive method of not considering how common a word is and just trying to maximize the information at each step along the way until it gets down to one and only one choice, by the end of the simulation the average score works out to be about 4.124.</p><p>Whichâ€¦you know itâ€™s not bad.</p><p>To be honest I kind of expected to do worse. But the people who play Wordle will tell you that they can usually get it in four.</p><p>The real challenge is to get as many in three as you can.</p><p>Itâ€™s a pretty big jump between the score four and the score of three.</p><p>The obvious low-hanging fruit here is to somehow incorporate whether or not a word is common, and how exactly do we do that?</p><h2 id="Incorporating-Word-Frequencies"><a href="#Incorporating-Word-Frequencies" class="headerlink" title="Incorporating Word Frequencies"></a>Incorporating Word Frequencies</h2><p>The way I approached it is to get a list of the relative frequencies for all of the words in the english language.</p><p>I just used Mathematicaâ€™s word frequency data function, which itself pulls from the google books english n-gram public dataset.</p><p>And itâ€™s kind of fun to look at, for example if we sort it from the most common words to the least common words, evidently these are the most common five letter words in the english language.</p><p><img src="https://s2.loli.net/2022/02/09/WKVlt4IXGFPySqD.png" alt="image-20220209161017067"></p><p>Or rather, â€œtheseâ€ is the eighth most common.</p><p>First is â€œwhichâ€ after which thereâ€™s â€œthereâ€ and â€œtheirâ€.</p><p>â€œFirstâ€ itself is not first but ninth, and it makes sense that these other words could come about more often, where those after â€œfirstâ€ are â€œafter,â€ â€œwhereâ€, and â€œthoseâ€, being just a little bit less common.</p><p>Now, in using this data to model how likely each of these words is to be the final answer, it shouldnâ€™t just be proportional to the frequency.</p><p>Because for example â€œwhichâ€ is given a score of 0.002 in this data set, whereas the word â€œbraidâ€ is in some sense about a thousand times less likely.</p><p><img src="https://s2.loli.net/2022/02/09/g2QwhfeLoIFs3Ak.png" alt="image-20220209161048640"></p><p>But both of these are common enough words that theyâ€™re almost certainly worth considering, so we want more of a binary cutoff.</p><p>The way I went about it is to imagine taking this whole sorted list of words, and then arranging it on an x-axis, and then applying the sigmoid function, which is the standard way to have a function whose output is basically binary, itâ€™s either zero or itâ€™s one, but thereâ€™s a smoothing in between for that region of uncertainty.</p><p><img src="https://s2.loli.net/2022/02/09/iNd4FsV3zk2ZtoD.png" alt="image-20220209161137592"></p><p>So essentially the probability that Iâ€™m assigning to each word for being in the final list will be the value of the sigmoid function above wherever it sits on the x-axis.</p><p>Now obviously this depends on a few parameters, for example how wide a space on the x-axis those words fill determines how gradually or steeply we drop off from one to zero, and where we situate them left to right determines the cut off. (å–å†³äºè¾“å…¥ç»´åº¦çš„åŒºé—´å®½åº¦åŠèŒƒå›´)</p><p>And to be honest the way I did this was kind of just licking my finger and sticking it into the wind.</p><p>I looked through the sorted list and tried to find a window where when I looked at it, I figured about half of these words are more likely than not to be the final answer. And I use that as the cutoff. </p><p><img src="https://s2.loli.net/2022/02/09/MTYE4pyde8aNinZ.png" alt="image-20220209161310497"></p><p>Now once we have a distribution like this across the words, it gives us another situation where entropy becomes this really useful measurement. For example letâ€™s say we were playing a game and we start with my old openers which were â€œotherâ€ and â€œnailsâ€, and we end up with a situation where thereâ€™s four possible words that match it.</p><p>And letâ€™s say we consider them all equally likely.</p><p><img src="https://s2.loli.net/2022/02/09/DwzTrXiO8jM241U.png" alt="image-20220209161353273"></p><p>Let me ask you, what is the entropy of this distribution? Well the information associated with each one of these possibilities is going to be the log_2(4), since each one is 1/4, and thatâ€™s 2.</p><p>Itâ€™s two bits of information, 4 possibilities, all very well and good. But! What if I told you that actually there are more than four matches.</p><p>In reality, when we look through the full word list, there are 16 words that match it.</p><p>But suppose our model puts a really low probability on those other 12 words of actually being the final answer, something like one in a thousand, because theyâ€™re really obscure.</p><p>Now let me ask you, what is the entropy of this distribution? If entropy was purely measuring the number of matches here, then you might expect it to be something like the log_2(16), which would be 4. Two more bits of uncertainty than we had before.</p><p>But of course, the actual uncertainty is not really that different from what we had before.</p><p>Just because thereâ€™s these 12 really obscure words doesnâ€™t mean that it would be all that more surprising to learn that the final answer is â€œcharmâ€, for example.</p><p>So when you actually do the calculation here, and you add up the probability of each occurrence times the corresponding information, what you get is 2.11 bits.</p><p><img src="https://s2.loli.net/2022/02/09/lfBS7JXdjD2M4ao.png" alt="image-20220209161502273"></p><p>Itâ€™s saying itâ€™s basically two bits, itâ€™s basically those four possibilities, but thereâ€™s a little more uncertainty because of all of those highly unlikely events though if you did learn them youâ€™d get a ton of information from it.</p><p>So zooming out, this is part of what makes Wordle such a nice example for an information theory lesson.</p><p><strong>We have these two distinct feeling applications for entropy, the first one telling us whatâ€™s the expected information weâ€™ll get from a given guess, and the second one saying can we measure the remaining uncertainty among all of the words that are possible.</strong></p><p>And I should emphasize, in that first case where weâ€™re looking at the expected information of a guess, once we have an unequal weighting to the words, that affects the entropy calculation.</p><p>For example let me pull up that same case we were looking at earlier of the distribution associated with â€œwearyâ€, but this time using a non-uniform distribution across all possible words.</p><p>So let me see if I can find a part here that illustrates it pretty wellâ€¦uh okay, here, this is pretty good.</p><p>Here we have two adjacent patterns that are about equally likely but one of them, weâ€™re told, has 32 possible words that match it.</p><p>And if we check what they are, these are those 32, which are all just very unlikely words.</p><p><img src="https://s2.loli.net/2022/02/09/GDQVr1hBYo5P7W6.png" alt="image-20220209161706837"></p><p>As you scan your eyes over them itâ€™s hard to find any that feel like plausible answers.</p><p>Maybe â€œyellsâ€? But if we look at the neighboring pattern in the distribution, which is considered just about as likely, weâ€™re told that it only has eight possible matches.</p><p>So a quarter as many matches, but itâ€™s about as likely.</p><p>And when we pull up those matches, we can see why.</p><p><img src="https://s2.loli.net/2022/02/09/ayRoFKzOZTmAWjH.png" alt="image-20220209161727181"></p><p>Some of these are actual plausible answers like â€œwringâ€ or â€œwrathâ€ or â€œwrapsâ€.</p><p>To illustrate how we incorporate all that, let me pull up version 2 of the wordlebot here. There are two or three main differences from the first one that we saw.</p><p>First off, like I just said, the way that weâ€™re computing these entropies, these expected values of information, is now using the more refined distributions across the patterns that incorporates the probability that a given word would actually be the answer. As it happens, â€œtaresâ€ is still number one, though the ones following are a bit different. </p><p><img src="https://s2.loli.net/2022/02/09/HevyU5hxcwrXpKQ.png" alt="image-20220209161825240"></p><p>Second, when it ranks its top picks, itâ€™s now going to keep a model of the probability that each word is the actual answer, and itâ€™ll incorporate that into its decision, which is easier to see once we have a few guesses on the table.</p><p>Again ignoring its recommendation, because we canâ€™t let machines rule our livesâ€¦And I suppose I should mention another thing different here is over on the left, that uncertainty value, that number of bits, is no longer just redundant with the number of possible matches.</p><p>Now if we pull it up, and you know, we calculated, say, 2 to the 8.02, which would be a little above 256â€¦I guess 259.</p><p><img src="https://s2.loli.net/2022/02/09/2jCnzwULoJIKV1i.png" alt="image-20220209161923324"></p><p>What itâ€™s saying is even though there are 526 total words that actually match this pattern, the amount of uncertainty it has is more akin to what it would be if there were 259 equally likely outcomes.</p><p>You could think of it like this, it knows â€œborksâ€ is not the answer same with â€œyortzâ€ and â€œzorilâ€ and â€œzorusâ€.</p><p>So itâ€™s a little less uncertain than it was in the previous case, this number of bits will be smaller.</p><p>And if I keep playing the game, Iâ€™ll refining this down with a couple guesses that are apropos of what I would like to explain hereâ€¦By the fourth guess, if you look over at its top picks, you can see itâ€™s no longer just maximizing the entropy.</p><p>At this point, thereâ€™s technically seven possibilities, but the only ones with a meaningful chance are â€œdormsâ€ and â€œwordsâ€, and you can see it ranks choosing both of those above all of these other values that, strictly speaking, would give more information.</p><p><img src="https://s2.loli.net/2022/02/09/wpbVlZ5EDegxfOY.png" alt="image-20220209162134927"></p><p>The very first time I did this I just added up these two numbers to measure the quality of each guess, which actually worked better than you might suspect.</p><p>But it really didnâ€™t feel systematic.</p><p>Iâ€™m sure there are other approaches people could take, but hereâ€™s the one I landed on.</p><p>If weâ€™re considering the prospect of a next guess, like in this case â€œwordsâ€, what we really care about is the expected score of our game if we do that.</p><p>And to calculate that expected score, we say â€œwhatâ€™s the probability that â€˜wordsâ€™ is the actual answer?â€, which at the moment it ascribes 58% to.</p><p>So we say with a 58% chance, our score in this game would be four, and then with the probability of one minus that 58 percent, our score will be more than that four.How much more? We donâ€™t know, but we can estimate it based on how much uncertainty thereâ€™s likely to be once we get to that point.</p><p><img src="https://s2.loli.net/2022/02/09/SKobMxvZHJB4pP2.png" alt="image-20220209162242496"></p><p>Specifically, at the moment there are 1.44 bits of uncertainty, if we guess â€œwordsâ€ itâ€™s telling us the expected information weâ€™ll get is 1.27 bits, so if we guess â€œwordsâ€ this difference represents how much uncertainty weâ€™re likely to be left with after that happens.</p><p>What we need is some kind of function, which Iâ€™m calling $f$ here, that associates this uncertainty with an expected score.</p><p>The way I went about this was to just plot a bunch of the data from previous games based on version one of the bot, to say â€œhey what was the actual score after various points with certain very measurable amounts of uncertainty?â€ For example, these data points here that are sitting above a value thatâ€™s around 8.7 or so are saying â€œfor some games, after a point at which there were 8.7 bits of uncertainty, it took two guesses to get the final answer.</p><p><img src="https://s2.loli.net/2022/02/09/CH8We4Z9a7hm2PS.png" alt="image-20220209162411016"></p><p>For other games it took three guesses, for other games it took four guesses.â€If we shift over to the left here, all the points over zero are saying â€œwhenever there are zero bits of uncertainty, which is to say thereâ€™s only one possibility, then the number of guesses required is always just oneâ€, which is reassuring.</p><p>Whenever there was one bit of uncertainty, meaning it was essentially just down to two possibilities, then sometimes it required one more guess sometimes it required two more guesses, and so on and so forth.</p><p>Here, maybe a slightly easier way to visualize this data is to bucket it together and take averages.</p><p><img src="https://s2.loli.net/2022/02/09/Kcf2tdrQmqRPC3l.png" alt="image-20220209162433488"></p><p>For example, this bar here is saying â€œamong all the points where we had one bit of uncertainty, on average the number of new guesses required was about 1.5.â€And the bar over here saying â€œamong all of the different games were at some point the uncertainty was a little above 4 bits, which is like narrowing it down to 16 different possibilities, then on average it requires a little more than two guesses from that point forwardâ€.</p><p>And from here I just did a regression to fit a function that seemed reasonable to this.And remember the whole point of doing any of that is so that we can quantify this intuition that the more information we gain from a word, the lower the expected score will be.</p><h2 id="Final-Performance"><a href="#Final-Performance" class="headerlink" title="Final Performance"></a>Final Performance</h2><p>So with this as version 2.0, if we go back and we run the same set of simulations, having it play against all 2,315 possible Wordle answers, how does it do? Well in contrast to our first version, itâ€™s definitely better, which is reassuring. All said and done, the average is around 3.6.</p><p>Although unlike the first version, there are a couple times that it loses and requires more than six in this circumstance, presumably because there are times when itâ€™s making that trade-off to actually go for the goal, rather than maximizing information.</p><p>So can we do better than 3.6? We definitely can. I said at the start that itâ€™s most fun to try not incorporating the true list of Wordle answers into the way that it builds its model.</p><p>But if we do incorporate it, the best performance I could get was around 3.43.</p><p><img src="https://s2.loli.net/2022/02/09/KPkag9GVXID2nlW.png" alt="image-20220209162714823"></p><p>So if we try to get more sophisticated than just using word frequency data to choose this prior distribution, this 3.43 probably gives a max at how good we could get with that. Or at least how good I could get with that.</p><p>That best performance essentially just uses the ideas that Iâ€™ve been talking about here, but it goes a little farther.</p><p>Like it does a search for the expected information two steps forward, rather than just one.</p><p>Originally I was planning on talking more about that, but I realize weâ€™ve actually gone quite long as it is.</p><p><img src="https://s2.loli.net/2022/02/09/rOoiW9mEnjU7PRu.png" alt="image-20220209162754003"></p><p>The one thing Iâ€™ll say is after doing this two-step search, and then running a couple sample simulations in the top candidates, so far for me at least itâ€™s looking like â€œcraneâ€ is the best opener.</p><p>Who would have guessed?Also if you use the true word list to determine your space of possibilities then the uncertainty you start with is a little over 11 bits.</p><p>And it turns out, just from a brute force search, the maximum possible expected information after the first two guesses is around 10 bits, which suggests that, best case scenario after your first two guesses, with perfectly optimal play, youâ€™ll be left with around one bit of uncertainty, which is the same as being down to two possible guesses.</p><p>So I think itâ€™s fair, and probably pretty conservative, to say that you could never possibly write an algorithm that gets this average as low as 3, because with the words available to you thereâ€™s simply not room to get enough information after only two steps to be able to guarantee the answer in the third slot every single time without fail.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è§†é¢‘é“¾æ¥ï¼š&lt;a href=&quot;https://www.youtube.om/watch?v=v68zYyaEmEA&quot;&gt;https://www.youtube.om/watch?v=v68zYyaEmEA&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The game Wordle has gone pretty viral in the last month or two, and never one to overlook an opportunity for a math lesson, it occurs to me that this game makes for a very good central example in a lesson about information theory, and in particular a topic known as entropy.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2022/02/09/qEurwPIfFleZXxH.png&quot; alt=&quot;image-20220209153901098&quot;&gt;&lt;/p&gt;
&lt;p&gt;You see like a lot of people I got kind of sucked into the puzzle, and like a lot of programmers I also got sucked into trying to write an algorithm that would play the game as optimally as it could.&lt;/p&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/ä¿¡æ¯è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E4%BF%A1%E6%81%AF%E8%AE%BA/"/>
    
    
    <category term="ä¿¡æ¯è®º" scheme="https://www.c7w.tech/tags/%E4%BF%A1%E6%81%AF%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>VSCode é…ç½®æŒ‡åŒ—</title>
    <link href="https://www.c7w.tech/vscode/"/>
    <id>https://www.c7w.tech/vscode/</id>
    <published>2022-02-09T03:49:16.000Z</published>
    <updated>2022-02-13T08:44:35.991Z</updated>
    
    <content type="html"><![CDATA[<p>VSCode æ˜¯ä¸€æ¬¾<strong>è½»é‡çº§</strong>çš„<strong>ä»£ç ç¼–è¾‘å™¨</strong>ï¼Œå¯ä»¥é€šè¿‡å®‰è£…å„ç§å„æ ·ä¸åŒ<strong>æ‰©å±•</strong>çš„æ–¹å¼æ¥å®ç°å¼€å‘è€…æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚</p><blockquote><p>åŒºåˆ†ï¼šä»£ç ç¼–è¾‘å™¨ï¼ˆEditorï¼‰ä¸é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDE, Integrated Development Environmentï¼‰</p><p>ä»£ç ç¼–è¾‘å™¨äº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªè®°äº‹æœ¬ï¼ˆæ²¡é”™ï¼Œå¦‚æœæ˜¯ Windows ç”¨æˆ·ï¼Œå°±æ˜¯ä½ æŒ‰ä¸‹ Win+R è¾“å…¥ notepad å›è½¦ä¹‹åçš„é‚£ä¸ªè®°äº‹æœ¬ï¼‰ï¼Œå…¶æœ€åŸºæœ¬çš„åŠŸèƒ½æ˜¯æ–‡æ¡£ç¼–è¾‘ã€‚ä¸è¿‡ä¹‹æ‰€ä»¥å°†å…¶ç§°ä¸ºæ˜¯<strong>ä»£ç ç¼–è¾‘å™¨</strong>ï¼Œæ˜¯å› ä¸ºå®ƒè™½ç„¶ç»§æ‰¿è‡ªä¸€èˆ¬çš„æ–‡æ¡£ç¼–è¾‘å™¨ï¼Œåˆå…·å¤‡äº†ä¸€äº›ä¸€èˆ¬çš„æ–‡æ¡£ç¼–è¾‘å™¨æ‰€ä¸å…·å¤‡çš„åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œä¾‹å¦‚è‡ªåŠ¨è¯­æ³•é«˜äº®ï¼Œè‡ªåŠ¨è¡¥å…¨ï¼Œç”šè‡³æ˜¯è‡ªåŠ¨ä»£ç é‡æ„ç­‰ç­‰ã€‚</p><p>é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰æ˜¯ä¸€ç§ç”¨äºæ„å»ºåº”ç”¨ç¨‹åºçš„è½¯ä»¶ï¼Œ<strong>å¯å°†å¸¸ç”¨çš„å¼€å‘äººå‘˜å·¥å…·åˆå¹¶åˆ°å•ä¸ªå›¾å½¢ç”¨æˆ·ç•Œé¢</strong>ï¼ˆGUIï¼‰ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„ç‚¹å‡»æŒ‰é’®ï¼Œå¯èƒ½å°±å¯ä»¥å®Œæˆç¨‹åºçš„ç¼–è¯‘ã€é“¾æ¥ã€è¿è¡Œã€è°ƒè¯•ç­‰ç­‰å·¥ä½œã€‚è€Œè¿™äº›å·¥ä½œåœ¨æœ€åˆéƒ½æ˜¯éœ€è¦äººæ‰‹å·¥åœ¨å‘½ä»¤è¡Œä¸­å®Œæˆçš„ã€‚æˆ‘ä»¬åœ¨ã€Šç¨‹åºè®¾è®¡åŸºç¡€ã€‹è¯¾ç¨‹ä¸­æœ€åˆä½¿ç”¨çš„ Dev-C++ ä¾¿æ˜¯ä¸€ä¸ªé›†æˆå¼€å‘ç¯å¢ƒã€‚</p></blockquote><p>æˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„ VSCode æ˜¯ä¸€æ¬¾è½»é‡çº§çš„<strong>ä»£ç ç¼–è¾‘å™¨</strong>ã€‚å¦‚æœæ²¡æœ‰å„ç§æ‰©å±•æ’ä»¶çš„æ”¯æŒçš„è¯ï¼Œå¯èƒ½æˆ‘ä»¬åªèƒ½æŠŠå®ƒç§°ä½œæ˜¯å¤§å·çš„ Notepad++ï¼Œè€Œæ­£æ˜¯å› ä¸ºç¤¾åŒºä¸­å„ç§å„æ ·çš„æ‰©å±•ï¼ŒVSCode æ‰å¾—ä»¥å±•ç°å…¶å¼ºå¤§ã€‚</p><p><img src="https://s2.loli.net/2022/02/09/psKk8yJ2CxMic1O.png" alt="image-20220209114623794"></p><p>æœ¬æ–‡æˆ‘ä»¬ä»‹ç» VSCode çš„åŸºæœ¬é…ç½®ï¼Œé‡ç‚¹åœ¨äºä»‹ç»ä¸€äº›æœªæ¥å¯èƒ½ä¼šç”¨åˆ°çš„æ‰©å±•æ’ä»¶ã€‚æŒ‰ç…§æœ¬æ–‡çš„æµç¨‹å®Œæˆåï¼Œä½ åº”è¯¥ç­‰æ•ˆåœ°å®Œæˆäº†è¶³ä»¥åº”å¯¹ã€Šé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡åŸºç¡€ã€‹è¯¾ç¨‹ä¸­çš„ä»£ç çš„é›†æˆå¼€å‘ç¯å¢ƒçš„é…ç½®ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šä»‹ç»ä¸€äº›åŸºæœ¬çš„è°ƒè¯•æ–¹æ³•ï¼Œè€Œè¿™æ°æ°æ˜¯ VSCode æ¯” Dev-C++ åœ¨ç°é˜¶æ®µä¸çŸ¥é“é«˜åˆ°å“ªé‡Œå»çš„åœ°æ–¹ã€‚</p><p>äº‹å®ä¸Šï¼Œåœ¨æœªæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ VSCode é…ç½® Python å¼€å‘ç¯å¢ƒï¼Œé…ç½®è½¯ä»¶å·¥ç¨‹è¯¾ç¨‹ä¸­æ‰€éœ€è¦çš„æ¡†æ¶çš„å¼€å‘ç¯å¢ƒï¼Œè€Œè¿™äº›éƒ½æ˜¯é€šè¿‡â€œæ‰©å±•â€ï¼ˆExtensionï¼‰æ¥å®ç°çš„ã€‚</p><a id="more"></a><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><ul><li>äº†è§£ä¸€ä¸ª C++ ç¨‹åºä»æºä»£ç åˆ°å¯æ‰§è¡Œç¨‹åºä¸­å‘ç”Ÿäº†ç¼–è¯‘ã€é“¾æ¥è¿™ä¸¤æ­¥æ“ä½œï¼ˆã€Šç¨‹åºè®¾è®¡åŸºç¡€ã€‹å¤§ä½œä¸šä¸­ä¼šæœ‰æ­¤éƒ¨åˆ†çš„è®²è§£ï¼‰</li><li>åŠ¨æ‰‹èƒ½åŠ›</li></ul><h2 id="ä¸‹è½½ä¸è¿è¡Œ"><a href="#ä¸‹è½½ä¸è¿è¡Œ" class="headerlink" title="ä¸‹è½½ä¸è¿è¡Œ"></a>ä¸‹è½½ä¸è¿è¡Œ</h2><ul><li>æ‰“å¼€ VSCode å®˜ç½‘ï¼š<a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></li><li>ç‚¹å‡»å¤§å¤§çš„ Download æŒ‰é’®ï¼ˆå¦‚æœæ˜¯ Windows 64 ä½ç”¨æˆ·å¯ä»¥ç‚¹å‡»ä¸‹æ‹‰æ¡†é€‰æ‹© x64 å®‰è£…åŒ…ç‰ˆæœ¬ï¼‰</li><li>è¿›è¡Œå®‰è£…æˆ–è§£å‹ç¼©ï¼ˆæ³¨æ„è·¯å¾„ä¸­ä¸èƒ½å­˜åœ¨ä»»ä½•ä¸­æ–‡å­—ç¬¦ï¼Œæ¨èä»…ç”¨å­—æ¯å’Œæ•°å­—ï¼‰</li><li>åˆ°ä½ å®‰è£… VSCode çš„ç›®å½•ä¸‹ï¼Œæ–°å»º <code>data</code> æ–‡ä»¶å¤¹</li></ul><blockquote><p>è¿™é‡Œæˆ‘ä»¬æ–°å»º <code>data</code> æ–‡ä»¶å¤¹åï¼Œä¹‹å VSCode è¿è¡Œæ—¶çš„æ‰©å±•æ’ä»¶å’Œç”¨æˆ·æ•°æ®ä¾¿éƒ½ä¼šå­˜æ”¾åœ¨ <code>data</code> æ–‡ä»¶å¤¹ä¸‹ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…ç³»ç»Ÿç›˜å®¹é‡å ç”¨çš„é—®é¢˜ã€‚å¦‚æœä¸æ–°å»º <code>data</code> æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆ VSCode ä¼šå°†ä¸Šè¿°æ’ä»¶å’Œç”¨æˆ·ä¿¡æ¯å­˜æ”¾åœ¨ç³»ç»Ÿç›˜çš„ç”¨æˆ·ç›®å½•ä¸‹ã€‚</p><p><img src="https://s2.loli.net/2022/02/09/IsPShQ2nLyqmwH8.png" alt="image-20220209213021194"></p></blockquote><h2 id="C-ç›¸å…³å¼€å‘ç¯å¢ƒé…ç½®"><a href="#C-ç›¸å…³å¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="C++ ç›¸å…³å¼€å‘ç¯å¢ƒé…ç½®"></a>C++ ç›¸å…³å¼€å‘ç¯å¢ƒé…ç½®</h2><h3 id="ç¯å¢ƒå˜é‡ä¸-Mingw64"><a href="#ç¯å¢ƒå˜é‡ä¸-Mingw64" class="headerlink" title="ç¯å¢ƒå˜é‡ä¸ Mingw64"></a>ç¯å¢ƒå˜é‡ä¸ Mingw64</h3><p>æˆ‘ä»¬å¯ä»¥å…ˆæ‰“å¼€ç»ˆç«¯ï¼ˆWindows ç”¨æˆ·è¯·ä½¿ç”¨ Win+Rï¼Œè¾“å…¥ <code>cmd</code>ï¼‰ï¼Œå°è¯•è¾“å…¥ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">g++ --version</code></pre><p>å¦‚æœä½ çš„ç»ˆç«¯è¿”å›äº† <code>g++</code> çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ­å–œï¼Œæ‚¨ C++ ç¼–è¯‘å™¨çš„ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€å°èŠ‚ã€‚å½“ç„¶ï¼Œå¦‚æœæƒ³æ›´åŠ è¯¦ç»†åœ°äº†è§£ç¯å¢ƒå˜é‡æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥ç»§ç»­é˜…è¯»è¿™ä¸€å°èŠ‚ã€‚</p><p>è€Œå¦‚æœè¿”å›ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token string">'g++'</span> ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚</code></pre><p>é‚£ä¹ˆåˆ™è¯´æ˜ä½ çš„ç»ˆç«¯ä¸çŸ¥é“ <code>g++</code> æ˜¯ä»€ä¹ˆå‘½ä»¤ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°†é¦–å…ˆè®²è§£ç¯å¢ƒå˜é‡æ˜¯ä»€ä¹ˆï¼Œç„¶åå†ä¸ºå¤§å®¶è®²è¿°è¯¥æ€ä¹ˆé…ç½®ç¯å¢ƒå˜é‡ã€‚</p><ul><li>ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡ï¼Ÿ</li></ul><p>å½“ä½ çš„ Shell åœ¨æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œä¼šå°è¯•åœ¨<strong>ä¸€ç³»åˆ—è·¯å¾„</strong>ä¸‹æœç´¢åŒåçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸€ç³»åˆ—è·¯å¾„æˆ‘ä»¬å°±ç§°ä½œæ˜¯ç¯å¢ƒå˜é‡ã€‚</p><p>Windows ç”¨æˆ·å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ path æ¥æŸ¥çœ‹å½“å‰ç¯å¢ƒå˜é‡ï¼ˆç”±äºæˆ‘è¿›è¡Œè¿‡ä¸€ç³»åˆ—é…ç½®ï¼Œæ‰€ä»¥å…¶è¾“å‡ºç»“æœå¯èƒ½ä¸ä½ çš„ä¸åŒï¼‰ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">D:<span class="token punctuation">\</span>Coding<span class="token operator">></span>path<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>D:<span class="token punctuation">\</span>Anaconda<span class="token punctuation">;</span>D:<span class="token punctuation">\</span>Anaconda<span class="token punctuation">\</span>Library<span class="token punctuation">\</span>mingw-w64<span class="token punctuation">\</span>bin<span class="token punctuation">;</span>D:<span class="token punctuation">\</span>Anaconda<span class="token punctuation">\</span>Library<span class="token punctuation">\</span>usr<span class="token punctuation">\</span>bin<span class="token punctuation">;</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></code></pre><p>Linux ç”¨æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>echo $PATH</code> æ¥æŸ¥çœ‹è‡ªå·±çš„ç¯å¢ƒå˜é‡ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">c7w@cc7w <span class="token operator">></span> /mnt/d/Coding <span class="token operator">></span> <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>/home/c7w/.local/lib/python3.8/site-packages:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/mnt/d/Anaconda:/mnt/d/Anaconda/Library/mingw-w64/bin:/mnt/d/Anaconda/Library/usr/bin:/mnt/d/Anaconda/Library/bin:/mnt/d/Anaconda/Scripts:/mnt/f/VM/bin/:/mnt/c/Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>/Common Files/Intel/Shared Libraries/redist/intel64/compiler:/mnt/c/Program Files/Common Files/Oracle/Java/javapath:<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></code></pre><p>æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¸€ç³»åˆ—æ–‡ä»¶å¤¹ã€‚å›å¿†æˆ‘ä»¬åˆšæ‰æ‰§è¡Œ <code>g++ --version</code> å‘½ä»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ç»ˆç«¯ä¼šåœ¨è¿™ä¸€ç³»åˆ—æ–‡ä»¶å¤¹ä¸‹ä¸ºæˆ‘ä»¬å¯»æ‰¾å«åš <code>g++</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚æœæ‰¾åˆ°äº†åä¸º <code>g++</code> çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬çš„ç»ˆç«¯å°±ä¼šå°†å‚æ•°ä¼ å…¥ï¼Œå°†å…¶æ‰§è¡Œï¼›è€Œå¦‚æœæˆ‘ä»¬çš„ç»ˆç«¯æ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šå‘æˆ‘ä»¬æŠ¥å‘Šâ€œæœªçŸ¥å‘½ä»¤â€ã€‚</p><p>æˆ‘ä»¬åˆšåˆšå·²ç»ç†è§£äº†â€œç¯å¢ƒå˜é‡ï¼ˆPathï¼‰â€çš„è¿è¡Œé€»è¾‘ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è®²è§£å¦‚ä½•è¿›è¡Œç¯å¢ƒå˜é‡çš„é…ç½®ã€‚`</p><p>å¯¹äº Windows ç”¨æˆ·ï¼Œè¯·æŒ‰ä¸‹ Windows + S æ‰“å¼€æœç´¢æ¡†ï¼Œåœ¨å…¶ä¸­è¾“å…¥ <code>path</code>ï¼Œç„¶åé€‰æ‹©â€ç¼–è¾‘ç³»ç»Ÿç¯å¢ƒå˜é‡â€ï¼Œè¿›è€Œé€‰æ‹©â€œç¯å¢ƒå˜é‡â€ï¼Œç„¶åé€‰æ‹©â€œç³»ç»Ÿå˜é‡â€ä¸­çš„ Path å­—æ®µï¼ŒåŒå‡»æ‰“å¼€åå³å¯é…ç½®ã€‚</p><p><img src="https://s2.loli.net/2022/02/09/L9DhPnOjNZ58gCV.png" alt="image-20220209214212982"></p><p>å¯¹äº Linux ç”¨æˆ·ï¼Œç¯å¢ƒå˜é‡æ˜¯ç»‘å®šåœ¨ä½ çš„ Shell ä¸Šçš„ï¼Œä¸åŒçš„ Shell æœ‰ä¸åŒçš„é…ç½®æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬æä¾›ä¸€ä¸ª<a href="https://www.cnblogs.com/youyoui/p/10680329.html">é“¾æ¥</a>å¸®åŠ©æ‚¨äº†è§£ç¯å¢ƒå˜é‡çš„ç›¸å…³é…ç½®ã€‚</p><ul><li>ä»€ä¹ˆæ˜¯ Mingw64ï¼Ÿ</li></ul><blockquote><p>MinGW çš„å…¨ç§°æ˜¯ï¼šMinimalist GNU on Windowsã€‚</p><p>å®ƒå®é™…ä¸Šæ˜¯å°†ç»å…¸çš„å¼€æº C è¯­è¨€ç¼–è¯‘å™¨ GCC ç§»æ¤åˆ°äº† Windows å¹³å°ä¸‹ï¼Œå¹¶ä¸”åŒ…å«äº† Win32APIï¼Œå› æ­¤å¯ä»¥å°†æºä»£ç ç¼–è¯‘ä¸ºå¯åœ¨ Windows ä¸­è¿è¡Œçš„å¯æ‰§è¡Œç¨‹åºã€‚è€Œä¸”è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº› Windows ä¸å…·å¤‡çš„ï¼ŒLinuxå¹³å°ä¸‹çš„å¼€å‘å·¥å…·ã€‚</p><p>ä¸€å¥è¯æ¥æ¦‚æ‹¬ï¼šMinGW å°±æ˜¯ GCC çš„ Windows ç‰ˆæœ¬ã€‚è¿™æ˜¯å°†ä½ å†™çš„ C/C++ è¯­è¨€çš„æºä»£ç ç¼–è¯‘æˆæ±‡ç¼–ä»£ç ï¼Œè¿›è€Œé“¾æ¥æˆå¯æ‰§è¡Œæ–‡ä»¶çš„å·¥å…·ã€‚ä¹‹å‰æˆ‘ä»¬çš„ Dev-C++ äº‹å®ä¸Šä¹Ÿé›†æˆäº†è¿™ä¸ªå·¥å…·ã€‚</p></blockquote><p>æˆ‘ä»¬ä¸‹è½½å®˜æ–¹çš„å®‰è£…å·¥å…·ï¼ˆ<a href="https://sourceforge.net/projects/mingw-w64/files/Toolchains%20targetting%20Win32/Personal%20Builds/mingw-builds/installer/mingw-w64-install.exe">é“¾æ¥</a>ï¼‰ï¼Œä¸‹è½½å®Œæˆåå³é”®ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œ<code>Architecture</code> ä¸­ <code>i686</code> æ˜¯é’ˆå¯¹äº 32 ä½ç³»ç»Ÿï¼Œ<code>x86_64</code> é’ˆå¯¹äº 64 ä½ç³»ç»Ÿï¼Œå…¶ä»–ä¸ç”¨ä¿®æ”¹ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥é€‰æ‹©å®‰è£…ç›®å½•å³å¯ã€‚ç„¶åå³å¯ç­‰å¾…å®‰è£…ç¨‹åºä¸‹è½½å¹¶è¿›è¡Œå®‰è£…ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œç¯å¢ƒå˜é‡é…ç½®ã€‚è¿›å…¥ <code>Mingw64 çš„å®‰è£…è·¯å¾„/mingw64/bin/</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>gcc</code>ï¼Œ<code>g++</code> è¿™äº›æˆ‘ä»¬ç†Ÿæ‚‰çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚<strong>ç„¶åæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†è¿™ä¸ªæ–‡ä»¶å¤¹æ·»åŠ è‡³ç¯å¢ƒå˜é‡ä¸­ã€‚</strong></p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ <code>g++</code> éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æˆåŠŸã€‚ï¼ˆè¯·æ³¨æ„ï¼Œåœ¨ç¯å¢ƒå˜é‡é…ç½®åéœ€è¦é‡å¯ç»ˆç«¯æ‰èƒ½ç”Ÿæ•ˆï¼‰</p><h3 id="Make"><a href="#Make" class="headerlink" title="Make"></a>Make</h3><p>åŒæ—¶ï¼Œé’ˆå¯¹äºæˆ‘ä»¬ä¹‹åè¯¾ä¸Šæ‰€éœ€è¦ç”¨åˆ°çš„ <code>make</code> å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŒç›®å½•ä¸‹çš„ <code>mingw32-make.exe</code> å¤åˆ¶ä¸€ä»½ï¼Œæ”¹åä¸º <code>make.exe</code>ï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ <code>make</code> å‘½ä»¤äº†ã€‚</p><p>ç”±äº Linux å¹³å°è‡ªå¸¦äº† <code>gcc</code> å’Œ <code>make</code> ç­‰ç­‰ç¼–è¯‘å·¥å…·ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦è¿›è¡Œé¢å¤–çš„é…ç½®ã€‚</p><h2 id="æ‰©å±•æ’ä»¶çš„å®‰è£…"><a href="#æ‰©å±•æ’ä»¶çš„å®‰è£…" class="headerlink" title="æ‰©å±•æ’ä»¶çš„å®‰è£…"></a>æ‰©å±•æ’ä»¶çš„å®‰è£…</h2><p>æˆ‘ä»¬æ‰“å¼€ VSCodeï¼Œå…ˆç®€å•ä»‹ç»ä¸‹ç•Œé¢åŠå…¶åŠŸèƒ½ï¼š</p><p><img src="https://s2.loli.net/2022/02/09/pM6kzGH4xbIRW5K.png" alt="image-20220209220846472"></p><p>çº¢è‰²æ¡†æ˜¯æˆ‘ä»¬å½“å‰é¡¹ç›®ï¼ˆå³æ–‡ä»¶å¤¹ï¼‰ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ¸…å•ï¼Œè“è‰²æ¡†æ˜¯æˆ‘ä»¬ç¼–å†™ä»£ç çš„åœ°æ–¹ï¼Œç»¿è‰²æ¡†æ˜¯æˆ‘ä»¬çš„åº”ç”¨å•†åº—ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æ¨èå‡ ä¸ªæ‰©å±•ï¼Œåœ¨åº”ç”¨å•†åº—ä¸­æœç´¢å³å¯ä¸‹è½½ï¼š</p><ul><li>Chinese (Simplified) Language Pack for Visual Studio Codeï¼šè¯­è¨€</li><li>Code Runnerï¼šè°ƒè¯•ç”¨</li><li>C/C++ï¼šæ”¯æŒåœ¨ Code ä¸­è°ƒè¯• C/C++ ç¨‹åº</li><li>Remote - SSHï¼šä¹‹åè¿›è¡Œè¿œç¨‹å¼€å‘ä¼šç”¨åˆ°ï¼Œè¿™é‡Œä¸å¤šåšä»‹ç»</li></ul><p>åœ¨å®‰è£…äº†ç®€ä½“ä¸­æ–‡æ’ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ <code>Ctrl + Shift + P</code>ï¼Œæ‰“å¼€è¾“å…¥æ¡†ï¼Œè¾“å…¥ <code>Configurate display language</code>ï¼Œé€‰æ‹©ä¸­æ–‡åé‡æ–°å¯åŠ¨å³å¯ã€‚</p><h2 id="ä»£ç è°ƒè¯•"><a href="#ä»£ç è°ƒè¯•" class="headerlink" title="ä»£ç è°ƒè¯•"></a>ä»£ç è°ƒè¯•</h2><p>å¦‚ä½•è¿è¡Œä¸€æ®µä»£ç å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<strong>å¯¹åº”çš„ä»£ç ç•Œé¢</strong>æŒ‰ä¸‹ <code>F5</code> æˆ–æ˜¯åœ¨èœå•æ æ‰¾åˆ°â€œè¿è¡Œ &gt; å¯åŠ¨è°ƒè¯•â€ï¼Œä¾¿å¯ä»¥å¯åŠ¨è°ƒè¯•æ¨¡å¼ï¼š</p><p><img src="https://s2.loli.net/2022/02/09/x6yBiPzfVAQsErZ.png" alt="image-20220209221547145"></p><p>åœ¨é…ç½®ä¸­é€‰æ‹© <code>C++ (GDB)</code>ï¼Œè¿›è€Œé€‰æ‹© <code>g++.exe</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬ä¼šå‘ç°é¡¹ç›®è·¯å¾„ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª <code>.vscode</code> æ–‡ä»¶å¤¹ï¼Œå†…å« <code>tasks.json</code> å’Œ <code>launch.json</code>ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨æˆ‘ä»¬å³å°†å°±ä¼šè¿›è¡Œä»‹ç»ã€‚</p><p><img src="https://s2.loli.net/2022/02/09/pwDenGirIJZdjsv.png" alt="image-20220209221657511"></p><p>ï¼ˆä½ çš„ç•Œé¢æ’ç‰ˆå¯èƒ½å’Œæˆ‘æœ‰æ‰€ä¸åŒï¼Œä¸è¿‡ä¸»è¦åŠŸèƒ½æ˜¯å¤§åŒå°å¼‚çš„ï¼Œå½“ä½ ç†Ÿç»ƒè¿ç”¨äº† Code ä¹‹åä½ å¯ä»¥è‡ªè¡Œå°†è¿™å‡ ä¸ªæ¡†æ¡†æ‹–æ¥æ‹–å»æ‘†åˆ°ä½ è§‰å¾—èˆ’é€‚çš„ä½ç½®ï¼‰</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥å°†åˆ†å•æ–‡ä»¶é¡¹ç›®å’Œå¤šæ–‡ä»¶é¡¹ç›®è¿›è¡Œè®¨è®ºï¼Œè¯´æ˜ä¸€äº›åœ¨ Code ä¸­è°ƒè¯• C++ ä»£ç çš„æŠ€å·§ã€‚</p><h3 id="å•æ–‡ä»¶é¡¹ç›®"><a href="#å•æ–‡ä»¶é¡¹ç›®" class="headerlink" title="å•æ–‡ä»¶é¡¹ç›®"></a>å•æ–‡ä»¶é¡¹ç›®</h3><p>å•æ–‡ä»¶é¡¹ç›®æŒ‡åªæœ‰ä¸€ä¸ª cpp æ–‡ä»¶çš„é¡¹ç›®ï¼Œ<code>main()</code> å‡½æ•°çš„å®šä¹‰å°±åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬åœ¨ã€Šç¨‹åºè®¾è®¡åŸºç¡€ã€‹è¯¾ç¨‹çš„å¤§éƒ¨åˆ†å¹³æ—¶ä½œä¸šéƒ½æ˜¯è¿™ç§é¡¹ç›®ã€‚</p><p>è¿™ç§é¡¹ç›®æˆ‘ä»¬ç›´æ¥æŒ‰ <code>F5</code> ä¾¿å¯è¿›è¡Œè¿è¡Œï¼Œå…¶è¾“å‡ºç»“æœä¼šåœ¨â€œç»ˆç«¯â€é€‰é¡¹å¡ä¸­å‡ºç°ã€‚</p><p><img src="https://s2.loli.net/2022/02/09/UO5mv1K3VBcN2lL.png" alt="image-20220209222124275"></p><p>è¿™æ˜¯ä¸€æ®µæ¼”ç¤ºå•å‘å¹³æ–¹å’ŒåŒå‘å¹³æ–¹æ¢æµ‹åœ¨å“ˆå¸Œè¡¨ä¸­å¯ä»¥å ç”¨çš„ä½ç½®çš„ç¤ºä¾‹ç¨‹åºï¼Œåœ¨è¿™é‡Œä»…åšè¯´æ˜ä½¿ç”¨ï¼Œå¤§å®¶ä¸å¿…ç†è§£å…¶èƒŒåçš„åŸç†ã€‚ï¼ˆäº‹å®ä¸Šä½ ç»™åˆ«äººè°ƒä»£ç çš„æ—¶å€™ä¸éƒ½æ˜¯è¿™æ ·å˜›ï¼Œå¯¹ç€çœ‹ä¸æ‡‚çš„é€»è¾‘æ»¡è„¸é»‘çº¿.jpegï¼‰</p><p>æƒ³è¦åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è®¾ç½®æ–­ç‚¹ï¼Œæˆ‘ä»¬åªéœ€ç‚¹å‡»å¯¹åº”çš„è¡Œå·ï¼š</p><p><img src="https://s2.loli.net/2022/02/09/ZVFLrcwSbaOdxTm.png" alt="image-20220209222401148"></p><p>åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹ï¼Œç¨‹åºå°†ä¼šåœ¨ç¬¬ 30 è¡Œæ‰§è¡Œå®Œæˆï¼Œç¬¬ 31 è¡Œå°†è¦æ‰§è¡Œçš„æ—¶å€™è§¦å‘æ–­ç‚¹ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€çœ‹ï¼š</p><p><img src="https://s2.loli.net/2022/02/09/5tHAOwQBdh1Sqcs.png" alt="image-20220209222500324"></p><p>çº¢æ¡†ï¼Œä¹Ÿå°±æ˜¯â€œç»ˆç«¯æ¡†ä¸­ï¼Œæˆ‘ä»¬çš„ç¨‹åºè¾“å‡ºäº†å‰åŠæ®µè¿è¡Œæ—¶äº§ç”Ÿçš„ <code>cout</code> ä¿¡æ¯ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¯´æ˜è¯¥å¦‚ä½•æŸ¥çœ‹ä¸­é—´å˜é‡ï¼š</p><p><img src="https://s2.loli.net/2022/02/09/UEioypzr9fa57GK.png" alt="image-20220209222635735"></p><p>æ¯”å¦‚ç¨‹åºåœ¨å‘½ä¸­è¿™ä¸ªæ–­ç‚¹æ—¶ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹é€”å¾„è·å–ä¸­é—´å˜é‡çš„å€¼ï¼š</p><p>åœ¨é»„è‰²æ¡†â€œå˜é‡â€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¨‹åºè‡ªåŠ¨è¿½æº¯çš„å±€éƒ¨å˜é‡å’Œå¯„å­˜å™¨å€¼ã€‚åœ¨è“è‰²æ¡†â€œç›‘è§†â€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œå®šä¹‰ä¸€äº›éœ€è¦è¿½æº¯çš„å˜é‡ã€‚åœ¨çº¢è‰²æ¡†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å…¥å˜é‡åæ¥æŸ¥çœ‹å…¶å¯¹åº”çš„å€¼ã€‚</p><p><img src="https://s2.loli.net/2022/02/09/jAlCZgHIYphwoDv.png" alt="image-20220209222812673"></p><p>ç„¶åï¼Œæˆ‘ä»¬æ¥å°†ç›®å…‰æ”¾åœ¨ä¸Šè¿°è¿™å‡ ä¸ªæŒ‰é’®èº«ä¸Šã€‚</p><ul><li>ç»§ç»­ï¼ˆF5ï¼‰æŒ‰é’®å°†ä¼šä½¿ç¨‹åºç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å‘½ä¸­ä¸‹ä¸€ä¸ªæ–­ç‚¹æˆ–æ˜¯åˆ°ç¨‹åºç»“å°¾ã€‚</li><li>å•æ­¥è·³è¿‡ï¼ˆF10ï¼‰æŒ‰é’®å¯¹äºç¨‹åºæ¥è¯´ï¼Œå¦‚æœå°†è¦æ‰§è¡Œçš„è¡Œè°ƒç”¨äº†æŸäº›å‡½æ•°ï¼Œé‚£ä¹ˆå°†ç›´æ¥å°†æœ¬è¡Œæ‰§è¡Œå®Œæ¯•ï¼Œè¿›å…¥ä¸‹ä¸€è¡Œã€‚</li><li>å•æ­¥è°ƒè¯•ï¼ˆF11ï¼‰æŒ‰é’®å¯¹äºç¨‹åºæ¥è¯´ï¼Œå¦‚æœå°†è¦æ‰§è¡Œçš„è¡Œè°ƒç”¨äº†æŸäº›å‡½æ•°ï¼Œé‚£ä¹ˆå°†è¿›å…¥å°†è¦æ‰§è¡Œçš„å‡½æ•°å†…éƒ¨ã€‚</li><li>åœæ­¢ï¼ˆShift+F5ï¼‰æŒ‰é’®ç»ˆæ­¢å½“å‰è°ƒè¯•å·¥ä½œã€‚</li></ul><h3 id="å¤šæ–‡ä»¶é¡¹ç›®"><a href="#å¤šæ–‡ä»¶é¡¹ç›®" class="headerlink" title="å¤šæ–‡ä»¶é¡¹ç›®"></a>å¤šæ–‡ä»¶é¡¹ç›®</h3><p>å¯¹äºå¤šæ–‡ä»¶é¡¹ç›®çš„è°ƒè¯•æ¥è¯´ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ç‚¹åœ¨äº <code>.vscode</code> ä¸‹ä¸¤ä¸ªæ–‡ä»¶çš„é…ç½®ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å°†æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºä¿®æ”¹ä¸ºå¤šæ–‡ä»¶é¡¹ç›®ï¼š</p><p><img src="https://s2.loli.net/2022/02/09/IBLJmUG7NCy1ikv.png" alt="image-20220209223422595"></p><p>æˆ‘ä»¬é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼ï¼Œå°†æˆ‘ä»¬çš„å•æ–‡ä»¶é¡¹ç›®é­”æ”¹æˆå¤šæ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬å›å¿†å¦‚æœä½¿ç”¨å‘½ä»¤è¡Œï¼Œè¯¥å¦‚ä½•å°†æˆ‘ä»¬çš„ç¨‹åºç¼–è¯‘ï¼š</p><pre class="language-bash'" data-language="bash'"><code class="language-bash'">g++ hash.cpp another.cpp -o main</code></pre><p>æ²¡é”™ï¼Œæˆ‘ä»¬ç°åœ¨é…ç½® Code ä½¿å¾—å…¶åœ¨â€œç”Ÿæˆç›®æ ‡æ–‡ä»¶â€ä»»åŠ¡ä¸­æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚</p><p><code>tasks.json</code> è´Ÿè´£å¯æ‰§è¡Œæ–‡ä»¶çš„ç”Ÿæˆï¼Œæˆ‘ä»¬ä¸»è¦è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"tasks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span> <span class="token comment">// cppbuild -> shell</span>            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"C/C++: g++.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶"</span><span class="token punctuation">,</span>            <span class="token property">"command"</span><span class="token operator">:</span> <span class="token string">"D:\\Mingw\\mingw64\\bin\\g++.exe"</span><span class="token punctuation">,</span>            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"-g"</span><span class="token punctuation">,</span>                <span class="token string">"hash.cpp"</span><span class="token punctuation">,</span> <span class="token comment">// $&#123;file&#125; -> your source code list</span>                <span class="token string">"another.cpp"</span><span class="token punctuation">,</span>                <span class="token string">"-o"</span><span class="token punctuation">,</span>                <span class="token string">"$&#123;fileDirname&#125;\\main.exe"</span> <span class="token comment">// main.exe</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"$&#123;fileDirname&#125;"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"problemMatcher"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"$gcc"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"group"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>                <span class="token property">"isDefault"</span><span class="token operator">:</span> <span class="token boolean">true</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"detail"</span><span class="token operator">:</span> <span class="token string">"è°ƒè¯•å™¨ç”Ÿæˆçš„ä»»åŠ¡ã€‚"</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">&#125;</span></code></pre><p><code>launch.json</code> ä¸»è¦è´Ÿè´£è°ƒè¯•ç›®æ ‡ç¨‹åºï¼Œæˆ‘ä»¬åšä»¥ä¸‹ä¿®æ”¹ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token comment">// ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ </span>    <span class="token comment">// æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚</span>    <span class="token comment">// æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"g++.exe - ç”Ÿæˆå’Œè°ƒè¯•æ´»åŠ¨æ–‡ä»¶"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"cppdbg"</span><span class="token punctuation">,</span>            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;fileDirname&#125;\\main.exe"</span><span class="token punctuation">,</span> <span class="token comment">// main.exe</span>            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"stopAtEntry"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"$&#123;fileDirname&#125;"</span><span class="token punctuation">,</span>            <span class="token property">"environment"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"externalConsole"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"MIMode"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>            <span class="token property">"miDebuggerPath"</span><span class="token operator">:</span> <span class="token string">"D:\\Mingw\\mingw64\\bin\\gdb.exe"</span><span class="token punctuation">,</span>            <span class="token property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">&#123;</span>                    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"ä¸º gdb å¯ç”¨æ•´é½æ‰“å°"</span><span class="token punctuation">,</span>                    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"-enable-pretty-printing"</span><span class="token punctuation">,</span>                    <span class="token property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">true</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"C/C++: g++.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶"</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span></code></pre><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«åœ°è°ƒè¯•å¤šæ–‡ä»¶é¡¹ç›®äº†ã€‚</p><h2 id="åç»­å­¦ä¹ "><a href="#åç»­å­¦ä¹ " class="headerlink" title="åç»­å­¦ä¹ "></a>åç»­å­¦ä¹ </h2><ul><li>è‡ªè¡Œç ”ç©¶ Remote-SSH çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚ä½•è¿æ¥åˆ°å¤–éƒ¨æœåŠ¡å™¨è¿›è¡Œå¼€å‘</li><li>è‡ªè¡Œç ”ç©¶ Python é…ç½®è°ƒè¯•ç¯å¢ƒçš„æ–¹æ³•</li><li>åœ¨ã€Šè½¯ä»¶å·¥ç¨‹ã€‹è¯¾ç¨‹ä¸­ï¼Œä½¿ç”¨ Code Prettier æ’ä»¶ + ESLint è§„èŒƒé¡¹ç›®</li></ul><h2 id="èµ„æºé“¾æ¥"><a href="#èµ„æºé“¾æ¥" class="headerlink" title="èµ„æºé“¾æ¥"></a>èµ„æºé“¾æ¥</h2><ul><li><a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></li><li><a href="https://zhuanlan.zhihu.com/p/76613134">https://zhuanlan.zhihu.com/p/76613134</a></li><li><a href="https://blog.csdn.net/linjf520/article/details/108559210">https://blog.csdn.net/linjf520/article/details/108559210</a></li></ul><p>Tips: é…ç½®å¼€å‘ç¯å¢ƒå¾€å¾€æ˜¯åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æœ€æ¼äººçš„ä¸€ä»¶äº‹ï¼Œä½†æ˜¯ä¸ç”¨å¿ƒæ€¥ï¼Œå¸¸è¨€é“â€œè‰¯å¥½çš„å¼€ç«¯æ˜¯æˆåŠŸçš„ä¸€åŠâ€ã€‚å¦‚æœå®åœ¨é‡åˆ°é…ç½®é—®é¢˜ï¼Œåœ¨è¿›è¡Œæœç´¢æ— æ³•è§£å†³åï¼Œå»ºè®®å‘åŒå¹´çº§/å­¦é•¿/ç­”ç–‘åŠè¿›è¡Œæ±‚åŠ©ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;VSCode æ˜¯ä¸€æ¬¾&lt;strong&gt;è½»é‡çº§&lt;/strong&gt;çš„&lt;strong&gt;ä»£ç ç¼–è¾‘å™¨&lt;/strong&gt;ï¼Œå¯ä»¥é€šè¿‡å®‰è£…å„ç§å„æ ·ä¸åŒ&lt;strong&gt;æ‰©å±•&lt;/strong&gt;çš„æ–¹å¼æ¥å®ç°å¼€å‘è€…æ‰€éœ€è¦çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åŒºåˆ†ï¼šä»£ç ç¼–è¾‘å™¨ï¼ˆEditorï¼‰ä¸é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDE, Integrated Development Environmentï¼‰&lt;/p&gt;
&lt;p&gt;ä»£ç ç¼–è¾‘å™¨äº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªè®°äº‹æœ¬ï¼ˆæ²¡é”™ï¼Œå¦‚æœæ˜¯ Windows ç”¨æˆ·ï¼Œå°±æ˜¯ä½ æŒ‰ä¸‹ Win+R è¾“å…¥ notepad å›è½¦ä¹‹åçš„é‚£ä¸ªè®°äº‹æœ¬ï¼‰ï¼Œå…¶æœ€åŸºæœ¬çš„åŠŸèƒ½æ˜¯æ–‡æ¡£ç¼–è¾‘ã€‚ä¸è¿‡ä¹‹æ‰€ä»¥å°†å…¶ç§°ä¸ºæ˜¯&lt;strong&gt;ä»£ç ç¼–è¾‘å™¨&lt;/strong&gt;ï¼Œæ˜¯å› ä¸ºå®ƒè™½ç„¶ç»§æ‰¿è‡ªä¸€èˆ¬çš„æ–‡æ¡£ç¼–è¾‘å™¨ï¼Œåˆå…·å¤‡äº†ä¸€äº›ä¸€èˆ¬çš„æ–‡æ¡£ç¼–è¾‘å™¨æ‰€ä¸å…·å¤‡çš„åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œä¾‹å¦‚è‡ªåŠ¨è¯­æ³•é«˜äº®ï¼Œè‡ªåŠ¨è¡¥å…¨ï¼Œç”šè‡³æ˜¯è‡ªåŠ¨ä»£ç é‡æ„ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰æ˜¯ä¸€ç§ç”¨äºæ„å»ºåº”ç”¨ç¨‹åºçš„è½¯ä»¶ï¼Œ&lt;strong&gt;å¯å°†å¸¸ç”¨çš„å¼€å‘äººå‘˜å·¥å…·åˆå¹¶åˆ°å•ä¸ªå›¾å½¢ç”¨æˆ·ç•Œé¢&lt;/strong&gt;ï¼ˆGUIï¼‰ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„ç‚¹å‡»æŒ‰é’®ï¼Œå¯èƒ½å°±å¯ä»¥å®Œæˆç¨‹åºçš„ç¼–è¯‘ã€é“¾æ¥ã€è¿è¡Œã€è°ƒè¯•ç­‰ç­‰å·¥ä½œã€‚è€Œè¿™äº›å·¥ä½œåœ¨æœ€åˆéƒ½æ˜¯éœ€è¦äººæ‰‹å·¥åœ¨å‘½ä»¤è¡Œä¸­å®Œæˆçš„ã€‚æˆ‘ä»¬åœ¨ã€Šç¨‹åºè®¾è®¡åŸºç¡€ã€‹è¯¾ç¨‹ä¸­æœ€åˆä½¿ç”¨çš„ Dev-C++ ä¾¿æ˜¯ä¸€ä¸ªé›†æˆå¼€å‘ç¯å¢ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬ä»Šå¤©è¦ä»‹ç»çš„ VSCode æ˜¯ä¸€æ¬¾è½»é‡çº§çš„&lt;strong&gt;ä»£ç ç¼–è¾‘å™¨&lt;/strong&gt;ã€‚å¦‚æœæ²¡æœ‰å„ç§æ‰©å±•æ’ä»¶çš„æ”¯æŒçš„è¯ï¼Œå¯èƒ½æˆ‘ä»¬åªèƒ½æŠŠå®ƒç§°ä½œæ˜¯å¤§å·çš„ Notepad++ï¼Œè€Œæ­£æ˜¯å› ä¸ºç¤¾åŒºä¸­å„ç§å„æ ·çš„æ‰©å±•ï¼ŒVSCode æ‰å¾—ä»¥å±•ç°å…¶å¼ºå¤§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2022/02/09/psKk8yJ2CxMic1O.png&quot; alt=&quot;image-20220209114623794&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æˆ‘ä»¬ä»‹ç» VSCode çš„åŸºæœ¬é…ç½®ï¼Œé‡ç‚¹åœ¨äºä»‹ç»ä¸€äº›æœªæ¥å¯èƒ½ä¼šç”¨åˆ°çš„æ‰©å±•æ’ä»¶ã€‚æŒ‰ç…§æœ¬æ–‡çš„æµç¨‹å®Œæˆåï¼Œä½ åº”è¯¥ç­‰æ•ˆåœ°å®Œæˆäº†è¶³ä»¥åº”å¯¹ã€Šé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡åŸºç¡€ã€‹è¯¾ç¨‹ä¸­çš„ä»£ç çš„é›†æˆå¼€å‘ç¯å¢ƒçš„é…ç½®ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šä»‹ç»ä¸€äº›åŸºæœ¬çš„è°ƒè¯•æ–¹æ³•ï¼Œè€Œè¿™æ°æ°æ˜¯ VSCode æ¯” Dev-C++ åœ¨ç°é˜¶æ®µä¸çŸ¥é“é«˜åˆ°å“ªé‡Œå»çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šï¼Œåœ¨æœªæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ VSCode é…ç½® Python å¼€å‘ç¯å¢ƒï¼Œé…ç½®è½¯ä»¶å·¥ç¨‹è¯¾ç¨‹ä¸­æ‰€éœ€è¦çš„æ¡†æ¶çš„å¼€å‘ç¯å¢ƒï¼Œè€Œè¿™äº›éƒ½æ˜¯é€šè¿‡â€œæ‰©å±•â€ï¼ˆExtensionï¼‰æ¥å®ç°çš„ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/ç»¼åˆ" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-%E7%BB%BC%E5%90%88/"/>
    
    
    <category term="VSCode" scheme="https://www.c7w.tech/tags/VSCode/"/>
    
  </entry>
  
  <entry>
    <title>ExpressJS é¡¹ç›®å¼€å‘æŒ‡åŒ—</title>
    <link href="https://www.c7w.tech/express-js/"/>
    <id>https://www.c7w.tech/express-js/</id>
    <published>2022-02-08T10:58:10.000Z</published>
    <updated>2022-02-08T16:14:35.861Z</updated>
    
    <content type="html"><![CDATA[<p>Express æ˜¯ä¸€ä¸ªç®€æ´è€Œçµæ´»çš„ Node.js Web åº”ç”¨æ¡†æ¶, æä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§ç‰¹æ€§å¸®åŠ©ä½ åˆ›å»ºå„ç§ Web åº”ç”¨ï¼Œå’Œä¸°å¯Œçš„ HTTP å·¥å…·ã€‚</p><p>ä½¿ç”¨ Express å¯ä»¥å¿«é€Ÿåœ°æ­å»ºä¸€ä¸ªå®Œæ•´åŠŸèƒ½çš„ç½‘ç«™ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ›´å€¾å‘äºä½¿ç”¨ Express æ¥å¿«é€Ÿæ­å»º<strong>ç½‘ç«™åç«¯</strong>ã€‚</p><p>æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ç½‘ç«™åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œäº‹å®ä¸Šä¸æˆ‘ä»¬åœ¨ã€Šç¨‹åºè®¾è®¡è®­ç»ƒã€‹è¯¾ç¨‹ä¸­å¯¹äºä½¿ç”¨ Django æ¥æ­å»ºç½‘ç«™çš„æ–¹å¼ä¸åŒã€‚Django çš„é¡µé¢æ¸²æŸ“æ˜¯<strong>æœåŠ¡å™¨ç«¯æ¸²æŸ“</strong>ï¼ˆServer-side Renderingï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ”¶åˆ°ç”¨æˆ·å‘æ¥çš„è¯·æ±‚åï¼ŒæœåŠ¡å™¨ç«¯æŒ‰ç…§è®¾è®¡çš„é€»è¾‘è¯»å–ç›¸åº”çš„é¡µé¢æ¨¡æ¿ï¼Œåœ¨å®Œæˆé¡µé¢æ¸²æŸ“ï¼ˆä¹Ÿå°±æ˜¯åœ¨é¡µé¢æ¨¡æ¿çš„å¯¹åº”å¤„å¡«å……å¯¹åº”å­—æ®µï¼‰åï¼Œå°†æ¸²æŸ“åçš„ HTML é¡µé¢ç›´æ¥å‘ç»™ç”¨æˆ·ã€‚</p><p>è€Œè¿™é‡Œæˆ‘ä»¬å°†ç½‘ç«™åˆ†ä¸ºâ€œå‰ç«¯â€å’Œâ€œåç«¯â€ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å’Œä¸Šè¿°æœåŠ¡å™¨ç«¯æ¸²æŸ“æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸º<strong>å®¢æˆ·ç«¯æ¸²æŸ“</strong>ï¼ˆClient-side Renderingï¼‰ã€‚å…¶è¿ä½œæ¨¡å¼æ˜¯ï¼Œç½‘ç«™æä¾›æœåŠ¡å™¨ç›´æ¥å°†æœªæ¸²æŸ“çš„ HTML æ¨¡æ¿ï¼ˆæˆ‘ä»¬ç§°ä¸ºâ€œå‰ç«¯ä»£ç â€ï¼‰å‘é€ç»™ç”¨æˆ·ï¼Œè€Œè¿™æ¨¡æ¿ä¸­åŒ…å«äº†ç±»ä¼¼äº <code>fetch</code> çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨å°†å…¶æ¸²æŸ“æ—¶å‘æˆ‘ä»¬çš„â€œåç«¯â€å‘é€è¯·æ±‚ã€‚â€œåç«¯â€åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¸€èˆ¬ä»¥ Json æ ¼å¼è¿”å›æ‰€è¯·æ±‚çš„æ•°æ®ï¼Œå‰ç«¯å†é€šè¿‡ Javascript è„šæœ¬å°†æ”¶åˆ°çš„æ•°æ®æ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚</p><p>åœ¨ã€Šè½¯ä»¶å·¥ç¨‹ã€‹è¯¾ç¨‹ä¸­æˆ‘ä»¬æ¨èä½¿ç”¨åè€…è¿™ç§è®¾è®¡æ¨¡å¼ï¼Œå³è¿›è¡Œå‰åç«¯åˆ†ç¦»ã€‚è™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»§ç»­åˆ©ç”¨ Django æ¥ä½œä¸ºåç«¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œç»™å¤§å®¶æä¾›ä¸€ç§ä¸šç•Œä¹Ÿå¾ˆå¸¸ç”¨çš„é€‰é¡¹ â€”â€” Expressã€‚å…¶ä¼˜ç‚¹åœ¨äºï¼Œç›¸æ¯”äº Django è€Œè¨€ï¼Œå…¶ç¼–å†™èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿæ›´åŠ å¿«æ·ã€‚<s>è€Œä¸”ï¼Œåç«¯æ›´åŠ é è¿‘ <code>npm</code> è¿™ä¸ªè½®å­å·¥å‚ï¼Œå¯¹äºæˆ‘ä»¬è¿›è¡Œå¤§è°ƒåº“ä¹Ÿæ›´åŠ çš„æ–¹ä¾¿ã€‚å½“ç„¶ï¼Œå› ä¸º Javascript ä»¤äºº**çš„è®¾è®¡ï¼Œä¹Ÿä¼šæ”¶è·æ›´åŠ é…¸çˆ½çš„ Debug ä½“éªŒã€‚</s></p><p>æœ¬æ–‡æˆ‘ä»¬ä¾§é‡ä»‹ç»å¦‚ä½•é…ç½®ä¸€ä¸ª Express é¡¹ç›®ï¼Œå¹¶å®Œæˆä¸€ä¸ªæœ€åŸºæœ¬çš„ä¸åç«¯æ•°æ®åº“é€šä¿¡çš„å¢åˆ æŸ¥æ”¹åŠŸèƒ½.</p><a id="more"></a><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><ul><li>JavaScript è¯­è¨€</li><li>RESTful API çš„æœ‰å…³çŸ¥è¯†ï¼ˆäº‹å®ä¸Šåæ–‡ä¹Ÿæœ‰ä»‹ç»ï¼‰ <a href="https://www.runoob.com/nodejs/nodejs-restful-api.html">https://www.runoob.com/nodejs/nodejs-restful-api.html</a></li><li>ï¼ˆè‡³å°‘ä¸€ç§ï¼‰æ•°æ®åº“çš„ä½¿ç”¨æ“ä½œ<ul><li>å¯ä»¥æ˜¯ç›´æ¥ä½¿ç”¨ SQL è¯­å¥æ“ä½œ</li><li>å¯ä»¥æ˜¯ä½¿ç”¨ ORM æ¥æ“ä½œ</li></ul></li></ul><h2 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h2><p>æœç´¢ç»“æœå¯ä»¥æ‰¾åˆ°çš„å¤§å¤šæ•°ç¼–å†™æ•™ç¨‹å‡æ˜¯åŸºäº <code>CommonJS</code> è§„èŒƒï¼ˆä»¥ <code>require</code> å’Œ <code>define</code> ä¸ºç‰¹ç‚¹ï¼‰ï¼Œè€Œ <code>Node.js</code> åˆ™æ¨å‡ºäº†åŸºäºè¯­è¨€å±‚é¢æ”¯æŒçš„ <code>ES6 Module</code> è§„èŒƒï¼ˆä»¥ <code>import</code> å’Œ <code>export</code> ä¸ºç‰¹ç‚¹ï¼‰ã€‚åè€…å¿…å°†æˆä¸ºä»Šåè¾ƒä¸ºå¸¸ç”¨çš„ç¼–å†™è§„èŒƒã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šå…³äº Javascript æ¨¡å—åŒ–å¼€å‘çš„æœ‰å…³çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒæœ¬æ–‡åˆç¨¿ä½œè€…çš„<a href="https://c7w.tech/javascript-module-dev/">è¿™ç¯‡åšå®¢</a>ã€‚</p><p>åŒæ ·ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ›´ä¸ºå¹¿æ³›ä½¿ç”¨çš„ <code>yarn</code> æ¥è¿›è¡ŒåŒ…ç®¡ç†ã€‚å…¶å®‰è£…åœ¨ Node.js ç®€ä»‹åŠ npm çš„ä»‹ç»ä¸­å·²ç»™å‡ºï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†èµ˜è¿°ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ªé¡¹ç›®ã€‚ï¼ˆè¿™é‡Œé‡‡ç”¨ Windows çš„ CMD è¿›è¡Œæ“ä½œï¼ŒLinux çš„æ“ä½œç±»ä¼¼ï¼Œä¸‹åŒï¼‰</p><pre class="language-bash" data-language="bash"><code class="language-bash">D:<span class="token punctuation">\</span>Coding<span class="token operator">></span>cd D:<span class="token punctuation">\</span>Coding<span class="token punctuation">\</span>MyDashBoardBackendD:<span class="token punctuation">\</span>Coding<span class="token punctuation">\</span>MyDashBoardBackend<span class="token operator">></span>yarn init<span class="token function">yarn</span> init v1.22.17question name <span class="token punctuation">(</span>MyDashBoardBackend<span class="token punctuation">)</span>:question version <span class="token punctuation">(</span><span class="token number">1.0</span>.0<span class="token punctuation">)</span>:question description: A sample backend project.question entry point <span class="token punctuation">(</span>index.js<span class="token punctuation">)</span>:question repository url:question author:question license <span class="token punctuation">(</span>MIT<span class="token punctuation">)</span>:question private:success Saved package.jsonDone <span class="token keyword">in</span> <span class="token number">20</span>.93s.</code></pre><p>ç„¶åæˆ‘ä»¬å®‰è£… express æ¨¡å—ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> express</code></pre><p>ä¸ºäº†ä½¿ç”¨ <code>ES6 Module</code> è§„èŒƒï¼Œæˆ‘ä»¬é…ç½® <code>package.json</code>ï¼Œåœ¨å…¶ä¸­åŠ å…¥ <code>&quot;type&quot;: &quot;module&quot;</code> å­—æ®µï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"MyDashBoardBackend"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"A sample backend project."</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.2"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ç„¶åï¼Œæˆ‘ä»¬åœ¨æ ¹ç›®å½•æ–°å»º <code>index.js</code>ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">"express"</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello, baka c7w!'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œ <code>node index.js</code>ï¼Œç„¶åå‰å¾€æµè§ˆå™¨è®¿é—® <code>http://localhost:3000/</code>ï¼Œä¾¿å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è¾“å‡ºçš„æ¬¢è¿ä¿¡æ¯ã€‚</p><p>è‹¥æ˜¯æ„Ÿè§‰å¦‚æ­¤é€¼æ ¼è¿˜ä¸å¤Ÿé«˜ï¼Œä¸è¦ç´§ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­è¿›è¡Œä¸€äº›é…ç½®ï¼š</p><p>æˆ‘ä»¬å¯ä»¥ç»§ç»­ä¿®æ”¹ <code>package.json</code>ï¼Œå‘å…¶ä¸­åŠ å…¥ä½¿ç”¨ <code>yarn start</code> å¼€å¯æœåŠ¡ç«¯çš„é…ç½®ï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"MyDashBoardBackend"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node index.js"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"A sample backend project."</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.2"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>yarn start</code> æ¥å¼€å¯æœåŠ¡ç«¯äº†ã€‚</p><h2 id="è·¯ç”±-Routing"><a href="#è·¯ç”±-Routing" class="headerlink" title="è·¯ç”± Routing"></a>è·¯ç”± Routing</h2><p>æ²¡é”™ï¼Œç›¸ä¿¡ä½ å·²ç»çŒœåˆ°äº†ï¼Œæˆ‘ä»¬åç«¯ç½‘ç«™çš„è·¯ç”±ä¾¿æ˜¯ä¸»è¦é€šè¿‡ <code>app.get</code> å’Œ <code>app.post</code> ä¸¤ä¸ªæ–¹æ³•æ¥å®šä¹‰ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ å¯¹ HTTP è¯·æ±‚æ–¹æ³•äº†è§£çš„æ›´å¤šäº›çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>app.get()</code></li><li><code>app.post()</code></li><li><code>app.put()</code></li><li><code>app.delete()</code></li></ul><p>äº‹å®ä¸Šè¿˜æœ‰æ›´å¤šï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†ä¸€ä¸€åˆ—å‡ºï¼Œå¦‚æ¬²äº†è§£å¯ä»¥å€ŸåŠ©<a href="https://expressjs.com/en/4x/api.html#app.METHOD">å®˜æ–¹çš„ Docs</a>ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œç»™å‡ºä¸€äº›ç¤ºä¾‹å†™æ³•ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">"express"</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello, baka c7w!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/item'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'GET method to /item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/item'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'POST method to /item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Regular Expression!</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/item/*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `/item/1`</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Item/*"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Variables!</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/item2/:item/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `/item2/1`</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; item: '1' &#125;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Item/*"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Even ReExp + Variables!</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/item3/:item(\\d+)"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `/item3/1`</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; item: '1' &#125;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Item/*"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="Route-Handler"><a href="#Route-Handler" class="headerlink" title="Route Handler"></a>Route Handler</h3><p>æˆ‘ä»¬å¯ä»¥å°è¯•è€ƒè™‘ä»¥ä¸‹æƒ…æ™¯ï¼šæˆ‘ä»¬è¦æ ¹æ®ç”¨æˆ·èº«ä»½ï¼ˆè¿™é‡Œåšç®€è¦ç®€åŒ–ï¼Œå‡è®¾ç”¨æˆ·èº«ä»½é€šè¿‡ Routing ä¼ å…¥ï¼‰ï¼Œåˆ†åˆ«å±•ç¤ºä¸åŒçš„é¡µé¢ã€‚äº‹å®ä¸Šè¿™ç§æƒ…æ™¯å¾ˆå¸¸è§ï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘ç«™çš„ç®¡ç†å‘˜ç™»å…¥åšå®¢çœ‹åˆ°çš„åº”è¯¥æ˜¯ç®¡ç†é¡µé¢ï¼Œè€Œç™»å½•ä½œè€…çœ‹åˆ°çš„åº”è¯¥æ˜¯å†™ä½œé¡µé¢ï¼Œæ™®é€šç”¨æˆ·çœ‹åˆ°çš„å°±æ˜¯æµè§ˆé¡µé¢ã€‚ä½†æ˜¯è¿™äº›é¡µé¢ä¸­åˆä¼šæœ‰ä¸€äº›è€¦åˆçš„å…ƒç´ ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½é‡‡ç”¨ OOP è¯¾ç¨‹ä¸­ç­–ç•¥æ¨¡å¼çš„æ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">logger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// Logger éƒ¨ä»¶ï¼Œè®°å½•ç”¨</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>user <span class="token operator">+</span> <span class="token string">' tried to visit...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>user <span class="token operator">==</span> <span class="token string">"c7w"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token string">"Welcome!&lt;br />"</span><span class="token punctuation">;</span>        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Permission Denied"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">footer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span>result <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'&lt;br />&lt;br />'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/user/:user"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>logger<span class="token punctuation">,</span> main<span class="token punctuation">,</span> footer<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>äº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§ Handler â€œæ•°ç»„â€æ¥å®šä¹‰å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„å…ˆåé¡ºåºã€‚å¦‚æœåœ¨å‰é¢çš„æŸä¸ª Handler è°ƒç”¨äº† <code>next()</code>ï¼Œé‚£ä¹ˆä¾¿ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ª <code>Handler</code>ã€‚</p><h2 id="req-ä¸-res"><a href="#req-ä¸-res" class="headerlink" title="req ä¸ res"></a>req ä¸ res</h2><p>è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸‹ <code>req</code> å’Œ <code>res</code> ä¸¤ä¸ªå‚æ•°çš„ä¸»è¦å±æ€§å’Œæ–¹æ³•ã€‚</p><h3 id="req"><a href="#req" class="headerlink" title="req"></a><code>req</code></h3><div class="table-container"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td>req.query</td><td>åœ¨è¯·æ±‚åä»¥ <code>?</code> å’Œ <code>&amp;</code> è¿æ¥çš„é”®å€¼å¯¹</td></tr><tr><td>req.body</td><td>è¯·æ±‚ä½“çš„å†…å®¹</td></tr><tr><td>req.cookies</td><td>Cookies ä¸­çš„å†…å®¹</td></tr></tbody></table></div><p>æ›´å¤šè¯¦è§ï¼š<a href="https://expressjs.com/en/4x/api.html#req">https://expressjs.com/en/4x/api.html#req</a></p><h3 id="res"><a href="#res" class="headerlink" title="res"></a><code>res</code></h3><div class="table-container"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://expressjs.com/en/4x/api.html#res.download">res.download()</a></td><td>Prompt a file to be downloaded.</td></tr><tr><td><a href="https://expressjs.com/en/4x/api.html#res.end">res.end()</a></td><td>End the response process.</td></tr><tr><td><a href="https://expressjs.com/en/4x/api.html#res.json">res.json()</a></td><td>Send a JSON response.</td></tr><tr><td><a href="https://expressjs.com/en/4x/api.html#res.redirect">res.redirect()</a></td><td>Redirect a request.</td></tr><tr><td><a href="https://expressjs.com/en/4x/api.html#res.render">res.render()</a></td><td>Render a view template.</td></tr><tr><td><a href="https://expressjs.com/en/4x/api.html#res.send">res.send()</a></td><td>Send a response of various types.</td></tr><tr><td><a href="https://expressjs.com/en/4x/api.html#res.sendFile">res.sendFile()</a></td><td>Send a file as an octet stream.</td></tr><tr><td><a href="https://expressjs.com/en/4x/api.html#res.sendStatus">res.sendStatus()</a></td><td>Set the response status code and send its string representation as the response body.</td></tr></tbody></table></div><p>æ›´å¤šè¯¦è§ï¼š<a href="https://expressjs.com/en/4x/api.html#res">https://expressjs.com/en/4x/api.html#res</a></p><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>Middlewareï¼ˆä¸­é—´ä»¶å‡½æ•°ï¼‰çš„æ¦‚å¿µå…¶å®å¾ˆå¥½ç†è§£ã€‚å°±åƒæ˜¯æˆ‘ä»¬ä¸Šé¢ä¸¾çš„é‚£ä¸ªä¾‹å­ï¼Œ<code>logger</code> å’Œ <code>main</code> å°±å¯ä»¥ç†è§£æˆæ˜¯ Middleware functionsã€‚ä¸­é—´ä»¶å‡½æ•°æ˜¯å¸¦æœ‰äº† <code>req, res, next</code> ä¸ºç­¾åçš„å‡½æ•°ï¼Œåœ¨ Express å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼Œäº‹å®ä¸Šä¼šå°†æŸä¸ªåœ°å€å¯¹åº”çš„è·¯ç”±çš„æ‰€æœ‰ä¸­é—´ä»¶ç»„ç»‡æˆä¸€ä¸ªç±»ä¼¼é“¾è¡¨çš„ç»“æ„ï¼Œéšç€ <code>next()</code> çš„è°ƒç”¨åœ¨ä¸­é—´ä»¶é—´é¡ºåºæ‰§è¡Œã€‚è€Œä¸”ï¼Œä¸­é—´ä»¶éƒ½æ˜¯æœ‰ä¿®æ”¹ <code>req</code> å’Œ <code>res</code> çš„æ‰€æœ‰å±æ€§çš„èƒ½åŠ›çš„ã€‚</p><p>ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œå¦‚æœä¸­é—´ä»¶å‡½æ•°æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼äº <code>res.send()</code> çš„æ–¹æ³•å°†ä¸€ä¸ªè¯·æ±‚è¿”å›çš„è¯ï¼Œå¿…é¡»è¦è°ƒç”¨ <code>next()</code> å‡½æ•°ï¼Œä¸ç„¶å³ä½¿è¿™ä¸ªä¸­é—´ä»¶å‡½æ•°æ‰§è¡Œåˆ°æœ«å°¾ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨è·³è½¬ã€‚è¿™å°±ä¼šå¯¼è‡´è¯·æ±‚â€œå‡æ­»â€çš„ç°è±¡ã€‚</p><h3 id="å…¨å±€-Middleware"><a href="#å…¨å±€-Middleware" class="headerlink" title="å…¨å±€ Middleware"></a>å…¨å±€ Middleware</h3><p>ä½¿ç”¨ <code>app.use([path], &lt;middleware function&gt;)</code> æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¾›å…¨å±€ä½¿ç”¨çš„ Middleware å‡½æ•°ï¼ˆApplication-level middlewareï¼‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">"express"</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">logger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// Logger éƒ¨ä»¶ï¼Œè®°å½•ç”¨</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>req<span class="token punctuation">.</span>originalUrl<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello, baka c7w!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/item'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'GET method to /item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/item'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'POST method to /item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/item/*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `/item/1`</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Item/*"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/item2/:item/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `/item2/1`</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; item: '1' &#125;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Item/*"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/item3/:item(\\d+)"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `/item3/1`</span>    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; item: '1' &#125;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Item/*"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Tue Feb 08 <span class="token number">2022</span> <span class="token number">22</span>:16:18 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span><span class="token punctuation">]</span> GET /user/123<span class="token punctuation">[</span>Tue Feb 08 <span class="token number">2022</span> <span class="token number">22</span>:16:20 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span><span class="token punctuation">]</span> GET /user/123<span class="token punctuation">[</span>Tue Feb 08 <span class="token number">2022</span> <span class="token number">22</span>:16:22 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span><span class="token punctuation">]</span> GET /user/123/123</code></pre><h3 id="å¼‚å¸¸å¤„ç†-Middleware"><a href="#å¼‚å¸¸å¤„ç†-Middleware" class="headerlink" title="å¼‚å¸¸å¤„ç† Middleware"></a>å¼‚å¸¸å¤„ç† Middleware</h3><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰å¤„ç†å¼‚å¸¸çš„ä¸­é—´ä»¶å‡½æ•°ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span>  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Sorry, but fatal error occurred meanwhile.'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre><h3 id="å†…ç½®-Middleware"><a href="#å†…ç½®-Middleware" class="headerlink" title="å†…ç½® Middleware"></a>å†…ç½® Middleware</h3><p>Express å†…ç½®äº†ä»¥ä¸‹ä¸­é—´ä»¶ï¼š</p><ul><li><a href="https://expressjs.com/en/4x/api.html#express.static">express.static</a> ç”¨äºæä¾›é™æ€æ–‡ä»¶ï¼Œæ¯”å¦‚å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰ç­‰</li><li><a href="https://expressjs.com/en/4x/api.html#express.json">express.json</a> å°† req.body å¤„ç†ä¸º json (Available with Express 4.16.0+)</li><li><a href="https://expressjs.com/en/4x/api.html#express.urlencoded">express.urlencoded</a></li></ul><p>å¯¹äº POST è¯·æ±‚ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨åä¸¤ä¸ªä¸­é—´ä»¶ã€‚</p><h2 id="CRUD-çš„å®ç°"><a href="#CRUD-çš„å®ç°" class="headerlink" title="CRUD çš„å®ç°"></a>CRUD çš„å®ç°</h2><p>é¦–å…ˆæˆ‘ä»¬å…ˆç®€å•åœ°ä»‹ç»ä¸€ä¸‹ RESTful API æ˜¯ä»€ä¹ˆã€‚</p><p>RESTful API æ˜¯ç›®å‰æ¯”è¾ƒæˆç†Ÿçš„ä¸€å¥—äº’è”ç½‘åº”ç”¨ç¨‹åºçš„ API è®¾è®¡ç†è®ºã€‚å¯ä»¥å‚è€ƒ <a href="https://www.ruanyifeng.com/blog/2014/05/restful_api.htmlã€‚">https://www.ruanyifeng.com/blog/2014/05/restful_api.htmlã€‚</a></p><p>TL; DR: æŒ‰ç…§ä¸€å®šçº¦å®šä¿—æˆçš„è®¾è®¡ï¼Œå¯¹äºæˆ‘ä»¬æ‰€å…³å¿ƒçš„æ¶‰åŠçš„èµ„æºï¼Œè¿›è¡Œå¢åˆ æŸ¥æ”¹çš„æ“ä½œã€‚RESTful API æ›´å¤šçš„æ˜¯å…³æ³¨åœ¨â€œè®¾è®¡â€è¿™ä¸€å±‚é¢ã€‚</p><p>ä½œä¸ºä»Šå¤©çš„æ•™ç¨‹ï¼Œæˆ‘ä»¬åªè¦ç†è§£ï¼Œæˆ‘ä»¬è®¾è®¡å‡ºä¸€ä¸ªåç«¯ï¼Œèƒ½è®©å®ƒå’Œæˆ‘ä»¬çš„æ•°æ®åº“è¿æ¥ï¼Œå®Œæˆå¢åˆ æŸ¥æ”¹ï¼ˆCreate, Read, Update, Deleteï¼‰å°±å¯ä»¥äº†ã€‚</p><p>ä½œä¸ºè½®å­å·¥å‚ï¼Œæˆ‘ä»¬ç»è¿‡ç®€å•çš„æœç´¢å°±èƒ½æ‰¾åˆ° JavaScript ä¸ mysql è¿æ¥çš„å·¥å…·ï¼Œå…¶ä½¿ç”¨æ•™ç¨‹å¯ä»¥<a href="https://www.runoob.com/nodejs/nodejs-mysql.html">è§æ­¤</a>ã€‚</p><p>ç›´æ¥æ’°å†™ SQL è¯­å¥å›ºç„¶åœ¨åº”ç”¨ä¸Šæ˜¯é«˜æ•ˆçš„ï¼Œä½†æ˜¯åˆ‡æ¢ç¼–ç¨‹è¯­è¨€æˆ–è€…æ‰¾ä¸€äº›è‡ªåŠ¨ç”Ÿæˆ SQL æŸ¥è¯¢è¯­å¥çš„å·¥å…·ä¹Ÿä¼šé™ä½æˆ‘ä»¬çš„ç¼–ç¨‹æ•ˆç‡ã€‚åœ¨æˆ‘ä»¬<strong>å¹¶ä¸æ˜¯å¾ˆåœ¨æ„æŸ¥è¯¢æ•ˆç‡çš„å‰æä¸‹</strong>ï¼Œæˆ‘ä»¬ä¸ç¦å›å¿†èµ· Django ä¸­ç”¨ç±»æ’°å†™ Model çš„æ¨¡å¼ï¼Œå½“æ—¶å¯æ˜¯ååˆ†èŠ‚çœæˆ‘ä»¬çš„åŠ›æ°”ã€‚</p><p>äº‹å®ä¸Šï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ååˆ†å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå«åš ORMï¼ˆObjectâ€“relational mappingï¼‰ã€‚ä¹‹å‰æˆ‘ä»¬å¯ä»¥å°†å…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨çœ‹åšæ˜¯ä¸€å¼  Excel è¡¨ï¼Œè€Œè¡¨å¤´è§„å®šäº†è¿™ä¸ªè¡¨çš„æ¯è¡Œè®°å½•æ‰€åº”è¯¥æœ‰çš„å±æ€§ã€‚è€Œå¦‚æœæˆ‘ä»¬æŠŠè¿™å¼ è¡¨ä¸­çš„è¡¨å¤´ï¼Œè§†ä¸ºæ˜¯ä¸€ä¸ªç±»åœ¨è§„å®šå®ƒåº”è¯¥å…·æœ‰çš„å±æ€§çš„è¯ï¼Œé‚£ä¹ˆè¿™å¼ è¡¨çš„æ¯è¡Œè®°å½•ï¼Œäº‹å®ä¸Šå°±æ˜¯è¿™ä¸ªç±»æ‰€å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ã€‚è¿™æ­£æ˜¯ Django çš„ db.models æ‰€é‡‡ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚</p><p>å†ä¸€æ¬¡ï¼Œä½œä¸ºè½®å­å·¥å‚ï¼Œåªéœ€è¦ç®€å•çš„æœç´¢ï¼Œæˆ‘ä»¬ä¾¿èƒ½æ‰¾åˆ°å®ç°ä¸æ•°æ®åº“ä¹‹é—´ ORM è®¾è®¡çš„åº“ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ <a href="https://sequelize.org/v7/">Sequelize</a> ä¸ºä¾‹ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ä¾¿æºçš„ <code>sqlite3</code> ä½œä¸ºæˆ‘ä»¬çš„æ•°æ®åº“ã€‚</p><p>å®ç°åçš„ç®€å•é¡¹ç›®å½’æ¡£äºï¼š<a href="https://github.com/c7w/MyDashboardBackend">https://github.com/c7w/MyDashboardBackend</a></p><h2 id="åç»­æ‹“å±•"><a href="#åç»­æ‹“å±•" class="headerlink" title="åç»­æ‹“å±•"></a>åç»­æ‹“å±•</h2><ul><li>äº†è§£æ›´å¤š ExpressJS çš„ä¸­é—´ä»¶</li><li>äº†è§£ ExpressJS çš„æ¨¡æ¿æ¸²æŸ“æœºåˆ¶</li><li>æ¢ç”¨å…¶ä»–æ•°æ®åº“å°è¯•ï¼ŒåŒ…æ‹¬ fsï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ï¼ŒMySQLï¼Œä»¥åŠéå…³ç³»å‹æ•°æ®åº“ PostgreSQL</li></ul><p>å¯ä»¥åº”ç”¨ ExpressJS çš„è¯¾ç¨‹ï¼š</p><ul><li>ã€Šè½¯ä»¶å·¥ç¨‹ã€‹</li></ul><h2 id="èµ„æºé“¾æ¥"><a href="#èµ„æºé“¾æ¥" class="headerlink" title="èµ„æºé“¾æ¥"></a>èµ„æºé“¾æ¥</h2><ul><li>ExpressJS å®˜ç½‘ <a href="https://expressjs.com/">https://expressjs.com/</a></li><li>ExpressJS ä¸­æ–‡ç½‘ <a href="https://expressjs.com/zh-cn/">https://expressjs.com/zh-cn/</a></li><li>èœé¸Ÿæ•™ç¨‹ <a href="https://www.runoob.com/nodejs/nodejs-express-framework.html">https://www.runoob.com/nodejs/nodejs-express-framework.html</a></li><li>MDN æ•™ç¨‹ <a href="https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Express_Nodejs/skeleton_website">https://developer.mozilla.org/zh-CN/docs/Learn/Server-side/Express_Nodejs/skeleton_website</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;Express æ˜¯ä¸€ä¸ªç®€æ´è€Œçµæ´»çš„ Node.js Web åº”ç”¨æ¡†æ¶, æä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§ç‰¹æ€§å¸®åŠ©ä½ åˆ›å»ºå„ç§ Web åº”ç”¨ï¼Œå’Œä¸°å¯Œçš„ HTTP å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ Express å¯ä»¥å¿«é€Ÿåœ°æ­å»ºä¸€ä¸ªå®Œæ•´åŠŸèƒ½çš„ç½‘ç«™ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ›´å€¾å‘äºä½¿ç”¨ Express æ¥å¿«é€Ÿæ­å»º&lt;strong&gt;ç½‘ç«™åç«¯&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ç½‘ç«™åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œäº‹å®ä¸Šä¸æˆ‘ä»¬åœ¨ã€Šç¨‹åºè®¾è®¡è®­ç»ƒã€‹è¯¾ç¨‹ä¸­å¯¹äºä½¿ç”¨ Django æ¥æ­å»ºç½‘ç«™çš„æ–¹å¼ä¸åŒã€‚Django çš„é¡µé¢æ¸²æŸ“æ˜¯&lt;strong&gt;æœåŠ¡å™¨ç«¯æ¸²æŸ“&lt;/strong&gt;ï¼ˆServer-side Renderingï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ”¶åˆ°ç”¨æˆ·å‘æ¥çš„è¯·æ±‚åï¼ŒæœåŠ¡å™¨ç«¯æŒ‰ç…§è®¾è®¡çš„é€»è¾‘è¯»å–ç›¸åº”çš„é¡µé¢æ¨¡æ¿ï¼Œåœ¨å®Œæˆé¡µé¢æ¸²æŸ“ï¼ˆä¹Ÿå°±æ˜¯åœ¨é¡µé¢æ¨¡æ¿çš„å¯¹åº”å¤„å¡«å……å¯¹åº”å­—æ®µï¼‰åï¼Œå°†æ¸²æŸ“åçš„ HTML é¡µé¢ç›´æ¥å‘ç»™ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;è€Œè¿™é‡Œæˆ‘ä»¬å°†ç½‘ç«™åˆ†ä¸ºâ€œå‰ç«¯â€å’Œâ€œåç«¯â€ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼å’Œä¸Šè¿°æœåŠ¡å™¨ç«¯æ¸²æŸ“æœ‰æœ¬è´¨çš„åŒºåˆ«ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¸º&lt;strong&gt;å®¢æˆ·ç«¯æ¸²æŸ“&lt;/strong&gt;ï¼ˆClient-side Renderingï¼‰ã€‚å…¶è¿ä½œæ¨¡å¼æ˜¯ï¼Œç½‘ç«™æä¾›æœåŠ¡å™¨ç›´æ¥å°†æœªæ¸²æŸ“çš„ HTML æ¨¡æ¿ï¼ˆæˆ‘ä»¬ç§°ä¸ºâ€œå‰ç«¯ä»£ç â€ï¼‰å‘é€ç»™ç”¨æˆ·ï¼Œè€Œè¿™æ¨¡æ¿ä¸­åŒ…å«äº†ç±»ä¼¼äº &lt;code&gt;fetch&lt;/code&gt; çš„å‡½æ•°ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨å°†å…¶æ¸²æŸ“æ—¶å‘æˆ‘ä»¬çš„â€œåç«¯â€å‘é€è¯·æ±‚ã€‚â€œåç«¯â€åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¸€èˆ¬ä»¥ Json æ ¼å¼è¿”å›æ‰€è¯·æ±‚çš„æ•°æ®ï¼Œå‰ç«¯å†é€šè¿‡ Javascript è„šæœ¬å°†æ”¶åˆ°çš„æ•°æ®æ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ã€Šè½¯ä»¶å·¥ç¨‹ã€‹è¯¾ç¨‹ä¸­æˆ‘ä»¬æ¨èä½¿ç”¨åè€…è¿™ç§è®¾è®¡æ¨¡å¼ï¼Œå³è¿›è¡Œå‰åç«¯åˆ†ç¦»ã€‚è™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»§ç»­åˆ©ç”¨ Django æ¥ä½œä¸ºåç«¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œç»™å¤§å®¶æä¾›ä¸€ç§ä¸šç•Œä¹Ÿå¾ˆå¸¸ç”¨çš„é€‰é¡¹ â€”â€” Expressã€‚å…¶ä¼˜ç‚¹åœ¨äºï¼Œç›¸æ¯”äº Django è€Œè¨€ï¼Œå…¶ç¼–å†™èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œä¹Ÿæ›´åŠ å¿«æ·ã€‚&lt;s&gt;è€Œä¸”ï¼Œåç«¯æ›´åŠ é è¿‘ &lt;code&gt;npm&lt;/code&gt; è¿™ä¸ªè½®å­å·¥å‚ï¼Œå¯¹äºæˆ‘ä»¬è¿›è¡Œå¤§è°ƒåº“ä¹Ÿæ›´åŠ çš„æ–¹ä¾¿ã€‚å½“ç„¶ï¼Œå› ä¸º Javascript ä»¤äºº**çš„è®¾è®¡ï¼Œä¹Ÿä¼šæ”¶è·æ›´åŠ é…¸çˆ½çš„ Debug ä½“éªŒã€‚&lt;/s&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æˆ‘ä»¬ä¾§é‡ä»‹ç»å¦‚ä½•é…ç½®ä¸€ä¸ª Express é¡¹ç›®ï¼Œå¹¶å®Œæˆä¸€ä¸ªæœ€åŸºæœ¬çš„ä¸åç«¯æ•°æ®åº“é€šä¿¡çš„å¢åˆ æŸ¥æ”¹åŠŸèƒ½.&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/åç«¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="ExpressJS" scheme="https://www.c7w.tech/tags/ExpressJS/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript æ¨¡å—åŒ–è¿›åŒ–è®º</title>
    <link href="https://www.c7w.tech/javascript-module-dev/"/>
    <id>https://www.c7w.tech/javascript-module-dev/</id>
    <published>2022-02-06T15:48:48.000Z</published>
    <updated>2022-02-07T13:48:41.795Z</updated>
    
    <content type="html"><![CDATA[<p>ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–å¼€å‘ï¼Ÿæˆ‘ä»¬å¯ä»¥ç±»æ¯” C++ ä¸­çš„é¢å‘å¯¹è±¡å’Œ Java ä¸­çš„ç±»ï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯ï¼Œä¸ºäº†é¿å…å› ä¸ºé¡¹ç›®è¿‡å¤§è€Œå¯¼è‡´å˜é‡åå‘ç”Ÿå†²çªï¼ŒåŒæ—¶ä¸ºäº†ä¾¿äºè§£è€¦åˆçš„å®ç°ï¼Œæˆ‘ä»¬å°†å…·æœ‰æŸä¸ªç‰¹å®šåŠŸèƒ½çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ç»„ç»‡ä¸ºä¸€ä¸ªç±»ï¼Œå•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¹‹ä¸­ã€‚</p><p>äº‹å®ä¸Šï¼Œåœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„ä¹ æƒ¯æ˜¯ï¼Œè¦ä¹ˆå°†ç”¨åˆ°çš„æ¨¡å—å…¨éƒ¨æ‰“åŒ…ï¼Œè¦ä¹ˆé€šè¿‡ CDN å¼•å…¥ã€‚å‰è€…é€šè¿‡ Node.js å®ç°ï¼Œè€Œåè€…åˆ™ç›´æ¥å°†å¯¼å‡ºçš„æ¨¡å—æŒ‚åœ¨åœ¨ <code>window</code> ä¸‹ï¼Œä¹Ÿå³æˆä¸ºå…¨å±€å˜é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯æ—©æœŸ JavaScript çš„é—®é¢˜ï¼Œé€šè¿‡å…¨å±€å˜é‡è§£å†³ä¸€åˆ‡é—®é¢˜ã€‚</p><p>æœ¬æ–‡æˆ‘ä»¬æ¢³ç† JavaScript å¯¹äºé¡¹ç›®æ¨¡å—åŒ–çš„èŒƒå¼çš„å†å²å‘å±•è¿›ç¨‹ï¼Œä»¥æ­¤æˆ‘ä»¬åœ¨ä»Šåç¼–å†™é¡¹ç›®æ—¶æå‡ºä»¥ä¸‹å»ºè®®ï¼šä½¿ç”¨æœ€æ–°çš„ <code>ES6</code> æ ‡å‡†ï¼Œä½¿ç”¨ <code>Babel</code> å‘å‰å…¼å®¹ã€‚</p><a id="more"></a><h2 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h2><h3 id="window-å¯¹è±¡"><a href="#window-å¯¹è±¡" class="headerlink" title="window å¯¹è±¡"></a><code>window</code> å¯¹è±¡</h3><p>æœ€åˆçš„æ—¶å€™ï¼ŒJavaScript è„šæœ¬ä¹‹é—´çš„é€šä¿¡å®Œå…¨ä¾é  <code>window</code> å¯¹è±¡ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// config.js</span><span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token string">'https://github.com/ronffy'</span><span class="token punctuation">;</span><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  api<span class="token operator">:</span> api<span class="token punctuation">,</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// utils.js</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>config<span class="token punctuation">.</span>api<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// main.js</span>window<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- æ‰€æœ‰ script æ ‡ç­¾å¿…é¡»ä¿è¯é¡ºåºæ­£ç¡®ï¼Œå¦åˆ™ä¼šä¾èµ–æŠ¥é”™ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/config.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/main.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="IIFE"><a href="#IIFE" class="headerlink" title="IIFE"></a>IIFE</h3><p><strong>IIFE</strong>ï¼ˆç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼‰æ˜¯ä¸€ä¸ªåœ¨å®šä¹‰æ—¶å°±ä¼šç«‹å³æ‰§è¡Œçš„ JavaScript å‡½æ•°ã€‚</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    statements<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token string">'https://github.com/ronffy'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    api<span class="token operator">:</span> api<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  root<span class="token punctuation">.</span>config <span class="token operator">=</span> config<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>IIFE çš„å‡ºç°ï¼Œä½¿å…¨å±€å˜é‡çš„å£°æ˜æ•°é‡å¾—åˆ°äº†æœ‰æ•ˆçš„æ§åˆ¶ã€‚</p><h2 id="AMD-CMD"><a href="#AMD-CMD" class="headerlink" title="AMD / CMD"></a>AMD / CMD</h2><p>éšç€å‰ç«¯ä¸šåŠ¡å¢é‡ï¼Œä»£ç è¶Šæ¥è¶Šå¤æ‚ï¼Œé å…¨å±€å˜é‡é€šä¿¡çš„æ–¹å¼å¼€å§‹æ‰è¥Ÿè§è‚˜ï¼Œå‰ç«¯æ€¥éœ€ä¸€ç§æ›´æ¸…æ™°ã€æ›´ç®€å•çš„å¤„ç†ä»£ç ä¾èµ–çš„æ–¹å¼ï¼Œå°† JS æ¨¡å—åŒ–çš„å®ç°åŠè§„èŒƒé™†ç»­å‡ºç°ï¼Œå…¶ä¸­è¢«åº”ç”¨è¾ƒå¹¿çš„æ¨¡å—è§„èŒƒæœ‰ AMD å’Œ CMDã€‚</p><p>é¢å¯¹ä¸€ç§æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£çš„æ˜¯ï¼š1. å¦‚ä½•å¯¼å‡ºæ¥å£ï¼›2. å¦‚ä½•å¯¼å…¥æ¥å£ã€‚</p><h3 id="AMD-RequireJS"><a href="#AMD-RequireJS" class="headerlink" title="AMD + RequireJS"></a>AMD + RequireJS</h3><p><code>AMD</code>(<code>Asynchronous Module Definition</code>ï¼Œå¼‚æ­¥åŠ è½½æ¨¡å—å®šä¹‰)è§„èŒƒï¼Œä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚å®ƒé‡‡ç”¨å¼‚æ­¥æ–¹å¼åŠ è½½æ¨¡å—ï¼Œæ¨¡å—çš„åŠ è½½ä¸å½±å“å®ƒåé¢è¯­å¥çš„è¿è¡Œã€‚</p><p>è¿™é‡Œå¼‚æ­¥æŒ‡çš„æ˜¯ä¸å µå¡æµè§ˆå™¨å…¶ä»–ä»»åŠ¡ï¼ˆ<code>dom</code> æ„å»ºï¼Œ<code>css</code> æ¸²æŸ“ç­‰ï¼‰ï¼Œè€ŒåŠ è½½å†…éƒ¨æ˜¯åŒæ­¥çš„ï¼ˆåŠ è½½å®Œæ¨¡å—åç«‹å³æ‰§è¡Œå›è°ƒï¼‰ã€‚</p><p>AMD æ˜¯ä¸€ç§å¼‚æ­¥æ¨¡å—è§„èŒƒï¼Œ<code>RequireJS</code> æ˜¯ AMD è§„èŒƒçš„å®ç°ã€‚å®˜ç½‘ä»‹ç» <code>RequireJS</code>æ˜¯ä¸€ä¸ª <code>js</code> æ–‡ä»¶å’Œæ¨¡å—çš„åŠ è½½å™¨ï¼Œæä¾›äº†åŠ è½½å’Œå®šä¹‰æ¨¡å—çš„ <code>api</code>ï¼Œå½“åœ¨é¡µé¢ä¸­å¼•å…¥äº† <code>RequireJS</code> ä¹‹åï¼Œæˆ‘ä»¬ä¾¿èƒ½å¤Ÿåœ¨å…¨å±€è°ƒç”¨ <strong><code>define</code> å’Œ <code>require</code></strong>ã€‚</p><h4 id="require"><a href="#require" class="headerlink" title="require"></a><code>require</code></h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•° [module]ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„æˆå‘˜æ˜¯è¦åŠ è½½çš„æ¨¡å—ï¼Œ<code>callback</code>æ˜¯åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°ä¸­å‚æ•°å¯¹åº”æ•°ç»„ä¸­çš„æˆå‘˜ï¼ˆæ¨¡å—ï¼‰ã€‚</p><p><code>AMD</code> çš„æ ‡å‡†ä¸­ï¼Œå¼•å…¥æ¨¡å—éœ€è¦ç”¨åˆ°æ–¹æ³• <code>require</code>ï¼Œç”±äº <code>window</code> å¯¹è±¡ä¸Šæ²¡å®šä¹‰ <code>require</code> æ–¹æ³•ï¼ŒRequireJS è¿™ä¸ªåº“å°†å…¶å…·ä½“å®ç°ã€‚</p><h4 id="define"><a href="#define" class="headerlink" title="define"></a><code>define</code></h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">define</span><span class="token punctuation">(</span>id<span class="token operator">?</span><span class="token punctuation">,</span> dependencies<span class="token operator">?</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><ul><li>idï¼šæ¨¡å—çš„åå­—ï¼Œå¦‚æœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œæ¨¡å—çš„åå­—åº”è¯¥é»˜è®¤ä¸ºæ¨¡å—åŠ è½½å™¨è¯·æ±‚çš„æŒ‡å®šè„šæœ¬çš„åå­—</li><li>dependenciesï¼šæ¨¡å—çš„ä¾èµ–ï¼Œå·²è¢«æ¨¡å—å®šä¹‰çš„æ¨¡å—æ ‡è¯†çš„æ•°ç»„å­—é¢é‡ã€‚ä¾èµ–å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¦‚æœå¿½ç•¥æ­¤å‚æ•°ï¼Œå®ƒåº”è¯¥é»˜è®¤ä¸º <code>[&quot;require&quot;, &quot;exports&quot;, &quot;module&quot;]</code>ã€‚ç„¶è€Œï¼Œå¦‚æœå·¥å‚æ–¹æ³•çš„é•¿åº¦å±æ€§å°äº 3ï¼ŒåŠ è½½å™¨ä¼šé€‰æ‹©ä»¥å‡½æ•°çš„é•¿åº¦å±æ€§æŒ‡å®šçš„å‚æ•°ä¸ªæ•°è°ƒç”¨å·¥å‚æ–¹æ³•ã€‚</li><li>factoryï¼šæ¨¡å—çš„å·¥å‚å‡½æ•°ï¼Œæ¨¡å—åˆå§‹åŒ–è¦æ‰§è¡Œçš„å‡½æ•°æˆ–å¯¹è±¡ã€‚<strong>å¦‚æœä¸ºå‡½æ•°ï¼Œå®ƒåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœæ˜¯å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åº”è¯¥ä¸ºæ¨¡å—çš„è¾“å‡ºå€¼ã€‚</strong></li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ <code>RequireJS</code> é‡æ„ä¸Šé¢çš„é¡¹ç›®ã€‚</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// config.js</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token string">'https://github.com/ronffy'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    api<span class="token operator">:</span> api<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> config<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// utils.js</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./config'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>api<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> utils<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// main.js</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./utils'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">utils</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  utils<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- index.html  --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">data-main</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/main<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/require.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p>CMD å’Œ AMD ä¸€æ ·ï¼Œéƒ½æ˜¯ JS çš„æ¨¡å—åŒ–è§„èŒƒï¼Œä¹Ÿä¸»è¦åº”ç”¨äºæµè§ˆå™¨ç«¯ã€‚</p><p>AMD æ˜¯ RequireJS åœ¨çš„æ¨å¹¿å’Œæ™®åŠè¿‡ç¨‹ä¸­è¢«åˆ›é€ å‡ºæ¥ã€‚</p><p>CMD æ˜¯ SeaJS åœ¨çš„æ¨å¹¿å’Œæ™®åŠè¿‡ç¨‹ä¸­è¢«åˆ›é€ å‡ºæ¥ã€‚</p><p>äºŒè€…çš„çš„ä¸»è¦åŒºåˆ«æ˜¯ CMD æ¨å´‡ä¾èµ–å°±è¿‘ï¼ŒAMD æ¨å´‡ä¾èµ–å‰ç½®ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// AMD</span><span class="token comment">// ä¾èµ–å¿…é¡»ä¸€å¼€å§‹å°±å†™å¥½</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./utils'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">utils</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  utils<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// CMD</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä¾èµ–å¯ä»¥å°±è¿‘ä¹¦å†™</span>  <span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  utils<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>AMD ä¹Ÿæ”¯æŒä¾èµ–å°±è¿‘ï¼Œä½† RequireJS ä½œè€…å’Œå®˜æ–¹æ–‡æ¡£éƒ½æ˜¯ä¼˜å…ˆæ¨èä¾èµ–å‰ç½®å†™æ³•ã€‚</p><p><strong>è€ƒè™‘åˆ°ç›®å‰ä¸»æµé¡¹ç›®ä¸­å¯¹ AMD å’Œ CMD çš„ä½¿ç”¨è¶Šæ¥è¶Šå°‘ï¼Œå¤§å®¶å¯¹ AMD å’Œ CMD æœ‰å¤§è‡´çš„è®¤è¯†å°±å¥½ï¼Œæ­¤å¤„ä¸å†è¿‡å¤šèµ˜è¿°ã€‚</strong></p><h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p><code>CommonJS</code> æ˜¯ä¸€ä¸ªæ›´<strong>åå‘äºæœåŠ¡å™¨ç«¯</strong>çš„è§„èŒƒã€‚<code>NodeJS</code> é‡‡ç”¨äº†è¿™ä¸ªè§„èŒƒã€‚<code>CommonJS</code> çš„ä¸€ä¸ªæ¨¡å—å°±æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ã€‚</p><h3 id="exports-ä¸-module-exports"><a href="#exports-ä¸-module-exports" class="headerlink" title="exports ä¸ module.exports"></a><code>exports</code> ä¸ <code>module.exports</code></h3><p>å®šä¹‰ä¸€ä¸ªæ¨¡å—å¯¼å‡ºé€šè¿‡ <code>exports</code> æˆ–è€… <code>module.exports</code> æŒ‚è½½å³å¯ã€‚</p><h3 id="require-1"><a href="#require-1" class="headerlink" title="require"></a><code>require</code></h3><p><code>require</code> å‘½ä»¤<strong>ç¬¬ä¸€æ¬¡åŠ è½½è¯¥è„šæœ¬æ—¶å°±ä¼šæ‰§è¡Œæ•´ä¸ªè„šæœ¬ï¼Œç„¶ååœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªå¯¹è±¡</strong>ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  id<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>  exports<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  loaded<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token operator">...</span><span class="token punctuation">&#125;</span></code></pre><p><code>id</code> æ˜¯æ¨¡å—åï¼Œ<code>exports</code>æ˜¯è¯¥æ¨¡å—å¯¼å‡ºçš„æ¥å£ï¼Œ<code>loaded</code> è¡¨ç¤ºæ¨¡å—æ˜¯å¦åŠ è½½å®Œæ¯•ã€‚</p><p>ä»¥åéœ€è¦ç”¨åˆ°è¿™ä¸ªæ¨¡å—æ—¶ï¼Œå°±ä¼šåˆ° <code>exports</code> å±æ€§ä¸Šå–å€¼ã€‚<strong>å³ä½¿å†æ¬¡æ‰§è¡Œ <code>require</code> å‘½ä»¤ï¼Œä¹Ÿä¸ä¼šå†æ¬¡æ‰§è¡Œè¯¥æ¨¡å—ï¼Œè€Œæ˜¯åˆ°ç¼“å­˜ä¸­å–å€¼</strong>ã€‚</p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// config.js</span><span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token string">'https://github.com/ronffy'</span><span class="token punctuation">;</span><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  api<span class="token operator">:</span> api<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span><span class="token comment">// utils.js</span><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>api<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> utils<span class="token punctuation">;</span><span class="token comment">// main.js</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>utils<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>api<span class="token punctuation">)</span></code></pre><p>æ‰§è¡Œ<code>node main.js</code>ï¼Œ<code>https://github.com/ronffy</code> è¢«æ‰“å°äº†å‡ºæ¥ã€‚</p><p>åœ¨ main.js ä¸­æ‰“å° <code>global.api</code>ï¼Œæ‰“å°ç»“æœæ˜¯ <code>undefined</code>ã€‚</p><p>node ç”¨ <code>global</code> ç®¡ç†å…¨å±€å˜é‡ï¼Œä¸æµè§ˆå™¨çš„ <code>window</code> ç±»ä¼¼ã€‚ä¸æµè§ˆå™¨ä¸åŒçš„æ˜¯ï¼Œæµè§ˆå™¨ä¸­é¡¶å±‚ä½œç”¨åŸŸæ˜¯å…¨å±€ä½œç”¨åŸŸï¼Œåœ¨é¡¶å±‚ä½œç”¨åŸŸä¸­å£°æ˜çš„å˜é‡éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œè€Œ node ä¸­é¡¶å±‚ä½œç”¨åŸŸä¸æ˜¯å…¨å±€ä½œç”¨åŸŸï¼Œæ‰€ä»¥åœ¨é¡¶å±‚ä½œç”¨åŸŸä¸­å£°æ˜çš„å˜é‡éå…¨å±€å˜é‡ã€‚</p><p>æ³¨æ„ï¼š</p><ul><li><code>CommonJS</code> æ˜¯åŒæ­¥å¯¼å…¥æ¨¡å—</li><li><code>CommonJS</code> å¯¼å…¥æ—¶ï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªå¯¼å…¥å¯¹è±¡çš„å‰¯æœ¬</li><li><code>CommonJS</code> æ¨¡å—ä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œéœ€è¦è¿›è¡Œè½¬æ¢ã€æ‰“åŒ…</li></ul><p>ç”±äº <code>CommonJS</code> æ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œè¿™å¯¹äºæœåŠ¡å™¨ç«¯ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ‰€æœ‰çš„æ¨¡å—éƒ½æ”¾åœ¨æœ¬åœ°ç¡¬ç›˜ã€‚ç­‰å¾…æ¨¡å—æ—¶é—´å°±æ˜¯ç¡¬ç›˜è¯»å–æ–‡ä»¶æ—¶é—´ï¼Œå¾ˆå°ã€‚ä½†æ˜¯ï¼Œå¯¹äºæµè§ˆå™¨è€Œè¨€ï¼Œå®ƒéœ€è¦ä»æœåŠ¡å™¨åŠ è½½æ¨¡å—ï¼Œæ¶‰åŠåˆ°ç½‘é€Ÿï¼Œä»£ç†ç­‰åŸå› ï¼Œä¸€æ—¦ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œæµè§ˆå™¨å¤„äºâ€å‡æ­»â€çŠ¶æ€ã€‚æ‰€ä»¥åœ¨æµè§ˆå™¨ç«¯ï¼Œä¸é€‚åˆäº <code>CommonJS</code> è§„èŒƒã€‚</p><h3 id="CommonJS-ä¸-AMD-çš„å¯¹æ¯”"><a href="#CommonJS-ä¸-AMD-çš„å¯¹æ¯”" class="headerlink" title="CommonJS ä¸ AMD çš„å¯¹æ¯”"></a>CommonJS ä¸ AMD çš„å¯¹æ¯”</h3><ol><li>CommonJS æ˜¯æœåŠ¡å™¨ç«¯æ¨¡å—è§„èŒƒï¼ŒAMD æ˜¯æµè§ˆå™¨ç«¯æ¨¡å—è§„èŒƒã€‚</li><li>CommonJS åŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„ï¼Œå³æ‰§è¡Œ<code>var a = require(&#39;./a.js&#39;);</code> æ—¶ï¼Œåœ¨ a.js æ–‡ä»¶åŠ è½½å®Œæˆåï¼Œæ‰æ‰§è¡Œåé¢çš„ä»£ç ã€‚AMD åŠ è½½æ¨¡å—æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€æœ‰ä¾èµ–åŠ è½½å®Œæˆåä»¥å›è°ƒå‡½æ•°çš„å½¢å¼æ‰§è¡Œä»£ç ã€‚</li><li>å¦‚ä¸‹ä»£ç ä¸­ï¼Œ<code>fs</code> å’Œ <code>chalk</code> éƒ½æ˜¯æ¨¡å—ï¼Œä¸åŒçš„æ˜¯ï¼Œ<code>fs</code> æ˜¯ node å†…ç½®æ¨¡å—ï¼Œ<code>chalk</code> æ˜¯ä¸€ä¸ª npm åŒ…ã€‚è¿™ä¸¤ç§æƒ…å†µåœ¨ CommonJS ä¸­æ‰æœ‰ï¼ŒAMD ä¸æ”¯æŒã€‚</li></ol><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h2><p><code>UMD</code> ä»£è¡¨é€šç”¨æ¨¡å—å®šä¹‰ï¼ˆ<code>Universal Module Definition</code>ï¼‰ã€‚æ‰€è°“çš„é€šç”¨ï¼Œå°±æ˜¯å…¼å®¹äº† <code>CommonJS</code> å’Œ <code>AMD</code> è§„èŒƒï¼Œè¿™æ„å‘³ç€æ— è®ºæ˜¯åœ¨ <code>CommonJS</code> è§„èŒƒçš„é¡¹ç›®ä¸­ï¼Œè¿˜æ˜¯ <code>AMD</code> è§„èŒƒçš„é¡¹ç›®ä¸­ï¼Œéƒ½å¯ä»¥ç›´æ¥å¼•ç”¨ <code>UMD</code> è§„èŒƒçš„æ¨¡å—ä½¿ç”¨ã€‚</p><p>åŸç†å…¶å®å°±æ˜¯åœ¨æ¨¡å—ä¸­å»åˆ¤æ–­å…¨å±€æ˜¯å¦å­˜åœ¨ <code>exports</code> å’Œ <code>define</code>ï¼Œå¦‚æœå­˜åœ¨ <code>exports</code>ï¼Œé‚£ä¹ˆä»¥ <code>CommonJS</code> çš„æ–¹å¼æš´éœ²æ¨¡å—ï¼Œå¦‚æœå­˜åœ¨ <code>define</code> é‚£ä¹ˆä»¥ <code>AMD</code> çš„æ–¹å¼æš´éœ²æ¨¡å—:</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">"function"</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"jquery"</span><span class="token punctuation">,</span> <span class="token string">"underscore"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jquery"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"underscore"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    root<span class="token punctuation">.</span>Requester <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>$<span class="token punctuation">,</span> root<span class="token punctuation">.</span>_<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$<span class="token punctuation">,</span> _</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// this is where I defined my module implementation</span>  <span class="token keyword">const</span> Requester <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ... &#125;;</span>  <span class="token keyword">return</span> Requester<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="ES6-Module"><a href="#ES6-Module" class="headerlink" title="ES6 Module"></a>ES6 Module</h2><p>AMDã€CMD ç­‰éƒ½æ˜¯åœ¨åŸæœ‰ JS è¯­æ³•çš„åŸºç¡€ä¸Š<strong>äºŒæ¬¡å°è£…</strong>çš„ä¸€äº›æ–¹æ³•æ¥è§£å†³æ¨¡å—åŒ–çš„æ–¹æ¡ˆï¼Œ<strong>ES6 module</strong>ï¼ˆåœ¨å¾ˆå¤šåœ°æ–¹è¢«ç®€å†™ä¸º ESMï¼‰æ˜¯<strong>è¯­è¨€å±‚é¢çš„è§„èŒƒ</strong>ï¼ŒES6 module æ—¨åœ¨<strong>ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨æä¾›é€šç”¨çš„æ¨¡å—è§£å†³æ–¹æ¡ˆ</strong>ã€‚</p><p><strong>é•¿è¿œæ¥çœ‹ï¼Œæœªæ¥æ— è®ºæ˜¯åŸºäº JS çš„ Web ç«¯ï¼Œè¿˜æ˜¯åŸºäº node çš„æœåŠ¡å™¨ç«¯æˆ–æ¡Œé¢åº”ç”¨ï¼Œæ¨¡å—è§„èŒƒéƒ½ä¼šç»Ÿä¸€ä½¿ç”¨ ES6 moduleã€‚å› æ­¤ï¼Œä½¿ç”¨ ES6 Module è§„èŒƒæ˜¯æˆ‘ä»¬ä»Šåçš„å¼€å‘é¦–é€‰ã€‚</strong></p><p><code>ES6</code> æ¨¡å—æ˜¯å‰ç«¯å¼€å‘åŒå­¦æ›´ä¸ºç†Ÿæ‚‰çš„æ–¹å¼ï¼Œä½¿ç”¨ <code>import</code>, <code>export</code> å…³é”®å­—æ¥è¿›è¡Œæ¨¡å—è¾“å…¥è¾“å‡ºã€‚<code>ES6</code> ä¸å†æ˜¯ä½¿ç”¨é—­åŒ…å’Œå‡½æ•°å°è£…çš„æ–¹å¼è¿›è¡Œæ¨¡å—åŒ–ï¼Œè€Œæ˜¯ä»è¯­æ³•å±‚é¢æä¾›äº†æ¨¡å—åŒ–çš„åŠŸèƒ½ã€‚</p><p>ä½¿ç”¨ <code>Node</code> åŸç”Ÿ <code>ES6</code> æ¨¡å—éœ€è¦å°† <code>js</code> æ–‡ä»¶åç¼€æ”¹æˆ <code>mjs</code>ï¼Œæˆ–è€… <code>package.json</code> â€œtypeâ€ å­—æ®µæ”¹ä¸º â€œmoduleâ€ï¼Œé€šè¿‡è¿™ç§å½¢å¼å‘ŠçŸ¥ <code>Node</code> ä½¿ç”¨ <code>ES Module</code> çš„å½¢å¼åŠ è½½æ¨¡å—ã€‚ï¼ˆè¿™é‡Œæˆ‘ä»¬æ¨èä½¿ç”¨åè€…ï¼‰</p><h3 id="export"><a href="#export" class="headerlink" title="export"></a><code>export</code></h3><p>æ–¹å¼ 1ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> prefix <span class="token operator">=</span> <span class="token string">'https://github.com'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>prefix<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/ronffy</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre><p>æ–¹å¼ 2ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> prefix <span class="token operator">=</span> <span class="token string">'https://github.com'</span><span class="token punctuation">;</span><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>prefix<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/ronffy</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>  prefix<span class="token punctuation">,</span>  api<span class="token punctuation">,</span><span class="token punctuation">&#125;</span></code></pre><p>æ–¹å¼ 1 å’Œæ–¹å¼ 2 åªæ˜¯å†™æ³•ä¸åŒï¼Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æŠŠ prefix å’Œ api åˆ†åˆ«å¯¼å‡ºã€‚</p><p>æ–¹å¼ 3ï¼ˆé»˜è®¤å¯¼å‡ºï¼‰ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// foo.js</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// ç­‰åŒäºï¼š</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>  foo <span class="token keyword">as</span> <span class="token keyword">default</span><span class="token punctuation">&#125;</span></code></pre><p>æ–¹å¼ 4ï¼ˆå…ˆå¯¼å…¥å†å¯¼å‡ºï¼‰ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> api <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span><span class="token comment">// ç­‰åŒäºï¼š</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> api <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span>  api<span class="token punctuation">&#125;</span></code></pre><h3 id="import"><a href="#import" class="headerlink" title="import"></a><code>import</code></h3><p>å‡è®¾æˆ‘ä»¬ä»¥æ–¹å¼ 1 å’Œæ–¹å¼ 2 å¯¼å‡ºäº† <code>&#123;prefix: prefix, api: api&#125;</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä»¥å¦‚ä¸‹æ–¹å¼å¯¼å…¥ï¼š</p><p>æ–¹å¼ 1ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> api <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span><span class="token comment">// or</span><span class="token comment">// é…åˆ import ä½¿ç”¨çš„ as å…³é”®å­—ç”¨æ¥ä¸ºå¯¼å…¥çš„æ¥å£é‡å‘½åã€‚</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> api <span class="token keyword">as</span> myApi <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span></code></pre><p>æ–¹å¼ 2ï¼ˆæ•´ä½“å¯¼å…¥ï¼‰ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> config <span class="token keyword">from</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span><span class="token keyword">const</span> api <span class="token operator">=</span> config<span class="token punctuation">.</span>api<span class="token punctuation">;</span></code></pre><p>æ–¹å¼ 3ï¼ˆé»˜è®¤å¯¼å‡ºçš„å¯¼å…¥ï¼‰ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// foo.js</span><span class="token keyword">export</span> <span class="token keyword">const</span> conut <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// index.js</span><span class="token comment">// é»˜è®¤å¯¼å…¥çš„æ¥å£æ­¤å¤„åˆ»æ„å‘½åä¸º cusFooï¼Œæ—¨åœ¨è¯´æ˜è¯¥å‘½åå¯å®Œå…¨è‡ªå®šä¹‰ã€‚</span><span class="token keyword">import</span> cusFoo<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./foo.js'</span><span class="token punctuation">;</span><span class="token comment">// ç­‰åŒäºï¼š</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span> <span class="token keyword">as</span> cusFoo<span class="token punctuation">,</span> count <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./foo.js'</span><span class="token punctuation">;</span></code></pre><p><code>export default</code> å¯¼å‡ºçš„æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ <code>import name from &#39;module&#39;</code> å¯¼å…¥ã€‚è¿™ç§æ–¹å¼ï¼Œä½¿å¯¼å…¥é»˜è®¤æ¥å£å¾ˆä¾¿æ·ã€‚</p><p>æ–¹å¼ 4ï¼ˆæ•´ä½“åŠ è½½ï¼‰ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span></code></pre><p>è¿™æ ·ä¼šåŠ è½½æ•´ä¸ª config.js æ¨¡å—ï¼Œä½†æœªå¯¼å…¥è¯¥æ¨¡å—çš„ä»»ä½•æ¥å£ã€‚</p><p>æ–¹å¼ 5ï¼ˆåŠ¨æ€åŠ è½½æ¨¡å—ï¼‰ï¼š</p><p>ä¸Šé¢ä»‹ç»äº† ES6 module å„ç§å¯¼å…¥æ¥å£çš„æ–¹å¼ï¼Œä½†æœ‰ä¸€ç§åœºæ™¯æœªè¢«æ¶µç›–ï¼šåŠ¨æ€åŠ è½½æ¨¡å—ã€‚æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æŸä¸ªæŒ‰é’®åæ‰å¼¹å‡ºå¼¹çª—ï¼Œå¼¹çª—é‡ŒåŠŸèƒ½æ¶‰åŠçš„æ¨¡å—çš„ä»£ç é‡æ¯”è¾ƒé‡ï¼Œæ‰€ä»¥è¿™äº›ç›¸å…³æ¨¡å—å¦‚æœåœ¨é¡µé¢åˆå§‹åŒ–æ—¶å°±åŠ è½½ï¼Œå®åœ¨æµªè´¹èµ„æºï¼Œ<code>import()</code> å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»è¯­è¨€å±‚é¢å®ç°æ¨¡å—ä»£ç çš„æŒ‰éœ€åŠ è½½ã€‚</p><p>ES6 module åœ¨å¤„ç†ä»¥ä¸Šå‡ ç§å¯¼å…¥æ¨¡å—æ¥å£çš„æ–¹å¼æ—¶éƒ½æ˜¯ç¼–è¯‘æ—¶å¤„ç†ï¼Œæ‰€ä»¥ <code>import</code> å’Œ <code>export</code> å‘½ä»¤åªèƒ½ç”¨åœ¨æ¨¡å—çš„é¡¶å±‚ï¼Œä»¥ä¸‹æ–¹å¼éƒ½ä¼šæŠ¥é”™ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æŠ¥é”™</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> api <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token comment">// æŠ¥é”™</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> api <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./config.js'</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token comment">// æŠ¥é”™</span><span class="token keyword">const</span> modulePath <span class="token operator">=</span> <span class="token string">'./utils'</span> <span class="token operator">+</span> <span class="token string">'/api.js'</span><span class="token punctuation">;</span><span class="token keyword">import</span> modulePath<span class="token punctuation">;</span></code></pre><p>ä½¿ç”¨ <code>import()</code> å®ç°æŒ‰éœ€åŠ è½½ï¼š</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./config.js'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> api <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> modulePath <span class="token operator">=</span> <span class="token string">'./utils'</span> <span class="token operator">+</span> <span class="token string">'/api.js'</span><span class="token punctuation">;</span><span class="token keyword">import</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ³¨æ„ï¼Œåœ¨æµè§ˆå™¨ä¸­åŠ è½½ ES6 æ¨¡å—çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>ä½†æ˜¯ï¼Œå¯¹äºåŠ è½½å¤–éƒ¨æ¨¡å—ï¼Œéœ€è¦æ³¨æ„ï¼š</p><ul><li>ä»£ç æ˜¯åœ¨æ¨¡å—ä½œç”¨åŸŸä¹‹ä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸè¿è¡Œã€‚<strong>æ¨¡å—å†…éƒ¨çš„é¡¶å±‚å˜é‡ï¼Œå¤–éƒ¨ä¸å¯è§</strong></li><li>æ¨¡å—è„šæœ¬è‡ªåŠ¨é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œä¸ç®¡æœ‰æ²¡æœ‰å£°æ˜ <code>use strict</code></li><li>æ¨¡å—ä¹‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>import</code> å‘½ä»¤åŠ è½½å…¶ä»–æ¨¡å—ï¼ˆ.js åç¼€ä¸å¯çœç•¥ï¼Œéœ€è¦æä¾›ç»å¯¹ URL æˆ–ç›¸å¯¹ URLï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>export</code> å‘½ä»¤è¾“å‡ºå¯¹å¤–æ¥å£</li><li><strong>æ¨¡å—ä¹‹ä¸­ï¼Œé¡¶å±‚çš„ <code>this</code> å…³é”®å­—è¿”å› <code>undefined</code>ï¼Œè€Œä¸æ˜¯æŒ‡å‘ <code>window</code></strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ¨¡å—é¡¶å±‚ä½¿ç”¨ <code>this</code> å…³é”®å­—ï¼Œæ˜¯æ— æ„ä¹‰çš„</li><li><strong>åŒä¸€ä¸ªæ¨¡å—å¦‚æœåŠ è½½å¤šæ¬¡ï¼Œå°†åªæ‰§è¡Œä¸€æ¬¡</strong></li></ul><h3 id="ES6-Module-ä¸-CommonJS-çš„åŒºåˆ«"><a href="#ES6-Module-ä¸-CommonJS-çš„åŒºåˆ«" class="headerlink" title="ES6 Module ä¸ CommonJS çš„åŒºåˆ«"></a>ES6 Module ä¸ CommonJS çš„åŒºåˆ«</h3><ul><li><code>CommonJS</code> è¾“å‡ºçš„æ˜¯ä¸€ä¸ª<strong>å€¼çš„æ‹·è´</strong>ï¼ŒES6 æ¨¡å—è¾“å‡ºçš„æ˜¯<strong>å€¼çš„å¼•ç”¨</strong>,åŠ è½½çš„æ—¶å€™ä¼šåšé™æ€ä¼˜åŒ–</li><li><code>CommonJS</code> æ¨¡å—æ˜¯<strong>è¿è¡Œæ—¶åŠ è½½</strong>ç¡®å®šè¾“å‡ºæ¥å£ï¼ŒES6 æ¨¡å—æ˜¯<strong>ç¼–è¯‘æ—¶</strong>ç¡®å®šè¾“å‡ºæ¥å£</li></ul><h2 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h2><p>ç›®å‰ï¼Œæ— è®ºæ˜¯æµè§ˆå™¨ç«¯è¿˜æ˜¯ nodeï¼Œ<strong>éƒ½æ²¡æœ‰å®Œå…¨åŸç”Ÿæ”¯æŒ ES6 module</strong>ï¼Œå¦‚æœæƒ³ä½¿ç”¨ ES6 module ï¼Œå¯å€ŸåŠ© <a href="https://link.segmentfault.com/?enc=NPnBue71LLC14ip6TZXbng%3D%3D.bbpSMgal9YqIDxlkVk1c1BQhJYiGJYf2ZYbUth7aOkE%3D">babel</a> ç­‰ç¼–è¯‘å™¨ã€‚</p><blockquote><p> Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨ã€‚</p><p>ä»Šå¤©å°±å¼€å§‹ä½¿ç”¨ä¸‹ä¸€ä»£çš„ JavaScript è¯­æ³•ç¼–ç¨‹å§ï¼</p><p><img src="https://s2.loli.net/2022/02/07/lm5dWXcRirIC8JH.png" alt="image-20220207214422726"></p><p><img src="https://s2.loli.net/2022/02/07/uSzJEKP8rBGV24T.png" alt="image-20220207214437008"></p><p>ç®€å•æ¥è¯´ï¼Œå¯ä»¥ç†è§£æˆæ˜¯ç¼–è¯‘æ—¶æ›¿æ¢çš„ä¸€ç§ polyfill.</p></blockquote><p>Babel is a toolchain that is mainly used to convert ECMAScript 2015+ code into a backwards compatible version of JavaScript in current and older browsers or environments. </p><p>Here are the main things Babel can do for you:</p><ul><li>Transform syntax</li><li>Polyfill features that are missing in your target environment (through a third-party polyfill such as core-js)</li><li>Source code transformations (codemods)</li><li>And more! (check out these videos for inspiration)</li></ul><p>é…ç½®æ–¹æ³•ï¼š<a href="https://babeljs.io/setup#installation">https://babeljs.io/setup#installation</a></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://segmentfault.com/a/1190000023711059">https://segmentfault.com/a/1190000023711059</a></li><li><a href="https://segmentfault.com/a/1190000039375332">https://segmentfault.com/a/1190000039375332</a></li><li><a href="https://juejin.cn/post/6844904080955932680">https://juejin.cn/post/6844904080955932680</a></li><li><a href="http://nodejs.cn/api/modules.html">http://nodejs.cn/api/modules.html</a></li><li><a href="http://nodejs.cn/api/esm.html">http://nodejs.cn/api/esm.html</a></li><li><a href="https://docs.net9.org/languages/node.js/">https://docs.net9.org/languages/node.js/</a></li><li><a href="https://babeljs.io/docs/en/index.html">https://babeljs.io/docs/en/index.html</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–å¼€å‘ï¼Ÿæˆ‘ä»¬å¯ä»¥ç±»æ¯” C++ ä¸­çš„é¢å‘å¯¹è±¡å’Œ Java ä¸­çš„ç±»ï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯ï¼Œä¸ºäº†é¿å…å› ä¸ºé¡¹ç›®è¿‡å¤§è€Œå¯¼è‡´å˜é‡åå‘ç”Ÿå†²çªï¼ŒåŒæ—¶ä¸ºäº†ä¾¿äºè§£è€¦åˆçš„å®ç°ï¼Œæˆ‘ä»¬å°†å…·æœ‰æŸä¸ªç‰¹å®šåŠŸèƒ½çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•ç»„ç»‡ä¸ºä¸€ä¸ªç±»ï¼Œå•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¹‹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šï¼Œåœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çš„ä¹ æƒ¯æ˜¯ï¼Œè¦ä¹ˆå°†ç”¨åˆ°çš„æ¨¡å—å…¨éƒ¨æ‰“åŒ…ï¼Œè¦ä¹ˆé€šè¿‡ CDN å¼•å…¥ã€‚å‰è€…é€šè¿‡ Node.js å®ç°ï¼Œè€Œåè€…åˆ™ç›´æ¥å°†å¯¼å‡ºçš„æ¨¡å—æŒ‚åœ¨åœ¨ &lt;code&gt;window&lt;/code&gt; ä¸‹ï¼Œä¹Ÿå³æˆä¸ºå…¨å±€å˜é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯æ—©æœŸ JavaScript çš„é—®é¢˜ï¼Œé€šè¿‡å…¨å±€å˜é‡è§£å†³ä¸€åˆ‡é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æˆ‘ä»¬æ¢³ç† JavaScript å¯¹äºé¡¹ç›®æ¨¡å—åŒ–çš„èŒƒå¼çš„å†å²å‘å±•è¿›ç¨‹ï¼Œä»¥æ­¤æˆ‘ä»¬åœ¨ä»Šåç¼–å†™é¡¹ç›®æ—¶æå‡ºä»¥ä¸‹å»ºè®®ï¼šä½¿ç”¨æœ€æ–°çš„ &lt;code&gt;ES6&lt;/code&gt; æ ‡å‡†ï¼Œä½¿ç”¨ &lt;code&gt;Babel&lt;/code&gt; å‘å‰å…¼å®¹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/JavaScript" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-JavaScript/"/>
    
    
    <category term="JavaScript" scheme="https://www.c7w.tech/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>çˆ¬å–ã€Šé›¨è¯¾å ‚ã€‹æ…•è¯¾å­—å¹• Tsinghua MOOC Caption Crawler</title>
    <link href="https://www.c7w.tech/yuketang-caption-crawler/"/>
    <id>https://www.c7w.tech/yuketang-caption-crawler/</id>
    <published>2022-01-29T16:03:46.000Z</published>
    <updated>2022-01-29T16:04:25.324Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2022/01/30/nkI5B9DcPQzX3Us.png" alt="image-20220130000139599"></p><p>GitHub Repo: <a href="https://github.com/c7w/TsinghuaMoocCaptionCrawler">https://github.com/c7w/TsinghuaMoocCaptionCrawler</a></p><p>Blog: <a href="https://c7w.tech/yuketang-caption-crawler/">https://c7w.tech/yuketang-caption-crawler/</a></p><a id="more"></a><h2 id="çˆ¬å–è¿‡ç¨‹"><a href="#çˆ¬å–è¿‡ç¨‹" class="headerlink" title="çˆ¬å–è¿‡ç¨‹"></a>çˆ¬å–è¿‡ç¨‹</h2><h3 id="ä¹±æŠ“"><a href="#ä¹±æŠ“" class="headerlink" title="ä¹±æŠ“"></a>ä¹±æŠ“</h3><ul><li><strong>åˆ©ç”¨ Break on change æŸ¥çœ‹è„šæœ¬è¿è¡ŒçŠ¶å†µ</strong></li></ul><p>é¦–å…ˆè‡ªç„¶æ˜¯å–å­—å¹•æ‰€åœ¨çš„é‚£ä¸ª xt-caption å…ƒç´ ï¼Œç„¶åæ‰“ä¸Š Break on change.</p><blockquote><p>åœ¨ Javascript è°ƒè¯•ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨åˆ°æ–­ç‚¹è°ƒè¯•ã€‚</p><p>å…¶å®ï¼Œåœ¨ DOM ç»“æ„çš„è°ƒè¯•ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ–­ç‚¹æ–¹æ³•ï¼Œè¿™å°±æ˜¯ DOM Breakpointï¼ˆDOM æ–­ç‚¹ï¼‰ã€‚</p><p>å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ï¼š</p><p>åœ¨ Chrome æµè§ˆå™¨ä¸­ï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå…ˆé€‰ä¸­ä¸€ä¸ªé¡µé¢å…ƒç´ ï¼Œç„¶åç‚¹å‡»é¼ æ ‡å³é”®ï¼Œä¾æ¬¡ç‚¹å‡»èœå•ä¸­çš„ â€œBreak on â€¦â€ â€”â€” å‹¾é€‰ â€œAttributes modificationsâ€ã€‚</p><p>åˆ·æ–°é¡µé¢ï¼Œå½“è¯¥å…ƒç´ çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¼šæš‚åœè„šæœ¬çš„æ‰§è¡Œï¼Œå¹¶ä¸”å®šä½åˆ°æ”¹å˜å‘ç”Ÿçš„åœ°æ–¹ã€‚</p><p>é™¤äº†å¯ä»¥ç›‘è§† DOM å…ƒç´ æœ¬èº«çš„å±æ€§å˜åŒ–ï¼ŒChrome è¿˜å¯ä»¥ç›‘è§†å…¶å­å…ƒç´ çš„å˜åŒ–ï¼Œä»¥åŠä½•æ—¶å…ƒç´ è¢«åˆ é™¤ã€‚</p></blockquote><p><img src="https://s2.loli.net/2022/01/29/xYiujWzwTfM7mIv.png" alt="image-20220129222222643"></p><ul><li><strong>æŸ¥çœ‹è°ƒç”¨æ ˆ</strong></li></ul><p>ç„¶åæ˜¯å½“ Trigger äº†å­—å¹•æ›´æ”¹ Event ä¹‹åï¼Œé€ä¸ªæ£€æŸ¥è¿™é‡Œçš„è°ƒç”¨æ ˆã€‚</p><p><img src="https://s2.loli.net/2022/01/27/e9qdIOvc2butLP3.png" alt="image-20220127155350265"></p><p>é€çº§æŸ¥çœ‹åï¼Œè¿™é‡Œï¼ˆé¡µé¢åŠ è½½ caption å±æ€§çš„æ—¶å€™ï¼‰çœ‹èµ·æ¥åƒæ˜¯åœ¨å‘å¯ç–‘çš„è¯·æ±‚ï¼Œç„¶åæ‰¾åˆ°äº†ä¸€ä¸ªåœ°å€ï¼š</p><p><img src="https://s2.loli.net/2022/01/27/NoOutDYEpwHPzy3.png" alt="image-20220127155631381"></p><p>ç„¶ååœ¨ HTML é‡Œé¢å…¨æ–‡æ£€ç´¢ç«Ÿç„¶æ‰¾åˆ°äº†ä¸€æ ·çš„åœ°å€ã€‚äºæ˜¯æˆ‘ä»¬å°±å¾—åˆ°äº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå…³é”®è¯ <code>subtitle_parse</code>ã€‚</p><p><img src="https://s2.loli.net/2022/01/27/HdU58pV4NkJyASC.png" alt="image-20220127155810865"></p><ul><li><strong>æŸ¥çœ‹å­—å¹•æºæ•°æ®</strong></li></ul><p>æ‰“å¼€è¿™ä¸ªç½‘é¡µï¼Œå‘ç°é‡Œé¢å°±æ˜¯çº¯å­—æ¯æ•°æ®ã€‚</p><p><img src="https://s2.loli.net/2022/01/27/uGwhPFHA176dXKy.png" alt="image-20220127160055541"></p><p>å³ä½¿æ˜¯å¼€æ— ç—•æµè§ˆä¹Ÿå¯ä»¥æ‰“å¼€ï¼Œè¯´æ˜ä¸è®°å½• Cookiesã€‚</p><p><img src="https://s2.loli.net/2022/01/29/dJBibYkN9enuEtx.png" alt="image-20220129222439327"></p><p>ç„¶åæœ¬æ¥æƒ³ç›´æ¥ç”¨ Python å†™æ‰¹é‡æŠ“å–è„šæœ¬ï¼Œç»“æœå†™äº†ä¸€æ®µå‘ç°è¿™ä¸ªå­—å¹•å…ƒç´ ç«Ÿç„¶ä¹Ÿæ˜¯æ™šåŠ è½½ï¼š</p><ul><li><code>Crawler.py</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">def</span> <span class="token function">getCookies</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>    f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\""</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span>    result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token string">'='</span> <span class="token keyword">in</span> entry<span class="token punctuation">:</span>            entryGroup <span class="token operator">=</span> entry<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span>            result<span class="token punctuation">[</span>entryGroup<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> entryGroup<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> result<span class="token keyword">def</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>\              <span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">fetch_single_video</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string">'https://tsinghua.yuketang.cn/pro/lms/8NpUsbr6GZH/3029907/video/2224317'</span>    cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">'./cookies'</span><span class="token punctuation">)</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>                            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                            cookies<span class="token operator">=</span>getCookies<span class="token punctuation">(</span><span class="token string">"./cookies"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>    html <span class="token operator">=</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./a.txt'</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>soup<span class="token punctuation">.</span>prettify<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    fetch_single_video<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></code></pre><p>å…¶ä¸­ <code>./cookies</code> é‡Œé¢æ”¾çš„æ˜¯ä½¿ç”¨ <code>EditThisCookie</code> extension å¯¼å‡ºçš„ txt æ ¼å¼çš„ Cookies.</p><p><img src="https://s2.loli.net/2022/01/29/8CIt4g7kFJLoxXp.png" alt="image-20220129222822889"></p><p>å‘ç°è¿™å°±æ˜¯ä¸ª Vue æ­çš„å‰ç«¯ç½‘ç«™ï¼Œè€Œä¸”æ˜¯æ™šåŠ è½½çš„æ¨¡å¼ï¼š</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/html; charset=utf-8<span class="token punctuation">"</span></span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content-type<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width,initial-scale=1,user-scalable=no<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-cache<span class="token punctuation">"</span></span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Pragma<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-transform <span class="token punctuation">"</span></span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cache-Control<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-siteapp<span class="token punctuation">"</span></span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cache-Control<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-cache<span class="token punctuation">"</span></span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Cache-Control<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Expires<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>é›¨è¯¾å ‚, æ¸…åå¤§å­¦, æ™ºæ…§æ•™å­¦, ç¿»è½¬è¯¾å ‚, æ··åˆå¼æ•™å­¦, æ•™å­¦å·¥å…·, æ•™å­¦è½¯ä»¶<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>keywords<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>é›¨è¯¾å ‚æ˜¯æ¸…åå¤§å­¦å’Œå­¦å ‚åœ¨çº¿å…±åŒæ¨å‡ºçš„æ–°å‹æ™ºæ…§æ•™å­¦è§£å†³æ–¹æ¡ˆï¼Œæ˜¯æ•™è‚²éƒ¨åœ¨çº¿æ•™è‚²ç ”ç©¶ä¸­å¿ƒçš„æœ€æ–°ç ”ç©¶æˆæœï¼Œè‡´åŠ›äºå¿«æ·å…è´¹çš„ä¸ºæ‰€æœ‰æ•™å­¦è¿‡ç¨‹æä¾›æ•°æ®åŒ–ã€æ™ºèƒ½åŒ–çš„ä¿¡æ¯æ”¯æŒã€‚<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Description<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//proxt-cdn.xuetangx.com<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//static-cdn.xuetangx.com<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//qn-next.xuetangx.com<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//s.xuetangx.com<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//storagecdn.xuetangx.com<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dns-prefetch<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/images/favicon.ico<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>J_logo_ico<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>shortcut icon<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/x-icon<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//at.alicdn.com/t/font_2914297_aiu6672k7jm.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//at.alicdn.com/t/font_2914297_aiu6672k7jm.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//at.alicdn.com/t/font_956123_fw8xrxx7a4u.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>//at.alicdn.com/t/font_956123_fw8xrxx7a4u.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>defer<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://code.bdstatic.com/npm/@baiducloud/sdk@1.0.0-rc.19/dist/baidubce-sdk.bundle.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://storagecdn.xuetangx.com/public_assets/xuetangx/aliyun-upload-sdk/lib/aliyun-oss-sdk-5.3.1.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://storagecdn.xuetangx.com/public_assets/xuetangx/aliyun-upload-sdk/aliyun-upload-sdk-1.5.0.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://ssl.captcha.qq.com/TCaptcha.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://web-stat.jiguang.cn/web-janalytics/scripts/janalytics-web.min.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">   <span class="token selector">.ie-hint</span><span class="token punctuation">&#123;</span><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token property">position</span><span class="token punctuation">:</span>relative<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">top</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">z-index</span><span class="token punctuation">:</span>100000<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>40px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span>40px<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span>16px<span class="token punctuation">;</span><span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span>#fff8bf<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#4a4a4a<span class="token punctuation">&#125;</span><span class="token selector">.ie-hint img</span><span class="token punctuation">&#123;</span><span class="token property">vertical-align</span><span class="token punctuation">:</span>middle<span class="token punctuation">&#125;</span><span class="token selector">.ie-hint a</span><span class="token punctuation">&#123;</span><span class="token property">color</span><span class="token punctuation">:</span>#639ef4<span class="token punctuation">&#125;</span><span class="token selector">.ie-hint .icon</span><span class="token punctuation">&#123;</span><span class="token property">font-size</span><span class="token punctuation">:</span>19px<span class="token punctuation">;</span><span class="token property">vertical-align</span><span class="token punctuation">:</span>middle<span class="token punctuation">&#125;</span><span class="token selector">#close-ie-hint</span><span class="token punctuation">&#123;</span><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span><span class="token property">right</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span><span class="token property">top</span><span class="token punctuation">:</span>10px<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>20px<span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@media</span> print</span><span class="token punctuation">&#123;</span><span class="token selector">.no-print</span><span class="token punctuation">&#123;</span><span class="token property">visibility</span><span class="token punctuation">:</span>hidden<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/styles.929a58a998b9713fd859.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/142.c165ba72220097b7a058.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/572.05955aff5704fb65b9f1.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1281.eb0a92d7006955f1e691.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1269.ecf512d0ea931c4302bf.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1255.a02392a53202a02f00cd.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1300.4c085e415259addde382.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1291.3fe43df5becd9c98e83b.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1301.d0128c8af9fd07b09a38.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1302.d0128c8af9fd07b09a38.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie-hint<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie-hint<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://qn-sfe.yuketang.cn/o_1ecmgnntbah3150231eevqmpja.png<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>   å½“å‰æµè§ˆå™¨å¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>school-name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>   ï¼Œ æ¨èä½¿ç”¨   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xiazai.sogou.com/detail/34/8/6262355089742005676.html<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chrome<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    chromeæµè§ˆå™¨ã€   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.firefox.com.cn/download/<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç«ç‹<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    ç«ç‹æµè§ˆå™¨   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>   æˆ–   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://browser.qq.com/?adtag=SEM1<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>QQæµè§ˆå™¨<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    QQæµè§ˆå™¨   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>   ã€‚   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close-ie-hint<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://qn-sfe.yuketang.cn/o_1ecmgnntcn761v2p1vcn1i851jqcb.png<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/x-mathjax-config<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">   window<span class="token punctuation">.</span>MathJax<span class="token punctuation">.</span>Hub<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>showProcessingMessages<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//å…³é—­jsåŠ è½½è¿‡ç¨‹ä¿¡æ¯</span>messageStyle<span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span> <span class="token comment">//ä¸æ˜¾ç¤ºä¿¡æ¯</span>jax<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"input/TeX"</span><span class="token punctuation">,</span> <span class="token string">"output/HTML-CSS"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>showMathMenu<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//å…³é—­å³å‡»èœå•æ˜¾ç¤º</span>tex2jax<span class="token operator">:</span> <span class="token punctuation">&#123;</span>inlineMath<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'$'</span><span class="token punctuation">,</span><span class="token string">'$'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"\\("</span><span class="token punctuation">,</span><span class="token string">"\\)"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'[mathjaxinline]'</span><span class="token punctuation">,</span><span class="token string">'[/mathjaxinline]'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>displayMath<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'$$'</span><span class="token punctuation">,</span><span class="token string">'$$'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"\\["</span><span class="token punctuation">,</span><span class="token string">"\\]"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'[mathjax]'</span><span class="token punctuation">,</span><span class="token string">'[/mathjax]'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>processEscapes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">"HTML-CSS"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> availableFonts<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"TeX"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://s.xuetangx.com/resource/mathjax/MathJax.js?config=TeX-MML-AM_HTMLorMML-full<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">   <span class="token keyword">var</span> _mtac<span class="token operator">=</span><span class="token punctuation">&#123;</span>performanceMonitor<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>senseQuery<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> t<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>t<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token string">"https://pingjs.qq.com/h5/stats.js?v2.0.4"</span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"MTAH5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">,</span><span class="token string">"500535776"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"cid"</span><span class="token punctuation">,</span><span class="token string">"500613279"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> e<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>e<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">   window<span class="token punctuation">.</span><span class="token constant">UEDITOR_HOME_URL</span><span class="token operator">=</span><span class="token string">"/vue_images/js/ueditor/"</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">   <span class="token keyword">var</span> ieHint<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"ie-hint"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>closeIeHintBtn<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"close-ie-hint"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>closeIeHintBtn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>ieHint<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> ua<span class="token operator">=</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">null</span><span class="token operator">==</span>ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">msie</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">null</span><span class="token operator">==</span>ua<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">trident</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>ieHint<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">"block"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> el<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"school-name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>el<span class="token punctuation">.</span>innerText<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">gdufemooc\.cn|gc\.xuetangonline\.com</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">"å¹¿è´¢æ…•è¯¾"</span><span class="token operator">:</span><span class="token string">"é›¨è¯¾å ‚"</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">   window<span class="token punctuation">.</span>JAnalyticsInterface<span class="token operator">&amp;&amp;</span>window<span class="token punctuation">.</span>JAnalyticsInterface<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>appkey<span class="token operator">:</span><span class="token string">"d651262356d93f6497b466bc"</span><span class="token punctuation">,</span>debugMode<span class="token operator">:</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>channel<span class="token operator">:</span><span class="token string">"web"</span><span class="token punctuation">,</span>loc<span class="token operator">:</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>singlePage<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/manifest_c74775d18d54217265e2.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/231_38a88de77e34999627ab.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/569_bc3c767e5675a607dbbd.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1282_f9bb16a2941af9a9732e.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/133_78b4a2f4ec1e774e0cd7.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1236_3946732fbcdc70b913ab.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/99_a1791a23a69e2309f9f1.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/46_492686a3fb63a70f8537.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/55_29d1ee187d2ac1bf8576.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/63_7e9066f450ffae3dbf1f.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1256_7a55b42b33475074b3d3.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/119_75b24be79cbc0f38e9b5.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/117_59618d0ce41a577cd0a2.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/232_5b17f99d4219ca1a5b59.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/339_18c69c22659d338f44af.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/100_29dabc580c2213c93d8c.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/56_ca3e56863eb65145d5ef.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/47_1a6f41d3f0d03e528606.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1264_4f1e99a3b8cdc6a85310.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/336_48448e96f180a901248e.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/101_317e4792ce1ff0603658.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/60_1f97ad5d40dccb242d3c.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/59_0b81e0afe51de42239f4.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/48_f696c92ebfa6dbe3a1ac.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/50_9da5f4380a1dd62a4349.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/70_c7d3361bfc7496f5d803.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1265_046603f30d395e0e1099.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/230_43fd774de4f928a81aa1.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1283_cdf10be9a5df97cb7d46.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/338_f4f2d394eb1bd2e4a76e.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/116_b722a9793903aa54c4a3.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1266_b1f6eab4866937cd2334.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/335_2f5c77a15099004dd76d.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/132_67afce490fea2dc1441a.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1274_53106a71aa695ff1e11d.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/337_5f023640d90421312cf8.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1258_0513b6935105b9242092.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/187_1d921a816015be88fc98.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/140_1429b54afac3f6055d28.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/189_312d72f77e83bd9f27d2.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/236_dd7f542d4cd9f02617d4.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1220_07a737b91c2b22ee2d3f.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/137_274aba69f9f08e27032a.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/118_03f55e7d8630c32b7003.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/139_32cd669c513bcc12f0d8.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1239_00c23825dfd87a3592d2.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/135_f61430536202b9abeb3f.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/138_e9b0ca84dbbf77e36067.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/141_b23872740ac87e16f8a0.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/188_f2c1d703e3c638123d7c.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/136_62c77544e64cd5ab11f5.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1296_9a4770963b01517ef057.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/121_8311183faa6fc009705d.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/134_592e67bb4735225d8109.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/styles_58dd88566a7c28f3ead9.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1235_8188f874883aec589e8d.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1288_777c8223f036e812be31.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/571_10162dcb435848dccc4a.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/234_46302fa6da910e733695.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1289_24f0da49aa9672e5f66b.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/235_9c17d4274dbb108f05a0.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/142_5298840037f69140cb58.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1290_37149584899447655329.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/574_83911d6a3fc0bac17622.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/120_4d32aa2ec1486063ffd5.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1237_e7ef338fbf8b5abae028.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1254_e17ce52fb300bba23ecb.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/572_6009ef3a4252cf76550d.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1281_ac1f61a1ceac82ef5c3a.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1269_1f2a8d4c2f0d32f8015c.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1255_64cf7487e3b6ed9cf088.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1300_7963eccd7914586cfe07.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1291_0619decfb4f04b856012.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1301_d74f386080e2a40bf9ed.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1302_a6924788437f7f6a7f03.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://proxt-cdn.xuetangx.com/fe-proxtassets/1287_07a707cc838c899e0e6a.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><h3 id="æ¨¡æ‹Ÿ"><a href="#æ¨¡æ‹Ÿ" class="headerlink" title="æ¨¡æ‹Ÿ"></a>æ¨¡æ‹Ÿ</h3><p>äºæ˜¯â€¦æƒ³æ³•å°±æ˜¯æ¨¡æ‹Ÿ JS é¡µé¢çš„åŠ è½½â€¦</p><p>ä»ç„¶å¿ƒå­˜ä¾¥å¹¸ï¼Œæƒ³ç€ä¸ç”¨æ²¹çŒ´å»å†™é¡µé¢åŠ è½½åè¿è¡Œçš„æŠ“å–è„šæœ¬ï¼Œæˆ–æ˜¯ä¸ç”¨ <code>PhantomJS</code> å†™ JS æ¨¡æ‹Ÿï¼ˆè¿™ä¸¤è€…éƒ½ä¸å¤Ÿä¼˜é›…ï¼‰ï¼Œäºæ˜¯æ‰“å¼€ DevTools çš„ Network é¡µé¢æ¨¡æ‹Ÿæ•´ä¸ªé¡µé¢çš„åŠ è½½è¿‡ç¨‹ï¼š</p><p><img src="https://s2.loli.net/2022/01/29/4OnxEIr7pWPLtUV.png" alt="image-20220129225952673"></p><p>æˆ‘ä»¬æƒ³è¦æœç´¢çš„ä¿¡æ¯æ˜¯è¿™ä¸ªè§†é¢‘çš„å­—å¹• IDï¼Œä¹Ÿå°±æ˜¯ <code>https://tsinghua.yuketang.cn/mooc-api/v1/lms/service/subtitle_parse/?c_d=07AA3C78762F81A09C33DC5901307461&amp;lg=0</code> ä¸­çš„ <code>07AA3C78762F81A09C33DC5901307461</code>ã€‚å¯¹æ‰€æœ‰è¯·æ±‚å…¨æ–‡æ£€ç´¢ï¼š</p><p><img src="https://s2.loli.net/2022/01/29/c8YTzbfE2x9RjNr.png" alt="image-20220129230159693"></p><p>é¦–å…ˆï¼Œå› ä¸ºæˆ‘ä»¬æœ€åˆå¹¶ä¸çŸ¥é“è¿™ä¸ª ID æ˜¯å¤šå°‘ï¼Œæ‰€ä»¥ä»¥è¿™ä¸ª ID ä¸ºç›®æ ‡ URL çš„ç›´æ¥ç•¥å»ï¼Œå› ä¸ºè¿™ä¸ª ID è‚¯å®šæ˜¯ä»¥æŸç§æ–¹å¼ä¼ åˆ°å‰ç«¯çš„ã€‚æ‰€ä»¥ç›®å…‰å°±æ”¾åœ¨äº†ç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªä¸¤ä¸ªè¯·æ±‚ä¸Šé¢ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªè¯·æ±‚çš„ URL ä¼¼ä¹å¾ˆåˆé€‚ï¼š</p><p><code>[GET] https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/leaf_info/3029907/2224317/?sign=8NpUsbr6GZH&amp;term=latest&amp;uv_id=2598</code></p><p>å¯¹ç…§ä¸€ä¸‹ï¼š</p><ul><li>3029907 æ˜¯è¯¾ç¨‹ ID</li><li>2224317 æ˜¯è¿™ä¸ªè§†é¢‘çš„ ID</li><li>8NpUsbr6GZH ä¼¼ä¹æ˜¯æˆ‘è¿™ä¸ªå­¦ç”Ÿçš„ IDï¼ˆå› ä¸ºåˆ«çš„è¯¾ç¨‹ç•Œé¢é‡Œé¢ä¹Ÿå¸¦æœ‰è¿™ä¸ª IDï¼‰</li><li>2598 åº”è¯¥æ˜¯ univ_IDï¼Œå­¦æ ¡ ID</li></ul><p>è€Œä¸”æ˜¯ GET è¯·æ±‚ï¼Œé™¤äº† Cookies ä¹‹å¤–ä¸éœ€è¦åˆ«çš„ POST å‚æ•°ã€‚</p><p>å°è¯•è®¿é—®ï¼š</p><p><img src="https://s2.loli.net/2022/01/29/qrRzEHdeusWP72N.png" alt="image-20220129230600173"></p><p><code>XTBZ</code> æ˜¯ä¸ªå•¥ï¼Ÿéš¾é“ GET è¯·æ±‚è¿˜éœ€è¦éªŒè¯ï¼Ÿå›åˆ°å‘è¯·æ±‚é‚£é‡Œè®¤çœŸçœ‹äº†ä¸‹ headersï¼š</p><p><img src="https://s2.loli.net/2022/01/29/2Ux9jtNVL13raCT.png" alt="image-20220129230701817"></p><p>å¥½å§ï¼Œç¡®å®æœ‰ä¸ª <code>xtbz</code> å­—æ®µï¼Œäºæ˜¯ç…§ç€å¡«ä¸Šå»â€¦</p><pre class="language-python" data-language="python"><code class="language-python">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/leaf_info/3029907/2224317/?sign=8NpUsbr6GZH&amp;term=latest&amp;uv_id=2598"</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>\                            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36'</span><span class="token punctuation">,</span>                            <span class="token string">'xtbz'</span><span class="token punctuation">:</span> <span class="token string">'cloud'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                            cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">"./cookies"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ç»“æœï¼š</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>'msg'<span class="token operator">:</span> ''<span class="token punctuation">,</span> 'data'<span class="token operator">:</span> <span class="token punctuation">&#123;</span>'sku_id'<span class="token operator">:</span> <span class="token number">813523</span><span class="token punctuation">,</span> 'is_assessed'<span class="token operator">:</span> False<span class="token punctuation">,</span> 'locked_reason'<span class="token operator">:</span> None<span class="token punctuation">,</span> 'course_id'<span class="token operator">:</span> <span class="token number">1360275</span><span class="token punctuation">,</span> 'classroom_short_name'<span class="token operator">:</span> None<span class="token punctuation">,</span> 'university_id'<span class="token operator">:</span> '<span class="token number">2598</span>'<span class="token punctuation">,</span> 'score_deadline'<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 'current_price'<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 'id'<span class="token operator">:</span> <span class="token number">2224317</span><span class="token punctuation">,</span> 'user_id'<span class="token operator">:</span> <span class="token number">20970575</span><span class="token punctuation">,</span> 'content_info'<span class="token operator">:</span> <span class="token punctuation">&#123;</span>'status'<span class="token operator">:</span> 'post'<span class="token punctuation">,</span> 'video_user_play'<span class="token operator">:</span> None<span class="token punctuation">,</span> 'expand_discuss'<span class="token operator">:</span> False<span class="token punctuation">,</span> 'score_evaluation'<span class="token operator">:</span> <span class="token punctuation">&#123;</span>'score_proportion'<span class="token operator">:</span> <span class="token punctuation">&#123;</span>'proportion'<span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 'score'<span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> 'id'<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> 'name'<span class="token operator">:</span> 'è§† é¢‘å•å…ƒè€ƒæ ¸'<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 'download'<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 'is_score'<span class="token operator">:</span> True<span class="token punctuation">,</span> 'is_discuss'<span class="token operator">:</span> True<span class="token punctuation">,</span> 'remark'<span class="token operator">:</span> <span class="token punctuation">&#123;</span>'remark'<span class="token operator">:</span> ''<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 'cover_desc'<span class="token operator">:</span> ''<span class="token punctuation">,</span> 'cover_thumbnail'<span class="token operator">:</span> 'https<span class="token operator">:</span><span class="token comment">//qn-next.xuetangx.com/15659303522988.jpg?imageView2/0/h/500', 'media': </span><span class="token punctuation">&#123;</span>'lecturer'<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 'ccid'<span class="token operator">:</span> '07AA3C78762F81A09C33DC5901307461'<span class="token punctuation">,</span> 'start_time'<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 'cover'<span class="token operator">:</span> 'https<span class="token operator">:</span><span class="token comment">//qn-next.xuetangx.com/15659303522988.jpg', 'ccurl': '07AA3C78762F81A09C33DC5901307461', 'duration': 550, 'end_time': 0, 'live_palyback_url': '', 'live_url': '', 'type': 'video', 'teacher': []&#125;, 'cover': 'https://qn-next.xuetangx.com/15659303522988.jpg', 'leaf_type_id': None, 'context': '&lt;!DOCTYPE html>&lt;html>&lt;head>&lt;/head>&lt;body>\n&lt;/body>&lt;/html>'&#125;, 'classroom_id': '3029907', 'leaf_type': 0, 'has_classend': True, 'upgrade_sku_status': None, 'price': 0, 'user_role': </span><span class="token number">3</span><span class="token punctuation">,</span> 'class_start_time'<span class="token operator">:</span> <span class="token number">1613959200000</span><span class="token punctuation">,</span> 'upgrade_sku_id'<span class="token operator">:</span> None<span class="token punctuation">,</span> 'be_in_force'<span class="token operator">:</span> False<span class="token punctuation">,</span> 'teacher'<span class="token operator">:</span> <span class="token punctuation">&#123;</span>'org_name'<span class="token operator">:</span> 'æ¸…åå¤§å­¦'<span class="token punctuation">,</span> 'picture'<span class="token operator">:</span> 'https<span class="token operator">:</span><span class="token comment">//qn-next.xuetangx.com/15659303632348.jpg', 'name': 'ã€æ•™å¸ˆåå­—ã€‘', 'department_name': 'ã€æ•™å¸ˆé™¢ç³»ã€‘', 'intro': 'ã€æ•™å¸ˆä»‹ç»ã€‘', 'job_title': 'å‰¯æ•™æˆ'&#125;, 'is_score': True, 'is_deleted': False, 'name': 'å¼€ç¯‡çš„è¯', 'is_locked': False, 'class_end_time': 1623596400000&#125;, 'success': True&#125;</span></code></pre><p>å¥½å§ï¼Œçœ‹åˆ° ccid æˆ‘ä»¬ç»ˆäºæ˜¯æ‹¿åˆ°æƒ³è¦çš„ä¸œè¥¿äº†ã€‚è¿™ä¸ª Response é‡Œé¢æ‰“ç äº†ä¸€äº›è·Ÿè¯¾ç¨‹æœ‰å…³çš„å†…å®¹ï¼ˆè™½ç„¶å·²ç»æ³„éœ²çš„å·®ä¸å¤šäº†å§xï¼‰</p><p>å¥½çš„ï¼Œç°åœ¨æ¥æ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œæˆªè‡³ç›®å‰æˆ‘ä»¬å·²ç»è·å¾—äº†ä»ä¸€ä¸ªè§†é¢‘åœ¨ç½‘é¡µä¸Šå¤–æ˜¾çš„ ID è½¬æ¢æˆå…¶ CCID çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ <code>[GET] https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/leaf_info/[è¯¾ç¨‹å·]/[è§†é¢‘å¤–æ˜¾ID]/?sign=[å­¦ç”ŸID]&amp;term=latest&amp;uv_id=2598</code>ï¼Œç„¶å<code>CCID = response.json()[&#39;data&#39;][&#39;content_info&#39;][&#39;media&#39;][&#39;ccid&#39;]</code>ï¼Œæ¥ç€æˆ‘ä»¬å°±èƒ½é€šè¿‡ <code>[GET] https://tsinghua.yuketang.cn/mooc-api/v1/lms/service/subtitle_parse/?c_d=[CCID]&amp;lg=0</code> æ¥è·å–å¯¹åº”è§†é¢‘å­—å¹•ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬è¿˜æƒ³ä¼˜åŒ–ï¼Œå°±æ˜¯æ€ä¹ˆæŠŠä¸€ä¸ªè¯¾ç¨‹æ‰€æœ‰çš„ <code>[è§†é¢‘å¤–æ˜¾ID]</code> å…¨éƒ¨æ‹¿å‡ºæ¥ï¼Œäº‹å®ä¸Šè¿™ä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œå› ä¸ºæˆ‘ä»¬å†ä»”ç»†æ£€æŸ¥ä¸€ä¸‹å‘é€çš„è¿™ä¸€å †è¯·æ±‚ï¼Œæ‰¾åˆ°äº†ï¼š</p><p><code>[GET] https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/course/chapter?cid=3029907&amp;sign=8NpUsbr6GZH&amp;term=latest&amp;uv_id=2598</code>ï¼Œè¯·æ±‚äº†æ•´ä¸ªè¯¾ç¨‹çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯¹å…¶è¿”å›çš„ JSON è§£ç å¾—åˆ°ï¼š</p><p><img src="https://s2.loli.net/2022/01/29/KftCcXuOY73v5NR.png" alt="image-20220129232309709"></p><p>ä»è¿™ä¸ª Response é‡Œé¢æˆ‘ä»¬èƒ½æ‹¿åˆ°æ‰€æœ‰è§†é¢‘çš„å¤–æ˜¾ IDã€‚</p><h3 id="è°ƒ-API"><a href="#è°ƒ-API" class="headerlink" title="è°ƒ API"></a>è°ƒ API</h3><ul><li><code>[GET] https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/course/chapter?cid=[è¯¾ç¨‹ID]&amp;sign=[å­¦ç”ŸID]&amp;term=latest&amp;uv_id=2598</code> -&gt; è§†é¢‘å¤–æ˜¾ ID çš„åˆ—è¡¨</li><li><code>[GET] https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/leaf_info/[è¯¾ç¨‹ID]/[è§†é¢‘å¤–æ˜¾ID]/?sign=[å­¦ç”ŸID]&amp;term=latest&amp;uv_id=2598</code> -&gt; è§†é¢‘ CCID</li><li><code>[GET] https://tsinghua.yuketang.cn/mooc-api/v1/lms/service/subtitle_parse/?c_d=[CCID]&amp;lg=0</code> -&gt; è§†é¢‘å­—å¹•</li></ul><p>æ•´ç†æˆä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_course_info</span><span class="token punctuation">(</span>cid<span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">:</span>        video_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'''https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/course/chapter?cid=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>cid<span class="token punctuation">&#125;</span></span><span class="token string">&amp;sign=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sid<span class="token punctuation">&#125;</span></span><span class="token string">&amp;term=latest&amp;uv_id=2598'''</span></span>    cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">'./cookies'</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>\                            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36'</span><span class="token punctuation">,</span>                            <span class="token string">'xtbz'</span><span class="token punctuation">:</span> <span class="token string">'cloud'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                            cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">"./cookies"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>    chapter_list <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'course_chapter'</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> chapter <span class="token keyword">in</span> chapter_list<span class="token punctuation">:</span>        leaves <span class="token operator">=</span> chapter<span class="token punctuation">[</span><span class="token string">'section_leaf_list'</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> leaf <span class="token keyword">in</span> leaves<span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                video_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>leaf<span class="token punctuation">[</span><span class="token string">'leaf_list'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                <span class="token keyword">pass</span>        <span class="token keyword">return</span> video_list<span class="token keyword">def</span> <span class="token function">get_caption</span><span class="token punctuation">(</span>cid<span class="token punctuation">,</span> sid<span class="token punctuation">,</span> vid<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'''https://tsinghua.yuketang.cn/mooc-api/v1/lms/learn/leaf_info/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>cid<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>vid<span class="token punctuation">&#125;</span></span><span class="token string">/?sign=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sid<span class="token punctuation">&#125;</span></span><span class="token string">&amp;term=latest&amp;uv_id=2598'''</span></span>    cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">'./cookies'</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>\                            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36'</span><span class="token punctuation">,</span>                            <span class="token string">'xtbz'</span><span class="token punctuation">:</span> <span class="token string">'cloud'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                            cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">"./cookies"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>    video_name <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>        ccid <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'content_info'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'media'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'ccid'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> ccid<span class="token punctuation">:</span> <span class="token keyword">raise</span> BaseException<span class="token punctuation">(</span><span class="token string">"HTML Introduction. No video."</span><span class="token punctuation">)</span>                url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'''https://tsinghua.yuketang.cn/mooc-api/v1/lms/service/subtitle_parse/?c_d=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>ccid<span class="token punctuation">&#125;</span></span><span class="token string">&amp;lg=0'''</span></span>        cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">'./cookies'</span><span class="token punctuation">)</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span>\                                <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36'</span><span class="token punctuation">,</span>                                <span class="token string">'xtbz'</span><span class="token punctuation">:</span> <span class="token string">'cloud'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                                cookies <span class="token operator">=</span> getCookies<span class="token punctuation">(</span><span class="token string">"./cookies"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>        data<span class="token punctuation">[</span><span class="token string">'start'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'start'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        caption_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'start'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"./output/[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>vid<span class="token punctuation">&#125;</span></span><span class="token string">] </span><span class="token interpolation"><span class="token punctuation">&#123;</span>video_name<span class="token punctuation">&#125;</span></span><span class="token string">.txt"</span></span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> caption <span class="token keyword">in</span> caption_list<span class="token punctuation">:</span>            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"%-10d  %s\n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>caption<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> caption<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span></code></pre><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/01/29/klDeE37nTJ6QPgb.png" alt="image-20220129235837541"></p><h2 id="ç¢ç¢å¿µ"><a href="#ç¢ç¢å¿µ" class="headerlink" title="ç¢ç¢å¿µ"></a>ç¢ç¢å¿µ</h2><p>æ¸…åé›¨è¯¾å ‚ç”¨æ¥æ”¾ MOOC çš„è¿™ä¸ªå¹³å°å’Œå­¦å ‚åœ¨çº¿é‚£ä¸ªå¹³å°å‰ç«¯æ˜¯ä¸€æ ·çš„ã€‚</p><p>è¿™ç®€ç›´å°±å’Œ net9.org å’Œ stu.cs.tsinghua.edu.cn çš„åå°ä¸€æ ·ï¼Œå†™ä¸€ä»½è´¦æˆ·ç®¡ç†å·¥å…·ï¼Œä¸€ä»½è‡ªå·±ç”¨ï¼Œå¦ä¸€ä»½æ‹¿å‡ºå»ç”¨ã€‚</p><p>è¿™ç¯‡åšæ–‡ä»…ä¾›ç»ƒä¹ ä½¿ç”¨ï¼Œä¸ä¿è¯èƒ½å¤ç°ï¼Œæ›´ä¸ä¼šæä¾›çˆ¬å–åçš„æ…•è¯¾å­—å¹•æ•°æ®ã€‚ä»¥ä¸Šã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2022/01/30/nkI5B9DcPQzX3Us.png&quot; alt=&quot;image-20220130000139599&quot;&gt;&lt;/p&gt;
&lt;p&gt;GitHub Repo: &lt;a href=&quot;https://github.com/c7w/TsinghuaMoocCaptionCrawler&quot;&gt;https://github.com/c7w/TsinghuaMoocCaptionCrawler&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Blog: &lt;a href=&quot;https://c7w.tech/yuketang-caption-crawler/&quot;&gt;https://c7w.tech/yuketang-caption-crawler/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/Pythonåº”ç”¨" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-Python%E5%BA%94%E7%94%A8/"/>
    
    
    <category term="çˆ¬è™«" scheme="https://www.c7w.tech/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ Pytorch ver. é˜…è¯»æ‘˜å½• Part C</title>
    <link href="https://www.c7w.tech/dive-into-dl-pytorch-C/"/>
    <id>https://www.c7w.tech/dive-into-dl-pytorch-C/</id>
    <published>2022-01-27T07:00:32.000Z</published>
    <updated>2022-01-28T08:16:40.949Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png" alt=""></p><ul><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š<a href="https://github.com/d2l-ai/d2l-zh">https://github.com/d2l-ai/d2l-zh</a></li><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š<a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/">https://tangshusen.me/Dive-into-DL-PyTorch/#/</a></li></ul><p>çŸ¥è¯†æ¶æ„ï¼š</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg" alt="å°é¢"></p><p>æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œ c7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚</p><p>ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚</p><p>Part C åŒ…å«ï¼š</p><ul><li>Â§ 7 ä¼˜åŒ–ç®—æ³•<ul><li>ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ ï¼Œä¼˜åŒ–å­˜åœ¨çš„æŒ‘æˆ˜</li><li>æ¢¯åº¦ä¸‹é™ï¼ˆç•¥ï¼‰</li><li>Momentum, Adagrad</li><li>RMSProp, AdaDelta</li><li>Adam</li></ul></li><li>Â§ 8 è®¡ç®—æ€§èƒ½<ul><li>å¤š GPU è®¡ç®—</li><li>å¤š GPU è®¡ç®—æ—¶æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½</li></ul></li><li>Â§ 10 NLP<ul><li>Word2Vec, fastText, GloVe</li><li>Encoder-Decoder, Beam Search</li><li>Attention</li></ul></li></ul><a id="more"></a><h2 id="ä¼˜åŒ–ç®—æ³•"><a href="#ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ä¼˜åŒ–ç®—æ³•"></a>ä¼˜åŒ–ç®—æ³•</h2><h3 id="ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ "><a href="#ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ " class="headerlink" title="ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ "></a>ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ </h3><p>æœ¬èŠ‚å°†è®¨è®ºä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ çš„å…³ç³»ï¼Œä»¥åŠä¼˜åŒ–åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„æŒ‘æˆ˜ã€‚</p><p>åœ¨ä¸€ä¸ªæ·±åº¦å­¦ä¹ é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé¢„å…ˆå®šä¹‰ä¸€ä¸ªæŸå¤±å‡½æ•°ã€‚æœ‰äº†æŸå¤±å‡½æ•°ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¼˜åŒ–ç®—æ³•è¯•å›¾å°†å…¶æœ€å°åŒ–ã€‚åœ¨ä¼˜åŒ–ä¸­ï¼Œè¿™æ ·çš„æŸå¤±å‡½æ•°é€šå¸¸è¢«ç§°ä½œä¼˜åŒ–é—®é¢˜çš„<strong>ç›®æ ‡å‡½æ•°</strong>ã€‚ä¾æ®æƒ¯ä¾‹ï¼Œä¼˜åŒ–ç®—æ³•é€šå¸¸åªè€ƒè™‘æœ€å°åŒ–ç›®æ ‡å‡½æ•°ã€‚å…¶å®ï¼Œä»»ä½•æœ€å¤§åŒ–é—®é¢˜éƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬åŒ–ä¸ºæœ€å°åŒ–é—®é¢˜ï¼Œåªéœ€ä»¤ç›®æ ‡å‡½æ•°çš„ç›¸åæ•°ä¸ºæ–°çš„ç›®æ ‡å‡½æ•°å³å¯ã€‚</p><p>ä¼˜åŒ–çš„æŒ‘æˆ˜ï¼š</p><ul><li>å±€éƒ¨æœ€å°å€¼</li><li>Saddle Point</li></ul><h3 id="Gradient-Descent-ä¸-SGD"><a href="#Gradient-Descent-ä¸-SGD" class="headerlink" title="Gradient Descent ä¸ SGD"></a>Gradient Descent ä¸ SGD</h3><p>ï¼ˆä¹‹å‰çš„ç¬”è®°ä¸­è®°å½•å·²ååˆ†è¯¦ç»†ï¼Œæ­¤å¤„ç•¥å»ï¼‰</p><h3 id="åŠ¨é‡æ³•"><a href="#åŠ¨é‡æ³•" class="headerlink" title="åŠ¨é‡æ³•"></a>åŠ¨é‡æ³•</h3><blockquote><p>ã€€æŒ‡æ•°ç§»åŠ¨åŠ æƒå¹³å‡æ³•ï¼Œæ˜¯æŒ‡<strong>å„æ•°å€¼çš„åŠ æƒç³»æ•°éšæ—¶é—´å‘ˆæŒ‡æ•°å¼é€’å‡ï¼Œè¶Šé è¿‘å½“å‰æ—¶åˆ»çš„æ•°å€¼åŠ æƒç³»æ•°å°±è¶Šå¤§</strong>ã€‚</p><p>ã€€æŒ‡æ•°ç§»åŠ¨åŠ æƒå¹³å‡è¾ƒä¼ ç»Ÿçš„å¹³å‡æ³•æ¥è¯´ï¼Œä¸€æ˜¯ä¸éœ€è¦ä¿å­˜è¿‡å»æ‰€æœ‰çš„æ•°å€¼ï¼›äºŒæ˜¯è®¡ç®—é‡æ˜¾è‘—å‡å°ã€‚</p></blockquote><p>ç›®æ ‡å‡½æ•°æœ‰å…³è‡ªå˜é‡çš„æ¢¯åº¦ä»£è¡¨äº†ç›®æ ‡å‡½æ•°åœ¨è‡ªå˜é‡å½“å‰ä½ç½®ä¸‹é™æœ€å¿«çš„æ–¹å‘ã€‚å› æ­¤ï¼Œæ¢¯åº¦ä¸‹é™ä¹Ÿå«ä½œæœ€é™¡ä¸‹é™ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ¢¯åº¦ä¸‹é™æ ¹æ®è‡ªå˜é‡å½“å‰ä½ç½®ï¼Œæ²¿ç€å½“å‰ä½ç½®çš„æ¢¯åº¦æ›´æ–°è‡ªå˜é‡ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœè‡ªå˜é‡çš„è¿­ä»£æ–¹å‘ä»…ä»…å–å†³äºè‡ªå˜é‡å½“å‰ä½ç½®ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚</p><p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªè¾“å…¥å’Œè¾“å‡ºåˆ†åˆ«ä¸ºäºŒç»´å‘é‡ $\boldsymbol{x} = [x_1, x_2]^\top$â€‹ å’Œæ ‡é‡çš„ç›®æ ‡å‡½æ•° $f(\boldsymbol{x})=0.1x_1^2+2x_2^2$â€‹ã€‚</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter07/7.4_output1.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŒä¸€ä½ç½®ä¸Šï¼Œç›®æ ‡å‡½æ•°åœ¨ç«–ç›´æ–¹å‘ï¼ˆ$x_2$ è½´æ–¹å‘ï¼‰æ¯”åœ¨æ°´å¹³æ–¹å‘ï¼ˆ$x_1$ è½´æ–¹å‘ï¼‰çš„æ–œç‡çš„ç»å¯¹å€¼æ›´å¤§ã€‚å› æ­¤ï¼Œç»™å®šå­¦ä¹ ç‡ï¼Œæ¢¯åº¦ä¸‹é™è¿­ä»£è‡ªå˜é‡æ—¶ä¼šä½¿è‡ªå˜é‡åœ¨ç«–ç›´æ–¹å‘æ¯”åœ¨æ°´å¹³æ–¹å‘ç§»åŠ¨å¹…åº¦æ›´å¤§ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾ƒå°çš„å­¦ä¹ ç‡ä»è€Œé¿å…è‡ªå˜é‡åœ¨ç«–ç›´æ–¹å‘ä¸Šè¶Šè¿‡ç›®æ ‡å‡½æ•°æœ€ä¼˜è§£ã€‚ç„¶è€Œï¼Œè¿™ä¼šé€ æˆè‡ªå˜é‡åœ¨æ°´å¹³æ–¹å‘ä¸Šæœæœ€ä¼˜è§£ç§»åŠ¨å˜æ…¢ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬è¯•ç€å°†å­¦ä¹ ç‡è°ƒå¾—ç¨å¤§ä¸€ç‚¹ï¼Œæ­¤æ—¶è‡ªå˜é‡åœ¨ç«–ç›´æ–¹å‘ä¸æ–­è¶Šè¿‡æœ€ä¼˜è§£å¹¶é€æ¸å‘æ•£ã€‚</p><p>åŠ¨é‡æ³•çš„æå‡ºæ˜¯ä¸ºäº†è§£å†³æ¢¯åº¦ä¸‹é™çš„ä¸Šè¿°é—®é¢˜ã€‚è®¾æ—¶é—´æ­¥ $t$â€‹ çš„è‡ªå˜é‡ä¸º $\boldsymbol{x}_t$â€‹ï¼Œå­¦ä¹ ç‡ä¸º $\eta_t$â€‹ï¼Œå¯¹åº”æ¢¯åº¦ä¸º $\boldsymbol  g_t$â€‹ã€‚<br>åœ¨æ—¶é—´æ­¥ $0$â€‹ï¼ŒåŠ¨é‡æ³•åˆ›å»ºé€Ÿåº¦å˜é‡ $\boldsymbol{v}_0$â€‹ï¼Œå¹¶å°†å…¶å…ƒç´ åˆå§‹åŒ–æˆ 0ã€‚åœ¨æ—¶é—´æ­¥ $t&gt;0$â€‹ï¼ŒåŠ¨é‡æ³•å¯¹æ¯æ¬¡è¿­ä»£çš„æ­¥éª¤åšå¦‚ä¸‹ä¿®æ”¹ï¼š</p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{v}_t &\leftarrow \gamma \boldsymbol{v}_{t-1} + \eta_t \boldsymbol{g}_t, \\\boldsymbol{x}_t &\leftarrow \boldsymbol{x}_{t-1} - \boldsymbol{v}_t,\end{aligned}</script><p>å…¶ä¸­ï¼ŒåŠ¨é‡è¶…å‚æ•°$\gamma$æ»¡è¶³$0 \leq \gamma &lt; 1$ã€‚å½“$\gamma=0$æ—¶ï¼ŒåŠ¨é‡æ³•ç­‰ä»·äºå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ã€‚</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter07/7.4_output3.png" alt="img"></p><p>åœ¨åŠ¨é‡æ³•ä¸­ï¼Œè‡ªå˜é‡åœ¨å„ä¸ªæ–¹å‘ä¸Šçš„ç§»åŠ¨å¹…åº¦ä¸ä»…å–å†³å½“å‰æ¢¯åº¦ï¼Œè¿˜å–å†³äºè¿‡å»çš„å„ä¸ªæ¢¯åº¦åœ¨å„ä¸ªæ–¹å‘ä¸Šæ˜¯å¦ä¸€è‡´ã€‚</p><p>å®ç°çš„è¯ä¹Ÿæ˜¯å¤§è°ƒåº“ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">d2l<span class="token punctuation">.</span>train_pytorch_ch7<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'lr'</span><span class="token punctuation">:</span> <span class="token number">0.004</span><span class="token punctuation">,</span> <span class="token string">'momentum'</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                    features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span></code></pre><h3 id="Adagrad"><a href="#Adagrad" class="headerlink" title="Adagrad"></a>Adagrad</h3><p>AdaGrad ç®—æ³•æ ¹æ®è‡ªå˜é‡åœ¨æ¯ä¸ªç»´åº¦çš„æ¢¯åº¦å€¼çš„å¤§å°æ¥è°ƒæ•´å„ä¸ªç»´åº¦ä¸Šçš„å­¦ä¹ ç‡ï¼Œä»è€Œé¿å…ç»Ÿä¸€çš„å­¦ä¹ ç‡éš¾ä»¥é€‚åº”æ‰€æœ‰ç»´åº¦çš„é—®é¢˜ã€‚</p><p>AdaGrad ç®—æ³•ä¼šä½¿ç”¨ä¸€ä¸ªå°æ‰¹é‡éšæœºæ¢¯åº¦ $\boldsymbol{g}_t$â€‹â€‹ æŒ‰å…ƒç´ å¹³æ–¹çš„ç´¯åŠ å˜é‡ $\boldsymbol{s}_t$â€‹â€‹ã€‚åœ¨æ—¶é—´æ­¥ 0ï¼ŒAdaGrad å°† $\boldsymbol{s}_0$â€‹â€‹ ä¸­æ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º 0ã€‚åœ¨æ—¶é—´æ­¥ $t$â€‹â€‹ï¼Œé¦–å…ˆå°†å°æ‰¹é‡éšæœºæ¢¯åº¦ $\boldsymbol{g}_t$â€‹â€‹ æŒ‰å…ƒç´ å¹³æ–¹åç´¯åŠ åˆ°å˜é‡ $\boldsymbol{s}_t$â€‹â€‹ï¼š</p><script type="math/tex; mode=display">\boldsymbol{s}_t \leftarrow \boldsymbol{s}_{t-1} + \boldsymbol{g}_t \odot \boldsymbol{g}_t</script><p>æ¥ç€ï¼Œæˆ‘ä»¬å°†ç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡é€šè¿‡æŒ‰å…ƒç´ è¿ç®—é‡æ–°è°ƒæ•´ä¸€ä¸‹ï¼š</p><script type="math/tex; mode=display">\boldsymbol{x}_t \leftarrow \boldsymbol{x}_{t-1} - \frac{\eta}{\sqrt{\boldsymbol{s}_t + \epsilon}} \odot \boldsymbol{g}_t</script><p>å…¶ä¸­ $\eta$â€‹ æ˜¯å­¦ä¹ ç‡ï¼Œ$\epsilon$â€‹ æ˜¯ä¸ºäº†ç»´æŒæ•°å€¼ç¨³å®šæ€§è€Œæ·»åŠ çš„å¸¸æ•°ï¼Œå¦‚ $10^{-6}$â€‹â€‹â€‹ã€‚è¿™é‡Œå¼€æ–¹ã€é™¤æ³•å’Œä¹˜æ³•çš„è¿ç®—éƒ½æ˜¯æŒ‰å…ƒç´ è¿ç®—çš„ã€‚è¿™äº›æŒ‰å…ƒç´ è¿ç®—ä½¿å¾—ç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ éƒ½åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å­¦ä¹ ç‡ã€‚</p><p>ç”±äº $\boldsymbol{s}_t$ ä¸€ç›´åœ¨ç´¯åŠ æŒ‰å…ƒç´ å¹³æ–¹çš„æ¢¯åº¦ï¼Œè‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸€ç›´åœ¨é™ä½ï¼ˆæˆ–ä¸å˜ï¼‰ã€‚æ‰€ä»¥ï¼Œå½“å­¦ä¹ ç‡åœ¨è¿­ä»£æ—©æœŸé™å¾—è¾ƒå¿«ä¸”å½“å‰è§£ä¾ç„¶ä¸ä½³æ—¶ï¼ŒAdaGradç®—æ³•åœ¨è¿­ä»£åæœŸç”±äºå­¦ä¹ ç‡è¿‡å°ï¼Œå¯èƒ½è¾ƒéš¾æ‰¾åˆ°ä¸€ä¸ªæœ‰ç”¨çš„è§£ã€‚</p><p>é€šè¿‡åç§°ä¸º <code>Adagrad</code> çš„ä¼˜åŒ–å™¨æ–¹æ³•ï¼Œæˆ‘ä»¬ä¾¿å¯ä½¿ç”¨ PyTorch æä¾›çš„ AdaGrad ç®—æ³•æ¥è®­ç»ƒæ¨¡å‹ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">d2l<span class="token punctuation">.</span>train_pytorch_ch7<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adagrad<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'lr'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span></code></pre><h3 id="RMSProp"><a href="#RMSProp" class="headerlink" title="RMSProp"></a>RMSProp</h3><p>é’ˆå¯¹æœ€åæˆ‘ä»¬æå‡ºçš„ Adagrad ç®—æ³•å­˜åœ¨çš„è¿­ä»£åæœŸ learning_rate è¿‡å°é—®é¢˜ï¼ŒRMSProp ç®—æ³•è¢«æå‡ºã€‚</p><p>ä¸åŒäº AdaGrad ç®—æ³•é‡ŒçŠ¶æ€å˜é‡ $\boldsymbol{s}_t$ æ˜¯æˆªè‡³æ—¶é—´æ­¥ $t$ æ‰€æœ‰å°æ‰¹é‡éšæœºæ¢¯åº¦ $\boldsymbol{g}_t$ æŒ‰å…ƒç´ å¹³æ–¹å’Œï¼ŒRMSProp ç®—æ³•å°†è¿™äº›æ¢¯åº¦æŒ‰å…ƒç´ å¹³æ–¹åšæŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ã€‚å…·ä½“æ¥è¯´ï¼Œç»™å®šè¶…å‚æ•° $0 \leq \gamma &lt; 1$ï¼ŒRMSProp ç®—æ³•åœ¨æ—¶é—´æ­¥ $t&gt;0$ è®¡ç®— $\boldsymbol{s}_t \leftarrow \gamma \boldsymbol{s}_{t-1} + (1 - \gamma) \boldsymbol{g}_t \odot \boldsymbol{g}_t$â€‹.</p><p>å’Œ AdaGrad ç®—æ³•ä¸€æ ·ï¼ŒRMSProp ç®—æ³•å°†ç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡é€šè¿‡æŒ‰å…ƒç´ è¿ç®—é‡æ–°è°ƒæ•´ï¼Œç„¶åæ›´æ–°è‡ªå˜é‡ $\boldsymbol{x}_t \leftarrow \boldsymbol{x}_{t-1} - \frac{\eta}{\sqrt{\boldsymbol{s}_t + \epsilon}} \odot \boldsymbol{g}_t $.</p><p>å› ä¸º RMSProp ç®—æ³•çš„çŠ¶æ€å˜é‡ $\boldsymbol{s}_t$ æ˜¯å¯¹å¹³æ–¹é¡¹ $\boldsymbol{g}_t \odot \boldsymbol{g}_t$ çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä½œæ˜¯æœ€è¿‘ $ \dfrac 1 {1-\gamma}$ ä¸ªæ—¶é—´æ­¥çš„å°æ‰¹é‡éšæœºæ¢¯åº¦å¹³æ–¹é¡¹çš„åŠ æƒå¹³å‡ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œè‡ªå˜é‡æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å°±ä¸å†ä¸€ç›´é™ä½ï¼ˆæˆ–ä¸å˜ï¼‰ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">d2l<span class="token punctuation">.</span>train_pytorch_ch7<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>RMSprop<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'lr'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token string">'alpha'</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                    features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span></code></pre><h3 id="AdaDelta"><a href="#AdaDelta" class="headerlink" title="AdaDelta"></a>AdaDelta</h3><p>é™¤äº† RMSProp ç®—æ³•ä»¥å¤–ï¼Œå¦ä¸€ä¸ªå¸¸ç”¨ä¼˜åŒ–ç®—æ³• AdaDelta ç®—æ³•ä¹Ÿé’ˆå¯¹ AdaGrad ç®—æ³•åœ¨è¿­ä»£åæœŸå¯èƒ½è¾ƒéš¾æ‰¾åˆ°æœ‰ç”¨è§£çš„é—®é¢˜åšäº†æ”¹è¿›ã€‚æœ‰æ„æ€çš„æ˜¯ï¼Œ<strong>AdaDelta ç®—æ³•æ²¡æœ‰å­¦ä¹ ç‡è¿™ä¸€è¶…å‚æ•°</strong>ã€‚</p><p>AdaDelta ç®—æ³•ä¹Ÿåƒ RMSProp ç®—æ³•ä¸€æ ·ï¼Œä½¿ç”¨äº†å°æ‰¹é‡éšæœºæ¢¯åº¦ $\boldsymbol{g}_t$ æŒ‰å…ƒç´ å¹³æ–¹çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å˜é‡ $\boldsymbol{s}_t$ã€‚åœ¨æ—¶é—´æ­¥ 0ï¼Œå®ƒçš„æ‰€æœ‰å…ƒç´ è¢«åˆå§‹åŒ–ä¸º 0ã€‚ç»™å®šè¶…å‚æ•° $0 \leq \rho &lt; 1$ï¼ˆå¯¹åº”RMSPropç®—æ³•ä¸­çš„ $\gamma$ï¼‰ï¼Œåœ¨æ—¶é—´æ­¥ $t&gt;0$ï¼ŒåŒRMSPropç®—æ³•ä¸€æ ·è®¡ç®— $ \boldsymbol{s}_t \leftarrow \rho \boldsymbol{s}_{t-1} + (1 - \rho) \boldsymbol{g}_t \odot \boldsymbol{g}_t $ã€‚â€‹</p><p>ä¸ RMSProp ç®—æ³•ä¸åŒçš„æ˜¯ï¼ŒAdaDelta ç®—æ³•è¿˜ç»´æŠ¤ä¸€ä¸ªé¢å¤–çš„çŠ¶æ€å˜é‡ $\Delta\boldsymbol{x}_t$ï¼Œå…¶å…ƒç´ åŒæ ·åœ¨æ—¶é—´æ­¥ 0 æ—¶è¢«åˆå§‹åŒ–ä¸º 0ã€‚æˆ‘ä»¬ä½¿ç”¨ $\Delta\boldsymbol{x}_{t-1}$ æ¥è®¡ç®—è‡ªå˜é‡çš„å˜åŒ–é‡ï¼š$ \boldsymbol{g}_tâ€™ \leftarrow \sqrt{\frac{\Delta\boldsymbol{x}_{t-1} + \epsilon}{\boldsymbol{s}_t + \epsilon}}   \odot \boldsymbol{g}_t $â€‹ï¼Œå…¶ä¸­ $\epsilon$ æ˜¯ä¸ºäº†ç»´æŒæ•°å€¼ç¨³å®šæ€§è€Œæ·»åŠ çš„å¸¸æ•°ï¼Œå¦‚$10^{-5}$ã€‚</p><p>æ¥ç€æ›´æ–°è‡ªå˜é‡ï¼š$ \boldsymbol{x}_t \leftarrow \boldsymbol{x}_{t-1} - \boldsymbol{g}â€™_t $â€‹ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ $\Delta\boldsymbol{x}_t$ æ¥è®°å½•è‡ªå˜é‡å˜åŒ–é‡ $\boldsymbol{g}â€™_t$ æŒ‰å…ƒç´ å¹³æ–¹çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼š$\Delta\boldsymbol{x}_t \leftarrow \rho \Delta\boldsymbol{x}_{t-1} + (1 - \rho) \boldsymbol{g}â€™_t \odot \boldsymbol{g}â€™_t$ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚ä¸è€ƒè™‘ $\epsilon$â€‹ çš„å½±å“ï¼Œ<strong>AdaDelta ç®—æ³•è·Ÿ RMSProp ç®—æ³•çš„ä¸åŒä¹‹å¤„åœ¨äºä½¿ç”¨ $\sqrt{\Delta\boldsymbol{x}_{t-1}}$â€‹ æ¥æ›¿ä»£å­¦ä¹ ç‡ $\eta$â€‹</strong>ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">d2l<span class="token punctuation">.</span>train_pytorch_ch7<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adadelta<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'rho'</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span></code></pre><h3 id="Adam"><a href="#Adam" class="headerlink" title="Adam"></a>Adam</h3><p>Adam ç®—æ³•åœ¨ RMSProp ç®—æ³•åŸºç¡€ä¸Šå¯¹å°æ‰¹é‡éšæœºæ¢¯åº¦ä¹Ÿåšäº†æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼Œæ‰€ä»¥ Adam ç®—æ³•å¯ä»¥çœ‹åšæ˜¯ RMSProp ç®—æ³•ä¸åŠ¨é‡æ³•çš„ç»“åˆã€‚</p><p>Adam ç®—æ³•ä½¿ç”¨äº†åŠ¨é‡å˜é‡ $\boldsymbol{v}_t$ å’Œ RMSProp ç®—æ³•ä¸­å°æ‰¹é‡éšæœºæ¢¯åº¦æŒ‰å…ƒç´ å¹³æ–¹çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å˜é‡ $\boldsymbol{s}_t$ï¼Œå¹¶åœ¨æ—¶é—´æ­¥ 0 å°†å®ƒä»¬ä¸­æ¯ä¸ªå…ƒç´ åˆå§‹åŒ–ä¸º 0ã€‚</p><p>ç»™å®šè¶…å‚æ•° $0 \leq \beta_1 &lt; 1$ï¼ˆç®—æ³•ä½œè€…å»ºè®®è®¾ä¸º 0.9ï¼‰ï¼Œæ—¶é—´æ­¥ $t$ çš„åŠ¨é‡å˜é‡ $\boldsymbol{v}_t$ å³å°æ‰¹é‡éšæœºæ¢¯åº¦ $\boldsymbol{g}_t$ çš„æŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡ï¼š$\boldsymbol{v}_t \leftarrow \beta_1 \boldsymbol{v}_{t-1} + (1 - \beta_1) \boldsymbol{g}_t $ã€‚â€‹</p><p>å’Œ RMSProp ç®—æ³•ä¸­ä¸€æ ·ï¼Œç»™å®šè¶…å‚æ•° $0 \leq \beta_2 &lt; 1$ï¼ˆç®—æ³•ä½œè€…å»ºè®®è®¾ä¸º0.999ï¼‰ï¼Œ<br>å°†å°æ‰¹é‡éšæœºæ¢¯åº¦æŒ‰å…ƒç´ å¹³æ–¹åçš„é¡¹ $\boldsymbol{g}_t \odot \boldsymbol{g}_t$ åšæŒ‡æ•°åŠ æƒç§»åŠ¨å¹³å‡å¾—åˆ° $\boldsymbol{s}_t$ï¼š$\boldsymbol{s}_t \leftarrow \beta_2 \boldsymbol{s}_{t-1} + (1 - \beta_2) \boldsymbol{g}_t \odot \boldsymbol{g}_t$</p><ul><li>åå·®ä¿®æ­£</li></ul><p>ç”±äºæˆ‘ä»¬å°† $\boldsymbol{v}_0$ å’Œ $\boldsymbol{s}_0$ ä¸­çš„å…ƒç´ éƒ½åˆå§‹åŒ–ä¸º 0ï¼Œåœ¨æ—¶é—´æ­¥ $t$ æˆ‘ä»¬å¾—åˆ° $\boldsymbol{v}_t =  (1-\beta_1) \sum_{i=1}^t \beta_1^{t-i} \boldsymbol{g}_i$ã€‚</p><p>å°†è¿‡å»å„æ—¶é—´æ­¥å°æ‰¹é‡éšæœºæ¢¯åº¦çš„æƒå€¼ç›¸åŠ ï¼Œå¾—åˆ° $(1-\beta_1) \sum_{i=1}^t \beta_1^{t-i} = 1 - \beta_1^t$ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ $t$ è¾ƒå°æ—¶ï¼Œè¿‡å»å„æ—¶é—´æ­¥å°æ‰¹é‡éšæœºæ¢¯åº¦æƒå€¼ä¹‹å’Œä¼šè¾ƒå°ã€‚ä¾‹å¦‚ï¼Œå½“ $\beta_1 = 0.9$ æ—¶ï¼Œ$\boldsymbol{v}_1 = 0.1\boldsymbol{g}_1$ã€‚</p><p>ä¸ºäº†æ¶ˆé™¤è¿™æ ·çš„å½±å“ï¼Œå¯¹äºä»»æ„æ—¶é—´æ­¥ $t$ï¼Œæˆ‘ä»¬å¯ä»¥å°† $\boldsymbol{v}_t$ å†é™¤ä»¥ $1 - \beta_1^t$â€‹ï¼Œä»è€Œä½¿è¿‡å»å„æ—¶é—´æ­¥å°æ‰¹é‡éšæœºæ¢¯åº¦æƒå€¼ä¹‹å’Œä¸º 1ã€‚è¿™ä¹Ÿå«ä½œåå·®ä¿®æ­£ã€‚</p><p>åœ¨ Adam ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å¯¹å˜é‡ $\boldsymbol{v}_t$ å’Œ $\boldsymbol{s}_t$ å‡ä½œåå·®ä¿®æ­£ï¼š</p><script type="math/tex; mode=display">\hat{\boldsymbol{v}}_t \leftarrow \frac{\boldsymbol{v}_t}{1 - \beta_1^t}, \\ \hat{\boldsymbol{s}}_t \leftarrow \frac{\boldsymbol{s}_t}{1 - \beta_2^t}.</script><p>æ¥ä¸‹æ¥ï¼ŒAdam ç®—æ³•ä½¿ç”¨ä»¥ä¸Šåå·®ä¿®æ­£åçš„å˜é‡ $\hat{\boldsymbol{v}}_t$ å’Œ $\hat{\boldsymbol{s}}_t$ï¼Œå°†æ¨¡å‹å‚æ•°ä¸­æ¯ä¸ªå…ƒç´ çš„å­¦ä¹ ç‡é€šè¿‡æŒ‰å…ƒç´ è¿ç®—é‡æ–°è°ƒæ•´ï¼š$\boldsymbol{g}_tâ€™ \leftarrow \frac{\eta \hat{\boldsymbol{v}}_t}{\sqrt{\hat{\boldsymbol{s}}_t} + \epsilon}$ã€‚â€‹â€‹å…¶ä¸­ $\eta$ â€‹æ˜¯å­¦ä¹ ç‡ï¼Œ$\epsilon$ â€‹æ˜¯ä¸ºäº†ç»´æŒæ•°å€¼ç¨³å®šæ€§è€Œæ·»åŠ çš„å¸¸æ•°ï¼Œå¦‚ $10^{-8}$â€‹ã€‚</p><p>å’Œ AdaGrad ç®—æ³•ã€RMSProp ç®—æ³•ä»¥åŠ AdaDelta ç®—æ³•ä¸€æ ·ï¼Œç›®æ ‡å‡½æ•°è‡ªå˜é‡ä¸­æ¯ä¸ªå…ƒç´ éƒ½åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å­¦ä¹ ç‡ã€‚æœ€åï¼Œä½¿ç”¨ $\boldsymbol{g}_tâ€™$ â€‹è¿­ä»£è‡ªå˜é‡ï¼š$\boldsymbol{x}_t \leftarrow \boldsymbol{x}_{t-1} - \boldsymbol{g}_tâ€™$ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">d2l<span class="token punctuation">.</span>train_pytorch_ch7<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">'lr'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span></code></pre><h2 id="è®¡ç®—æ€§èƒ½ï¼šå¤š-GPU-è®¡ç®—"><a href="#è®¡ç®—æ€§èƒ½ï¼šå¤š-GPU-è®¡ç®—" class="headerlink" title="è®¡ç®—æ€§èƒ½ï¼šå¤š GPU è®¡ç®—"></a>è®¡ç®—æ€§èƒ½ï¼šå¤š GPU è®¡ç®—</h2><ul><li>å¤š GPU è®¡ç®—</li></ul><p>å…ˆå®šä¹‰ä¸€ä¸ªæ¨¡å‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torchnet <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span> <span class="token comment"># Linear(in_features=10, out_features=1, bias=True)</span></code></pre><p>è¦æƒ³ä½¿ç”¨ PyTorch è¿›è¡Œå¤š GPU è®¡ç®—ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥ç”¨ <code>torch.nn.DataParallel</code> å°†æ¨¡å‹wrapä¸€ä¸‹å³å¯ï¼š<br><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>DataParallel<span class="token punctuation">(</span>net<span class="token punctuation">)</span>net</code></pre><br>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">DataParallel(  (module): Linear(in_features&#x3D;10, out_features&#x3D;1, bias&#x3D;True))</code></pre><br>è¿™æ—¶ï¼Œé»˜è®¤æ‰€æœ‰å­˜åœ¨çš„ GPU éƒ½ä¼šè¢«ä½¿ç”¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬æœºå­ä¸­æœ‰å¾ˆå¤š GPU (ä¾‹å¦‚ä¸Šé¢æ˜¾ç¤ºæˆ‘ä»¬æœ‰ 4 å¼ æ˜¾å¡ï¼Œä½†æ˜¯åªæœ‰ç¬¬ 0ã€3 å—è¿˜å‰©ä¸‹ä¸€ç‚¹ç‚¹æ˜¾å­˜)ï¼Œä½†æˆ‘ä»¬åªæƒ³ä½¿ç”¨ 0ã€3 å·æ˜¾å¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨å‚æ•° <code>device_ids</code> æŒ‡å®šå³å¯ï¼š<code>torch.nn.DataParallel(net, device_ids=[0, 3])</code>ã€‚</p><ul><li>å¤š GPU æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½</li></ul><p>æŒ‰ä¹‹å‰çš„æ–¹æ³•ï¼Œè¢« <code>DataParallel</code> åŒ…å›´çš„æ¨¡å‹ä¿å­˜æ—¶æ­£å¸¸ï¼Œä½†åŠ è½½æ—¶ä¼šå‡ºé—®é¢˜ã€‚</p><p>æ­£ç¡®çš„æ–¹æ³•æ˜¯ä¿å­˜çš„æ—¶å€™åªä¿å­˜ <code>net.module</code>:</p><pre class="language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>net<span class="token punctuation">.</span>module<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"./8.4_model.pt"</span><span class="token punctuation">)</span>new_net<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"./8.4_model.pt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># åŠ è½½æˆåŠŸ</span></code></pre><p>æˆ–è€…å…ˆå°† <code>new_net</code> ç”¨ <code>DataParallel</code> åŒ…æ‹¬ä»¥ä¸‹å†ç”¨ä¸Šé¢æŠ¥é”™çš„æ–¹æ³•è¿›è¡Œæ¨¡å‹åŠ è½½:<br><pre class="language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>net<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"./8.4_model.pt"</span><span class="token punctuation">)</span>new_net <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>new_net <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>DataParallel<span class="token punctuation">(</span>new_net<span class="token punctuation">)</span>new_net<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"./8.4_model.pt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># åŠ è½½æˆåŠŸ</span></code></pre></p><h2 id="NLP"><a href="#NLP" class="headerlink" title="NLP"></a>NLP</h2><h3 id="Word2Vec"><a href="#Word2Vec" class="headerlink" title="Word2Vec"></a>Word2Vec</h3><p>Word2vec æ˜¯ Google äº 2013 å¹´æ¨å‡ºçš„å¼€æºçš„è·å–è¯å‘é‡ word2vec çš„å·¥å…·åŒ…ã€‚å®ƒåŒ…æ‹¬äº†ä¸€ç»„ç”¨äº word embedding çš„æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹é€šå¸¸éƒ½æ˜¯ç”¨æµ…å±‚ï¼ˆä¸¤å±‚ï¼‰ç¥ç»ç½‘ç»œè®­ç»ƒè¯å‘é‡ã€‚</p><p>Word2vec çš„æ¨¡å‹ä»¥å¤§è§„æ¨¡è¯­æ–™åº“ä½œä¸ºè¾“å…¥ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªå‘é‡ç©ºé—´ï¼ˆé€šå¸¸ä¸ºå‡ ç™¾ç»´ï¼‰ã€‚è¯å…¸ä¸­çš„æ¯ä¸ªè¯éƒ½å¯¹åº”äº†å‘é‡ç©ºé—´ä¸­çš„ä¸€ä¸ªç‹¬ä¸€çš„å‘é‡ï¼Œè€Œä¸”<strong>è¯­æ–™åº“ä¸­æ‹¥æœ‰å…±åŒä¸Šä¸‹æ–‡çš„è¯æ˜ å°„åˆ°å‘é‡ç©ºé—´ä¸­çš„è·ç¦»ä¼šæ›´è¿‘</strong>ã€‚</p><p>æœ¬èŠ‚å‚è€ƒ <a href="https://www.zybuluo.com/Dounm/note/591752ï¼Œæ¢³ç†å…¶å‘å±•å†ç¨‹åŠåŸç†ã€‚">https://www.zybuluo.com/Dounm/note/591752ï¼Œæ¢³ç†å…¶å‘å±•å†ç¨‹åŠåŸç†ã€‚</a></p><ul><li><strong>ç¥ç»æ¦‚ç‡è¯­è¨€æ¨¡å‹</strong></li></ul><p><img src="https://raw.githubusercontent.com/Dounm/TheFarmOfDounm/master/resources/images/word2vec/1.png" alt="1"></p><ul><li>è®­ç»ƒæ ·æœ¬ä¸º <code>(Context(w), w)</code>ï¼Œå…¶ä¸­ $w \in Corpus$, $Context(w)$ ä¸ºå…¶å‰é¢çš„ $n-1$ ä¸ªè¯</li><li>$X_w$ ä¸ºç›´æ¥å°† $Context(w)$â€‹ æ”¶å°¾é¡ºæ¬¡ç›¸æ¥å¾—åˆ°çš„ $(n-1) \cdot m$ é•¿åº¦çš„å‘é‡ï¼Œå…¶ä¸­ $m$ ä¸ºè¯å‘é‡é•¿åº¦</li><li>$Z_w = \tanh (WX_w + p), \, y_w = Uz_w + q$.</li></ul><p>äºæ˜¯åœ¨å¯¹ $y_w$ Softmax å½’ä¸€åŒ–ä¹‹åï¼Œ$y_w$ åœ¨å¯¹åº”ç»´åº¦çš„åˆ†é‡å°±æ˜¯å¯¹åº”è¯çš„é¢„æµ‹æ¦‚ç‡ã€‚</p><p>è¿™ä¸ªæ¨¡å‹å­˜åœ¨çš„é—®é¢˜ï¼šè®¡ç®—é‡å¤ªå¤§ã€‚å‡è®¾ $n \sim  5, m \sim 10^2, |Z_w| \sim 10^2, |y_w| = | \Sigma| \sim 10^5$ï¼Œé‚£ä¹ˆ<strong>éšå±‚å’Œè¾“å‡ºå±‚ä¹‹é—´çš„çŸ©é˜µè¿ç®—</strong>ï¼Œä»¥åŠ<strong>è¾“å‡ºå±‚çš„ Softmax è¿ç®—</strong>ä¼šå¤§å¤§å¢åŠ æ¨¡å‹çš„è®¡ç®—é‡ã€‚</p><ul><li><strong>Word2vec å¯¹ç½‘æ ¼ç»“æ„çš„ä¼˜åŒ–</strong></li></ul><p><img src="https://raw.githubusercontent.com/Dounm/TheFarmOfDounm/master/resources/images/word2vec/2.png" alt="7"></p><p>ç½‘æ ¼ç»“æ„åˆ é™¤äº†éšè—å±‚ï¼Œè€Œä¸” Projection Layer ä¹Ÿç”±â€œæ‹¼æ¥â€å˜æˆäº†â€œæ±‚å’Œâ€ï¼Œå› æ­¤ Projection Layer çš„ç»“ç‚¹æ•°ä¸ºè¯å‘é‡å¯¹åº”ç»´æ•°ï¼›è¾“å‡ºå±‚è§„æ¨¡ä»ç„¶æ˜¯è¯å…¸ä¸­è¯çš„ä¸ªæ•°ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºç¥ç»ç½‘ç»œè€Œè¨€ï¼Œæˆ‘ä»¬çš„è¾“å…¥å±‚çš„å‚æ•°æ˜¯ä¸­å„ä¸ªè¯çš„è¯å‘é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯å‘é‡æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨ç»™å®š $x$ è®¡ç®— $y_i$ çš„æ—¶å€™ï¼Œé‡‡ç”¨çš„æ–¹æ³•æ˜¯ $Y = Wx$ï¼Œå³ $y_i = w_i^Tx$ï¼Œå³çŸ©é˜µ $W$ ç¬¬ $i$ è¡Œä¸æŠ•å½±å±‚åšç‚¹ç§¯ã€‚äºæ˜¯è¿™ä¸ªè¯å‘é‡å°±å¯ä»¥ç›´æ¥ç”¨è¾“å‡ºå±‚å’Œæ˜ å°„å±‚ä¹‹é—´çš„å‚æ•° $W$ çš„ç¬¬ $i$ è¡Œ $w_i$ æ¥è¡¨ç¤ºã€‚</p><p>è¿™æ ·ä¸€æ¥çš„è¯ï¼Œæˆ‘ä»¬è®­ç»ƒç¥ç»ç½‘ç»œçš„å‚æ•°ï¼Œå°±ç›¸å½“äºè®­ç»ƒäº†æ¯ä¸ªè¯çš„è¯å‘é‡ï¼Œä¹Ÿå°±å¾—åˆ°äº†è¯å…¸ä¸­æ¯ä¸ªè¯çš„è¯å‘é‡ã€‚</p><ul><li><strong>å¯¹ Softmax å½’ä¸€åŒ–çš„ä¼˜åŒ–</strong></li></ul><p>ä½†æ˜¯è¿™æ ·æˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰ç»•å¼€ Softmax å¯¹è®¡ç®—é‡çš„æ¶ˆè€—ã€‚</p><script type="math/tex; mode=display">\begin {align}p(y_i | Context(w)) &= \dfrac {e^{y_i}}{\sum_{k=1}^{|C|} e^{y_k} } \\ &=\dfrac {e^{w_i^Tx}} { \sum_{k=1}^{|C|} e^{w_k^T x}}\end {align}</script><p>ä¸Šè¿°å¼å­çš„è®¡ç®—ç“¶é¢ˆåœ¨äºåˆ†æ¯ã€‚åˆ†æ¯éœ€è¦æšä¸¾ä¸€éè¯å…¸ä¸­æ‰€æœ‰çš„è¯ï¼Œè€Œè¯å…¸ä¸­çš„è¯çš„æ•°ç›®åœ¨ $10^5$ çš„é‡çº§ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¯­æ–™åº“ä¸­çš„æ¯ä¸ªè¯è¿›è¡Œè®­ç»ƒå¹¶æŒ‰ç…§è¿™ä¸ªå…¬å¼è®¡ç®—æ‰€æœ‰ $y_i$ çš„å½’ä¸€åŒ–æ¦‚ç‡ï¼Œè€Œè¯­æ–™åº“ä¸­çš„è¯çš„æ•°é‡çº§é€šå¸¸åœ¨ million ç”šè‡³ billion é‡çº§ï¼Œè¿™æ ·ä¸€æ¥çš„è¯ï¼Œè®­ç»ƒå¤æ‚åº¦å°±æ— æ³•æ¥å—ã€‚</p><p>å› æ­¤ï¼ŒWord2vec æå‡ºäº†ä¸¤ç§ä¼˜åŒ– Softmax è®¡ç®—è¿‡ç¨‹çš„æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿå¯¹åº”ç€ Word2vec çš„ä¸¤ç§æ¡†æ¶ï¼Œå³ï¼š Hieraichical Softmax å’Œ Negative Samplingã€‚</p><ul><li><strong>Hierarchical Softmax</strong></li></ul><p>æœ¬æ¡†æ¶ä¹‹æ‰€ä»¥å« Hierarchical Softmaxï¼Œæ˜¯å› ä¸ºå®ƒåˆ©ç”¨äº†æ ‘å®ç°äº†åˆ†å±‚çš„ Softmaxï¼Œå³ç”¨æ ‘å½¢ç»“æ„æ›¿ä»£äº†è¾“å‡ºå±‚çš„ç»“æ„ã€‚</p><p>å…¶å…·ä½“ä½œç”¨åŸç†æˆ‘ä»¬ä¼šåœ¨åç»­ä»‹ç» CBOW æ¨¡å‹æ—¶ä»‹ç»ã€‚</p><ul><li><strong>Negative Sampling</strong></li></ul><p>é™¤äº†ä½¿ç”¨ä¸Šè¿° Hierarchical Softmax æ–¹æ³•ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Noise Contrastive Estimation æ¥ä¼˜åŒ–ã€‚</p><blockquote><p>NCE posits that a good model should <strong>be able to differentiate data from noise</strong> by means of <strong>logistic regression</strong>.</p></blockquote><p>Word2vec é‡‡ç”¨çš„ Negative Sampling æ˜¯ NCE çš„ä¸€ç§ç®€åŒ–ç‰ˆæœ¬ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜è®­ç»ƒé€Ÿåº¦ä»¥åŠæ”¹å–„æ‰€å¾—è¯çš„è´¨é‡ã€‚ç›¸æ¯”äº Hierarchical Softmaxï¼ŒNegative Sampling ä¸å†é‡‡ç”¨ Huffman æ ‘ï¼Œè€Œæ˜¯é‡‡ç”¨<strong>éšæœºè´Ÿé‡‡æ ·</strong>ã€‚</p><p>è€ƒè™‘ï¼š</p><script type="math/tex; mode=display">\begin {align}p(y_i | Context(w)) &= \dfrac {e^{y_i}}{\sum_{k=1}^{|C|} e^{y_k} } \\ &=\dfrac {e^{w_i^Tx}} { \sum_{k=1}^{|C|} e^{w_k^T x}}\end {align}</script><p>æˆ‘ä»¬è¦è®©è¿™ä¸ªå€¼æœ€å¤§åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æœ€å¤§åŒ– $w_i$ å’Œ $x$ çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œæœ€å°åŒ–é $w_i$ ä¸ $x$ çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†åˆ†å­çš„ $(Context(w), w_i)$â€‹â€‹ çœ‹åšä¸€ä¸ªæ­£æ ·æœ¬ï¼Œå°†åˆ†æ¯çš„ $(Context(w), w_k)$â€‹â€‹ çœ‹åšè´Ÿæ ·æœ¬ï¼Œè¿™é‡Œ $k \ne i$ã€‚</p><p>é—®é¢˜åœ¨äºï¼Œä¸Šé¢å…¬å¼å°†è¯å…¸é‡Œçš„å‡ ä¹æ‰€æœ‰è¯éƒ½çœ‹åšäº†è´Ÿæ ·æœ¬ï¼Œå› æ­¤è®¡ç®—åˆ†æ¯å¤ªè€—æ—¶é—´ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ Negative Sampling çš„æ€è·¯ï¼Œæ¯æ¬¡åªä»è¯å…¸é‡Œéšæœºé€‰ä¸€äº›è¯ä½œä¸ºå½“å‰è¯ $w$â€‹ çš„è´Ÿæ ·æœ¬ï¼ˆç§°ä¸º $NCE(w)$â€‹â€‹ï¼‰ï¼Œè€Œä¸æ˜¯ä»¥æ‰€æœ‰çš„å­—å…¸é‡Œçš„å…¶ä»–è¯ä½œä¸ºè´Ÿæ ·æœ¬ã€‚</p><p>Word2vec çš„ä½œè€…ä»¬æµ‹è¯•å‘ç°ï¼Œ<strong>æœ€ä½³çš„åˆ†å¸ƒæ˜¯ $\frac 3 4$ æ¬¡å¹‚çš„ Unigram Distribution</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé€‰ä¸­è¯­æ–™åº“ä¸­è¯ $w$ çš„æ¦‚ç‡ä¸º $\dfrac {count(w)^{3/4}} {\sum_{u \in D}count(u)^{3/4}}$. </p><p>å…¶å®åœ¨åšå‡ºéšæœºé€‰å–è´Ÿæ ·æœ¬çš„åŠ¨ä½œä¹‹åï¼Œæˆ‘ä»¬å°±å·²ç»æŠ›å¼ƒäº† Softmax è¿™ä¸ªå‡½æ•°æ‰€ä»£è¡¨çš„å½’ä¸€åŒ–çš„æ„æ€äº†ã€‚ä¹Ÿå°±ä»£è¡¨äº†æˆ‘ä»¬å·²ç»ä¸å†å…³æ³¨æ±‚è§£<strong>è¯­è¨€æ¨¡å‹</strong>çš„é—®é¢˜ï¼Œè€Œåªå…³æ³¨æ±‚è§£<strong>è¯å‘é‡</strong>çš„é—®é¢˜ã€‚</p><ul><li><strong>Continous Bag-of-words</strong></li></ul><p>è¿™é‡Œæˆ‘ä»¬ä»¥ CBOWï¼ˆContinous Bag-of-wordsï¼‰æ¨¡å‹æ¥è¯´æ˜ Hierarchical Softmax çš„ä½œç”¨æ–¹æ³•ã€‚</p><p><img src="https://raw.githubusercontent.com/Dounm/TheFarmOfDounm/master/resources/images/word2vec/3.png" alt="2"></p><p>è¿™é‡Œé¦–å…ˆå¯¹ä¸Šå›¾è¿›è¡Œä¸€å®šçš„è§£é‡Šï¼š</p><ul><li>$Context(w)$: ç”± $w$ å‰åå„ $c$ ä¸ªè¯æ„æˆ</li><li>è¾“å…¥å±‚ï¼šåŒ…å« $2c$ ä¸ªè¯çš„è¯å‘é‡</li><li>æŠ•å½±å±‚ï¼šå°† $2c$ ä¸ªè¯å‘é‡ç´¯åŠ æ±‚å’Œå¾—åˆ°çš„ $X_w$</li><li>è¾“å‡ºå±‚ï¼šè¾“å‡ºå±‚å¯¹åº”çš„æ˜¯ä¸€æ£µ Huffman æ ‘ã€‚è¯¥ Huffman æ ‘ä»¥è¯­æ–™ä¸­å‡ºç°çš„è¯ä¸ºå¶å­èŠ‚ç‚¹ï¼Œä»¥å„è¯åœ¨è¯­æ–™ä¸­<strong>å‡ºç°çš„æ¬¡æ•°å½“åšæƒå€¼</strong>æ„é€ å‡ºæ¥çš„ã€‚è¯¥æ ‘ä¸­ï¼Œå¶å­èŠ‚ç‚¹æ€»å…±æœ‰ $N$ ä¸ªï¼ˆ$N = |D| := |Corpus|$ï¼‰ã€‚</li></ul><p>é¦–å…ˆå®šä¹‰ä»¥ä¸‹ç¬¦å·ï¼š</p><ul><li>$p^w$ï¼šä»æ ¹èŠ‚ç‚¹åˆ° $w$ å¯¹åº”çš„é‚£ä¸ªå¶å­ç»“ç‚¹åœ¨æ ‘ä¸­çš„è·¯å¾„</li><li>$l^w$ï¼šè·¯å¾„ $p^w$ ä¸ŠåŒ…å«çš„ç»“ç‚¹æ•°ç›®</li><li>$p^w_1, p^w_2, \cdots, p^w_{l^w}$ï¼šè·¯å¾„ $p^w$ ä¸Šå¯¹åº”çš„ç»“ç‚¹</li><li>$d^w_2, d^w_3, \cdots, d^w_{l^w}$ï¼šè·¯å¾„ $p^w$ ä¸Šçš„ç»“ç‚¹å¯¹åº”çš„ Huffman ç¼–ç </li><li>$\theta^w_1, \theta^w_2, \cdots, \theta^w_{l^w}$ï¼šè·¯å¾„ $p^w$ ä¸Šéå¶å­ç»“ç‚¹å¯¹åº”çš„è¯å‘é‡</li></ul><p>ä»æ ¹èŠ‚ç‚¹å‡ºå‘åˆ°æŸä¸ªå¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸Šï¼Œæ¯æ¬¡åˆ†æ”¯éƒ½å¯è§†ä¸ºè¿›è¡Œäº†ä¸€æ¬¡<strong>äºŒåˆ†ç±»</strong>ã€‚ä»¥ä¸‹çš„æ¨å¯¼è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é»˜è®¤å·¦è¾¹ï¼ˆç¼–ç ä¸º0ï¼‰æ˜¯è´Ÿç±»ï¼Œå³è¾¹ï¼ˆç¼–ç ä¸º1ï¼‰æ˜¯æ­£ç±»ã€‚äºæ˜¯æœ‰ï¼š</p><ul><li>åˆ†ä¸ºæ­£ç±»çš„æ¦‚ç‡ï¼š$\sigma(X_w^T\theta) = \dfrac 1 {1 + e^{-X_w^T\theta}}$</li><li>åˆ†ä¸ºè´Ÿç±»çš„æ¦‚ç‡ï¼š$1-\sigma(X_w^T\theta)$</li></ul><p>å…¶ä¸­ $\theta$ å³ä¸ºå½“å‰éå¶å­ç»“ç‚¹çš„å¯¹åº”è¯å‘é‡ã€‚</p><p>æ‰€ä»¥ Hierarchical Softmax çš„æ€æƒ³å°±æ˜¯ï¼š<strong>å¯¹äºè¯å…¸ $D$ ä¸­çš„ä»»æ„è¯ $w$ï¼ŒHuffman æ ‘ä¸­å¿…å­˜åœ¨ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°è¯å¯¹åº”å¶å­èŠ‚ç‚¹ $w$ çš„è·¯å¾„ $p^w$ã€‚è¿™æ¡è·¯å¾„ $p^w$ ä¸Šå­˜åœ¨ $l^w-1$ ä¸ªåˆ†æ”¯ï¼Œå°†æ¯ä¸ªåˆ†æ”¯çœ‹åšä¸€æ¬¡äºŒåˆ†ç±»ï¼Œæ¯æ¬¡åˆ†ç±»å°±äº§ç”Ÿä¸€ä¸ªæ¦‚ç‡ï¼Œå°†è¿™äº›æ¦‚ç‡è¿ä¹˜ï¼Œå³å¾—åˆ°æˆ‘ä»¬æ‰€éœ€è¿‘ä¼¼çš„ $p(w | Context(w))$</strong>ã€‚</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æå¤§ä¼¼ç„¶æ³•ï¼Œåªéœ€å°†è¿™ä¸ªè¿‘ä¼¼çš„æ¡ä»¶æ¦‚ç‡æœ€å¤§åŒ–ï¼Œå°±å¯ä»¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„è®­ç»ƒæ•ˆæœã€‚è¿™é‡Œæˆ‘ä»¬ç•¥å»å¯¹å…¶æ±‚æ¢¯åº¦çš„æ¨å¯¼è¿‡ç¨‹ã€‚</p><ul><li><strong>Skip-gram</strong></li></ul><p>Skip-gram æ¨¡å‹æ˜¯å·²çŸ¥å½“å‰è¯ $w$ï¼Œå¯¹å…¶ä¸Šä¸‹æ–‡ä¸­çš„è¯ $Context(w)$ è¿›è¡Œé¢„æµ‹ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ–‡æœ¬åºåˆ—æ˜¯ â€œtheâ€â€œmanâ€â€œlovesâ€â€œhisâ€â€œsonâ€ã€‚ä»¥ â€œlovesâ€ ä½œä¸ºä¸­å¿ƒè¯ï¼Œè®¾èƒŒæ™¯çª—å£å¤§å°ä¸º 2ã€‚Skip-gram æ¨¡å‹æ‰€å…³å¿ƒçš„æ˜¯ï¼Œç»™å®šä¸­å¿ƒè¯ â€œlovesâ€ï¼Œç”Ÿæˆä¸å®ƒè·ç¦»ä¸è¶…è¿‡ 2 ä¸ªè¯çš„èƒŒæ™¯è¯ â€œtheâ€â€œmanâ€â€œhisâ€â€œsonâ€ çš„æ¡ä»¶æ¦‚ç‡ï¼Œå³</p><script type="math/tex; mode=display">P(the, man, his, son | loves) \\= P(the |loves) P(man | loves) P(his | loves) P(son | loves)</script><p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯ä½¿ç”¨æå¤§ä¼¼ç„¶æ³•æœ€å¤§åŒ–è¿™ä¸ªæ¡ä»¶æ¦‚ç‡ã€‚</p><h3 id="fastText"><a href="#fastText" class="headerlink" title="fastText"></a>fastText</h3><p>åœ¨ Word2Vec ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ç›´æ¥åˆ©ç”¨æ„è¯å­¦ä¸­çš„ä¿¡æ¯ã€‚æ— è®ºæ˜¯åœ¨è·³å­—æ¨¡å‹è¿˜æ˜¯è¿ç»­è¯è¢‹æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬éƒ½å°†å½¢æ€ä¸åŒçš„å•è¯ç”¨ä¸åŒçš„å‘é‡æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œâ€œdogâ€ å’Œ â€œdogsâ€ åˆ†åˆ«ç”¨ä¸¤ä¸ªä¸åŒçš„å‘é‡è¡¨ç¤ºï¼Œè€Œæ¨¡å‹ä¸­å¹¶æœªç›´æ¥è¡¨è¾¾è¿™ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„å…³ç³»ã€‚é‰´äºæ­¤ï¼ŒfastText æå‡ºäº†å­è¯åµŒå…¥çš„æ–¹æ³•ï¼Œä»è€Œè¯•å›¾å°†æ„è¯ä¿¡æ¯å¼•å…¥ Word2Vec ä¸­çš„è·³å­—æ¨¡å‹ã€‚</p><p>åœ¨ fastText ä¸­ï¼Œæ¯ä¸ªä¸­å¿ƒè¯è¢«è¡¨ç¤ºæˆå­è¯çš„é›†åˆã€‚ä¸‹é¢æˆ‘ä»¬ç”¨å•è¯ â€œwhereâ€ ä½œä¸ºä¾‹å­æ¥äº†è§£å­è¯æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å•è¯çš„é¦–å°¾åˆ†åˆ«æ·»åŠ ç‰¹æ®Šå­—ç¬¦ â€œ&lt;â€ å’Œ â€œ&gt;â€ ä»¥åŒºåˆ†ä½œä¸ºå‰åç¼€çš„å­è¯ã€‚ç„¶åï¼Œå°†å•è¯å½“æˆä¸€ä¸ªç”±å­—ç¬¦æ„æˆçš„åºåˆ—æ¥æå– $n$â€‹ å…ƒè¯­æ³•ã€‚ä¾‹å¦‚ï¼Œå½“ $n=3$â€‹ æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°æ‰€æœ‰é•¿åº¦ä¸º3çš„å­è¯ï¼š<code>â€œ&lt;wh&gt;â€â€œwheâ€â€œherâ€â€œereâ€â€œ&lt;re&gt;â€</code> ä»¥åŠç‰¹æ®Šå­è¯ <code>â€œ&lt;where&gt;â€</code>ã€‚</p><p>åœ¨ fastText ä¸­ï¼Œå¯¹äºä¸€ä¸ªè¯ $w$â€‹â€‹ï¼Œæˆ‘ä»¬å°†å®ƒæ‰€æœ‰é•¿åº¦åœ¨ $3 \sim 6$â€‹ â€‹çš„å­è¯å’Œç‰¹æ®Šå­è¯çš„å¹¶é›†è®°ä¸º $\mathcal{G}_w$â€‹â€‹ã€‚é‚£ä¹ˆè¯å…¸åˆ™æ˜¯æ‰€æœ‰è¯çš„å­è¯é›†åˆçš„å¹¶é›†ã€‚å‡è®¾è¯å…¸ä¸­å­è¯ $g$â€‹â€‹ çš„å‘é‡ä¸º $\boldsymbol{z}_g$â€‹â€‹ï¼Œé‚£ä¹ˆè·³å­—æ¨¡å‹ä¸­è¯ $w$â€‹â€‹ çš„ä½œä¸ºä¸­å¿ƒè¯çš„å‘é‡ $\boldsymbol{v}_w$ â€‹â€‹â€‹åˆ™è¡¨ç¤ºæˆ</p><script type="math/tex; mode=display">\boldsymbol{v}_w = \sum_{g\in\mathcal{G}_w} \boldsymbol{z}_g.</script><h3 id="GloVe"><a href="#GloVe" class="headerlink" title="GloVe"></a>GloVe</h3><ul><li>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œäº¤å‰ç†µæŸå¤±å‡½æ•°æœ‰åŠ£åŠ¿ã€‚GloVe æ¨¡å‹é‡‡ç”¨äº†å¹³æ–¹æŸå¤±ï¼Œå¹¶é€šè¿‡è¯å‘é‡æ‹Ÿåˆé¢„å…ˆåŸºäºæ•´ä¸ªæ•°æ®é›†è®¡ç®—å¾—åˆ°çš„å…¨å±€ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li>ä»»æ„è¯çš„ä¸­å¿ƒè¯å‘é‡å’ŒèƒŒæ™¯è¯å‘é‡åœ¨ GloVe æ¨¡å‹ä¸­æ˜¯ç­‰ä»·çš„ã€‚</li></ul><h3 id="Encoder-Decoder"><a href="#Encoder-Decoder" class="headerlink" title="Encoder-Decoder"></a>Encoder-Decoder</h3><ul><li>æ€»è§ˆ</li></ul><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter10/10.9_seq2seq.svg" alt="img"></p><p>å›¾ä¸­æè¿°äº†ä½¿ç”¨ç¼–ç å™¨â€”è§£ç å™¨å°†ä¸Šè¿°è‹±è¯­å¥å­ç¿»è¯‘æˆæ³•è¯­å¥å­çš„ä¸€ç§æ–¹æ³•ã€‚</p><p>åœ¨è®­ç»ƒæ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªå¥å­åé™„ä¸Šç‰¹æ®Šç¬¦å·â€œ&lt;eos&gt;â€ï¼ˆend of sequenceï¼‰ä»¥è¡¨ç¤ºåºåˆ—çš„ç»ˆæ­¢ã€‚</p><p>ç¼–ç å™¨æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ä¾æ¬¡ä¸ºè‹±è¯­å¥å­ä¸­çš„å•è¯ã€æ ‡ç‚¹å’Œç‰¹æ®Šç¬¦å·â€œ&lt;eos&gt;â€ã€‚å›¾ä¸­ä½¿ç”¨äº†ç¼–ç å™¨åœ¨æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ä½œä¸ºè¾“å…¥å¥å­çš„è¡¨å¾æˆ–ç¼–ç ä¿¡æ¯ã€‚</p><p>è§£ç å™¨åœ¨å„ä¸ªæ—¶é—´æ­¥ä¸­ä½¿ç”¨è¾“å…¥å¥å­çš„ç¼–ç ä¿¡æ¯å’Œä¸Šä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºä»¥åŠéšè—çŠ¶æ€ä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å¸Œæœ›è§£ç å™¨åœ¨å„ä¸ªæ—¶é—´æ­¥èƒ½æ­£ç¡®ä¾æ¬¡è¾“å‡ºç¿»è¯‘åçš„æ³•è¯­å•è¯ã€æ ‡ç‚¹å’Œç‰¹æ®Šç¬¦å·â€&lt;eos&gt;â€ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè§£ç å™¨åœ¨æœ€åˆæ—¶é—´æ­¥çš„è¾“å…¥ç”¨åˆ°äº†ä¸€ä¸ªè¡¨ç¤ºåºåˆ—å¼€å§‹çš„ç‰¹æ®Šç¬¦å·â€&lt;bos&gt;â€ï¼ˆbeginning of sequenceï¼‰ã€‚</p><ul><li>Encoder (Usually RNN)</li></ul><p>ç¼–ç å™¨çš„ä½œç”¨æ˜¯æŠŠä¸€ä¸ªä¸å®šé•¿çš„è¾“å…¥åºåˆ—å˜æ¢æˆä¸€ä¸ªå®šé•¿çš„èƒŒæ™¯å˜é‡ $\boldsymbol{c}$ï¼Œå¹¶åœ¨è¯¥èƒŒæ™¯å˜é‡ä¸­ç¼–ç è¾“å…¥åºåˆ—ä¿¡æ¯ã€‚å¸¸ç”¨çš„ç¼–ç å™¨æ˜¯å¾ªç¯ç¥ç»ç½‘ç»œã€‚</p><p>è®©æˆ‘ä»¬è€ƒè™‘æ‰¹é‡å¤§å°ä¸º 1 çš„æ—¶åºæ•°æ®æ ·æœ¬ã€‚å‡è®¾è¾“å…¥åºåˆ—æ˜¯ $x_1,\ldots,x_T$ï¼Œ$x_i$ æ˜¯è¾“å…¥å¥å­ä¸­çš„ç¬¬ $i$ ä¸ªè¯ã€‚åœ¨æ—¶é—´æ­¥ $t$ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œå°†è¾“å…¥ $x_t$ çš„ç‰¹å¾å‘é‡ $\boldsymbol{x}_t$ å’Œä¸Šä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $\boldsymbol{h}_{t-1}$ å˜æ¢ä¸ºå½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $\boldsymbol{h}_t$ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•° $f$ è¡¨è¾¾å¾ªç¯ç¥ç»ç½‘ç»œéšè—å±‚çš„å˜æ¢ï¼š</p><script type="math/tex; mode=display">\boldsymbol{h}_t = f(\boldsymbol{x}_t, \boldsymbol{h}_{t-1})</script><p>æ¥ä¸‹æ¥ï¼Œç¼–ç å™¨é€šè¿‡è‡ªå®šä¹‰å‡½æ•° $q$ å°†å„ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€å˜æ¢ä¸ºèƒŒæ™¯å˜é‡</p><script type="math/tex; mode=display">\boldsymbol{c} =  q(\boldsymbol{h}_1, \ldots, \boldsymbol{h}_T)</script><p>ä¾‹å¦‚ï¼Œå½“é€‰æ‹© $q(\boldsymbol{h}_1, \ldots, \boldsymbol{h}_T) = \boldsymbol{h}_T$ æ—¶ï¼ŒèƒŒæ™¯å˜é‡æ˜¯è¾“å…¥åºåˆ—æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $\boldsymbol{h}_T$ã€‚</p><p>ä»¥ä¸Šæè¿°çš„ç¼–ç å™¨æ˜¯ä¸€ä¸ªå•å‘çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼Œæ¯ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€åªå–å†³äºè¯¥æ—¶é—´æ­¥åŠä¹‹å‰çš„è¾“å…¥å­åºåˆ—ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œæ„é€ ç¼–ç å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–ç å™¨æ¯ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€åŒæ—¶å–å†³äºè¯¥æ—¶é—´æ­¥ä¹‹å‰å’Œä¹‹åçš„å­åºåˆ—ï¼ˆåŒ…æ‹¬å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ï¼‰ï¼Œå¹¶ç¼–ç äº†æ•´ä¸ªåºåˆ—çš„ä¿¡æ¯ã€‚</p><ul><li>Decoder</li></ul><p>åˆšåˆšå·²ç»ä»‹ç»ï¼Œç¼–ç å™¨è¾“å‡ºçš„èƒŒæ™¯å˜é‡ $\boldsymbol{c}$ ç¼–ç äº†æ•´ä¸ªè¾“å…¥åºåˆ— $x_1, \ldots, x_T$ çš„ä¿¡æ¯ã€‚ç»™å®šè®­ç»ƒæ ·æœ¬ä¸­çš„è¾“å‡ºåºåˆ— $y_1, y_2, \ldots, y_{Tâ€™}$ï¼Œå¯¹æ¯ä¸ªæ—¶é—´æ­¥ $tâ€™$ï¼ˆç¬¦å·ä¸è¾“å…¥åºåˆ—æˆ–ç¼–ç å™¨çš„æ—¶é—´æ­¥ $t$ æœ‰åŒºåˆ«ï¼‰ï¼Œè§£ç å™¨è¾“å‡º $y_{tâ€™}$ çš„æ¡ä»¶æ¦‚ç‡å°†åŸºäºä¹‹å‰çš„è¾“å‡ºåºåˆ— $y_1,\ldots,y_{tâ€™-1}$ å’ŒèƒŒæ™¯å˜é‡ $\boldsymbol{c}$ï¼Œå³$P(y_{tâ€™} \mid y_1, \ldots, y_{tâ€™-1}, \boldsymbol{c})$ã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå¾ªç¯ç¥ç»ç½‘ç»œä½œä¸ºè§£ç å™¨ã€‚åœ¨è¾“å‡ºåºåˆ—çš„æ—¶é—´æ­¥ $t^\prime$ï¼Œè§£ç å™¨å°†ä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡º $y_{t^\prime-1}$ ä»¥åŠèƒŒæ™¯å˜é‡ $\boldsymbol{c}$ ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†å®ƒä»¬ä¸ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $\boldsymbol{s}_{t^\prime-1}$ å˜æ¢ä¸ºå½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ $\boldsymbol{s}_{t^\prime}$ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•° $g$ è¡¨è¾¾è§£ç å™¨éšè—å±‚çš„å˜æ¢ï¼š</p><script type="math/tex; mode=display">\boldsymbol{s}_{t^\prime} = g(y_{t^\prime-1}, \boldsymbol{c}, \boldsymbol{s}_{t^\prime-1})</script><p>æœ‰äº†è§£ç å™¨çš„éšè—çŠ¶æ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„è¾“å‡ºå±‚å’Œ softmax è¿ç®—æ¥è®¡ç®— $P(y_{t^\prime} \mid y_1, \ldots, y_{t^\prime-1}, \boldsymbol{c})$ï¼Œä¾‹å¦‚ï¼ŒåŸºäºå½“å‰æ—¶é—´æ­¥çš„è§£ç å™¨éšè—çŠ¶æ€ $\boldsymbol{s}_{t^\prime}$ã€ä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡º $y_{t^\prime-1}$ ä»¥åŠèƒŒæ™¯å˜é‡ $\boldsymbol{c}$ æ¥è®¡ç®—å½“å‰æ—¶é—´æ­¥è¾“å‡º$y_{t^\prime}$çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p><h4 id="Beam-Search"><a href="#Beam-Search" class="headerlink" title="Beam Search"></a>Beam Search</h4><ul><li>è¾“å‡ºå±‚çš„è´ªå©ªæœç´¢ä¸ä¸€å®šèƒ½å¾—åˆ°æœ€ä¼˜è¾“å‡ºåºåˆ—</li></ul><p>ä¸Šä¸€èŠ‚é‡Œå·²ç»æåˆ°ï¼Œåœ¨å‡†å¤‡è®­ç»ƒæ•°æ®é›†æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨æ ·æœ¬çš„è¾“å…¥åºåˆ—å’Œè¾“å‡ºåºåˆ—åé¢åˆ†åˆ«é™„ä¸Šä¸€ä¸ªç‰¹æ®Šç¬¦å· â€œ&lt;eos&gt;â€ è¡¨ç¤ºåºåˆ—çš„ç»ˆæ­¢ã€‚æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„è®¨è®ºä¸­ä¹Ÿå°†æ²¿ç”¨ä¸Šä¸€èŠ‚çš„å…¨éƒ¨æ•°å­¦ç¬¦å·ã€‚ä¸ºäº†ä¾¿äºè®¨è®ºï¼Œå‡è®¾è§£ç å™¨çš„è¾“å‡ºæ˜¯ä¸€æ®µæ–‡æœ¬åºåˆ—ã€‚è®¾è¾“å‡ºæ–‡æœ¬è¯å…¸ $\mathcal{Y}$ï¼ˆåŒ…å«ç‰¹æ®Šç¬¦å· â€œ&lt;eos&gt;â€ ï¼‰çš„å¤§å°ä¸º $\left|\mathcal{Y}\right|$ï¼Œè¾“å‡ºåºåˆ—çš„æœ€å¤§é•¿åº¦ä¸º $Tâ€™$ã€‚æ‰€æœ‰å¯èƒ½çš„è¾“å‡ºåºåˆ—ä¸€å…±æœ‰ $\mathcal{O}(\left|\mathcal{Y}\right|^{Tâ€™})$ ç§ã€‚è¿™äº›è¾“å‡ºåºåˆ—ä¸­æ‰€æœ‰ç‰¹æ®Šç¬¦å· â€œ&lt;eos&gt;â€ åé¢çš„å­åºåˆ—å°†è¢«èˆå¼ƒã€‚</p><p>è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼šè´ªå©ªæœç´¢ï¼ˆgreedy searchï¼‰ã€‚å¯¹äºè¾“å‡ºåºåˆ—ä»»ä¸€æ—¶é—´æ­¥ $tâ€™$â€‹â€‹ï¼Œæˆ‘ä»¬ä» $|\mathcal{Y}|$â€‹â€‹ ä¸ªè¯ä¸­æœç´¢å‡ºæ¡ä»¶æ¦‚ç‡æœ€å¤§çš„è¯</p><script type="math/tex; mode=display">y _ { t ^ { \prime } } = \underset { y \in \mathcal { Y } } { \operatorname { argmax } } P \left( y | y _ { 1 } , \ldots , y _ { t ^ { \prime } - 1 } , c \right)</script><p>ä½œä¸ºè¾“å‡ºã€‚ä¸€æ—¦æœç´¢å‡º â€œ&lt;eos&gt;â€ ç¬¦å·ï¼Œæˆ–è€…è¾“å‡ºåºåˆ—é•¿åº¦å·²ç»è¾¾åˆ°äº†æœ€å¤§é•¿åº¦ $Tâ€™$â€‹ï¼Œä¾¿å®Œæˆè¾“å‡ºã€‚</p><p>è¿™æ ·åšçš„é—®é¢˜æ˜¯ï¼Œè¿™æ ·â€œé€å±‚è´ªå¿ƒâ€çš„ç­–ç•¥ä¸ä¸€å®šèƒ½å¤Ÿå¾—åˆ°æœ€ä¼˜è¾“å‡ºåºåˆ—ã€‚</p><ul><li>ç©·ä¸¾æœç´¢çš„å¼€é”€è¿‡äºåºå¤§</li><li>Beam Search!</li></ul><p>æŸæœç´¢ï¼ˆbeam searchï¼‰æ˜¯å¯¹è´ªå©ªæœç´¢çš„ä¸€ä¸ªæ”¹è¿›ç®—æ³•ã€‚</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter10/10.10_beam_search.svg" alt="img"></p><p>å®ƒæœ‰ä¸€ä¸ªæŸå®½ï¼ˆbeam sizeï¼‰è¶…å‚æ•°ã€‚æˆ‘ä»¬å°†å®ƒè®¾ä¸º $k$â€‹â€‹ã€‚åœ¨æ—¶é—´æ­¥1æ—¶ï¼Œé€‰å–å½“å‰æ—¶é—´æ­¥æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„ $k$â€‹â€‹ ä¸ªè¯ï¼Œåˆ†åˆ«ç»„æˆ $k$â€‹â€‹ ä¸ªå€™é€‰è¾“å‡ºåºåˆ—çš„é¦–è¯ã€‚åœ¨ä¹‹åçš„æ¯ä¸ªæ—¶é—´æ­¥ï¼ŒåŸºäºä¸Šä¸ªæ—¶é—´æ­¥çš„ $k$ â€‹â€‹ä¸ªå€™é€‰è¾“å‡ºåºåˆ—ï¼Œä» $k\left|\mathcal{Y}\right|$â€‹â€‹ ä¸ªå¯èƒ½çš„è¾“å‡ºåºåˆ—ä¸­é€‰å–æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„ $k$â€‹ â€‹â€‹ä¸ªï¼Œä½œä¸ºè¯¥æ—¶é—´æ­¥çš„å€™é€‰è¾“å‡ºåºåˆ—ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬ä»å„ä¸ªæ—¶é—´æ­¥çš„å€™é€‰è¾“å‡ºåºåˆ—ä¸­ç­›é€‰å‡ºåŒ…å«ç‰¹æ®Šç¬¦å· â€œ&lt;eos&amp; gt;â€çš„åºåˆ—ï¼Œå¹¶å°†å®ƒä»¬ä¸­æ‰€æœ‰ç‰¹æ®Šç¬¦å· â€œ&lt;eos&gt;â€ åé¢çš„å­åºåˆ—èˆå¼ƒï¼Œå¾—åˆ°æœ€ç»ˆå€™é€‰è¾“å‡ºåºåˆ—çš„é›†åˆã€‚</p><p>åœ¨æœ€ç»ˆå€™é€‰è¾“å‡ºåºåˆ—çš„é›†åˆä¸­ï¼Œæˆ‘ä»¬å–ä»¥ä¸‹åˆ†æ•°æœ€é«˜çš„åºåˆ—ä½œä¸ºè¾“å‡ºåºåˆ—ï¼š</p><script type="math/tex; mode=display">\frac{1}{L^\alpha} \log P(y_1, \ldots, y_{L}) = \frac{1}{L^\alpha} \sum_{t'=1}^L \log P(y_{t'} \mid y_1, \ldots, y_{t'-1}, \boldsymbol{c})</script><p>å…¶ä¸­ $L$â€‹â€‹ ä¸ºæœ€ç»ˆå€™é€‰åºåˆ—é•¿åº¦ï¼Œ$\alpha$â€‹â€‹ ä¸€èˆ¬å¯é€‰ä¸º0.75ã€‚åˆ†æ¯ä¸Šçš„ $L^\alpha$ â€‹â€‹æ˜¯ä¸ºäº†æƒ©ç½šè¾ƒé•¿åºåˆ—åœ¨ä»¥ä¸Šåˆ†æ•°ä¸­è¾ƒå¤šçš„å¯¹æ•°ç›¸åŠ é¡¹ã€‚åˆ†æå¯çŸ¥ï¼ŒæŸæœç´¢çš„è®¡ç®—å¼€é”€ä¸º $\mathcal{O}(k\left|\mathcal{Y}\right|Tâ€™)$â€‹â€‹ã€‚è¿™ä»‹äºè´ªå©ªæœç´¢å’Œç©·ä¸¾æœç´¢çš„è®¡ç®—å¼€é”€ä¹‹é—´ã€‚æ­¤å¤–ï¼Œè´ªå©ªæœç´¢å¯çœ‹ä½œæ˜¯æŸå®½ä¸º 1 çš„æŸæœç´¢ã€‚æŸæœç´¢é€šè¿‡çµæ´»çš„æŸå®½ $k$ â€‹â€‹æ¥æƒè¡¡è®¡ç®—å¼€é”€å’Œæœç´¢è´¨é‡ã€‚</p><h3 id="Attention-Mechanism"><a href="#Attention-Mechanism" class="headerlink" title="Attention Mechanism"></a>Attention Mechanism</h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡æ€è€ƒä¸Šä¸€èŠ‚æåˆ°çš„ç¿»è¯‘ä¾‹å­ï¼šè¾“å…¥ä¸ºè‹±è¯­åºåˆ— â€œTheyâ€â€œareâ€â€œwatchingâ€â€œ.â€ï¼Œè¾“å‡ºä¸ºæ³•è¯­åºåˆ— â€œIlsâ€â€œregardentâ€â€œ.â€ã€‚</p><p>ä¸éš¾æƒ³åˆ°ï¼Œè§£ç å™¨åœ¨ç”Ÿæˆè¾“å‡ºåºåˆ—ä¸­çš„æ¯ä¸€ä¸ªè¯æ—¶å¯èƒ½åªéœ€åˆ©ç”¨è¾“å…¥åºåˆ—æŸä¸€éƒ¨åˆ†çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨è¾“å‡ºåºåˆ—çš„æ—¶é—´æ­¥ 1ï¼Œè§£ç å™¨å¯ä»¥ä¸»è¦ä¾èµ– â€œTheyâ€â€œareâ€ çš„ä¿¡æ¯æ¥ç”Ÿæˆ â€œIlsâ€ï¼Œåœ¨æ—¶é—´æ­¥ 2 åˆ™ä¸»è¦ä½¿ç”¨æ¥è‡ª â€œwatchingâ€ çš„ç¼–ç ä¿¡æ¯ç”Ÿæˆ â€œregardentâ€ï¼Œæœ€ååœ¨æ—¶é—´æ­¥3åˆ™ç›´æ¥æ˜ å°„å¥å· â€œ.â€ã€‚è¿™çœ‹ä¸Šå»å°±åƒæ˜¯åœ¨è§£ç å™¨çš„æ¯ä¸€æ—¶é—´æ­¥å¯¹è¾“å…¥åºåˆ—ä¸­ä¸åŒæ—¶é—´æ­¥çš„è¡¨å¾æˆ–ç¼–ç ä¿¡æ¯åˆ†é…ä¸åŒçš„æ³¨æ„åŠ›ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯æ³¨æ„åŠ›æœºåˆ¶çš„ç”±æ¥ã€‚</p><p>ä»ç„¶ä»¥å¾ªç¯ç¥ç»ç½‘ç»œä¸ºä¾‹ï¼Œæ³¨æ„åŠ›æœºåˆ¶é€šè¿‡å¯¹ç¼–ç å™¨æ‰€æœ‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€åšåŠ æƒå¹³å‡æ¥å¾—åˆ°èƒŒæ™¯å˜é‡ã€‚è§£ç å™¨åœ¨æ¯ä¸€æ—¶é—´æ­¥è°ƒæ•´è¿™äº›æƒé‡ï¼Œå³æ³¨æ„åŠ›æƒé‡ï¼Œä»è€Œèƒ½å¤Ÿåœ¨ä¸åŒæ—¶é—´æ­¥åˆ†åˆ«å…³æ³¨è¾“å…¥åºåˆ—ä¸­çš„ä¸åŒéƒ¨åˆ†å¹¶ç¼–ç è¿›ç›¸åº”æ—¶é—´æ­¥çš„èƒŒæ™¯å˜é‡ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†è®¨è®ºæ³¨æ„åŠ›æœºåˆ¶æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p><p>åœ¨ä¸Šä¸€èŠ‚é‡Œæˆ‘ä»¬åŒºåˆ†äº†è¾“å…¥åºåˆ—æˆ–ç¼–ç å™¨çš„ç´¢å¼• $t$ â€‹ä¸è¾“å‡ºåºåˆ—æˆ–è§£ç å™¨çš„ç´¢å¼• $tâ€™$â€‹ã€‚è¯¥èŠ‚ä¸­ï¼Œè§£ç å™¨åœ¨æ—¶é—´æ­¥ $tâ€™$ â€‹çš„éšè—çŠ¶æ€ $\boldsymbol{s}_{tâ€™} = g(\boldsymbol{y}_{tâ€™-1}, \boldsymbol{c}, \boldsymbol{s}_{tâ€™-1})$ï¼Œå…¶ä¸­ $\boldsymbol{y}_{tâ€™-1}$â€‹ æ˜¯ä¸Šä¸€æ—¶é—´æ­¥ $tâ€™-1$â€‹ çš„è¾“å‡º $y_{tâ€™-1}$ â€‹çš„è¡¨å¾ï¼Œä¸”ä»»ä¸€æ—¶é—´æ­¥ $tâ€™$ â€‹ä½¿ç”¨ç›¸åŒçš„èƒŒæ™¯å˜é‡ $\boldsymbol{c}$â€‹ã€‚</p><p>ä½†åœ¨æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œè§£ç å™¨çš„æ¯ä¸€æ—¶é—´æ­¥å°†ä½¿ç”¨å¯å˜çš„èƒŒæ™¯å˜é‡ã€‚è®° $\boldsymbol{c}_{tâ€™}$ â€‹æ˜¯è§£ç å™¨åœ¨æ—¶é—´æ­¥ $tâ€™$ â€‹çš„èƒŒæ™¯å˜é‡ï¼Œé‚£ä¹ˆè§£ç å™¨åœ¨è¯¥æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å¯ä»¥æ”¹å†™ä¸ºï¼š$\boldsymbol{s}_{tâ€™} = g(\boldsymbol{y}_{tâ€™-1}, \boldsymbol{c}_{tâ€™}, \boldsymbol{s}_{tâ€™-1})$ã€‚</p><p>è¿™é‡Œçš„å…³é”®æ˜¯å¦‚ä½•è®¡ç®—èƒŒæ™¯å˜é‡ $\boldsymbol{c}_{tâ€™}$ â€‹å’Œå¦‚ä½•åˆ©ç”¨å®ƒæ¥æ›´æ–°éšè—çŠ¶æ€ $\boldsymbol{s}_{tâ€™}$â€‹ã€‚ä¸‹é¢å°†åˆ†åˆ«æè¿°è¿™ä¸¤ä¸ªå…³é”®ç‚¹ã€‚</p><ul><li><strong>è®¡ç®—èƒŒæ™¯å˜é‡</strong></li></ul><p>æˆ‘ä»¬å…ˆæè¿°ç¬¬ä¸€ä¸ªå…³é”®ç‚¹ï¼Œå³è®¡ç®—èƒŒæ™¯å˜é‡ã€‚</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter10/10.11_attention.svg" alt="img"></p><p>å›¾ä¸­æç»˜äº†æ³¨æ„åŠ›æœºåˆ¶å¦‚ä½•ä¸ºè§£ç å™¨åœ¨æ—¶é—´æ­¥ 2 è®¡ç®—èƒŒæ™¯å˜é‡ã€‚</p><p>é¦–å…ˆï¼Œå‡½æ•° $a$â€‹â€‹â€‹ æ ¹æ®è§£ç å™¨åœ¨æ—¶é—´æ­¥ 1 çš„éšè—çŠ¶æ€å’Œç¼–ç å™¨åœ¨å„ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€è®¡ç®— softmax è¿ç®—çš„è¾“å…¥ã€‚softmax è¿ç®—è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒå¹¶å¯¹ç¼–ç å™¨å„ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€åšåŠ æƒå¹³å‡ï¼Œä»è€Œå¾—åˆ°èƒŒæ™¯å˜é‡ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä»¤ç¼–ç å™¨åœ¨æ—¶é—´æ­¥ $t$ çš„éšè—çŠ¶æ€ä¸º $\boldsymbol{h}_t$ï¼Œä¸”æ€»æ—¶é—´æ­¥æ•°ä¸º $T$ã€‚é‚£ä¹ˆè§£ç å™¨åœ¨æ—¶é—´æ­¥ $tâ€™$ â€‹çš„èƒŒæ™¯å˜é‡ä¸ºæ‰€æœ‰ç¼–ç å™¨éšè—çŠ¶æ€çš„åŠ æƒå¹³å‡ï¼š</p><script type="math/tex; mode=display">\boldsymbol{c}_{t'} = \sum_{t=1}^T \alpha_{t' t} \boldsymbol{h}_t,</script><p>å…¶ä¸­ç»™å®š $tâ€™$â€‹ æ—¶ï¼Œæƒé‡ $\alpha_{tâ€™ t}$ â€‹åœ¨ $t=1,\ldots,T$ â€‹çš„å€¼æ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚ä¸ºäº†å¾—åˆ°æ¦‚ç‡åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ softmax è¿ç®—:</p><script type="math/tex; mode=display">\alpha_{t' t} = \frac{\exp(e_{t' t})}{ \sum_{k=1}^T \exp(e_{t' k}) },\quad t=1,\ldots,T.</script><p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å¦‚ä½•è®¡ç®—ä¸Šå¼ä¸­ softmax è¿ç®—çš„è¾“å…¥ $e_{tâ€™ t}$â€‹â€‹ã€‚ç”±äº $e_{tâ€™ t} $ â€‹â€‹åŒæ—¶å–å†³äºè§£ç å™¨çš„æ—¶é—´æ­¥ $tâ€™$â€‹â€‹ å’Œç¼–ç å™¨çš„æ—¶é—´æ­¥ $t$â€‹â€‹ï¼Œæˆ‘ä»¬ä¸å¦¨ä»¥è§£ç å™¨åœ¨æ—¶é—´æ­¥ $tâ€™-1$ â€‹â€‹çš„éšè—çŠ¶æ€ $\boldsymbol{s}_{tâ€™ - 1}$ â€‹â€‹ä¸ç¼–ç å™¨åœ¨æ—¶é—´æ­¥ $t$â€‹â€‹ çš„éšè—çŠ¶æ€ $\boldsymbol{h}_t$â€‹â€‹ ä¸ºè¾“å…¥ï¼Œå¹¶é€šè¿‡å‡½æ•° $a$ â€‹â€‹è®¡ç®—$e_{tâ€™ t}$â€‹â€‹ï¼š</p><script type="math/tex; mode=display">e_{t' t} = a(\boldsymbol{s}_{t' - 1}, \boldsymbol{h}_t).</script><p>è¿™é‡Œå‡½æ•° $a$ â€‹æœ‰å¤šç§é€‰æ‹©ï¼Œå¦‚æœä¸¤ä¸ªè¾“å…¥å‘é‡é•¿åº¦ç›¸åŒï¼Œä¸€ä¸ªç®€å•çš„é€‰æ‹©æ˜¯è®¡ç®—å®ƒä»¬çš„å†…ç§¯ $a(\boldsymbol{s}, \boldsymbol{h})=\boldsymbol{s}^\top \boldsymbol{h}$â€‹ã€‚è€Œæœ€æ—©æå‡ºæ³¨æ„åŠ›æœºåˆ¶çš„è®ºæ–‡åˆ™å°†è¾“å…¥è¿ç»“åé€šè¿‡å«å•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºå˜æ¢ï¼š</p><script type="math/tex; mode=display">a(\boldsymbol{s}, \boldsymbol{h}) = \boldsymbol{v}^\top \tanh(\boldsymbol{W}_s \boldsymbol{s} + \boldsymbol{W}_h \boldsymbol{h}),</script><p>å…¶ä¸­$\boldsymbol{v}$â€‹ã€$\boldsymbol{W}_s$â€‹ã€$\boldsymbol{W}_h$â€‹éƒ½æ˜¯å¯ä»¥å­¦ä¹ çš„æ¨¡å‹å‚æ•°ã€‚</p><ul><li><strong>çŸ¢é‡åŒ–è®¡ç®—</strong> (Query, Key &amp; Value)</li></ul><p>å¹¿ä¹‰ä¸Šï¼Œæ³¨æ„åŠ›æœºåˆ¶çš„è¾“å…¥åŒ…æ‹¬ query ä»¥åŠå¯¹åº”çš„ key å’Œ valueï¼Œå…¶ä¸­ value æ˜¯éœ€è¦åŠ æƒå¹³å‡çš„ä¸€ç»„é¡¹ã€‚åœ¨åŠ æƒå¹³å‡ä¸­ï¼Œvalue çš„æƒé‡æ¥è‡ª $a(query, key)$ã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢é¡¹ä¸ºè§£ç å™¨çš„éšè—çŠ¶æ€ $s_{tâ€™-1}$ï¼ŒKey å’Œ Value å‡ä¸ºç¼–ç å™¨çš„éšè—çŠ¶æ€ $h_t$ã€‚</p><p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå¸¸è§çš„ç®€å•æƒ…å½¢ï¼Œå³ç¼–ç å™¨å’Œè§£ç å™¨çš„éšè—å•å…ƒä¸ªæ•°å‡ä¸º $h$ï¼Œä¸”å‡½æ•°$a(\boldsymbol{s}, \boldsymbol{h})=\boldsymbol{s}^\top \boldsymbol{h}$ã€‚</p><p>å‡è®¾æˆ‘ä»¬å¸Œæœ›æ ¹æ®è§£ç å™¨å•ä¸ªéšè—çŠ¶æ€ $\boldsymbol{s}_{tâ€™ - 1} \in \mathbb{R}^{h}$ å’Œç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€ $\boldsymbol{h}_t \in \mathbb{R}^{h}, t = 1,\ldots,T$ æ¥è®¡ç®—èƒŒæ™¯å‘é‡$\boldsymbol{c}_{tâ€™}\in \mathbb{R}^{h}$ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†æŸ¥è¯¢é¡¹çŸ©é˜µ $\boldsymbol{Q} \in \mathbb{R}^{1 \times h}$ è®¾ä¸º $\boldsymbol{s}_{tâ€™ - 1}^\top$ï¼Œå¹¶ä»¤é”®é¡¹çŸ©é˜µ $\boldsymbol{K} \in \mathbb{R}^{T \times h}$ å’Œå€¼é¡¹çŸ©é˜µ $\boldsymbol{V} \in \mathbb{R}^{T \times h}$ ç›¸åŒä¸”ç¬¬ $t$ è¡Œå‡ä¸º $\boldsymbol{h}_t^\top$â€‹ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡çŸ¢é‡åŒ–è®¡ç®— $\text{softmax}(\boldsymbol{Q}\boldsymbol{K}^\top)\boldsymbol{V}$â€‹â€‹ å³å¯ç®—å‡ºè½¬ç½®åçš„èƒŒæ™¯å‘é‡ $\boldsymbol{c}_{tâ€™}^\top$ã€‚</p><p>å½“æŸ¥è¯¢é¡¹çŸ©é˜µ $\boldsymbol{Q}$ çš„è¡Œæ•°ä¸º $n$ æ—¶ï¼Œä¸Šå¼å°†å¾—åˆ° $n$ è¡Œçš„è¾“å‡ºçŸ©é˜µã€‚è¾“å‡ºçŸ©é˜µä¸æŸ¥è¯¢é¡¹çŸ©é˜µåœ¨ç›¸åŒè¡Œä¸Šä¸€ä¸€å¯¹åº”ã€‚</p><ul><li><strong>æ›´æ–°éšè—çŠ¶æ€</strong> (GRU)</li></ul><p>ä»¥é—¨æ§å¾ªç¯å•å…ƒä¸ºä¾‹ï¼Œåœ¨è§£ç å™¨ä¸­æˆ‘ä»¬å¯ä»¥å¯¹ GRU ä¸­é—¨æ§å¾ªç¯å•å…ƒçš„è®¾è®¡ç¨ä½œä¿®æ”¹ï¼Œä»è€Œå˜æ¢ä¸Šä¸€æ—¶é—´æ­¥ $tâ€™-1$ çš„è¾“å‡º $\boldsymbol{y}_{tâ€™-1}$ã€éšè—çŠ¶æ€ $\boldsymbol{s}_{tâ€™ - 1}$ å’Œå½“å‰æ—¶é—´æ­¥ $tâ€™$ çš„å«æ³¨æ„åŠ›æœºåˆ¶çš„èƒŒæ™¯å˜é‡ $\boldsymbol{c}_{tâ€™}$ã€‚</p><p>è§£ç å™¨åœ¨æ—¶é—´æ­¥ $tâ€™$ çš„éšè—çŠ¶æ€ä¸ºï¼š$\boldsymbol{s}_{tâ€™} = \boldsymbol{z}_{tâ€™} \odot \boldsymbol{s}_{tâ€™-1}  + (1 - \boldsymbol{z}_{tâ€™}) \odot \tilde{\boldsymbol{s}}_{tâ€™}$.â€‹</p><p>å…¶ä¸­çš„é‡ç½®é—¨ã€æ›´æ–°é—¨å’Œå€™é€‰éšè—çŠ¶æ€åˆ†åˆ«ä¸º</p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{r}_{t'} &= \sigma(\boldsymbol{W}_{yr} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{sr} \boldsymbol{s}_{t' - 1} + \boldsymbol{W}_{cr} \boldsymbol{c}_{t'} + \boldsymbol{b}_r),\\\boldsymbol{z}_{t'} &= \sigma(\boldsymbol{W}_{yz} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{sz} \boldsymbol{s}_{t' - 1} + \boldsymbol{W}_{cz} \boldsymbol{c}_{t'} + \boldsymbol{b}_z),\\\tilde{\boldsymbol{s}}_{t'} &= \text{tanh}(\boldsymbol{W}_{ys} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{ss} (\boldsymbol{s}_{t' - 1} \odot \boldsymbol{r}_{t'}) + \boldsymbol{W}_{cs} \boldsymbol{c}_{t'} + \boldsymbol{b}_s),\end{aligned}</script><p>å…¶ä¸­å«ä¸‹æ ‡çš„ $\boldsymbol{W}$ â€‹å’Œ $\boldsymbol{b}$ â€‹åˆ†åˆ«ä¸ºé—¨æ§å¾ªç¯å•å…ƒçš„æƒé‡å‚æ•°å’Œåå·®å‚æ•°ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š&lt;a href=&quot;https://github.com/d2l-ai/d2l-zh&quot;&gt;https://github.com/d2l-ai/d2l-zh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š&lt;a href=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/#/&quot;&gt;https://tangshusen.me/Dive-into-DL-PyTorch/#/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çŸ¥è¯†æ¶æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œ c7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Part C åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Â§ 7 ä¼˜åŒ–ç®—æ³•&lt;ul&gt;
&lt;li&gt;ä¼˜åŒ–ä¸æ·±åº¦å­¦ä¹ ï¼Œä¼˜åŒ–å­˜åœ¨çš„æŒ‘æˆ˜&lt;/li&gt;
&lt;li&gt;æ¢¯åº¦ä¸‹é™ï¼ˆç•¥ï¼‰&lt;/li&gt;
&lt;li&gt;Momentum, Adagrad&lt;/li&gt;
&lt;li&gt;RMSProp, AdaDelta&lt;/li&gt;
&lt;li&gt;Adam&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Â§ 8 è®¡ç®—æ€§èƒ½&lt;ul&gt;
&lt;li&gt;å¤š GPU è®¡ç®—&lt;/li&gt;
&lt;li&gt;å¤š GPU è®¡ç®—æ—¶æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Â§ 10 NLP&lt;ul&gt;
&lt;li&gt;Word2Vec, fastText, GloVe&lt;/li&gt;
&lt;li&gt;Encoder-Decoder, Beam Search&lt;/li&gt;
&lt;li&gt;Attention&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ Pytorch ver. é˜…è¯»åç»ƒä¹ </title>
    <link href="https://www.c7w.tech/dive-into-dl-pytorch-practice/"/>
    <id>https://www.c7w.tech/dive-into-dl-pytorch-practice/</id>
    <published>2022-01-26T13:44:56.000Z</published>
    <updated>2022-01-28T08:20:45.206Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png" alt=""></p><ul><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š<a href="https://github.com/d2l-ai/d2l-zh">https://github.com/d2l-ai/d2l-zh</a></li><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š<a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/">https://tangshusen.me/Dive-into-DL-PyTorch/#/</a></li></ul><p>çŸ¥è¯†æ¶æ„ï¼š</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg" alt="å°é¢"></p><p>æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œc7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚</p><p>ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚</p><p>æœ¬éƒ¨åˆ†åŒ…å«ï¼š</p><ol><li>{Finished} [5-5] å®ç°ä¸€ä¸ªå¯ä»¥å®ç°è¡¨æƒ…è¯†åˆ«çš„ç±» CNN ç½‘ç»œå¹¶è®­ç»ƒï¼Œé‡ç‚¹åœ¨äºé€ å‡ºä¸€ä¸ªæœºå™¨å­¦ä¹ çš„æ¡†æ¶ï¼Œç„¶åè¯„ä¼°å…¶å‡†ç¡®ç‡ã€‚</li><li>{Finished} [5-11, 5-12] å®ç° ResNet å’Œ DenseNetï¼Œæ³¨æ„ä½“ä¼šæ€æ ·æ‰èƒ½ä½¿å¾—è¿ç®—ç»´åº¦åŒ¹é…ã€‚</li></ol><a id="more"></a><h2 id="5-5-CNN"><a href="#5-5-CNN" class="headerlink" title="[5-5] CNN"></a>[5-5] CNN</h2><p>ä¸»è¦æ˜¯æŠŠè®­ç»ƒæ¨¡å‹çš„è½®å­è¿æŠ„å¸¦é€ å†™äº†ä¸€éã€‚</p><ul><li><code>train.py</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> toolkit<span class="token punctuation">.</span>dataset <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> torch<span class="token keyword">from</span> toolkit<span class="token punctuation">.</span>utils <span class="token keyword">import</span> get_device<span class="token keyword">from</span> toolkit<span class="token punctuation">.</span>net <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> toolkit<span class="token punctuation">.</span>procedure <span class="token keyword">import</span> <span class="token operator">*</span><span class="token comment"># By c7w, created on 2022/1/27.</span><span class="token triple-quoted-string string">'''Usage:+ Define your model in toolkit/net.py+ Define your dataset in toolkit/dataset.py+ Define configuration in main.py'''</span>device <span class="token operator">=</span> get_device<span class="token punctuation">(</span><span class="token punctuation">)</span>device <span class="token operator">=</span> <span class="token string">'cpu'</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Now on </span><span class="token interpolation"><span class="token punctuation">&#123;</span>device<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token comment"># Configuration Here</span>config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'epochs'</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>    <span class="token string">'batch_size'</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>    <span class="token comment"># 'optimizer': in training stage</span>    <span class="token string">'early_stop'</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>    <span class="token string">'save_path'</span><span class="token punctuation">:</span> <span class="token string">'save/model2-rms.pth'</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    <span class="token comment"># Data Preparation Stage</span>    tr_data <span class="token operator">=</span> Data<span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">)</span>    vd_data <span class="token operator">=</span> Data<span class="token punctuation">(</span><span class="token string">'valid'</span><span class="token punctuation">)</span>    tt_data <span class="token operator">=</span> Data<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>    tr_set <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>tr_data<span class="token punctuation">,</span> config<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> drop_last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    vd_set <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>vd_data<span class="token punctuation">,</span> config<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> drop_last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    tt_set <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>tt_data<span class="token punctuation">,</span> config<span class="token punctuation">[</span><span class="token string">'batch_size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> drop_last<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token comment"># Training Stage</span>    model <span class="token operator">=</span> LeNet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>    <span class="token comment"># config['optimizer'] = torch.optim.Adam(model.parameters())</span>    config<span class="token punctuation">[</span><span class="token string">'optimizer'</span><span class="token punctuation">]</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>RMSprop<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    model_loss<span class="token punctuation">,</span> model_loss_record <span class="token operator">=</span> train<span class="token punctuation">(</span>tr_set<span class="token punctuation">,</span> vd_set<span class="token punctuation">,</span> model<span class="token punctuation">,</span> config<span class="token punctuation">,</span> device<span class="token punctuation">)</span>    <span class="token comment"># Test Stage</span>    <span class="token keyword">del</span> model    model <span class="token operator">=</span> LeNet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>    model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>config<span class="token punctuation">[</span><span class="token string">'save_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    acc <span class="token operator">=</span> test<span class="token punctuation">(</span>tt_set<span class="token punctuation">,</span> model<span class="token punctuation">,</span> device<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span></code></pre><ul><li><code>toolkit/dataset.py</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">import</span> random<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> Dataset<span class="token punctuation">,</span> DataLoader<span class="token keyword">from</span> icecream <span class="token keyword">import</span> ic<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">(</span>Dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>mode <span class="token operator">=</span> mode        data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"./project/data.csv"</span><span class="token punctuation">)</span>                usage <span class="token operator">=</span> <span class="token string">"Test"</span> <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">"test"</span> <span class="token keyword">else</span> <span class="token string">"Training"</span>        data <span class="token operator">=</span> data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>data<span class="token punctuation">.</span>Usage <span class="token operator">==</span> usage<span class="token punctuation">]</span>                features <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                <span class="token keyword">for</span> r<span class="token punctuation">,</span> row <span class="token keyword">in</span> data<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>  <span class="token builtin">int</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'emotion'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>            feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span> <span class="token keyword">for</span> number <span class="token keyword">in</span> row<span class="token punctuation">[</span><span class="token string">'pixels'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            features<span class="token punctuation">.</span>append<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>Tensor<span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">)</span>        random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>                <span class="token comment"># im = Image.fromarray((self.data[0][0].view(48, 48) * 255).numpy())</span>        <span class="token comment"># im = im.convert('L')</span>        <span class="token comment"># ic(self.data[0][0], self.data[0][1])</span>        <span class="token comment"># im.show()</span>                l <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">10</span>        <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token string">'valid'</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token operator">-</span>l <span class="token punctuation">:</span> <span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span> <span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">-</span> l<span class="token punctuation">]</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Reading </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mode<span class="token punctuation">&#125;</span></span><span class="token string"> set finished with </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> samples in total."</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Example:"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>            <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span>            <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span></code></pre><ul><li><code>toolkit/net.py</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token keyword">class</span> <span class="token class-name">LeNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>LeNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            <span class="token comment"># Conv Layer</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token comment"># FC Layer</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">*</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>                self<span class="token punctuation">.</span>Loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>net<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">loss</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>Loss<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><ul><li><code>toolkit/procedure.py</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>tr_set<span class="token punctuation">,</span> vd_set<span class="token punctuation">,</span> model<span class="token punctuation">,</span> config<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>    max_epoch_count <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">'epochs'</span><span class="token punctuation">]</span>    optimizer <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">'optimizer'</span><span class="token punctuation">]</span>    loss_record <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'train'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'valid'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>    curr_min_loss <span class="token operator">=</span> <span class="token number">1145141919810.0</span>    early_stop_cnt <span class="token operator">=</span> <span class="token number">0</span>    epoch <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">while</span> epoch <span class="token operator">&lt;</span> max_epoch_count<span class="token punctuation">:</span>        model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> tr_set<span class="token punctuation">:</span>            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            x<span class="token punctuation">,</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>            pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>                        l <span class="token operator">=</span> model<span class="token punctuation">.</span>loss<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>                        loss_record<span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        valid_mse <span class="token operator">=</span> validate<span class="token punctuation">(</span>vd_set<span class="token punctuation">,</span> model<span class="token punctuation">,</span> device<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Epoch &#123;:4d&#125; completed, tr_loss = &#123;:.4f&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> valid_mse<span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token keyword">if</span> valid_mse <span class="token operator">&lt;</span> curr_min_loss<span class="token punctuation">:</span>            <span class="token comment"># Save model if model improved</span>            curr_min_loss <span class="token operator">=</span> valid_mse                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Saving model (epoch = &#123;:4d&#125;, loss = &#123;:.4f&#125;)'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> curr_min_loss<span class="token punctuation">)</span><span class="token punctuation">)</span>            torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> config<span class="token punctuation">[</span><span class="token string">'save_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># Save model to specified path</span>            early_stop_cnt <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            early_stop_cnt <span class="token operator">+=</span> <span class="token number">1</span>        epoch <span class="token operator">+=</span> <span class="token number">1</span>        loss_record<span class="token punctuation">[</span><span class="token string">'valid'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>valid_mse<span class="token punctuation">)</span>        <span class="token keyword">if</span> early_stop_cnt <span class="token operator">></span> config<span class="token punctuation">[</span><span class="token string">'early_stop'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token comment"># Stop training if your model stops improving for "config['early_stop']" epochs.</span>            <span class="token keyword">break</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Finished training after </span><span class="token interpolation"><span class="token punctuation">&#123;</span>epoch<span class="token punctuation">&#125;</span></span><span class="token string"> epochs.'</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> curr_min_loss<span class="token punctuation">,</span> loss_record<span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>vd_set<span class="token punctuation">,</span> model<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    total_loss <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> vd_set<span class="token punctuation">:</span>        x<span class="token punctuation">,</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>            vd_loss <span class="token operator">=</span> model<span class="token punctuation">.</span>loss<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> y<span class="token punctuation">)</span>        total_loss <span class="token operator">+=</span> vd_loss<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        total_loss <span class="token operator">=</span> total_loss <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vd_set<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>              <span class="token comment"># compute averaged loss</span>    <span class="token keyword">return</span> total_loss<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>tt_set<span class="token punctuation">,</span> model<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    total_right <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> tt_set<span class="token punctuation">:</span>        x<span class="token punctuation">,</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>                <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token keyword">for</span> i<span class="token punctuation">,</span> logit <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pred<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>logit<span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span> total_right <span class="token operator">+=</span> <span class="token number">1</span>                acc <span class="token operator">=</span> total_right <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tt_set<span class="token punctuation">.</span>dataset<span class="token punctuation">)</span>              <span class="token comment"># compute averaged loss</span>    <span class="token keyword">return</span> acc<span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>tt_set<span class="token punctuation">,</span> model<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    preds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> tt_set<span class="token punctuation">:</span>        x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            pred <span class="token operator">=</span> model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>            preds<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pred<span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    preds <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>preds<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> preds</code></pre><ul><li><code>toolkit/utils.py</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">def</span> <span class="token function">get_device</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token keyword">def</span> <span class="token function">get_one_hot</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> dim<span class="token punctuation">)</span><span class="token punctuation">:</span>    t <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">(</span>dim<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>    t<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">return</span> t</code></pre><ul><li>è®­ç»ƒç»“æœ</li></ul><pre class="language-none"><code class="language-none">Now on cpuReading train set finished with 25839 samples in total.Example:(tensor([[[0.2000, 0.1922, 0.2118,  ..., 0.1804, 0.2392, 0.2863],         [0.1922, 0.1843, 0.1647,  ..., 0.2392, 0.2078, 0.2588],         [0.1961, 0.1804, 0.1608,  ..., 0.2039, 0.1569, 0.2000],         ...,         [0.3098, 0.1961, 0.2353,  ..., 0.2980, 0.3255, 0.3412],         [0.2706, 0.1647, 0.2471,  ..., 0.3098, 0.3294, 0.3373],         [0.2392, 0.1686, 0.2157,  ..., 0.3255, 0.3333, 0.3490]]]), 3)Reading valid set finished with 2870 samples in total.Example:(tensor([[[0.1725, 0.1333, 0.1451,  ..., 0.3176, 0.3216, 0.4510],         [0.1333, 0.1333, 0.1255,  ..., 0.3137, 0.3216, 0.4471],         [0.1333, 0.1216, 0.1137,  ..., 0.3137, 0.3216, 0.4471],         ...,         [0.3922, 0.3255, 0.4039,  ..., 0.4000, 0.4510, 0.5137],         [0.3882, 0.3098, 0.3961,  ..., 0.3843, 0.4549, 0.5333],         [0.4000, 0.2745, 0.3725,  ..., 0.3961, 0.4392, 0.5137]]]), 3)Reading test set finished with 6461 samples in total.Example:(tensor([[[0.7373, 0.7608, 0.7255,  ..., 0.8549, 0.8157, 0.8275],         [0.7529, 0.7608, 0.7137,  ..., 0.8588, 0.8314, 0.8157],         [0.7804, 0.7451, 0.7137,  ..., 0.8510, 0.8353, 0.8157],         ...,         [0.4784, 0.5765, 0.5804,  ..., 0.6863, 0.5451, 0.4235],         [0.2549, 0.3373, 0.4588,  ..., 0.5804, 0.5373, 0.5608],         [0.3608, 0.3961, 0.6275,  ..., 0.5569, 0.3176, 0.6314]]]), 3)Epoch    1 completed, tr_loss &#x3D; 1.4529Saving model (epoch &#x3D;    1, loss &#x3D; 1.4529)Epoch    2 completed, tr_loss &#x3D; 1.2995Saving model (epoch &#x3D;    2, loss &#x3D; 1.2995)Epoch    3 completed, tr_loss &#x3D; 1.1131Saving model (epoch &#x3D;    3, loss &#x3D; 1.1131)Epoch    4 completed, tr_loss &#x3D; 1.0275Saving model (epoch &#x3D;    4, loss &#x3D; 1.0275)Epoch    5 completed, tr_loss &#x3D; 1.1062Epoch    6 completed, tr_loss &#x3D; 0.8805Saving model (epoch &#x3D;    6, loss &#x3D; 0.8805)Epoch    7 completed, tr_loss &#x3D; 0.7520Saving model (epoch &#x3D;    7, loss &#x3D; 0.7520)Epoch    8 completed, tr_loss &#x3D; 0.8390Epoch    9 completed, tr_loss &#x3D; 0.8715Epoch   10 completed, tr_loss &#x3D; 0.6758Saving model (epoch &#x3D;   10, loss &#x3D; 0.6758)Epoch   11 completed, tr_loss &#x3D; 0.6634Saving model (epoch &#x3D;   11, loss &#x3D; 0.6634)Epoch   12 completed, tr_loss &#x3D; 0.5063Saving model (epoch &#x3D;   12, loss &#x3D; 0.5063)Epoch   13 completed, tr_loss &#x3D; 0.5055Saving model (epoch &#x3D;   13, loss &#x3D; 0.5055)Epoch   14 completed, tr_loss &#x3D; 0.6266Epoch   15 completed, tr_loss &#x3D; 0.4653Saving model (epoch &#x3D;   15, loss &#x3D; 0.4653)Epoch   16 completed, tr_loss &#x3D; 0.4373Saving model (epoch &#x3D;   16, loss &#x3D; 0.4373)Epoch   17 completed, tr_loss &#x3D; 0.3892Saving model (epoch &#x3D;   17, loss &#x3D; 0.3892)Epoch   18 completed, tr_loss &#x3D; 0.4048Epoch   19 completed, tr_loss &#x3D; 0.4376Epoch   20 completed, tr_loss &#x3D; 0.3657Saving model (epoch &#x3D;   20, loss &#x3D; 0.3657)Epoch   21 completed, tr_loss &#x3D; 0.3765Epoch   22 completed, tr_loss &#x3D; 0.3329Saving model (epoch &#x3D;   22, loss &#x3D; 0.3329)Epoch   23 completed, tr_loss &#x3D; 0.3969Epoch   24 completed, tr_loss &#x3D; 0.3382Epoch   25 completed, tr_loss &#x3D; 0.3283Saving model (epoch &#x3D;   25, loss &#x3D; 0.3283)Epoch   26 completed, tr_loss &#x3D; 0.3192Saving model (epoch &#x3D;   26, loss &#x3D; 0.3192)Epoch   27 completed, tr_loss &#x3D; 0.3671Epoch   28 completed, tr_loss &#x3D; 0.3457Epoch   29 completed, tr_loss &#x3D; 0.3352Epoch   30 completed, tr_loss &#x3D; 0.3461Epoch   31 completed, tr_loss &#x3D; 0.3258Epoch   32 completed, tr_loss &#x3D; 0.3097Saving model (epoch &#x3D;   32, loss &#x3D; 0.3097)Epoch   33 completed, tr_loss &#x3D; 0.3976Epoch   34 completed, tr_loss &#x3D; 0.3364Epoch   35 completed, tr_loss &#x3D; 0.3275Epoch   36 completed, tr_loss &#x3D; 0.3179Epoch   37 completed, tr_loss &#x3D; 0.3415Epoch   38 completed, tr_loss &#x3D; 0.3471Epoch   39 completed, tr_loss &#x3D; 0.3302Epoch   40 completed, tr_loss &#x3D; 0.3407Epoch   41 completed, tr_loss &#x3D; 0.4045Epoch   42 completed, tr_loss &#x3D; 0.3310Epoch   43 completed, tr_loss &#x3D; 0.3626Epoch   44 completed, tr_loss &#x3D; 0.3288Epoch   45 completed, tr_loss &#x3D; 0.3600Epoch   46 completed, tr_loss &#x3D; 0.3866Epoch   47 completed, tr_loss &#x3D; 0.3613Epoch   48 completed, tr_loss &#x3D; 0.3402Epoch   49 completed, tr_loss &#x3D; 0.3562Epoch   50 completed, tr_loss &#x3D; 0.3674Epoch   51 completed, tr_loss &#x3D; 0.3733Epoch   52 completed, tr_loss &#x3D; 0.3461Epoch   53 completed, tr_loss &#x3D; 0.3542Finished training after 53 epochs.0.5304132487231079</code></pre><h2 id="Resnet-amp-DenseNet-5-11-5-12"><a href="#Resnet-amp-DenseNet-5-11-5-12" class="headerlink" title="Resnet &amp; DenseNet (5-11, 5-12)"></a>Resnet &amp; DenseNet (5-11, 5-12)</h2><ul><li><code>main.py</code></li></ul><p>éšæœºç”Ÿæˆæ•°æ®ï¼Œæ¨¡æ‹Ÿ <code>batch_size = 4</code>ï¼Œ<code>input_channels = 3</code>, <code>pic_size = 96x96</code> çš„æƒ…å†µï¼Œç„¶åå°†å…¶ä¸¢å…¥å®ç°çš„ç½‘ç»œä¸­æŸ¥çœ‹è¿è¡Œç»“æœï¼Œæ²¡æœ‰å‘ç”Ÿé”™è¯¯åˆ™è¯´æ˜ç»´åº¦å¯¹åº”æ­£ç¡®ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> ResNet <span class="token keyword">import</span> ResNet<span class="token keyword">from</span> DenseNet <span class="token keyword">import</span> DenseNet<span class="token keyword">from</span> icecream <span class="token keyword">import</span> ic <span class="token keyword">as</span> <span class="token keyword">print</span>data <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># print(data)</span><span class="token comment"># net = ResNet(3)</span>net <span class="token operator">=</span> DenseNet<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span><span class="token comment"># print(net(data))</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span></code></pre><ul><li><code>ResNet.py</code></li></ul><p>æœ¬æ–‡ä»¶ä¸­å®ç°äº† ResNet-18.</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token comment"># Implementation of ResNet-18</span><span class="token keyword">class</span> <span class="token class-name">Residual</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># Stride: to control the height/width of the manipulating data</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span>stride<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token comment"># If in_channels != out_channels</span>        <span class="token comment"># Then use 1x1 conv layer to change channel size</span>        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span>stride<span class="token punctuation">)</span> <span class="token keyword">if</span> in_channels <span class="token operator">!=</span> out_channels <span class="token keyword">else</span> <span class="token boolean">None</span>                self<span class="token punctuation">.</span>bn <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">)</span>                self<span class="token punctuation">.</span>relu <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        y <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        y <span class="token operator">=</span> self<span class="token punctuation">.</span>bn<span class="token punctuation">(</span>y<span class="token punctuation">)</span>        y <span class="token operator">=</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>y<span class="token punctuation">)</span>        y <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>y<span class="token punctuation">)</span>        y <span class="token operator">=</span> self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>y<span class="token punctuation">)</span>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">:</span>            x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x<span class="token punctuation">)</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">resnet_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> num_residuals<span class="token punctuation">,</span> first_block<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    blk <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_residuals<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token keyword">not</span> first_block<span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Residual<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Residual<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>blk<span class="token punctuation">)</span>    <span class="token keyword">class</span> <span class="token class-name">ResNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>start <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        self<span class="token punctuation">.</span>residual <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>            resnet_block<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            resnet_block<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            resnet_block<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            resnet_block<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        old_shape <span class="token operator">=</span> x<span class="token punctuation">.</span>shape        x <span class="token operator">=</span> self<span class="token punctuation">.</span>start<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">for</span> rb <span class="token keyword">in</span> self<span class="token punctuation">.</span>residual<span class="token punctuation">:</span>            x <span class="token operator">=</span> rb<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x <span class="token operator">=</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>old_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>output<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">return</span> x</code></pre><pre class="language-none"><code class="language-none">ic| net: ResNet(           (start): Sequential(             (0): Conv2d(3, 64, kernel_size&#x3D;(7, 7), stride&#x3D;(2, 2), padding&#x3D;(3, 3))             (1): BatchNorm2d(64, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)             (2): ReLU()             (3): MaxPool2d(kernel_size&#x3D;3, stride&#x3D;2, padding&#x3D;1, dilation&#x3D;1, ceil_mode&#x3D;False)           )           (residual): ModuleList(             (0): Sequential(               (0): Residual(                 (conv1): Conv2d(64, 64, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv2): Conv2d(64, 64, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (bn): BatchNorm2d(64, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(64, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )               (1): Residual(                 (conv1): Conv2d(64, 64, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv2): Conv2d(64, 64, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (bn): BatchNorm2d(64, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(64, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )             )             (1): Sequential(               (0): Residual(                 (conv1): Conv2d(64, 128, kernel_size&#x3D;(3, 3), stride&#x3D;(2, 2), padding&#x3D;(1, 1))                 (conv2): Conv2d(128, 128, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv3): Conv2d(64, 128, kernel_size&#x3D;(1, 1), stride&#x3D;(2, 2))                 (bn): BatchNorm2d(128, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(128, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )               (1): Residual(                 (conv1): Conv2d(128, 128, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv2): Conv2d(128, 128, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (bn): BatchNorm2d(128, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(128, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )             )             (2): Sequential(               (0): Residual(                 (conv1): Conv2d(128, 256, kernel_size&#x3D;(3, 3), stride&#x3D;(2, 2), padding&#x3D;(1, 1))                 (conv2): Conv2d(256, 256, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv3): Conv2d(128, 256, kernel_size&#x3D;(1, 1), stride&#x3D;(2, 2))                 (bn): BatchNorm2d(256, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(256, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )               (1): Residual(                 (conv1): Conv2d(256, 256, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv2): Conv2d(256, 256, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (bn): BatchNorm2d(256, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(256, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )             )             (3): Sequential(               (0): Residual(                 (conv1): Conv2d(256, 512, kernel_size&#x3D;(3, 3), stride&#x3D;(2, 2), padding&#x3D;(1, 1))                 (conv2): Conv2d(512, 512, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv3): Conv2d(256, 512, kernel_size&#x3D;(1, 1), stride&#x3D;(2, 2))                 (bn): BatchNorm2d(512, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(512, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )               (1): Residual(                 (conv1): Conv2d(512, 512, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (conv2): Conv2d(512, 512, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 (bn): BatchNorm2d(512, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (bn2): BatchNorm2d(512, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                 (relu): ReLU()               )             )           )           (output): Sequential(             (0): Flatten(start_dim&#x3D;1, end_dim&#x3D;-1)             (1): Linear(in_features&#x3D;512, out_features&#x3D;10, bias&#x3D;True)           )         )ic| net(data).shape: torch.Size([4, 10])</code></pre><ul><li><code>DenseNet.py</code></li></ul><p>æœ¬æ–‡ä»¶å®ç°äº† DenseNet.</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> enum<span class="token keyword">import</span> torch<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn<span class="token comment"># Implementation of DenseNet</span><span class="token keyword">def</span> <span class="token function">conv_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">DenseBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token comment"># Out_channels number is the increasing rate of channels</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_convs<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        net <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_convs<span class="token punctuation">)</span><span class="token punctuation">:</span>            in_c <span class="token operator">=</span> in_channels <span class="token operator">+</span> i <span class="token operator">*</span> out_channels            net<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conv_block<span class="token punctuation">(</span>in_c<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span>net<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>out_channels <span class="token operator">=</span> in_channels <span class="token operator">+</span> num_convs <span class="token operator">*</span> out_channels        <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> blk <span class="token keyword">in</span> self<span class="token punctuation">.</span>net<span class="token punctuation">:</span>            y <span class="token operator">=</span> blk<span class="token punctuation">(</span>x<span class="token punctuation">)</span>            x <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> dim <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> x<span class="token keyword">def</span> <span class="token function">transition_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">DenseNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>start <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>                dense_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                num_channels<span class="token punctuation">,</span> growth_rate <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span>        num_convs_in_dense_blocks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                <span class="token keyword">for</span> i<span class="token punctuation">,</span> num_convs <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>num_convs_in_dense_blocks<span class="token punctuation">)</span><span class="token punctuation">:</span>            DB <span class="token operator">=</span> DenseBlock<span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span> growth_rate<span class="token punctuation">)</span>            num_channels <span class="token operator">=</span> DB<span class="token punctuation">.</span>out_channels                        dense_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>DB<span class="token punctuation">)</span>                        <span class="token keyword">if</span> i <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num_convs_in_dense_blocks<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>                dense_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span> transition_block<span class="token punctuation">(</span>num_channels<span class="token punctuation">,</span> num_channels <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                num_channels <span class="token operator">=</span> num_channels <span class="token operator">//</span> <span class="token number">2</span>                self<span class="token punctuation">.</span>dense <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span>dense_list<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>num_channels<span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_channels<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>start<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">for</span> layer <span class="token keyword">in</span> self<span class="token punctuation">.</span>dense<span class="token punctuation">:</span>            x <span class="token operator">=</span> layer<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>output<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        x <span class="token operator">=</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">return</span> x</code></pre><pre class="language-none"><code class="language-none">ic| net: DenseNet(           (start): Sequential(             (0): Conv2d(3, 64, kernel_size&#x3D;(7, 7), stride&#x3D;(2, 2), padding&#x3D;(3, 3))             (1): BatchNorm2d(64, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)             (2): ReLU()             (3): MaxPool2d(kernel_size&#x3D;3, stride&#x3D;2, padding&#x3D;1, dilation&#x3D;1, ceil_mode&#x3D;False)           )           (dense): ModuleList(             (0): DenseBlock(               (net): ModuleList(                 (0): Sequential(                   (0): BatchNorm2d(64, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(64, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (1): Sequential(                   (0): BatchNorm2d(96, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(96, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (2): Sequential(                   (0): BatchNorm2d(128, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(128, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (3): Sequential(                   (0): BatchNorm2d(160, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(160, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )               )             )             (1): Sequential(               (0): BatchNorm2d(192, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)               (1): ReLU()               (2): Conv2d(192, 96, kernel_size&#x3D;(1, 1), stride&#x3D;(1, 1))               (3): AvgPool2d(kernel_size&#x3D;2, stride&#x3D;2, padding&#x3D;0)             )             (2): DenseBlock(               (net): ModuleList(                 (0): Sequential(                   (0): BatchNorm2d(96, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(96, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (1): Sequential(                   (0): BatchNorm2d(128, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(128, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (2): Sequential(                   (0): BatchNorm2d(160, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(160, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (3): Sequential(                   (0): BatchNorm2d(192, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(192, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )               )             )             (3): Sequential(               (0): BatchNorm2d(224, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)               (1): ReLU()               (2): Conv2d(224, 112, kernel_size&#x3D;(1, 1), stride&#x3D;(1, 1))               (3): AvgPool2d(kernel_size&#x3D;2, stride&#x3D;2, padding&#x3D;0)             )             (4): DenseBlock(               (net): ModuleList(                 (0): Sequential(                   (0): BatchNorm2d(112, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(112, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (1): Sequential(                   (0): BatchNorm2d(144, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(144, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (2): Sequential(                   (0): BatchNorm2d(176, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(176, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (3): Sequential(                   (0): BatchNorm2d(208, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(208, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )               )             )             (5): Sequential(               (0): BatchNorm2d(240, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)               (1): ReLU()               (2): Conv2d(240, 120, kernel_size&#x3D;(1, 1), stride&#x3D;(1, 1))               (3): AvgPool2d(kernel_size&#x3D;2, stride&#x3D;2, padding&#x3D;0)             )             (6): DenseBlock(               (net): ModuleList(                 (0): Sequential(                   (0): BatchNorm2d(120, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(120, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (1): Sequential(                   (0): BatchNorm2d(152, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(152, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (2): Sequential(                   (0): BatchNorm2d(184, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(184, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )                 (3): Sequential(                   (0): BatchNorm2d(216, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)                   (1): ReLU()                   (2): Conv2d(216, 32, kernel_size&#x3D;(3, 3), stride&#x3D;(1, 1), padding&#x3D;(1, 1))                 )               )             )           )           (output): Sequential(             (0): BatchNorm2d(248, eps&#x3D;1e-05, momentum&#x3D;0.1, affine&#x3D;True, track_running_stats&#x3D;True)             (1): ReLU()           )           (fc): Sequential(             (0): Flatten(start_dim&#x3D;1, end_dim&#x3D;-1)             (1): Linear(in_features&#x3D;248, out_features&#x3D;10, bias&#x3D;True)           )         )ic| net(data).shape: torch.Size([4, 10])</code></pre>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š&lt;a href=&quot;https://github.com/d2l-ai/d2l-zh&quot;&gt;https://github.com/d2l-ai/d2l-zh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š&lt;a href=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/#/&quot;&gt;https://tangshusen.me/Dive-into-DL-PyTorch/#/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çŸ¥è¯†æ¶æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œc7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬éƒ¨åˆ†åŒ…å«ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;{Finished} [5-5] å®ç°ä¸€ä¸ªå¯ä»¥å®ç°è¡¨æƒ…è¯†åˆ«çš„ç±» CNN ç½‘ç»œå¹¶è®­ç»ƒï¼Œé‡ç‚¹åœ¨äºé€ å‡ºä¸€ä¸ªæœºå™¨å­¦ä¹ çš„æ¡†æ¶ï¼Œç„¶åè¯„ä¼°å…¶å‡†ç¡®ç‡ã€‚&lt;/li&gt;
&lt;li&gt;{Finished} [5-11, 5-12] å®ç° ResNet å’Œ DenseNetï¼Œæ³¨æ„ä½“ä¼šæ€æ ·æ‰èƒ½ä½¿å¾—è¿ç®—ç»´åº¦åŒ¹é…ã€‚&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ Pytorch ver. é˜…è¯»æ‘˜å½• Part B</title>
    <link href="https://www.c7w.tech/dive-into-dl-pytorch-B/"/>
    <id>https://www.c7w.tech/dive-into-dl-pytorch-B/</id>
    <published>2022-01-26T04:01:54.000Z</published>
    <updated>2022-01-27T06:59:48.550Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png" alt=""></p><ul><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š<a href="https://github.com/d2l-ai/d2l-zh">https://github.com/d2l-ai/d2l-zh</a></li><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š<a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/">https://tangshusen.me/Dive-into-DL-PyTorch/#/</a></li></ul><p>çŸ¥è¯†æ¶æ„ï¼š</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg" alt="å°é¢"></p><p>æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œ c7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚</p><p>ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚</p><p>Part B åŒ…å«ï¼š</p><ul><li>Â§ 5 CNN<ul><li>åŸºæœ¬æ¦‚å¿µï¼šå·ç§¯å±‚ã€å¡«å……ä¸æ­¥é•¿ã€å¤šé€šé“ã€æ± åŒ–ã€æ‰¹é‡å½’ä¸€åŒ–</li><li>æ¨¡å‹çš„ä¾‹å­ï¼šLeNetã€AlexNetã€VGGã€NiNã€GoogLeNetã€ResNetã€DenseNet</li></ul></li><li>Â§ 6 RNN<ul><li>è¯­è¨€æ¨¡å‹åŠå…¶è®¡ç®—ï¼ŒN-gram çš„æ¦‚å¿µ</li><li>RNN åŸºæœ¬æ¨¡å‹åŠå…¶å®ç°ï¼Œå­—ç¬¦æ•°æ®é›†çš„åˆ¶ä½œ</li><li>GRU, LSTM çš„åŸç†</li><li>Deep-RNN, bi-RNN</li></ul></li></ul><a id="more"></a><h2 id="CNN"><a href="#CNN" class="headerlink" title="CNN"></a>CNN</h2><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><h4 id="å·ç§¯å±‚"><a href="#å·ç§¯å±‚" class="headerlink" title="å·ç§¯å±‚"></a>å·ç§¯å±‚</h4><ul><li><strong>äºŒç»´äº’ç›¸å…³è¿ç®—</strong></li></ul><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.1_correlation.svg" alt="img"></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªé«˜å’Œå®½å‡ä¸º3çš„äºŒç»´æ•°ç»„ã€‚æˆ‘ä»¬å°†è¯¥æ•°ç»„çš„å½¢çŠ¶è®°ä¸º $3 \times 3$ æˆ–$ï¼ˆ3ï¼Œ3ï¼‰$ã€‚</p><p>æ ¸æ•°ç»„çš„é«˜å’Œå®½åˆ†åˆ«ä¸º 2ã€‚è¯¥æ•°ç»„åœ¨å·ç§¯è®¡ç®—ä¸­åˆç§°å·ç§¯æ ¸æˆ–è¿‡æ»¤å™¨ï¼ˆfilterï¼‰ã€‚</p><p>å·ç§¯æ ¸çª—å£ï¼ˆåˆç§°å·ç§¯çª—å£ï¼‰çš„å½¢çŠ¶å–å†³äºå·ç§¯æ ¸çš„é«˜å’Œå®½ï¼Œå³ $2 \times 2$ã€‚</p><p>å›¾ä¸­çš„é˜´å½±éƒ¨åˆ†ä¸ºç¬¬ä¸€ä¸ªè¾“å‡ºå…ƒç´ åŠå…¶è®¡ç®—æ‰€ä½¿ç”¨çš„è¾“å…¥å’Œæ ¸æ•°ç»„å…ƒç´ ï¼š</p><p>$0\times0+1\times1+3\times2+4\times3=19$â€‹â€‹â€‹â€‹ã€‚</p><p>åœ¨äºŒç»´äº’ç›¸å…³è¿ç®—ä¸­ï¼Œå·ç§¯çª—å£ä»è¾“å…¥æ•°ç»„çš„æœ€å·¦ä¸Šæ–¹å¼€å§‹ï¼ŒæŒ‰ä»å·¦å¾€å³ã€ä»ä¸Šå¾€ä¸‹çš„é¡ºåºï¼ŒæŒ‰ç…§ç‰¹å®šçš„æ­¥é•¿ï¼Œä¾æ¬¡åœ¨è¾“å…¥æ•°ç»„ä¸Šæ»‘åŠ¨ã€‚</p><p>å½“å·ç§¯çª—å£æ»‘åŠ¨åˆ°æŸä¸€ä½ç½®æ—¶ï¼Œçª—å£ä¸­çš„è¾“å…¥å­æ•°ç»„ä¸æ ¸æ•°ç»„æŒ‰å…ƒç´ ç›¸ä¹˜å¹¶æ±‚å’Œï¼Œå¾—åˆ°è¾“å‡ºæ•°ç»„ä¸­ç›¸åº”ä½ç½®çš„å…ƒç´ ã€‚</p><ul><li><strong>ä»äº’ç›¸å…³è¿ç®—åˆ°å·ç§¯è¿ç®—</strong></li></ul><p>å®é™…ä¸Šï¼Œå·ç§¯è¿ç®—ä¸äº’ç›¸å…³è¿ç®—ç±»ä¼¼ã€‚<strong>ä¸ºäº†å¾—åˆ°å·ç§¯è¿ç®—çš„è¾“å‡ºï¼Œæˆ‘ä»¬åªéœ€å°†æ ¸æ•°ç»„å·¦å³ç¿»è½¬å¹¶ä¸Šä¸‹ç¿»è½¬ï¼Œå†ä¸è¾“å…¥æ•°ç»„åšäº’ç›¸å…³è¿ç®—</strong>ã€‚</p><ul><li><strong>Feature Map ä¸ Receptive Field</strong></li></ul><p>äºŒç»´å·ç§¯å±‚è¾“å‡ºçš„äºŒç»´æ•°ç»„å¯ä»¥çœ‹ä½œæ˜¯è¾“å…¥åœ¨ç©ºé—´ç»´åº¦ï¼ˆå®½å’Œé«˜ï¼‰ä¸ŠæŸä¸€çº§çš„è¡¨å¾ï¼Œä¹Ÿå«ç‰¹å¾å›¾ï¼ˆfeature mapï¼‰ã€‚</p><p>å½±å“å…ƒç´  $x$ çš„å‰å‘è®¡ç®—çš„æ‰€æœ‰å¯èƒ½è¾“å…¥åŒºåŸŸï¼ˆå¯èƒ½å¤§äºè¾“å…¥çš„å®é™…å°ºå¯¸ï¼‰å«åšçš„ $x$ æ„Ÿå—é‡ï¼ˆreceptive fieldï¼‰ã€‚</p><p>ä»¥å›¾ä¸ºä¾‹ï¼Œè¾“å…¥ä¸­é˜´å½±éƒ¨åˆ†çš„å››ä¸ªå…ƒç´ æ˜¯è¾“å‡ºä¸­é˜´å½±éƒ¨åˆ†å…ƒç´ çš„æ„Ÿå—é‡ã€‚</p><p>æˆ‘ä»¬å°†å›¾ä¸­å½¢çŠ¶ä¸º $2 \times 2$â€‹â€‹â€‹ çš„è¾“å‡ºè®°ä¸º $Y$â€‹â€‹ï¼Œå¹¶è€ƒè™‘ä¸€ä¸ªæ›´æ·±çš„å·ç§¯ç¥ç»ç½‘ç»œï¼šå°† $Y$ ä¸å¦ä¸€ä¸ªå½¢çŠ¶ä¸º $2 \times 2$ çš„æ ¸æ•°ç»„åšäº’ç›¸å…³è¿ç®—ï¼Œè¾“å‡ºå•ä¸ªå…ƒç´  $z$ã€‚é‚£ä¹ˆï¼Œ$z$ åœ¨ $Y$ ä¸Šçš„ Receptive Field ä¸º $Y$ çš„å…¨éƒ¨å››ä¸ªå…ƒç´ ï¼Œåœ¨ $x$ ä¸Šçš„æ„Ÿå—é‡åŒ…æ‹¬å…¶ä¸­å…¨éƒ¨ 9 ä¸ªå…ƒç´ ã€‚</p><p>å¯è§ï¼Œæˆ‘ä»¬å¯ä»¥<strong>é€šè¿‡æ›´æ·±çš„å·ç§¯ç¥ç»ç½‘ç»œä½¿ç‰¹å¾å›¾ä¸­å•ä¸ªå…ƒç´ çš„æ„Ÿå—é‡å˜å¾—æ›´åŠ å¹¿é˜”ï¼Œä»è€Œæ•æ‰è¾“å…¥ä¸Šæ›´å¤§å°ºå¯¸çš„ç‰¹å¾</strong>ã€‚</p><h4 id="Padding-amp-Stride"><a href="#Padding-amp-Stride" class="headerlink" title="Padding &amp; Stride"></a>Padding &amp; Stride</h4><p>æœ¬èŠ‚æˆ‘ä»¬å°†ä»‹ç»å·ç§¯å±‚çš„ä¸¤ä¸ªè¶…å‚æ•°ï¼Œå³å¡«å……å’Œæ­¥å¹…ã€‚å®ƒä»¬å¯ä»¥å¯¹ç»™å®šå½¢çŠ¶çš„è¾“å…¥å’Œå·ç§¯æ ¸æ”¹å˜è¾“å‡ºå½¢çŠ¶ã€‚</p><ul><li><strong>Padding</strong></li></ul><p>å¡«å……ï¼ˆpaddingï¼‰æ˜¯æŒ‡åœ¨è¾“å…¥é«˜å’Œå®½çš„ä¸¤ä¾§å¡«å……å…ƒç´ ï¼ˆé€šå¸¸æ˜¯ 0 å…ƒç´ ï¼‰ã€‚</p><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.2_conv_pad.svg" alt="img"></p><p>å›¾ä¸­æˆ‘ä»¬åœ¨åŸè¾“å…¥é«˜å’Œå®½çš„ä¸¤ä¾§åˆ†åˆ«æ·»åŠ äº†å€¼ä¸º 0 çš„å…ƒç´ ï¼Œä½¿å¾—è¾“å…¥é«˜å’Œå®½ä» 3 å˜æˆäº† 5 ï¼Œå¹¶å¯¼è‡´è¾“å‡ºé«˜å’Œå®½ç”± 2 å¢åŠ åˆ° 4ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœåœ¨é«˜çš„ä¸¤ä¾§ä¸€å…±å¡«å…… $p_h$ è¡Œï¼Œåœ¨å®½çš„ä¸¤ä¾§ä¸€å…±å¡«å…… $p_w$ åˆ—ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šè®¾ç½® $p_h=k_h-1$ å’Œ $p_w=k_w-1$ æ¥ä½¿è¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜å’Œå®½ï¼Œå…¶ä¸­ $k_h\times k_w$ æ˜¯å·ç§¯æ ¸çª—å£å½¢çŠ¶ã€‚è¿™æ ·ä¼šæ–¹ä¾¿åœ¨æ„é€ ç½‘ç»œæ—¶æ¨æµ‹æ¯ä¸ªå±‚çš„è¾“å‡ºå½¢çŠ¶ã€‚</p><p>å‡è®¾è¿™é‡Œ $k_h$ æ˜¯å¥‡æ•°ï¼Œæˆ‘ä»¬ä¼šåœ¨é«˜çš„ä¸¤ä¾§åˆ†åˆ«å¡«å…… $p_h/2$ è¡Œã€‚å¦‚æœ $k_h$ æ˜¯å¶æ•°ï¼Œä¸€ç§å¯èƒ½æ˜¯åœ¨è¾“å…¥çš„é¡¶ç«¯ä¸€ä¾§å¡«å…… $\lceil p_h/2\rceil$ è¡Œï¼Œè€Œåœ¨åº•ç«¯ä¸€ä¾§å¡«å…… $\lfloor p_h/2\rfloor$â€‹ è¡Œã€‚åœ¨å®½çš„ä¸¤ä¾§å¡«å……åŒç†ã€‚å·ç§¯ç¥ç»ç½‘ç»œç»å¸¸ä½¿ç”¨<strong>å¥‡æ•°é«˜å®½çš„å·ç§¯æ ¸</strong> $k_h \times k_w$ï¼Œå¦‚ 1ã€3ã€5 å’Œ 7ï¼Œæ‰€ä»¥ä¸¤ç«¯ä¸Šçš„å¡«å……ä¸ªæ•°ç›¸ç­‰ã€‚</p><p>å¯¹ä»»æ„çš„äºŒç»´æ•°ç»„ <code>X</code>ï¼Œè®¾å®ƒçš„ç¬¬ <code>i</code> è¡Œç¬¬ <code>j</code> åˆ—çš„å…ƒç´ ä¸º <code>X[i,j]</code>ã€‚å½“ä¸¤ç«¯ä¸Šçš„å¡«å……ä¸ªæ•°ç›¸ç­‰ï¼Œå¹¶ä½¿è¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜å’Œå®½æ—¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¾“å‡º <code>Y[i,j]</code> æ˜¯ç”±è¾“å…¥ä»¥ <code>X[i,j]</code> ä¸ºä¸­å¿ƒçš„çª—å£åŒå·ç§¯æ ¸è¿›è¡Œäº’ç›¸å…³è®¡ç®—å¾—åˆ°çš„ã€‚</p><ul><li><strong>Stride</strong></li></ul><p>åœ¨ä¸Šä¸€èŠ‚é‡Œæˆ‘ä»¬ä»‹ç»äº†äºŒç»´äº’ç›¸å…³è¿ç®—ã€‚å·ç§¯çª—å£ä»è¾“å…¥æ•°ç»„çš„æœ€å·¦ä¸Šæ–¹å¼€å§‹ï¼ŒæŒ‰ä»å·¦å¾€å³ã€ä»ä¸Šå¾€ä¸‹çš„é¡ºåºï¼Œä¾æ¬¡åœ¨è¾“å…¥æ•°ç»„ä¸Šæ»‘åŠ¨ã€‚æˆ‘ä»¬å°†æ¯æ¬¡æ»‘åŠ¨çš„è¡Œæ•°å’Œåˆ—æ•°ç§°ä¸ºæ­¥å¹…ï¼ˆstrideï¼‰ã€‚</p><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.2_conv_stride.svg" alt="img"></p><p>ç›®å‰æˆ‘ä»¬çœ‹åˆ°çš„ä¾‹å­é‡Œï¼Œåœ¨é«˜å’Œå®½ä¸¤ä¸ªæ–¹å‘ä¸Šæ­¥å¹…å‡ä¸º1ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´å¤§æ­¥å¹…ã€‚</p><p>å›¾ä¸­å±•ç¤ºäº†åœ¨é«˜ä¸Šæ­¥å¹…ä¸º 3ã€åœ¨å®½ä¸Šæ­¥å¹…ä¸º 2 çš„äºŒç»´äº’ç›¸å…³è¿ç®—ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºç¬¬ä¸€åˆ—ç¬¬äºŒä¸ªå…ƒç´ æ—¶ï¼Œå·ç§¯çª—å£å‘ä¸‹æ»‘åŠ¨äº† 3 è¡Œï¼Œè€Œåœ¨è¾“å‡ºç¬¬ä¸€è¡Œç¬¬äºŒä¸ªå…ƒç´ æ—¶å·ç§¯çª—å£å‘å³æ»‘åŠ¨äº† 2 åˆ—ã€‚å½“å·ç§¯çª—å£åœ¨è¾“å…¥ä¸Šå†å‘å³æ»‘åŠ¨ 2 åˆ—æ—¶ï¼Œç”±äºè¾“å…¥å…ƒç´ æ— æ³•å¡«æ»¡çª—å£ï¼Œæ— ç»“æœè¾“å‡ºã€‚</p><h4 id="å¤šé€šé“"><a href="#å¤šé€šé“" class="headerlink" title="å¤šé€šé“"></a>å¤šé€šé“</h4><p>å‰é¢ä¸¤èŠ‚é‡Œæˆ‘ä»¬ç”¨åˆ°çš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯äºŒç»´æ•°ç»„ï¼Œä½†çœŸå®æ•°æ®çš„ç»´åº¦ç»å¸¸æ›´é«˜ã€‚</p><p>ä¾‹å¦‚ï¼Œå½©è‰²å›¾åƒåœ¨é«˜å’Œå®½ 2 ä¸ªç»´åº¦å¤–è¿˜æœ‰ RGBï¼ˆçº¢ã€ç»¿ã€è“ï¼‰3 ä¸ªé¢œè‰²é€šé“ã€‚</p><p>å‡è®¾å½©è‰²å›¾åƒçš„é«˜å’Œå®½åˆ†åˆ«æ˜¯ $h$ å’Œ $w$ï¼ˆåƒç´ ï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ª $3\times h\times w$ çš„å¤šç»´æ•°ç»„ã€‚</p><p>æˆ‘ä»¬å°†å¤§å°ä¸º 3 çš„è¿™ä¸€ç»´ç§°ä¸ºé€šé“ï¼ˆchannelï¼‰ç»´ã€‚</p><p>æœ¬èŠ‚æˆ‘ä»¬å°†ä»‹ç»å«å¤šä¸ªè¾“å…¥é€šé“æˆ–å¤šä¸ªè¾“å‡ºé€šé“çš„å·ç§¯æ ¸ã€‚</p><ul><li><strong>å¤šè¾“å…¥é€šé“</strong></li></ul><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.3_conv_multi_in.svg" alt="img"></p><p>å½“è¾“å…¥æ•°æ®å«å¤šä¸ªé€šé“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªè¾“å…¥é€šé“æ•°ä¸è¾“å…¥æ•°æ®çš„é€šé“æ•°ç›¸åŒçš„å·ç§¯æ ¸ï¼Œä»è€Œèƒ½å¤Ÿä¸å«å¤šé€šé“çš„è¾“å…¥æ•°æ®åšäº’ç›¸å…³è¿ç®—ã€‚</p><p>å«å¤šä¸ªé€šé“çš„è¾“å…¥æ•°æ®ä¸å¤šè¾“å…¥é€šé“çš„å·ç§¯æ ¸åšäºŒç»´äº’ç›¸å…³è¿ç®—çš„è¾“å‡ºï¼šåœ¨å„ä¸ªé€šé“ä¸Šå¯¹è¾“å…¥çš„äºŒç»´æ•°ç»„å’Œå·ç§¯æ ¸çš„äºŒç»´æ ¸æ•°ç»„åšäº’ç›¸å…³è¿ç®—ï¼Œå†å°†è¿™äº›äº’ç›¸å…³è¿ç®—çš„è¾“å‡ºç›¸åŠ ã€‚</p><ul><li><strong>å¤šè¾“å‡ºé€šé“</strong></li></ul><p>å½“è¾“å…¥é€šé“æœ‰å¤šä¸ªæ—¶ï¼Œå› ä¸ºæˆ‘ä»¬å¯¹å„ä¸ªé€šé“çš„ç»“æœåšäº†ç´¯åŠ ï¼Œæ‰€ä»¥ä¸è®ºè¾“å…¥é€šé“æ•°æ˜¯å¤šå°‘ï¼Œè¾“å‡ºé€šé“æ•°æ€»æ˜¯ä¸º 1ã€‚è®¾å·ç§¯æ ¸è¾“å…¥é€šé“æ•°å’Œè¾“å‡ºé€šé“æ•°åˆ†åˆ«ä¸º $c_i$ å’Œ $c_o$ï¼Œé«˜å’Œå®½åˆ†åˆ«ä¸º $k_h$ å’Œ $k_w$ã€‚</p><p>å¦‚æœå¸Œæœ›å¾—åˆ°å«å¤šä¸ªé€šé“çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªè¾“å‡ºé€šé“åˆ†åˆ«åˆ›å»ºå½¢çŠ¶ä¸º $c_i\times k_h\times k_w$ çš„æ ¸æ•°ç»„ã€‚å°†å®ƒä»¬åœ¨è¾“å‡ºé€šé“ç»´ä¸Šè¿ç»“ï¼Œå·ç§¯æ ¸çš„å½¢çŠ¶å³ $c_o\times c_i\times k_h\times k_w$ã€‚</p><ul><li><strong>1 x 1 å·ç§¯å±‚</strong></li></ul><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.3_conv_1x1.svg" alt="img"></p><p>å› ä¸ºä½¿ç”¨äº†æœ€å°çª—å£ï¼Œ$1\times 1$ å·ç§¯å¤±å»äº†å·ç§¯å±‚å¯ä»¥è¯†åˆ«é«˜å’Œå®½ç»´åº¦ä¸Šç›¸é‚»å…ƒç´ æ„æˆçš„æ¨¡å¼çš„åŠŸèƒ½ã€‚å®é™…ä¸Šï¼Œ$1\times 1$ å·ç§¯çš„ä¸»è¦è®¡ç®—å‘ç”Ÿåœ¨é€šé“ç»´ä¸Šã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¾“å…¥å’Œè¾“å‡ºå…·æœ‰ç›¸åŒçš„é«˜å’Œå®½ã€‚è¾“å‡ºä¸­çš„æ¯ä¸ªå…ƒç´ æ¥è‡ªè¾“å…¥ä¸­åœ¨é«˜å’Œå®½ä¸Šç›¸åŒä½ç½®çš„å…ƒç´ <strong>åœ¨ä¸åŒé€šé“ä¹‹é—´çš„æŒ‰æƒé‡ç´¯åŠ </strong>ã€‚</p><p>å‡è®¾æˆ‘ä»¬å°†é€šé“ç»´å½“ä½œç‰¹å¾ç»´ï¼Œå°†é«˜å’Œå®½ç»´åº¦ä¸Šçš„å…ƒç´ å½“æˆæ•°æ®æ ·æœ¬ï¼Œ<strong>é‚£ä¹ˆ $1\times 1$â€‹ å·ç§¯å±‚çš„ä½œç”¨ä¸å…¨è¿æ¥å±‚ç­‰ä»·</strong>ã€‚</p><h4 id="Pooling"><a href="#Pooling" class="headerlink" title="Pooling"></a>Pooling</h4><p>è®¾ä»»æ„äºŒç»´æ•°ç»„ <code>X</code> çš„ <code>i</code>è¡Œ <code>j</code> åˆ—çš„å…ƒç´ ä¸º <code>X[i, j]</code>ã€‚å¦‚æœæˆ‘ä»¬æ„é€ çš„ $1 \times 2$å·ç§¯æ ¸ $[1, -1]$ è¾“å‡º <code>Y[i, j]=1</code>ï¼Œé‚£ä¹ˆè¯´æ˜è¾“å…¥ä¸­ <code>X[i, j]</code> å’Œ <code>X[i, j+1]</code> æ•°å€¼ä¸ä¸€æ ·ã€‚è¿™å¯èƒ½æ„å‘³ç€ç‰©ä½“è¾¹ç¼˜é€šè¿‡è¿™ä¸¤ä¸ªå…ƒç´ ä¹‹é—´ã€‚</p><p>å®é™…å›¾åƒé‡Œï¼Œæˆ‘ä»¬æ„Ÿå…´è¶£çš„ç‰©ä½“ä¸ä¼šæ€»å‡ºç°åœ¨å›ºå®šä½ç½®ï¼šå³ä½¿æˆ‘ä»¬è¿ç»­æ‹æ‘„åŒä¸€ä¸ªç‰©ä½“ä¹Ÿææœ‰å¯èƒ½å‡ºç°åƒç´ ä½ç½®ä¸Šçš„åç§»ã€‚è¿™ä¼šå¯¼è‡´åŒä¸€ä¸ªè¾¹ç¼˜å¯¹åº”çš„è¾“å‡ºå¯èƒ½å‡ºç°åœ¨å·ç§¯è¾“å‡º <code>Y</code> ä¸­çš„ä¸åŒä½ç½®ï¼Œè¿›è€Œå¯¹åé¢çš„æ¨¡å¼è¯†åˆ«é€ æˆä¸ä¾¿ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»æ± åŒ–ï¼ˆpoolingï¼‰å±‚ï¼Œå®ƒçš„æå‡ºæ˜¯<strong>ä¸ºäº†ç¼“è§£å·ç§¯å±‚å¯¹ä½ç½®çš„è¿‡åº¦æ•æ„Ÿæ€§</strong>ã€‚</p><ul><li><strong>2D-MaxPooling &amp; Mean Pooling</strong></li></ul><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.4_pooling.svg" alt="img"></p><p>åŒå·ç§¯å±‚ä¸€æ ·ï¼Œæ± åŒ–å±‚æ¯æ¬¡å¯¹è¾“å…¥æ•°æ®çš„ä¸€ä¸ªå›ºå®šå½¢çŠ¶çª—å£ï¼ˆåˆç§°æ± åŒ–çª—å£ï¼‰ä¸­çš„å…ƒç´ è®¡ç®—è¾“å‡ºã€‚</p><p>ä¸åŒäºå·ç§¯å±‚é‡Œè®¡ç®—è¾“å…¥å’Œæ ¸çš„äº’ç›¸å…³æ€§ï¼Œæ± åŒ–å±‚ç›´æ¥è®¡ç®—æ± åŒ–çª—å£å†…å…ƒç´ çš„æœ€å¤§å€¼æˆ–è€…å¹³å‡å€¼ã€‚è¯¥è¿ç®—ä¹Ÿåˆ†åˆ«å«åšæœ€å¤§æ± åŒ–æˆ–å¹³å‡æ± åŒ–ã€‚</p><p>è®©æˆ‘ä»¬å†æ¬¡å›åˆ°æœ¬èŠ‚å¼€å§‹æåˆ°çš„ç‰©ä½“è¾¹ç¼˜æ£€æµ‹çš„ä¾‹å­ã€‚ç°åœ¨æˆ‘ä»¬å°†å·ç§¯å±‚çš„è¾“å‡ºä½œä¸º $2\times 2$ æœ€å¤§æ± åŒ–çš„è¾“å…¥ã€‚è®¾è¯¥å·ç§¯å±‚è¾“å…¥æ˜¯ <code>X</code>ã€æ± åŒ–å±‚è¾“å‡ºä¸º <code>Y</code>ã€‚æ— è®ºæ˜¯ <code>X[i, j]</code> å’Œ <code>X[i, j+1]</code> å€¼ä¸åŒï¼Œè¿˜æ˜¯ <code>X[i, j+1]</code> å’Œ <code>X[i, j+2]</code> ä¸åŒï¼Œæ± åŒ–å±‚è¾“å‡ºå‡æœ‰ <code>Y[i, j]=1</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ $2\times 2$ æœ€å¤§æ± åŒ–å±‚æ—¶ï¼Œåªè¦å·ç§¯å±‚è¯†åˆ«çš„æ¨¡å¼åœ¨é«˜å’Œå®½ä¸Šç§»åŠ¨ä¸è¶…è¿‡ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥å°†å®ƒæ£€æµ‹å‡ºæ¥ã€‚</p><ul><li><strong>Padding &amp; Stride</strong></li></ul><p>åŒå·ç§¯å±‚ä¸€æ ·ï¼Œæ± åŒ–å±‚ä¹Ÿå¯ä»¥åœ¨è¾“å…¥çš„é«˜å’Œå®½ä¸¤ä¾§çš„å¡«å……å¹¶è°ƒæ•´çª—å£çš„ç§»åŠ¨æ­¥å¹…æ¥æ”¹å˜è¾“å‡ºå½¢çŠ¶ã€‚æ± åŒ–å±‚å¡«å……å’Œæ­¥å¹…ä¸å·ç§¯å±‚å¡«å……å’Œæ­¥å¹…çš„å·¥ä½œæœºåˆ¶ä¸€æ ·ã€‚æˆ‘ä»¬å°†é€šè¿‡ <code>nn</code> æ¨¡å—é‡Œçš„äºŒç»´æœ€å¤§æ± åŒ–å±‚ <code>MaxPool2d</code> æ¥æ¼”ç¤ºæ± åŒ–å±‚å¡«å……å’Œæ­¥å¹…çš„å·¥ä½œæœºåˆ¶ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">X <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># C_o * C_i * K_h * K_w</span><span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">tensor([[[[ 0.,  1.,  2.,  3.],          [ 4.,  5.,  6.,  7.],          [ 8.,  9., 10., 11.],          [12., 13., 14., 15.]]]])</code></pre></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>MaxPool2d</code> å®ä¾‹é‡Œæ­¥å¹…å’Œæ± åŒ–çª—å£å½¢çŠ¶ç›¸åŒã€‚ä¸‹é¢ä½¿ç”¨å½¢çŠ¶ä¸º $(3, 3)$ çš„æ± åŒ–çª—å£ï¼Œé»˜è®¤è·å¾—å½¢çŠ¶ä¸º $(3, 3)$ çš„æ­¥å¹…ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">pool2d <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>pool2d<span class="token punctuation">(</span>X<span class="token punctuation">)</span> </code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">tensor([[[[10.]]]])</code></pre></p><p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ­¥å¹…å’Œå¡«å……ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">pool2d <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>pool2d<span class="token punctuation">(</span>X<span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">tensor([[[[ 5.,  7.],          [13., 15.]]]])</code></pre></p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šéæ­£æ–¹å½¢çš„æ± åŒ–çª—å£ï¼Œå¹¶åˆ†åˆ«æŒ‡å®šé«˜å’Œå®½ä¸Šçš„å¡«å……å’Œæ­¥å¹…ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">pool2d <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>pool2d<span class="token punctuation">(</span>X<span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">tensor([[[[ 1.,  3.],          [ 9., 11.],          [13., 15.]]]])</code></pre></p><ul><li><strong>å¤šé€šé“</strong></li></ul><p>åœ¨å¤„ç†å¤šé€šé“è¾“å…¥æ•°æ®æ—¶ï¼Œ<strong>æ± åŒ–å±‚å¯¹æ¯ä¸ªè¾“å…¥é€šé“åˆ†åˆ«æ± åŒ–ï¼Œè€Œä¸æ˜¯åƒå·ç§¯å±‚é‚£æ ·å°†å„é€šé“çš„è¾“å…¥æŒ‰é€šé“ç›¸åŠ </strong>ã€‚</p><p>è¿™æ„å‘³ç€æ± åŒ–å±‚çš„è¾“å‡ºé€šé“æ•°ä¸è¾“å…¥é€šé“æ•°ç›¸ç­‰ã€‚ä¸‹é¢å°†æ•°ç»„ <code>X</code> å’Œ <code>X+1</code> åœ¨é€šé“ç»´ä¸Šè¿ç»“æ¥æ„é€ é€šé“æ•°ä¸º 2 çš„è¾“å…¥ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">X <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> X <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>X</code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">tensor([[[[ 0.,  1.,  2.,  3.],          [ 4.,  5.,  6.,  7.],          [ 8.,  9., 10., 11.],          [12., 13., 14., 15.]],         [[ 1.,  2.,  3.,  4.],          [ 5.,  6.,  7.,  8.],          [ 9., 10., 11., 12.],          [13., 14., 15., 16.]]]])</code></pre></p><p>æ± åŒ–åï¼Œæˆ‘ä»¬å‘ç°è¾“å‡ºé€šé“æ•°ä»ç„¶æ˜¯2ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">pool2d <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>pool2d<span class="token punctuation">(</span>X<span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">tensor([[[[ 5.,  7.],          [13., 15.]],         [[ 6.,  8.],          [14., 16.]]]])</code></pre></p><h4 id="æ‰¹é‡å½’ä¸€åŒ–"><a href="#æ‰¹é‡å½’ä¸€åŒ–" class="headerlink" title="æ‰¹é‡å½’ä¸€åŒ–"></a>æ‰¹é‡å½’ä¸€åŒ–</h4><p>æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»æ‰¹é‡å½’ä¸€åŒ–ï¼ˆbatch normalizationï¼‰å±‚ï¼Œå®ƒèƒ½è®©è¾ƒæ·±çš„ç¥ç»ç½‘ç»œçš„è®­ç»ƒå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><ul><li>ä¸ºä»€ä¹ˆè¦æœ‰ Batch Normalization?</li></ul><p>åœ¨é¢„æµ‹å›å½’é—®é¢˜é‡Œï¼Œæˆ‘ä»¬å¯¹è¾“å…¥æ•°æ®åšäº†æ ‡å‡†åŒ–å¤„ç†ï¼šå¤„ç†åçš„ä»»æ„ä¸€ä¸ªç‰¹å¾åœ¨æ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬ä¸Šçš„å‡å€¼ä¸º 0ã€æ ‡å‡†å·®ä¸º 1ã€‚æ ‡å‡†åŒ–å¤„ç†è¾“å…¥æ•°æ®ä½¿å„ä¸ªç‰¹å¾çš„åˆ†å¸ƒç›¸è¿‘ï¼šè¿™å¾€å¾€æ›´å®¹æ˜“è®­ç»ƒå‡ºæœ‰æ•ˆçš„æ¨¡å‹ã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œæ•°æ®æ ‡å‡†åŒ–é¢„å¤„ç†å¯¹äºæµ…å±‚æ¨¡å‹å°±è¶³å¤Ÿæœ‰æ•ˆäº†ã€‚éšç€æ¨¡å‹è®­ç»ƒçš„è¿›è¡Œï¼Œå½“æ¯å±‚ä¸­å‚æ•°æ›´æ–°æ—¶ï¼Œé è¿‘è¾“å‡ºå±‚çš„è¾“å‡ºè¾ƒéš¾å‡ºç°å‰§çƒˆå˜åŒ–ã€‚ä½†å¯¹æ·±å±‚ç¥ç»ç½‘ç»œæ¥è¯´ï¼Œå³ä½¿è¾“å…¥æ•°æ®å·²åšæ ‡å‡†åŒ–ï¼Œè®­ç»ƒä¸­æ¨¡å‹å‚æ•°çš„æ›´æ–°ä¾ç„¶å¾ˆå®¹æ˜“é€ æˆé è¿‘è¾“å‡ºå±‚è¾“å‡ºçš„å‰§çƒˆå˜åŒ–ã€‚è¿™ç§è®¡ç®—æ•°å€¼çš„ä¸ç¨³å®šæ€§é€šå¸¸ä»¤æˆ‘ä»¬éš¾ä»¥è®­ç»ƒå‡ºæœ‰æ•ˆçš„æ·±åº¦æ¨¡å‹ã€‚</p><p>æ‰¹é‡å½’ä¸€åŒ–çš„æå‡ºæ­£æ˜¯ä¸ºäº†åº”å¯¹æ·±åº¦æ¨¡å‹è®­ç»ƒçš„æŒ‘æˆ˜ã€‚åœ¨æ¨¡å‹è®­ç»ƒæ—¶ï¼Œæ‰¹é‡å½’ä¸€åŒ–åˆ©ç”¨å°æ‰¹é‡ä¸Šçš„å‡å€¼å’Œæ ‡å‡†å·®ï¼Œä¸æ–­è°ƒæ•´ç¥ç»ç½‘ç»œä¸­é—´è¾“å‡ºï¼Œä»è€Œä½¿æ•´ä¸ªç¥ç»ç½‘ç»œåœ¨å„å±‚çš„ä¸­é—´è¾“å‡ºçš„æ•°å€¼æ›´ç¨³å®šã€‚<strong>æ‰¹é‡å½’ä¸€åŒ–å’Œä¸‹ä¸€èŠ‚å°†è¦ä»‹ç»çš„æ®‹å·®ç½‘ç»œä¸ºè®­ç»ƒå’Œè®¾è®¡æ·±åº¦æ¨¡å‹æä¾›äº†ä¸¤ç±»é‡è¦æ€è·¯</strong>ã€‚</p><ul><li>æ€ä¹ˆåš Batch Normalization?</li></ul><p>å¯¹å…¨è¿æ¥å±‚å’Œå·ç§¯å±‚åšæ‰¹é‡å½’ä¸€åŒ–çš„æ–¹æ³•ç¨æœ‰ä¸åŒã€‚ä¸‹é¢æˆ‘ä»¬å°†åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§æƒ…å†µä¸‹çš„æ‰¹é‡å½’ä¸€åŒ–ã€‚</p><p><strong>å¯¹ Fully Connected Layer çš„ Batch Normalization</strong></p><p>æˆ‘ä»¬å…ˆè€ƒè™‘å¦‚ä½•å¯¹å…¨è¿æ¥å±‚åšæ‰¹é‡å½’ä¸€åŒ–ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å°†æ‰¹é‡å½’ä¸€åŒ–å±‚ç½®äºå…¨è¿æ¥å±‚ä¸­çš„ä»¿å°„å˜æ¢å’Œæ¿€æ´»å‡½æ•°ä¹‹é—´ã€‚è®¾å…¨è¿æ¥å±‚çš„è¾“å…¥ä¸º $\boldsymbol{u}$â€‹â€‹ï¼Œæƒé‡å‚æ•°å’Œåå·®å‚æ•°åˆ†åˆ«ä¸º $\boldsymbol{W}$â€‹ â€‹å’Œ $\boldsymbol{b}$â€‹â€‹ï¼Œæ¿€æ´»å‡½æ•°ä¸º $\phi$â€‹â€‹ã€‚è®¾æ‰¹é‡å½’ä¸€åŒ–çš„è¿ç®—ç¬¦ä¸º $\text{BN}$â€‹â€‹ã€‚é‚£ä¹ˆï¼Œä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–çš„å…¨è¿æ¥å±‚çš„è¾“å‡ºä¸º $\phi(\text{BN}(\boldsymbol{Wu+b}))$â€‹ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬è§£é‡Š $\text{BN}$â€‹ ç®—ç¬¦æ˜¯ä»€ä¹ˆã€‚</p><p>è€ƒè™‘ä¸€ä¸ªç”± $m$â€‹â€‹ ä¸ªæ ·æœ¬ç»„æˆçš„ Mini-batchï¼Œä»¿å°„å˜æ¢çš„è¾“å‡ºä¸ºä¸€ä¸ªæ–°çš„ Mini-batch $\mathcal{B} = {\boldsymbol{x}^{(1)}, \ldots, \boldsymbol{x}^{(m)} }$â€‹â€‹ã€‚å®ƒä»¬æ­£æ˜¯æ‰¹é‡å½’ä¸€åŒ–å±‚çš„è¾“å…¥ã€‚å¯¹äºå°æ‰¹é‡ $\mathcal{B}$â€‹ â€‹ä¸­ä»»æ„æ ·æœ¬ $\boldsymbol{x}^{(i)} \in \mathbb{R}^d, 1 \leq i \leq m$â€‹â€‹ï¼Œæ‰¹é‡å½’ä¸€åŒ–å±‚çš„è¾“å‡ºåŒæ ·æ˜¯ $d$â€‹ â€‹ç»´å‘é‡$\boldsymbol{y}^{(i)} = \text{BN}(\boldsymbol{x}^{(i)})$â€‹ï¼Œå¹¶ç”±ä»¥ä¸‹å‡ æ­¥æ±‚å¾—ã€‚</p><script type="math/tex; mode=display">\boldsymbol{\mu}_\mathcal{B} \leftarrow \frac{1}{m}\sum_{i = 1}^{m} \boldsymbol{x}^{(i)} \\\boldsymbol{\sigma}_\mathcal{B}^2 \leftarrow \frac{1}{m} \sum_{i=1}^{m}(\boldsymbol{x}^{(i)} - \boldsymbol{\mu}_\mathcal{B})^2 \\ \hat{\boldsymbol{x}}^{(i)} \leftarrow \frac{\boldsymbol{x}^{(i)} - \boldsymbol{\mu}_\mathcal{B}}{\sqrt{\boldsymbol{\sigma}_\mathcal{B}^2 + \epsilon}}</script><p>è¿™é‡Œ $\epsilon &gt; 0$ æ˜¯ä¸€ä¸ªå¾ˆå°çš„å¸¸æ•°ï¼Œæ˜¯ä¸ºäº†ä¿è¯åˆ†æ¯å¤§äº 0ã€‚åœ¨ä¸Šé¢æ ‡å‡†åŒ–çš„åŸºç¡€ä¸Šï¼Œæ‰¹é‡å½’ä¸€åŒ–å±‚å¼•å…¥äº†ä¸¤ä¸ªå¯ä»¥å­¦ä¹ çš„æ¨¡å‹å‚æ•°ï¼Œæ‹‰ä¼¸ï¼ˆscaleï¼‰å‚æ•° $\boldsymbol{\gamma}$ å’Œåç§»ï¼ˆshiftï¼‰å‚æ•° $\boldsymbol{\beta}$ã€‚è¿™ä¸¤ä¸ªå‚æ•°å’Œ $\boldsymbol{x}^{(i)}$ å½¢çŠ¶ç›¸åŒï¼Œçš†ä¸º $d$ ç»´å‘é‡ã€‚å®ƒä»¬ä¸ $\boldsymbol{x}^{(i)}$ åˆ†åˆ«åš Hadamard Productï¼ˆç¬¦å·$\odot$â€‹ï¼‰å’ŒåŠ æ³•è®¡ç®—ï¼š</p><script type="math/tex; mode=display">{\boldsymbol{y}}^{(i)} \leftarrow \boldsymbol{\gamma} \odot \hat{\boldsymbol{x}}^{(i)} + \boldsymbol{\beta}</script><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº† $\boldsymbol{x}^{(i)}$â€‹ â€‹çš„æ‰¹é‡å½’ä¸€åŒ–çš„è¾“å‡º $\boldsymbol{y}^{(i)}$â€‹â€‹ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯å­¦ä¹ çš„æ‹‰ä¼¸å’Œåç§»å‚æ•°ä¿ç•™äº†ä¸å¯¹ $\hat{\boldsymbol{x}}^{(i)}$ â€‹â€‹åšæ‰¹é‡å½’ä¸€åŒ–çš„å¯èƒ½ï¼šæ­¤æ—¶åªéœ€å­¦å‡º $\boldsymbol{\gamma} = \sqrt{\boldsymbol{\sigma}_\mathcal{B}^2 + \epsilon}$ â€‹â€‹å’Œ $\boldsymbol{\beta} = \boldsymbol{\mu}_\mathcal{B}$â€‹â€‹ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ­¤è¿™æ ·ç†è§£ï¼šå¦‚æœæ‰¹é‡å½’ä¸€åŒ–æ— ç›Šï¼Œç†è®ºä¸Šï¼Œå­¦å‡ºçš„æ¨¡å‹å¯ä»¥ä¸ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–ã€‚</p><p><strong>å¯¹ Conv. Layer çš„ Batch Normalization</strong></p><p>å¯¹å·ç§¯å±‚æ¥è¯´ï¼Œæ‰¹é‡å½’ä¸€åŒ–å‘ç”Ÿåœ¨å·ç§¯è®¡ç®—ä¹‹åã€åº”ç”¨æ¿€æ´»å‡½æ•°ä¹‹å‰ã€‚</p><p>å¦‚æœå·ç§¯è®¡ç®—è¾“å‡ºå¤šä¸ªé€šé“ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™äº›é€šé“çš„è¾“å‡ºåˆ†åˆ«åšæ‰¹é‡å½’ä¸€åŒ–ï¼Œä¸”<strong>æ¯ä¸ªé€šé“éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„æ‹‰ä¼¸å’Œåç§»å‚æ•°ï¼Œå¹¶å‡ä¸ºæ ‡é‡</strong>ã€‚</p><p>è®¾å°æ‰¹é‡ä¸­æœ‰ $m$ ä¸ªæ ·æœ¬ï¼Œåœ¨å•ä¸ªé€šé“ä¸Šï¼Œå‡è®¾å·ç§¯è®¡ç®—è¾“å‡ºçš„é«˜å’Œå®½åˆ†åˆ«ä¸º $p$ å’Œ $q$ã€‚æˆ‘ä»¬éœ€è¦å¯¹è¯¥é€šé“ä¸­ $m \times p \times q$ ä¸ªå…ƒç´ åŒæ—¶åšæ‰¹é‡å½’ä¸€åŒ–ã€‚å¯¹è¿™äº›å…ƒç´ åšæ ‡å‡†åŒ–è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„å‡å€¼å’Œæ–¹å·®ï¼Œå³è¯¥é€šé“ä¸­ $m \times p \times q$â€‹ ä¸ªå…ƒç´ çš„å‡å€¼å’Œæ–¹å·®ã€‚</p><p><strong>é¢„æµ‹æ—¶çš„ Batch Normalization</strong></p><p>ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–è®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰¹é‡å¤§å°è®¾å¾—å¤§ä¸€ç‚¹ï¼Œä»è€Œä½¿æ‰¹é‡å†…æ ·æœ¬çš„å‡å€¼å’Œæ–¹å·®çš„è®¡ç®—éƒ½è¾ƒä¸ºå‡†ç¡®ã€‚å°†è®­ç»ƒå¥½çš„æ¨¡å‹ç”¨äºé¢„æµ‹æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹å¯¹äºä»»æ„è¾“å…¥éƒ½æœ‰ç¡®å®šçš„è¾“å‡ºã€‚å› æ­¤ï¼Œ<strong>å•ä¸ªæ ·æœ¬çš„è¾“å‡ºä¸åº”å–å†³äºæ‰¹é‡å½’ä¸€åŒ–æ‰€éœ€è¦çš„éšæœºå°æ‰¹é‡ä¸­çš„å‡å€¼å’Œæ–¹å·®</strong>ã€‚ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡ç§»åŠ¨å¹³å‡<strong>ä¼°ç®—æ•´ä¸ªè®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬å‡å€¼å’Œæ–¹å·®</strong>ï¼Œå¹¶åœ¨é¢„æµ‹æ—¶ä½¿ç”¨å®ƒä»¬å¾—åˆ°ç¡®å®šçš„è¾“å‡ºã€‚å¯è§ï¼Œå’Œä¸¢å¼ƒå±‚ä¸€æ ·ï¼Œæ‰¹é‡å½’ä¸€åŒ–å±‚åœ¨è®­ç»ƒæ¨¡å¼å’Œé¢„æµ‹æ¨¡å¼ä¸‹çš„è®¡ç®—ç»“æœä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚</p><ul><li>å®ç°ï¼ˆSimple ver.ï¼‰</li></ul><p>ä¸æˆ‘ä»¬åˆšåˆšè‡ªå·±å®šä¹‰çš„ <code>BatchNorm</code> ç±»ç›¸æ¯”ï¼ŒPytorch ä¸­ <code>nn</code> æ¨¡å—å®šä¹‰çš„ <code>BatchNorm1d</code> å’Œ <code>BatchNorm2d</code> ç±»ä½¿ç”¨èµ·æ¥æ›´åŠ ç®€å•ï¼ŒäºŒè€…åˆ†åˆ«ç”¨äºå…¨è¿æ¥å±‚å’Œå·ç§¯å±‚ï¼Œéƒ½éœ€è¦æŒ‡å®šè¾“å…¥çš„ <code>num_features</code> å‚æ•°å€¼ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ PyTorch å®ç°ä½¿ç”¨æ‰¹é‡å½’ä¸€åŒ–çš„ LeNetã€‚</p><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># in_channels, out_channels, kernel_size</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># kernel_size, stride</span>                nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                d2l<span class="token punctuation">.</span>FlattenLayer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>BatchNorm1d<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span></code></pre><h3 id="CNN-çš„ä¾‹å­"><a href="#CNN-çš„ä¾‹å­" class="headerlink" title="CNN çš„ä¾‹å­"></a>CNN çš„ä¾‹å­</h3><h4 id="LeNet"><a href="#LeNet" class="headerlink" title="LeNet"></a>LeNet</h4><p>ä¹‹å‰æˆ‘ä»¬æ›¾ä½¿ç”¨ MLP å¯¹ Fashion-MNIST æ•°æ®é›†ä¸­çš„å›¾åƒè¿›è¡Œåˆ†ç±»ã€‚æ¯å¼ å›¾åƒé«˜å’Œå®½å‡æ˜¯ 28 åƒç´ ã€‚æˆ‘ä»¬å°†å›¾åƒä¸­çš„åƒç´ é€è¡Œå±•å¼€ï¼Œå¾—åˆ°é•¿åº¦ä¸º 784 çš„å‘é‡ï¼Œå¹¶è¾“å…¥è¿›å…¨è¿æ¥å±‚ä¸­ã€‚ç„¶è€Œï¼Œè¿™ç§åˆ†ç±»æ–¹æ³•æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚</p><ol><li>å›¾åƒåœ¨åŒä¸€åˆ—é‚»è¿‘çš„åƒç´ åœ¨è¿™ä¸ªå‘é‡ä¸­å¯èƒ½ç›¸è·è¾ƒè¿œã€‚å®ƒä»¬æ„æˆçš„æ¨¡å¼å¯èƒ½éš¾ä»¥è¢«æ¨¡å‹è¯†åˆ«ã€‚</li><li>å¯¹äºå¤§å°ºå¯¸çš„è¾“å…¥å›¾åƒï¼Œä½¿ç”¨å…¨è¿æ¥å±‚å®¹æ˜“é€ æˆæ¨¡å‹è¿‡å¤§ã€‚å‡è®¾è¾“å…¥æ˜¯é«˜å’Œå®½å‡ä¸º 1000 åƒç´ çš„å½©è‰²ç…§ç‰‡ï¼ˆå« 3 ä¸ªé€šé“ï¼‰ã€‚å³ä½¿å…¨è¿æ¥å±‚è¾“å‡ºä¸ªæ•°ä»æ˜¯ 256ï¼Œè¯¥å±‚æƒé‡å‚æ•°çš„å½¢çŠ¶æ˜¯$ 3,000,000\times 256$â€‹ï¼šå®ƒå ç”¨äº†å¤§çº¦ 3 GB çš„å†…å­˜æˆ–æ˜¾å­˜ã€‚è¿™å¸¦æ¥è¿‡å¤æ‚çš„æ¨¡å‹å’Œè¿‡é«˜çš„å­˜å‚¨å¼€é”€ã€‚</li></ol><p>å·ç§¯å±‚å°è¯•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚ä¸€æ–¹é¢ï¼Œå·ç§¯å±‚ä¿ç•™è¾“å…¥å½¢çŠ¶ï¼Œä½¿å›¾åƒçš„åƒç´ åœ¨é«˜å’Œå®½ä¸¤ä¸ªæ–¹å‘ä¸Šçš„ç›¸å…³æ€§å‡å¯èƒ½è¢«æœ‰æ•ˆè¯†åˆ«ï¼›å¦ä¸€æ–¹é¢ï¼Œå·ç§¯å±‚é€šè¿‡æ»‘åŠ¨çª—å£å°†åŒä¸€å·ç§¯æ ¸ä¸ä¸åŒä½ç½®çš„è¾“å…¥é‡å¤è®¡ç®—ï¼Œä»è€Œé¿å…å‚æ•°å°ºå¯¸è¿‡å¤§ã€‚</p><p>å·ç§¯ç¥ç»ç½‘ç»œå°±æ˜¯å«å·ç§¯å±‚çš„ç½‘ç»œã€‚æœ¬èŠ‚é‡Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªæ—©æœŸç”¨æ¥è¯†åˆ«æ‰‹å†™æ•°å­—å›¾åƒçš„å·ç§¯ç¥ç»ç½‘ç»œï¼šLeNetã€‚</p><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.5_lenet.png" alt="img"></p><p>LeNetåˆ†ä¸ºå·ç§¯å±‚å—å’Œå…¨è¿æ¥å±‚å—ä¸¤ä¸ªéƒ¨åˆ†ã€‚ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»è¿™ä¸¤ä¸ªæ¨¡å—ã€‚</p><p>å·ç§¯å±‚å—é‡Œçš„åŸºæœ¬å•ä½æ˜¯<strong>å·ç§¯å±‚åæ¥æœ€å¤§æ± åŒ–å±‚</strong>ï¼š</p><ul><li>å·ç§¯å±‚ç”¨æ¥è¯†åˆ«å›¾åƒé‡Œçš„ç©ºé—´æ¨¡å¼ï¼Œå¦‚çº¿æ¡å’Œç‰©ä½“å±€éƒ¨</li><li>ä¹‹åçš„æœ€å¤§æ± åŒ–å±‚åˆ™ç”¨æ¥é™ä½å·ç§¯å±‚å¯¹ä½ç½®çš„æ•æ„Ÿæ€§</li></ul><p>å·ç§¯å±‚å—ç”±ä¸¤ä¸ªè¿™æ ·çš„åŸºæœ¬å•ä½é‡å¤å †å æ„æˆã€‚åœ¨å·ç§¯å±‚å—ä¸­ï¼Œæ¯ä¸ªå·ç§¯å±‚éƒ½ä½¿ç”¨ $5\times 5$â€‹ çš„çª—å£ï¼Œå¹¶åœ¨è¾“å‡ºä¸Šä½¿ç”¨ sigmoid æ¿€æ´»å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå·ç§¯å±‚è¾“å‡ºé€šé“æ•°ä¸º 6ï¼Œç¬¬äºŒä¸ªå·ç§¯å±‚è¾“å‡ºé€šé“æ•°åˆ™å¢åŠ åˆ° 16ã€‚è¿™æ˜¯å› ä¸ºç¬¬äºŒä¸ªå·ç§¯å±‚æ¯”ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„è¾“å…¥çš„é«˜å’Œå®½è¦å°ï¼Œæ‰€ä»¥å¢åŠ è¾“å‡ºé€šé“ä½¿ä¸¤ä¸ªå·ç§¯å±‚çš„å‚æ•°å°ºå¯¸ç±»ä¼¼ã€‚å·ç§¯å±‚å—çš„ä¸¤ä¸ªæœ€å¤§æ± åŒ–å±‚çš„çª—å£å½¢çŠ¶å‡ä¸º $2\times 2$â€‹â€‹ï¼Œä¸”æ­¥å¹…ä¸º 2ã€‚ç”±äºæ± åŒ–çª—å£ä¸æ­¥å¹…å½¢çŠ¶ç›¸åŒï¼Œæ± åŒ–çª—å£åœ¨è¾“å…¥ä¸Šæ¯æ¬¡æ»‘åŠ¨æ‰€è¦†ç›–çš„åŒºåŸŸäº’ä¸é‡å ã€‚</p><p>å·ç§¯å±‚å—çš„è¾“å‡ºå½¢çŠ¶ä¸º (æ‰¹é‡å¤§å°, é€šé“, é«˜, å®½)ã€‚å½“å·ç§¯å±‚å—çš„è¾“å‡ºä¼ å…¥å…¨è¿æ¥å±‚å—æ—¶ï¼Œå…¨è¿æ¥å±‚å—ä¼šå°†å°æ‰¹é‡ä¸­æ¯ä¸ªæ ·æœ¬å˜å¹³ï¼ˆflattenï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¨è¿æ¥å±‚çš„è¾“å…¥å½¢çŠ¶å°†å˜æˆäºŒç»´ï¼Œå…¶ä¸­ç¬¬äºŒç»´æ˜¯æ¯ä¸ªæ ·æœ¬å˜å¹³åçš„å‘é‡è¡¨ç¤ºï¼Œä¸”å‘é‡é•¿åº¦ä¸ºé€šé“ã€é«˜å’Œå®½çš„ä¹˜ç§¯ã€‚å…¨è¿æ¥å±‚å—å« 3 ä¸ªå…¨è¿æ¥å±‚ã€‚å®ƒä»¬çš„è¾“å‡ºä¸ªæ•°åˆ†åˆ«æ˜¯ 120ã€84 å’Œ 10ï¼Œå…¶ä¸­ 10 ä¸ºè¾“å‡ºçš„ç±»åˆ«ä¸ªæ•°ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ <code>Sequential</code> ç±»æ¥å®ç° LeNet æ¨¡å‹ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">LeNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>LeNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conv <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># in_channels, out_channels, kernel_size</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># kernel_size, stride</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>        self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>        feature <span class="token operator">=</span> self<span class="token punctuation">.</span>conv<span class="token punctuation">(</span>img<span class="token punctuation">)</span>        output <span class="token operator">=</span> self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>feature<span class="token punctuation">.</span>view<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> output</code></pre><p>è¿™é‡Œä½¿ç”¨ GPU è¿›è¡Œè®¡ç®—ï¼Œå¯¹ç›¸å…³å‡½æ•°çš„ä¿®æ”¹å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzh_pytorchåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span><span class="token keyword">def</span> <span class="token function">train_ch5</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> test_iter<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> optimizer<span class="token punctuation">,</span> device<span class="token punctuation">,</span> num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>    net <span class="token operator">=</span> net<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"training on "</span><span class="token punctuation">,</span> device<span class="token punctuation">)</span>    loss <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>        train_l_sum<span class="token punctuation">,</span> train_acc_sum<span class="token punctuation">,</span> n<span class="token punctuation">,</span> batch_count<span class="token punctuation">,</span> start <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span>            X <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>            y <span class="token operator">=</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>            y_hat <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">)</span>            l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">)</span>            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>            train_l_sum <span class="token operator">+=</span> l<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>            train_acc_sum <span class="token operator">+=</span> <span class="token punctuation">(</span>y_hat<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>            n <span class="token operator">+=</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            batch_count <span class="token operator">+=</span> <span class="token number">1</span>        test_acc <span class="token operator">=</span> evaluate_accuracy<span class="token punctuation">(</span>test_iter<span class="token punctuation">,</span> net<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'epoch %d, loss %.4f, train acc %.3f, test acc %.3f, time %.1f sec'</span>              <span class="token operator">%</span> <span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> train_l_sum <span class="token operator">/</span> batch_count<span class="token punctuation">,</span> train_acc_sum <span class="token operator">/</span> n<span class="token punctuation">,</span> test_acc<span class="token punctuation">,</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># æœ¬å‡½æ•°å·²ä¿å­˜åœ¨d2lzh_pytorchåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨ã€‚è¯¥å‡½æ•°å°†è¢«é€æ­¥æ”¹è¿›ã€‚</span><span class="token keyword">def</span> <span class="token function">evaluate_accuracy</span><span class="token punctuation">(</span>data_iter<span class="token punctuation">,</span> net<span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> device <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># å¦‚æœæ²¡æŒ‡å®šdeviceå°±ä½¿ç”¨netçš„device</span>        device <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>device    acc_sum<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> data_iter<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>                net<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># è¯„ä¼°æ¨¡å¼, è¿™ä¼šå…³é—­ dropout</span>                acc_sum <span class="token operator">+=</span> <span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>                net<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># æ”¹å›è®­ç»ƒæ¨¡å¼</span>            <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># è‡ªå®šä¹‰çš„æ¨¡å‹, 3.13èŠ‚ä¹‹åä¸ä¼šç”¨åˆ°, ä¸è€ƒè™‘GPU</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'is_training'</span> <span class="token keyword">in</span> net<span class="token punctuation">.</span>__code__<span class="token punctuation">.</span>co_varnames<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># å¦‚æœæœ‰ is_training è¿™ä¸ªå‚æ•°</span>                    <span class="token comment"># å°† is_training è®¾ç½®æˆ False</span>                    acc_sum <span class="token operator">+=</span> <span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">,</span> is_training<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>                 <span class="token keyword">else</span><span class="token punctuation">:</span>                    acc_sum <span class="token operator">+=</span> <span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>             n <span class="token operator">+=</span> y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> acc_sum <span class="token operator">/</span> n</code></pre><h4 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h4><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.6_alexnet.png" alt="img"></p><ul><li>Larger parameter size</li><li>Use ReLU instead of sigmoid</li><li>Introducing Dropout</li><li>Data augmentation</li></ul><h4 id="VGG"><a href="#VGG" class="headerlink" title="VGG"></a>VGG</h4><p>VGG æå‡ºäº†å¯ä»¥é€šè¿‡é‡å¤ä½¿ç”¨ç®€å•çš„åŸºç¡€å—æ¥æ„å»ºæ·±åº¦æ¨¡å‹çš„æ€è·¯ã€‚</p><p>VGGå—çš„ç»„æˆè§„å¾‹æ˜¯ï¼šè¿ç»­ä½¿ç”¨æ•°ä¸ªç›¸åŒçš„å¡«å……ä¸º 1ã€çª—å£å½¢çŠ¶ä¸º $3\times 3$ çš„å·ç§¯å±‚åæ¥ä¸Šä¸€ä¸ªæ­¥å¹…ä¸º 2ã€çª—å£å½¢çŠ¶ä¸º $2\times 2$â€‹ â€‹çš„æœ€å¤§æ± åŒ–å±‚ã€‚å·ç§¯å±‚ä¿æŒè¾“å…¥çš„é«˜å’Œå®½ä¸å˜ï¼Œè€Œæ± åŒ–å±‚åˆ™å¯¹å…¶å‡åŠã€‚æˆ‘ä»¬ä½¿ç”¨<code>vgg_block</code>å‡½æ•°æ¥å®ç°è¿™ä¸ªåŸºç¡€çš„VGG å—ï¼Œå®ƒå¯ä»¥æŒ‡å®šå·ç§¯å±‚çš„æ•°é‡å’Œè¾“å…¥è¾“å‡ºé€šé“æ•°ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">vgg_block</span><span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>    blk <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_convs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># è¿™é‡Œä¼šä½¿å®½é«˜å‡åŠ</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>blk<span class="token punctuation">)</span></code></pre><p>ç°åœ¨æˆ‘ä»¬æ„é€ ä¸€ä¸ª VGG ç½‘ç»œã€‚å®ƒæœ‰ 5 ä¸ª <code>vgg_block</code>ï¼Œå‰ 2 å—ä½¿ç”¨å•å·ç§¯å±‚ <code>num_convs=1</code>ï¼Œè€Œå 3 å—ä½¿ç”¨åŒå·ç§¯å±‚ <code>num_convs=2</code>ã€‚ç¬¬ä¸€å—çš„è¾“å…¥è¾“å‡ºé€šé“åˆ†åˆ«æ˜¯ 1ï¼ˆå› ä¸ºä¸‹é¢è¦ä½¿ç”¨çš„ Fashion-MNIST æ•°æ®çš„é€šé“æ•°ä¸º 1ï¼‰å’Œ 64ï¼Œä¹‹åæ¯æ¬¡å¯¹è¾“å‡ºé€šé“æ•°ç¿»å€ï¼Œç›´åˆ°å˜ä¸º 512ã€‚å› ä¸ºè¿™ä¸ªç½‘ç»œä½¿ç”¨äº† 8 ä¸ªå·ç§¯å±‚å’Œ 3 ä¸ªå…¨è¿æ¥å±‚ï¼Œæ‰€ä»¥ç»å¸¸è¢«ç§°ä¸º VGG-11ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">conv_arch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># ç»è¿‡5ä¸ª vgg_block, å®½é«˜ä¼šå‡åŠ5æ¬¡, å˜æˆ 224/32 = 7</span>fc_features <span class="token operator">=</span> <span class="token number">512</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token comment"># c * w * h</span>fc_hidden_units <span class="token operator">=</span> <span class="token number">4096</span> <span class="token comment"># ä»»æ„</span><span class="token keyword">def</span> <span class="token function">vgg</span><span class="token punctuation">(</span>conv_arch<span class="token punctuation">,</span> fc_features<span class="token punctuation">,</span> fc_hidden_units<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># å·ç§¯å±‚éƒ¨åˆ†</span>    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>conv_arch<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># æ¯ç»è¿‡ä¸€ä¸ªvgg_blockéƒ½ä¼šä½¿å®½é«˜å‡åŠ</span>        net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"vgg_block_"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vgg_block<span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># å…¨è¿æ¥å±‚éƒ¨åˆ†</span>    net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"fc"</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>FlattenLayer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                 nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>fc_features<span class="token punctuation">,</span> fc_hidden_units<span class="token punctuation">)</span><span class="token punctuation">,</span>                                 nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                 nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                 nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>fc_hidden_units<span class="token punctuation">,</span> fc_hidden_units<span class="token punctuation">)</span><span class="token punctuation">,</span>                                 nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                 nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                 nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>fc_hidden_units<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>                                <span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> net</code></pre><h4 id="NiN"><a href="#NiN" class="headerlink" title="NiN"></a>NiN</h4><p>å‰å‡ èŠ‚ä»‹ç»çš„ LeNetã€AlexNet å’Œ VGG åœ¨è®¾è®¡ä¸Šçš„å…±åŒä¹‹å¤„æ˜¯ï¼šå…ˆä»¥ç”±å·ç§¯å±‚æ„æˆçš„æ¨¡å—å……åˆ†æŠ½å–ç©ºé—´ç‰¹å¾ï¼Œå†ä»¥ç”±å…¨è¿æ¥å±‚æ„æˆçš„æ¨¡å—æ¥è¾“å‡ºåˆ†ç±»ç»“æœã€‚å…¶ä¸­ï¼ŒAlexNet å’Œ VGG å¯¹ LeNet çš„æ”¹è¿›ä¸»è¦åœ¨äºå¦‚ä½•å¯¹è¿™ä¸¤ä¸ªæ¨¡å—åŠ å®½ï¼ˆå¢åŠ é€šé“æ•°ï¼‰å’ŒåŠ æ·±ã€‚</p><p>æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»ç½‘ç»œä¸­çš„ç½‘ç»œï¼ˆNiNï¼‰ã€‚å®ƒæå‡ºäº†å¦å¤–ä¸€ä¸ªæ€è·¯ï¼Œå³ä¸²è”å¤šä¸ªç”±å·ç§¯å±‚å’Œâ€œå…¨è¿æ¥â€å±‚æ„æˆçš„å°ç½‘ç»œæ¥æ„å»ºä¸€ä¸ªæ·±å±‚ç½‘ç»œã€‚NiNä½¿ç”¨ $1\times 1$ å·ç§¯å±‚æ¥æ›¿ä»£å…¨è¿æ¥å±‚ï¼Œä»è€Œä½¿ç©ºé—´ä¿¡æ¯èƒ½å¤Ÿè‡ªç„¶ä¼ é€’åˆ°åé¢çš„å±‚ä¸­å»ã€‚</p><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.8_nin.svg" alt="img"></p><p>å·¦å›¾æ˜¯ AlexNet å’Œ VGG çš„ç½‘ç»œç»“æ„å±€éƒ¨ï¼Œå³å›¾æ˜¯ NiN çš„ç½‘ç»œç»“æ„å±€éƒ¨ã€‚</p><p><strong>NiN å—</strong>æ˜¯ NiN ä¸­çš„åŸºç¡€å—ã€‚å®ƒç”±ä¸€ä¸ªå·ç§¯å±‚åŠ ä¸¤ä¸ªå……å½“å…¨è¿æ¥å±‚çš„ $1\times 1$ å·ç§¯å±‚ä¸²è”è€Œæˆã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„è¶…å‚æ•°å¯ä»¥è‡ªè¡Œè®¾ç½®ï¼Œè€Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå·ç§¯å±‚çš„è¶…å‚æ•°ä¸€èˆ¬æ˜¯å›ºå®šçš„ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">nin_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> padding<span class="token punctuation">)</span><span class="token punctuation">:</span>    blk <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> padding<span class="token punctuation">)</span><span class="token punctuation">,</span>                        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> blk</code></pre><p><strong>NiN æ¨¡å‹</strong>ä½¿ç”¨å·ç§¯çª—å£å½¢çŠ¶åˆ†åˆ«ä¸º $11\times 11$â€‹ã€$5\times 5$â€‹ å’Œ $3\times 3$ â€‹çš„å·ç§¯å±‚ï¼Œç›¸åº”çš„è¾“å‡ºé€šé“æ•°ä¹Ÿä¸ AlexNet ä¸­çš„ä¸€è‡´ã€‚æ¯ä¸ª NiN å—åæ¥ä¸€ä¸ªæ­¥å¹…ä¸º 2ã€çª—å£å½¢çŠ¶ä¸º $3\times 3$â€‹â€‹ çš„æœ€å¤§æ± åŒ–å±‚ã€‚</p><p>é™¤ä½¿ç”¨ NiN å—ä»¥å¤–ï¼ŒNiN è¿˜æœ‰ä¸€ä¸ªè®¾è®¡ä¸ AlexNet æ˜¾è‘—ä¸åŒï¼šNiN å»æ‰äº† AlexNet æœ€åçš„3ä¸ªå…¨è¿æ¥å±‚ï¼Œå–è€Œä»£ä¹‹åœ°ï¼ŒNiN ä½¿ç”¨äº†è¾“å‡ºé€šé“æ•°ç­‰äºæ ‡ç­¾ç±»åˆ«æ•°çš„NiN å—ï¼Œç„¶åä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–å±‚å¯¹æ¯ä¸ªé€šé“ä¸­æ‰€æœ‰å…ƒç´ æ±‚å¹³å‡å¹¶ç›´æ¥ç”¨äºåˆ†ç±»ã€‚è¿™é‡Œçš„å…¨å±€å¹³å‡æ± åŒ–å±‚å³çª—å£å½¢çŠ¶ç­‰äºè¾“å…¥ç©ºé—´ç»´å½¢çŠ¶çš„å¹³å‡æ± åŒ–å±‚ã€‚NiN çš„è¿™ä¸ªè®¾è®¡çš„å¥½å¤„æ˜¯å¯ä»¥æ˜¾è‘—å‡å°æ¨¡å‹å‚æ•°å°ºå¯¸ï¼Œä»è€Œç¼“è§£è¿‡æ‹Ÿåˆã€‚ç„¶è€Œï¼Œè¯¥è®¾è®¡æœ‰æ—¶ä¼šé€ æˆè·å¾—æœ‰æ•ˆæ¨¡å‹çš„è®­ç»ƒæ—¶é—´çš„å¢åŠ ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F<span class="token keyword">class</span> <span class="token class-name">GlobalAvgPool2d</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># å…¨å±€å¹³å‡æ± åŒ–å±‚å¯é€šè¿‡å°†æ± åŒ–çª—å£å½¢çŠ¶è®¾ç½®æˆè¾“å…¥çš„é«˜å’Œå®½å®ç°</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>GlobalAvgPool2d<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> F<span class="token punctuation">.</span>avg_pool2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    nin_block<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nin_block<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nin_block<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># æ ‡ç­¾ç±»åˆ«æ•°æ˜¯10</span>    nin_block<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    GlobalAvgPool2d<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment"># å°†å››ç»´çš„è¾“å‡ºè½¬æˆäºŒç»´çš„è¾“å‡ºï¼Œå…¶å½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°, 10)</span>    d2l<span class="token punctuation">.</span>FlattenLayer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="GoogLeNet"><a href="#GoogLeNet" class="headerlink" title="GoogLeNet"></a>GoogLeNet</h4><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.9_inception.svg" alt="img"></p><p>å›¾ä¸º Inception å—çš„ç»“æ„ã€‚ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ„è¯†åˆ°çš„ä¸€ç‚¹æ˜¯ï¼Œä»¥ Block ä¸ºå•ä½æ¥æ‹¼å‡‘æ¨¡å‹çš„è¿™ç§æ–¹æ³•é€æ¸ç«çƒ­â€¦</p><h4 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h4><p>è®©æˆ‘ä»¬å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¯¹ç¥ç»ç½‘ç»œæ¨¡å‹æ·»åŠ æ–°çš„å±‚ï¼Œå……åˆ†è®­ç»ƒåçš„æ¨¡å‹æ˜¯å¦åªå¯èƒ½æ›´æœ‰æ•ˆåœ°é™ä½è®­ç»ƒè¯¯å·®ï¼Ÿ</p><p>ç†è®ºä¸Šï¼ŒåŸæ¨¡å‹è§£çš„ç©ºé—´åªæ˜¯æ–°æ¨¡å‹è§£çš„ç©ºé—´çš„å­ç©ºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å°†æ–°æ·»åŠ çš„å±‚è®­ç»ƒæˆæ’ç­‰æ˜ å°„ $f(x) = x$â€‹ï¼Œæ–°æ¨¡å‹å’ŒåŸæ¨¡å‹å°†åŒæ ·æœ‰æ•ˆã€‚ç”±äºæ–°æ¨¡å‹å¯èƒ½å¾—å‡ºæ›´ä¼˜çš„è§£æ¥æ‹Ÿåˆè®­ç»ƒæ•°æ®é›†ï¼Œå› æ­¤æ·»åŠ å±‚ä¼¼ä¹æ›´å®¹æ˜“é™ä½è®­ç»ƒè¯¯å·®ã€‚</p><p>ç„¶è€Œåœ¨å®è·µä¸­ï¼Œæ·»åŠ è¿‡å¤šçš„å±‚åè®­ç»ƒè¯¯å·®å¾€å¾€ä¸é™åå‡ã€‚å³ä½¿åˆ©ç”¨æ‰¹é‡å½’ä¸€åŒ–å¸¦æ¥çš„æ•°å€¼ç¨³å®šæ€§ä½¿è®­ç»ƒæ·±å±‚æ¨¡å‹æ›´åŠ å®¹æ˜“ï¼Œè¯¥é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚é’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œæ®‹å·®ç½‘ç»œè¢«æå‡ºã€‚</p><ul><li>æ®‹å·®å—</li></ul><p>è®©æˆ‘ä»¬èšç„¦äºç¥ç»ç½‘ç»œå±€éƒ¨ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè®¾è¾“å…¥ä¸º $\boldsymbol{x}$ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›å­¦å‡ºçš„ç†æƒ³æ˜ å°„ä¸º $f(\boldsymbol{x})$ï¼Œä»è€Œä½œä¸ºå›¾ä¸Šæ–¹æ¿€æ´»å‡½æ•°çš„è¾“å…¥ã€‚å·¦å›¾è™šçº¿æ¡†ä¸­çš„éƒ¨åˆ†éœ€è¦ç›´æ¥æ‹Ÿåˆå‡ºè¯¥æ˜ å°„ $f(\boldsymbol{x})$ï¼Œè€Œå³å›¾è™šçº¿æ¡†ä¸­çš„éƒ¨åˆ†åˆ™éœ€è¦æ‹Ÿåˆå‡ºæœ‰å…³æ’ç­‰æ˜ å°„çš„æ®‹å·®æ˜ å°„ $f(\boldsymbol{x})-\boldsymbol{x}$â€‹ã€‚</p><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.11_residual-block.svg" alt="img"></p><p>æ®‹å·®æ˜ å°„åœ¨å®é™…ä¸­å¾€å¾€æ›´å®¹æ˜“ä¼˜åŒ–ã€‚ä»¥æœ¬èŠ‚å¼€å¤´æåˆ°çš„æ’ç­‰æ˜ å°„ä½œä¸ºæˆ‘ä»¬å¸Œæœ›å­¦å‡ºçš„ç†æƒ³æ˜ å°„ $f(\boldsymbol{x})$ã€‚æˆ‘ä»¬åªéœ€å°†å›¾ä¸­å³å›¾è™šçº¿æ¡†å†…ä¸Šæ–¹çš„åŠ æƒè¿ç®—ï¼ˆå¦‚ä»¿å°„ï¼‰çš„æƒé‡å’Œåå·®å‚æ•°å­¦æˆ 0ï¼Œé‚£ä¹ˆ $f(\boldsymbol{x})$ å³ä¸ºæ’ç­‰æ˜ å°„ã€‚</p><p>å®é™…ä¸­ï¼Œå½“ç†æƒ³æ˜ å°„ $f(\boldsymbol{x})$ ææ¥è¿‘äºæ’ç­‰æ˜ å°„æ—¶ï¼Œæ®‹å·®æ˜ å°„ä¹Ÿæ˜“äºæ•æ‰æ’ç­‰æ˜ å°„çš„ç»†å¾®æ³¢åŠ¨ã€‚å³å›¾ä¹Ÿæ˜¯ ResNet çš„åŸºç¡€å—ï¼Œå³<strong>æ®‹å·®å—</strong>ï¼ˆresidual blockï¼‰ã€‚åœ¨æ®‹å·®å—ä¸­ï¼Œè¾“å…¥å¯é€šè¿‡è·¨å±‚çš„æ•°æ®çº¿è·¯æ›´å¿«åœ°å‘å‰ä¼ æ’­ã€‚</p><p>ResNet æ²¿ç”¨äº† VGG å…¨ $3\times 3$ å·ç§¯å±‚çš„è®¾è®¡ã€‚æ®‹å·®å—é‡Œé¦–å…ˆæœ‰ 2 ä¸ªæœ‰ç›¸åŒè¾“å‡ºé€šé“æ•°çš„ $3\times 3$ å·ç§¯å±‚ã€‚æ¯ä¸ªå·ç§¯å±‚åæ¥ä¸€ä¸ªæ‰¹é‡å½’ä¸€åŒ–å±‚å’ŒReLUæ¿€æ´»å‡½æ•°ã€‚ç„¶åæˆ‘ä»¬å°†è¾“å…¥è·³è¿‡è¿™ä¸¤ä¸ªå·ç§¯è¿ç®—åç›´æ¥åŠ åœ¨æœ€åçš„ReLUæ¿€æ´»å‡½æ•°å‰ã€‚è¿™æ ·çš„è®¾è®¡è¦æ±‚ä¸¤ä¸ªå·ç§¯å±‚çš„è¾“å‡ºä¸è¾“å…¥å½¢çŠ¶ä¸€æ ·ï¼Œä»è€Œå¯ä»¥ç›¸åŠ ã€‚å¦‚æœæƒ³æ”¹å˜é€šé“æ•°ï¼Œå°±éœ€è¦å¼•å…¥ä¸€ä¸ªé¢å¤–çš„ $1\times 1$â€‹â€‹ å·ç§¯å±‚æ¥å°†è¾“å…¥å˜æ¢æˆéœ€è¦çš„å½¢çŠ¶åå†åšç›¸åŠ è¿ç®—ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Residual</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># æœ¬ç±»å·²ä¿å­˜åœ¨d2lzh_pytorchåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> use_1x1conv<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>Residual<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span>stride<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> use_1x1conv<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> stride<span class="token operator">=</span>stride<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>bn1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bn2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        Y <span class="token operator">=</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        Y <span class="token operator">=</span> self<span class="token punctuation">.</span>bn2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">:</span>            X <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        <span class="token keyword">return</span> F<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>Y <span class="token operator">+</span> X<span class="token punctuation">)</span></code></pre><ul><li>ResNet æ¨¡å‹</li></ul><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">resnet_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> num_residuals<span class="token punctuation">,</span> first_block<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> first_block<span class="token punctuation">:</span>        <span class="token keyword">assert</span> in_channels <span class="token operator">==</span> out_channels <span class="token comment"># ç¬¬ä¸€ä¸ªæ¨¡å—çš„é€šé“æ•°åŒè¾“å…¥é€šé“æ•°ä¸€è‡´</span>    blk <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_residuals<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token keyword">not</span> first_block<span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Residual<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> use_1x1conv<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            blk<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Residual<span class="token punctuation">(</span>out_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>blk<span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"resnet_block1"</span><span class="token punctuation">,</span> resnet_block<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> first_block<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"resnet_block2"</span><span class="token punctuation">,</span> resnet_block<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"resnet_block3"</span><span class="token punctuation">,</span> resnet_block<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"resnet_block4"</span><span class="token punctuation">,</span> resnet_block<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"global_avg_pool"</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>GlobalAvgPool2d<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># GlobalAvgPool2dçš„è¾“å‡º: (Batch, 512, 1, 1)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"fc"</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>FlattenLayer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </code></pre><h4 id="DenseNet"><a href="#DenseNet" class="headerlink" title="DenseNet"></a>DenseNet</h4><p>ResNet ä¸­çš„è·¨å±‚è¿æ¥è®¾è®¡å¼•ç”³å‡ºäº†æ•°ä¸ªåç»­å·¥ä½œã€‚æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»å…¶ä¸­çš„ä¸€ä¸ªï¼šç¨ å¯†è¿æ¥ç½‘ç»œã€‚</p><p><img src="http://tangshusen.me/Dive-into-DL-PyTorch/img/chapter05/5.12_densenet.svg" alt="img"></p><p>å›¾ä¸­å°†éƒ¨åˆ†å‰åç›¸é‚»çš„è¿ç®—æŠ½è±¡ä¸ºæ¨¡å— A å’Œæ¨¡å— Bã€‚</p><p>ä¸ ResNet çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒDenseNet é‡Œæ¨¡å— B çš„è¾“å‡ºä¸æ˜¯åƒ ResNet é‚£æ ·å’Œæ¨¡å— A çš„è¾“å‡ºç›¸åŠ ï¼Œè€Œæ˜¯åœ¨é€šé“ç»´ä¸Šè¿ç»“ã€‚è¿™æ ·æ¨¡å— A çš„è¾“å‡ºå¯ä»¥ç›´æ¥ä¼ å…¥æ¨¡å— B åé¢çš„å±‚ã€‚åœ¨è¿™ä¸ªè®¾è®¡é‡Œï¼Œæ¨¡å— A ç›´æ¥è·Ÿæ¨¡å— B åé¢çš„æ‰€æœ‰å±‚è¿æ¥åœ¨äº†ä¸€èµ·ã€‚è¿™ä¹Ÿæ˜¯å®ƒè¢«ç§°ä¸ºâ€œç¨ å¯†è¿æ¥â€çš„åŸå› ã€‚</p><ul><li>DenseBlock</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">conv_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>    blk <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">)</span><span class="token punctuation">,</span>                         nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> blk<span class="token keyword">class</span> <span class="token class-name">DenseBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num_convs<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>DenseBlock<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        net <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_convs<span class="token punctuation">)</span><span class="token punctuation">:</span>            in_c <span class="token operator">=</span> in_channels <span class="token operator">+</span> i <span class="token operator">*</span> out_channels            net<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conv_block<span class="token punctuation">(</span>in_c<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span>net<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>out_channels <span class="token operator">=</span> in_channels <span class="token operator">+</span> num_convs <span class="token operator">*</span> out_channels <span class="token comment"># è®¡ç®—è¾“å‡ºé€šé“æ•°</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> blk <span class="token keyword">in</span> self<span class="token punctuation">.</span>net<span class="token punctuation">:</span>            Y <span class="token operator">=</span> blk<span class="token punctuation">(</span>X<span class="token punctuation">)</span>            X <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># åœ¨é€šé“ç»´ä¸Šå°†è¾“å…¥å’Œè¾“å‡ºè¿ç»“</span>        <span class="token keyword">return</span> X</code></pre><ul><li>è¿‡æ¸¡å±‚</li></ul><p>ç”±äºæ¯ä¸ªç¨ å¯†å—éƒ½ä¼šå¸¦æ¥é€šé“æ•°çš„å¢åŠ ï¼Œä½¿ç”¨è¿‡å¤šåˆ™ä¼šå¸¦æ¥è¿‡äºå¤æ‚çš„æ¨¡å‹ã€‚è¿‡æ¸¡å±‚ç”¨æ¥æ§åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚å®ƒé€šè¿‡ $1\times1$ â€‹å·ç§¯å±‚æ¥å‡å°é€šé“æ•°ï¼Œå¹¶ä½¿ç”¨æ­¥å¹…ä¸º 2 çš„å¹³å‡æ± åŒ–å±‚å‡åŠé«˜å’Œå®½ï¼Œä»è€Œè¿›ä¸€æ­¥é™ä½æ¨¡å‹å¤æ‚åº¦ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">transition_block</span><span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">)</span><span class="token punctuation">:</span>    blk <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>            nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">)</span><span class="token punctuation">,</span>             nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            nn<span class="token punctuation">.</span>AvgPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> blk</code></pre><ul><li>DenseNet æ¨¡å‹</li></ul><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>num_channels<span class="token punctuation">,</span> growth_rate <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span>  <span class="token comment"># num_channelsä¸ºå½“å‰çš„é€šé“æ•°</span>num_convs_in_dense_blocks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> num_convs <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>num_convs_in_dense_blocks<span class="token punctuation">)</span><span class="token punctuation">:</span>    DB <span class="token operator">=</span> DenseBlock<span class="token punctuation">(</span>num_convs<span class="token punctuation">,</span> num_channels<span class="token punctuation">,</span> growth_rate<span class="token punctuation">)</span>    net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"DenseBlock_%d"</span> <span class="token operator">%</span> i<span class="token punctuation">,</span> DB<span class="token punctuation">)</span>    <span class="token comment"># ä¸Šä¸€ä¸ªç¨ å¯†å—çš„è¾“å‡ºé€šé“æ•°</span>    num_channels <span class="token operator">=</span> DB<span class="token punctuation">.</span>out_channels    <span class="token comment"># åœ¨ç¨ å¯†å—ä¹‹é—´åŠ å…¥é€šé“æ•°å‡åŠçš„è¿‡æ¸¡å±‚</span>    <span class="token keyword">if</span> i <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num_convs_in_dense_blocks<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>        net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"transition_block_%d"</span> <span class="token operator">%</span> i<span class="token punctuation">,</span> transition_block<span class="token punctuation">(</span>num_channels<span class="token punctuation">,</span> num_channels <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        num_channels <span class="token operator">=</span> num_channels <span class="token operator">//</span> <span class="token number">2</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"BN"</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>num_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"relu"</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"global_avg_pool"</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>GlobalAvgPool2d<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># GlobalAvgPool2dçš„è¾“å‡º: (Batch, num_channels, 1, 1)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">"fc"</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>FlattenLayer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_channels<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </code></pre><h2 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h2><h3 id="è¯­è¨€æ¨¡å‹"><a href="#è¯­è¨€æ¨¡å‹" class="headerlink" title="è¯­è¨€æ¨¡å‹"></a>è¯­è¨€æ¨¡å‹</h3><p>è¯­è¨€æ¨¡å‹ï¼ˆlanguage modelï¼‰æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†çš„é‡è¦æŠ€æœ¯ã€‚è‡ªç„¶è¯­è¨€å¤„ç†ä¸­æœ€å¸¸è§çš„æ•°æ®æ˜¯æ–‡æœ¬æ•°æ®ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸€æ®µè‡ªç„¶è¯­è¨€æ–‡æœ¬çœ‹ä½œä¸€æ®µç¦»æ•£çš„æ—¶é—´åºåˆ—ã€‚å‡è®¾ä¸€æ®µé•¿åº¦ä¸º $T$ çš„æ–‡æœ¬ä¸­çš„è¯ä¾æ¬¡ä¸º $w_1, w_2, \ldots, w_T$ï¼Œé‚£ä¹ˆåœ¨ç¦»æ•£çš„æ—¶é—´åºåˆ—ä¸­ï¼Œ$w_t$ï¼ˆ$1 \leq t \leq T$ï¼‰å¯çœ‹ä½œåœ¨æ—¶é—´æ­¥ï¼ˆtime stepï¼‰$t$ çš„è¾“å‡ºæˆ–æ ‡ç­¾ã€‚</p><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $T$ çš„è¯çš„åºåˆ— $w_1, w_2, \ldots, w_T$ï¼Œè¯­è¨€æ¨¡å‹å°†è®¡ç®—è¯¥åºåˆ—çš„æ¦‚ç‡ï¼š$P(w_1, w_2, \ldots, w_T)$.</p><p>è¯­è¨€æ¨¡å‹å¯ç”¨äºæå‡è¯­éŸ³è¯†åˆ«å’Œæœºå™¨ç¿»è¯‘çš„æ€§èƒ½ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨è¯­éŸ³è¯†åˆ«ä¸­ï¼Œç»™å®šä¸€æ®µâ€œå¨æˆ¿é‡Œé£Ÿæ²¹ç”¨å®Œäº†â€çš„è¯­éŸ³ï¼Œæœ‰å¯èƒ½ä¼šè¾“å‡ºâ€œå¨æˆ¿é‡Œé£Ÿæ²¹ç”¨å®Œäº†â€å’Œâ€œå¨æˆ¿é‡ŒçŸ³æ²¹ç”¨å®Œäº†â€è¿™ä¸¤ä¸ªè¯»éŸ³å®Œå…¨ä¸€æ ·çš„æ–‡æœ¬åºåˆ—ã€‚å¦‚æœè¯­è¨€æ¨¡å‹åˆ¤æ–­å‡ºå‰è€…çš„æ¦‚ç‡å¤§äºåè€…çš„æ¦‚ç‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ç›¸åŒè¯»éŸ³çš„è¯­éŸ³è¾“å‡ºâ€œå¨æˆ¿é‡Œé£Ÿæ²¹ç”¨å®Œäº†â€çš„æ–‡æœ¬åºåˆ—ã€‚</p><p>åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼Œå¦‚æœå¯¹è‹±æ–‡â€œyou go firstâ€é€è¯ç¿»è¯‘æˆä¸­æ–‡çš„è¯ï¼Œå¯èƒ½å¾—åˆ°â€œä½ èµ°å…ˆâ€â€œä½ å…ˆèµ°â€ç­‰æ’åˆ—æ–¹å¼çš„æ–‡æœ¬åºåˆ—ã€‚å¦‚æœè¯­è¨€æ¨¡å‹åˆ¤æ–­å‡ºâ€œä½ å…ˆèµ°â€çš„æ¦‚ç‡å¤§äºå…¶ä»–æ’åˆ—æ–¹å¼çš„æ–‡æœ¬åºåˆ—çš„æ¦‚ç‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠâ€œyou go firstâ€ç¿»è¯‘æˆâ€œä½ å…ˆèµ°â€ã€‚</p><h4 id="è¯­è¨€æ¨¡å‹çš„è®¡ç®—"><a href="#è¯­è¨€æ¨¡å‹çš„è®¡ç®—" class="headerlink" title="è¯­è¨€æ¨¡å‹çš„è®¡ç®—"></a>è¯­è¨€æ¨¡å‹çš„è®¡ç®—</h4><p>æ ¹æ®ã€Šæ¦‚ç‡è®ºã€‹è¯¾ç¨‹å­¦è¿‡çš„æœ‰å…³çŸ¥è¯†ï¼Œæˆ‘ä»¬ä¸éš¾ç†è§£ï¼š</p><script type="math/tex; mode=display">P(w_1, w_2, \ldots, w_T) = \prod_{t=1}^T P(w_t \mid w_1, \ldots, w_{t-1})</script><p>é‚£ä¹ˆï¼Œè¿™äº›æ¦‚ç‡è¯¥å¦‚ä½•è·å¾—å‘¢ï¼Ÿ</p><p>è®¾è®­ç»ƒæ•°æ®é›†ä¸ºä¸€ä¸ªå¤§å‹æ–‡æœ¬è¯­æ–™åº“ï¼Œå¦‚ç»´åŸºç™¾ç§‘çš„æ‰€æœ‰æ¡ç›®ã€‚è¯çš„æ¦‚ç‡å¯ä»¥é€šè¿‡<strong>è¯¥è¯åœ¨è®­ç»ƒæ•°æ®é›†ä¸­çš„ç›¸å¯¹è¯é¢‘æ¥è®¡ç®—</strong>ã€‚ä¾‹å¦‚ï¼Œ$P(w_1)$ å¯ä»¥è®¡ç®—ä¸º $w_1$ åœ¨è®­ç»ƒæ•°æ®é›†ä¸­çš„è¯é¢‘ï¼ˆè¯å‡ºç°çš„æ¬¡æ•°ï¼‰ä¸è®­ç»ƒæ•°æ®é›†çš„æ€»è¯æ•°ä¹‹æ¯”ã€‚å› æ­¤ï¼Œæ ¹æ®æ¡ä»¶æ¦‚ç‡å®šä¹‰ï¼Œä¸€ä¸ªè¯åœ¨ç»™å®šå‰å‡ ä¸ªè¯çš„æƒ…å†µä¸‹çš„æ¡ä»¶æ¦‚ç‡ä¹Ÿå¯ä»¥é€šè¿‡è®­ç»ƒæ•°æ®é›†ä¸­çš„ç›¸å¯¹è¯é¢‘è®¡ç®—ã€‚å†ä¾‹å¦‚ï¼Œ$P(w_2 \mid w_1)$ å¯ä»¥è®¡ç®—ä¸º $w_1, w_2$ ä¸¤è¯ç›¸é‚»çš„é¢‘ç‡ä¸ $w_1$ è¯é¢‘çš„æ¯”å€¼ï¼Œå› ä¸ºè¯¥æ¯”å€¼å³ $P(w_1, w_2)$ ä¸ $P(w_1)$ ä¹‹æ¯”ï¼›è€Œ $P(w_3 \mid w_1, w_2)$ åŒç†å¯ä»¥è®¡ç®—ä¸º $w_1$ã€$w_2$ å’Œ $w_3$ ä¸‰è¯ç›¸é‚»çš„é¢‘ç‡ä¸ $w_1$ å’Œ $w_2$ ä¸¤è¯ç›¸é‚»çš„é¢‘ç‡çš„æ¯”å€¼ã€‚ä»¥æ­¤ç±»æ¨ã€‚</p><h4 id="N-grams"><a href="#N-grams" class="headerlink" title="N-grams"></a>N-grams</h4><p>å½“åºåˆ—é•¿åº¦å¢åŠ æ—¶ï¼Œè®¡ç®—å’Œå­˜å‚¨å¤šä¸ªè¯å…±åŒå‡ºç°çš„æ¦‚ç‡çš„å¤æ‚åº¦ä¼šå‘ˆæŒ‡æ•°çº§å¢åŠ ã€‚$n$â€‹ å…ƒè¯­æ³•é€šè¿‡é©¬å°”å¯å¤«å‡è®¾ï¼ˆè™½ç„¶å¹¶ä¸ä¸€å®šæˆç«‹ï¼‰ç®€åŒ–äº†è¯­è¨€æ¨¡å‹çš„è®¡ç®—ã€‚è¿™é‡Œçš„é©¬å°”å¯å¤«å‡è®¾æ˜¯æŒ‡ï¼Œ<strong>ä¸€ä¸ªè¯çš„å‡ºç°åªä¸å‰é¢ $n$ â€‹ä¸ªè¯ç›¸å…³</strong>ã€‚</p><p>å¦‚æœ $n=1$ï¼Œé‚£ä¹ˆæœ‰ $P(w_3 \mid w_1, w_2) = P(w_3 \mid w_2)$ã€‚</p><p>å¦‚æœåŸºäº $n-1$ é˜¶é©¬å°”å¯å¤«é“¾ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯­è¨€æ¨¡å‹æ”¹å†™ä¸ºï¼š$P(w_1, w_2, \ldots, w_T) \approx \prod_{t=1}^T P(w_t \mid w_{t-(n-1)}, \ldots, w_{t-1}) $ã€‚</p><p>å½“ $n$ åˆ†åˆ«ä¸º 1ã€2 å’Œ 3 æ—¶ï¼Œæˆ‘ä»¬å°†å…¶åˆ†åˆ«ç§°ä½œä¸€å…ƒè¯­æ³•ï¼ˆunigramï¼‰ã€äºŒå…ƒè¯­æ³•ï¼ˆbigramï¼‰å’Œä¸‰å…ƒè¯­æ³•ï¼ˆtrigramï¼‰ã€‚</p><p>å½“ $n$ è¾ƒå°æ—¶ï¼Œ$n$ å…ƒè¯­æ³•å¾€å¾€å¹¶ä¸å‡†ç¡®ã€‚ç„¶è€Œï¼Œå½“ $n$ è¾ƒå¤§æ—¶ï¼Œ$n$ å…ƒè¯­æ³•éœ€è¦è®¡ç®—å¹¶å­˜å‚¨å¤§é‡çš„è¯é¢‘å’Œå¤šè¯ç›¸é‚»é¢‘ç‡ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ–¹æ³•åœ¨è¯­è¨€æ¨¡å‹ä¸­æ›´å¥½åœ°å¹³è¡¡ä»¥ä¸Šè¿™ä¸¤ç‚¹å‘¢ï¼Ÿæˆ‘ä»¬å°†åœ¨æœ¬ç« æ¢ç©¶è¿™æ ·çš„æ–¹æ³•ã€‚</p><h3 id="RNN-1"><a href="#RNN-1" class="headerlink" title="RNN"></a>RNN</h3><p>æœ¬èŠ‚å°†ä»‹ç»å¾ªç¯ç¥ç»ç½‘ç»œã€‚å®ƒå¹¶éåˆšæ€§åœ°è®°å¿†æ‰€æœ‰å›ºå®šé•¿åº¦çš„åºåˆ—ï¼Œè€Œæ˜¯é€šè¿‡éšè—çŠ¶æ€æ¥å­˜å‚¨ä¹‹å‰æ—¶é—´æ­¥çš„ä¿¡æ¯ã€‚é¦–å…ˆæˆ‘ä»¬å›å¿†ä¸€ä¸‹å‰é¢ä»‹ç»è¿‡çš„å¤šå±‚æ„ŸçŸ¥æœºï¼Œç„¶åæè¿°å¦‚ä½•æ·»åŠ éšè—çŠ¶æ€æ¥å°†å®ƒå˜æˆå¾ªç¯ç¥ç»ç½‘ç»œã€‚</p><ul><li>ä¸å«éšè—çŠ¶æ€çš„ç¥ç»ç½‘ç»œ</li></ul><p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå«å•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºã€‚ç»™å®šæ ·æœ¬æ•°ä¸º $n$ã€è¾“å…¥ä¸ªæ•°ï¼ˆç‰¹å¾æ•°æˆ–ç‰¹å¾å‘é‡ç»´åº¦ï¼‰ä¸º $d$ çš„å°æ‰¹é‡æ•°æ®æ ·æœ¬ $\boldsymbol{X} \in \mathbb{R}^{n \times d}$ã€‚è®¾éšè—å±‚çš„æ¿€æ´»å‡½æ•°ä¸º $\phi$ï¼Œé‚£ä¹ˆéšè—å±‚çš„è¾“å‡º $\boldsymbol{H} \in \mathbb{R}^{n \times h}$ è®¡ç®—ä¸º</p><script type="math/tex; mode=display">\boldsymbol{H} = \phi(\boldsymbol{X} \boldsymbol{W}_{xh} + \boldsymbol{b}_h)</script><p>å…¶ä¸­éšè—å±‚æƒé‡å‚æ•° $\boldsymbol{W}_{xh} \in \mathbb{R}^{d \times h}$ï¼Œéšè—å±‚åå·®å‚æ•° $\boldsymbol{b}_h \in \mathbb{R}^{1 \times h}$ï¼Œ$h$ ä¸ºéšè—å•å…ƒä¸ªæ•°ã€‚ä¸Šå¼ç›¸åŠ çš„ä¸¤é¡¹å½¢çŠ¶ä¸åŒï¼Œå› æ­¤å°†æŒ‰ç…§å¹¿æ’­æœºåˆ¶ç›¸åŠ ã€‚æŠŠéšè—å˜é‡ $\boldsymbol{H}$ ä½œä¸ºè¾“å‡ºå±‚çš„è¾“å…¥ï¼Œä¸”è®¾è¾“å‡ºä¸ªæ•°ä¸º $q$â€‹â€‹ï¼ˆå¦‚åˆ†ç±»é—®é¢˜ä¸­çš„ç±»åˆ«æ•°ï¼‰ï¼Œè¾“å‡ºå±‚çš„è¾“å‡ºä¸º $\boldsymbol{O} = \boldsymbol{H} \boldsymbol{W}_{hq} + \boldsymbol{b}_q$.â€‹ å…¶ä¸­è¾“å‡ºå˜é‡ $\boldsymbol{O} \in \mathbb{R}^{n \times q}$, è¾“å‡ºå±‚æƒé‡å‚æ•° $\boldsymbol{W}_{hq} \in \mathbb{R}^{h \times q}$, è¾“å‡ºå±‚åå·®å‚æ•° $\boldsymbol{b}_q \in \mathbb{R}^{1 \times q}$ã€‚å¦‚æœæ˜¯åˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ $\text{softmax}(\boldsymbol{O})$ æ¥è®¡ç®—è¾“å‡ºç±»åˆ«çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p><ul><li>å«éšè—çŠ¶æ€çš„ RNN</li></ul><p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘è¾“å…¥æ•°æ®å­˜åœ¨æ—¶é—´ç›¸å…³æ€§çš„æƒ…å†µã€‚å‡è®¾ $\boldsymbol{X}_t \in \mathbb{R}^{n \times d}$ æ˜¯åºåˆ—ä¸­æ—¶é—´æ­¥ $t$ çš„å°æ‰¹é‡è¾“å…¥ï¼Œ$\boldsymbol{H}_t \in \mathbb{R}^{n \times h}$ æ˜¯è¯¥æ—¶é—´æ­¥çš„éšè—å˜é‡ã€‚</p><p>ä¸å¤šå±‚æ„ŸçŸ¥æœºä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿å­˜ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—å˜é‡ $\boldsymbol{H}_{t-1}$ï¼Œå¹¶å¼•å…¥ä¸€ä¸ªæ–°çš„æƒé‡å‚æ•° $\boldsymbol{W}_{hh} \in \mathbb{R}^{h \times h}$ï¼Œè¯¥å‚æ•°ç”¨æ¥æè¿°åœ¨å½“å‰æ—¶é—´æ­¥å¦‚ä½•ä½¿ç”¨ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—å˜é‡ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œæ—¶é—´æ­¥ $t$ çš„éšè—å˜é‡çš„è®¡ç®—ç”±å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥å’Œä¸Šä¸€æ—¶é—´æ­¥çš„éšè—å˜é‡å…±åŒå†³å®šï¼š</p><script type="math/tex; mode=display">\boldsymbol{H}_t = \phi(\boldsymbol{X}_t \boldsymbol{W}_{xh} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{hh} + \boldsymbol{b}_h)</script><p>ä¸å¤šå±‚æ„ŸçŸ¥æœºç›¸æ¯”ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ·»åŠ äº† $\boldsymbol{H}_{t-1} \boldsymbol{W}_{hh}$ ä¸€é¡¹ã€‚ç”±ä¸Šå¼ä¸­ç›¸é‚»æ—¶é—´æ­¥çš„éšè—å˜é‡ $\boldsymbol{H}_t$ â€‹å’Œ $\boldsymbol{H}_{t-1}$ â€‹ä¹‹é—´çš„å…³ç³»å¯çŸ¥ï¼Œè¿™é‡Œçš„éšè—å˜é‡èƒ½å¤Ÿæ•æ‰æˆªè‡³å½“å‰æ—¶é—´æ­¥çš„åºåˆ—çš„å†å²ä¿¡æ¯ï¼Œå°±åƒæ˜¯ç¥ç»ç½‘ç»œå½“å‰æ—¶é—´æ­¥çš„çŠ¶æ€æˆ–è®°å¿†ä¸€æ ·ã€‚å› æ­¤ï¼Œè¯¥éšè—å˜é‡ä¹Ÿç§°ä¸ºéšè—çŠ¶æ€ã€‚</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter06/6.2_rnn.svg" alt="img"></p><p>ç”±äºéšè—çŠ¶æ€åœ¨å½“å‰æ—¶é—´æ­¥çš„å®šä¹‰ä½¿ç”¨äº†ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ï¼Œä¸Šå¼çš„è®¡ç®—æ˜¯å¾ªç¯çš„ã€‚ä½¿ç”¨å¾ªç¯è®¡ç®—çš„ç½‘ç»œå³å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆrecurrent neural networkï¼‰ã€‚</p><p>è€Œåœ¨æ—¶é—´æ­¥ $t$ï¼Œè¾“å‡ºå±‚çš„è¾“å‡ºå’Œå¤šå±‚æ„ŸçŸ¥æœºä¸­çš„è®¡ç®—ç±»ä¼¼ï¼š$\boldsymbol{O}_t = \boldsymbol{H}_t \boldsymbol{W}_{hq} + \boldsymbol{b}_q$.</p><h3 id="å­—ç¬¦æ•°æ®é›†çš„åˆ¶ä½œ"><a href="#å­—ç¬¦æ•°æ®é›†çš„åˆ¶ä½œ" class="headerlink" title="å­—ç¬¦æ•°æ®é›†çš„åˆ¶ä½œ"></a>å­—ç¬¦æ•°æ®é›†çš„åˆ¶ä½œ</h3><ul><li>è¯»å–æ•°æ®é›†</li><li><p>å»ºç«‹å­—ç¬¦ç´¢å¼• idx_to_char ä¸ char_to_idx</p></li><li><p>æ—¶åºæ•°æ®çš„é‡‡æ ·</p><ul><li>éšæœºé‡‡æ ·ï¼šåœ¨éšæœºé‡‡æ ·ä¸­ï¼Œæ¯ä¸ªæ ·æœ¬æ˜¯åŸå§‹åºåˆ—ä¸Šä»»æ„æˆªå–çš„ä¸€æ®µåºåˆ—ã€‚ç›¸é‚»çš„ä¸¤ä¸ªéšæœºå°æ‰¹é‡åœ¨åŸå§‹åºåˆ—ä¸Šçš„ä½ç½®ä¸ä¸€å®šç›¸æ¯—é‚»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•ç”¨ä¸€ä¸ªå°æ‰¹é‡æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€æ¥åˆå§‹åŒ–ä¸‹ä¸€ä¸ªå°æ‰¹é‡çš„éšè—çŠ¶æ€ã€‚åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæ¯æ¬¡éšæœºé‡‡æ ·å‰éƒ½éœ€è¦é‡æ–°åˆå§‹åŒ–éšè—çŠ¶æ€ã€‚</li><li>ç›¸é‚»é‡‡æ ·ï¼šä»¤ç›¸é‚»çš„ä¸¤ä¸ªéšæœºå°æ‰¹é‡åœ¨åŸå§‹åºåˆ—ä¸Šçš„ä½ç½®ç›¸æ¯—é‚»ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€ä¸ªå°æ‰¹é‡æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€æ¥åˆå§‹åŒ–ä¸‹ä¸€ä¸ªå°æ‰¹é‡çš„éšè—çŠ¶æ€ï¼Œä»è€Œä½¿ä¸‹ä¸€ä¸ªå°æ‰¹é‡çš„è¾“å‡ºä¹Ÿå–å†³äºå½“å‰å°æ‰¹é‡çš„è¾“å…¥ï¼Œå¹¶å¦‚æ­¤å¾ªç¯ä¸‹å»ã€‚<ul><li>åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬åªéœ€åœ¨æ¯ä¸€ä¸ªè¿­ä»£å‘¨æœŸå¼€å§‹æ—¶åˆå§‹åŒ–éšè—çŠ¶æ€ã€‚</li><li>å½“å¤šä¸ªç›¸é‚»å°æ‰¹é‡é€šè¿‡ä¼ é€’éšè—çŠ¶æ€ä¸²è”èµ·æ¥æ—¶ï¼Œæ¨¡å‹å‚æ•°çš„æ¢¯åº¦è®¡ç®—å°†ä¾èµ–æ‰€æœ‰ä¸²è”èµ·æ¥çš„å°æ‰¹é‡åºåˆ—ã€‚åŒä¸€è¿­ä»£å‘¨æœŸä¸­ï¼Œéšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ ï¼Œæ¢¯åº¦çš„è®¡ç®—å¼€é”€ä¼šè¶Šæ¥è¶Šå¤§ã€‚ä¸ºäº†ä½¿æ¨¡å‹å‚æ•°çš„æ¢¯åº¦è®¡ç®—åªä¾èµ–ä¸€æ¬¡è¿­ä»£è¯»å–çš„å°æ‰¹é‡åºåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡è¯»å–å°æ‰¹é‡å‰å°†éšè—çŠ¶æ€ä»è®¡ç®—å›¾ä¸­åˆ†ç¦»å‡ºæ¥ã€‚</li></ul></li></ul></li></ul><h3 id="RNN-çš„å®ç°"><a href="#RNN-çš„å®ç°" class="headerlink" title="RNN çš„å®ç°"></a>RNN çš„å®ç°</h3><h4 id="From-scratch"><a href="#From-scratch" class="headerlink" title="From scratch"></a>From scratch</h4><ul><li>å•ä¸ªè¯çš„è¡¨ç¤ºï¼šOne-hot å‘é‡</li><li>åˆå§‹åŒ–æ¨¡å‹å‚æ•°ä¸æ¨¡å‹å®šä¹‰</li><li>é¢„æµ‹å‡½æ•°çš„å®šä¹‰</li><li>è£å‰ªæ¢¯åº¦</li><li>æ¨¡å‹è¯„ä¼°ï¼šå›°æƒ‘åº¦<ul><li>å›°æƒ‘åº¦æ˜¯å¯¹äº¤å‰ç†µæŸå¤±å‡½æ•°åšæŒ‡æ•°è¿ç®—åå¾—åˆ°çš„å€¼<ul><li>æœ€ä½³æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯æŠŠæ ‡ç­¾ç±»åˆ«çš„æ¦‚ç‡é¢„æµ‹ä¸º1ï¼Œæ­¤æ—¶å›°æƒ‘åº¦ä¸º1ï¼›</li><li>æœ€åæƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯æŠŠæ ‡ç­¾ç±»åˆ«çš„æ¦‚ç‡é¢„æµ‹ä¸º0ï¼Œæ­¤æ—¶å›°æƒ‘åº¦ä¸ºæ­£æ— ç©·ï¼›</li><li>åŸºçº¿æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ€»æ˜¯é¢„æµ‹æ‰€æœ‰ç±»åˆ«çš„æ¦‚ç‡éƒ½ç›¸åŒï¼Œæ­¤æ—¶å›°æƒ‘åº¦ä¸ºç±»åˆ«ä¸ªæ•°ã€‚</li></ul></li></ul></li></ul><h4 id="Simple"><a href="#Simple" class="headerlink" title="Simple"></a>Simple</h4><p>Pytorch å®ç°ï¼šå¤§è°ƒåº“</p><pre class="language-python" data-language="python"><code class="language-python">num_hiddens <span class="token operator">=</span> <span class="token number">256</span><span class="token comment"># rnn_layer = nn.LSTM(input_size=vocab_size, hidden_size=num_hiddens) # å·²æµ‹è¯•</span>rnn_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>RNN<span class="token punctuation">(</span>input_size<span class="token operator">=</span>vocab_size<span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>num_hiddens<span class="token punctuation">)</span></code></pre><p>ä¸ä¸Šä¸€èŠ‚ä¸­å®ç°çš„å¾ªç¯ç¥ç»ç½‘ç»œä¸åŒï¼Œè¿™é‡Œ <code>rnn_layer</code> çš„è¾“å…¥å½¢çŠ¶ä¸º <code>(æ—¶é—´æ­¥æ•°, æ‰¹é‡å¤§å°, è¾“å…¥ä¸ªæ•°)</code>ã€‚å…¶ä¸­è¾“å…¥ä¸ªæ•°å³ one-hot å‘é‡é•¿åº¦ï¼ˆè¯å…¸å¤§å°ï¼‰ã€‚</p><p>æ­¤å¤–ï¼Œ<code>rnn_layer</code> ä½œä¸º <code>nn.RNN</code> å®ä¾‹ï¼Œåœ¨å‰å‘è®¡ç®—åä¼šåˆ†åˆ«è¿”å›<strong>éšè—å±‚çš„è¾“å‡º $H$</strong> å’Œ<strong>éšè—çŠ¶æ€ $h$</strong>ã€‚</p><ul><li>$H$â€‹ æŒ‡çš„æ˜¯éšè—å±‚åœ¨<strong>å„ä¸ªæ—¶é—´æ­¥</strong>ä¸Šè®¡ç®—å¹¶è¾“å‡ºçš„éšè—çŠ¶æ€ï¼Œå®ƒä»¬é€šå¸¸ä½œä¸ºåç»­è¾“å‡ºå±‚çš„è¾“å…¥ï¼Œå½¢çŠ¶ä¸º <code>(æ—¶é—´æ­¥æ•°, æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)</code>ã€‚</li><li>$h$ æŒ‡çš„æ˜¯éšè—å±‚åœ¨<strong>æœ€åæ—¶é—´æ­¥</strong>çš„éšè—çŠ¶æ€ï¼šå½“éšè—å±‚æœ‰å¤šå±‚æ—¶ï¼Œæ¯ä¸€å±‚çš„éšè—çŠ¶æ€éƒ½ä¼šè®°å½•åœ¨è¯¥å˜é‡ä¸­ï¼›å¯¹äºåƒé•¿çŸ­æœŸè®°å¿†ï¼ˆLSTMï¼‰ï¼Œéšè—çŠ¶æ€æ˜¯ä¸€ä¸ªå…ƒç»„ $(h, c)$ï¼Œå³ hidden state å’Œ cell stateã€‚</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># æœ¬ç±»å·²ä¿å­˜åœ¨d2lzh_pytorchåŒ…ä¸­æ–¹ä¾¿ä»¥åä½¿ç”¨</span><span class="token keyword">class</span> <span class="token class-name">RNNModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rnn_layer<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>RNNModel<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>rnn <span class="token operator">=</span> rnn_layer        self<span class="token punctuation">.</span>hidden_size <span class="token operator">=</span> rnn_layer<span class="token punctuation">.</span>hidden_size <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">if</span> rnn_layer<span class="token punctuation">.</span>bidirectional <span class="token keyword">else</span> <span class="token number">1</span><span class="token punctuation">)</span>         self<span class="token punctuation">.</span>vocab_size <span class="token operator">=</span> vocab_size        self<span class="token punctuation">.</span>dense <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>self<span class="token punctuation">.</span>hidden_size<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputs<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># inputs: (batch, seq_len)</span>        <span class="token comment"># è·å– one-hot å‘é‡è¡¨ç¤º</span>        X <span class="token operator">=</span> d2l<span class="token punctuation">.</span>to_onehot<span class="token punctuation">(</span>inputs<span class="token punctuation">,</span> self<span class="token punctuation">.</span>vocab_size<span class="token punctuation">)</span> <span class="token comment"># X æ˜¯ä¸ª list</span>        Y<span class="token punctuation">,</span> self<span class="token punctuation">.</span>state <span class="token operator">=</span> self<span class="token punctuation">.</span>rnn<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>        <span class="token comment"># å…¨è¿æ¥å±‚ä¼šé¦–å…ˆå°† Y çš„å½¢çŠ¶å˜æˆ (num_steps * batch_size, num_hiddens)ï¼Œå®ƒçš„è¾“å‡º</span>        <span class="token comment"># å½¢çŠ¶ä¸º (num_steps * batch_size, vocab_size)</span>        output <span class="token operator">=</span> self<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>Y<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Y<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> output<span class="token punctuation">,</span> self<span class="token punctuation">.</span>state</code></pre><p>åœ¨å‰é¢ä¸¤èŠ‚ä¸­ï¼Œå¦‚æœä¸è£å‰ªæ¢¯åº¦ï¼Œæ¨¡å‹å°†æ— æ³•æ­£å¸¸è®­ç»ƒã€‚å½“æ€»çš„æ—¶é—´æ­¥æ•°è¾ƒå¤§æˆ–è€…å½“å‰æ—¶é—´æ­¥è¾ƒå°æ—¶ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œçš„æ¢¯åº¦è¾ƒå®¹æ˜“å‡ºç°è¡°å‡æˆ–çˆ†ç‚¸ã€‚</p><h3 id="RNN-çš„æ”¹è¿›"><a href="#RNN-çš„æ”¹è¿›" class="headerlink" title="RNN çš„æ”¹è¿›"></a>RNN çš„æ”¹è¿›</h3><h4 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h4><p>è™½ç„¶è£å‰ªæ¢¯åº¦å¯ä»¥åº”å¯¹æ¢¯åº¦çˆ†ç‚¸ï¼Œä½†æ— æ³•è§£å†³æ¢¯åº¦è¡°å‡çš„é—®é¢˜ã€‚é€šå¸¸ç”±äºè¿™ä¸ªåŸå› ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œåœ¨å®é™…ä¸­è¾ƒéš¾æ•æ‰æ—¶é—´åºåˆ—ä¸­æ—¶é—´æ­¥è·ç¦»è¾ƒå¤§çš„ä¾èµ–å…³ç³»ã€‚</p><p>é—¨æ§å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆgated recurrent neural networkï¼‰çš„æå‡ºï¼Œæ­£æ˜¯ä¸ºäº†æ›´å¥½åœ°æ•æ‰æ—¶é—´åºåˆ—ä¸­æ—¶é—´æ­¥è·ç¦»è¾ƒå¤§çš„ä¾èµ–å…³ç³»ã€‚å®ƒé€šè¿‡å¯ä»¥å­¦ä¹ çš„é—¨æ¥æ§åˆ¶ä¿¡æ¯çš„æµåŠ¨ã€‚</p><ul><li>é—¨æ§å¾ªç¯å•å…ƒ</li></ul><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter06/6.7_gru_3.svg" alt="img"></p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{R}_t & = \sigma(\boldsymbol{X}_t \boldsymbol{W}_{xr} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{hr} + \boldsymbol{b}_r),\\\boldsymbol{Z}_t & = \sigma(\boldsymbol{X}_t \boldsymbol{W}_{xz} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{hz} + \boldsymbol{b}_z), \\ \tilde{\boldsymbol{H}}_t & = \text{tanh}(\boldsymbol{X}_t \boldsymbol{W}_{xh} + \left(\boldsymbol{R}_t \odot \boldsymbol{H}_{t-1}\right) \boldsymbol{W}_{hh} + \boldsymbol{b}_h), \\ \boldsymbol{H}_t & = \boldsymbol{Z}_t \odot \boldsymbol{H}_{t-1}  + (1 - \boldsymbol{Z}_t) \odot \tilde{\boldsymbol{H}}_t.\end{aligned}</script><ul><li>é‡ç½®é—¨æœ‰åŠ©äºæ•æ‰æ—¶é—´åºåˆ—é‡ŒçŸ­æœŸçš„ä¾èµ–å…³ç³»<ul><li>é‡ç½®é—¨æ§åˆ¶äº†ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å¦‚ä½•æµå…¥å½“å‰æ—¶é—´æ­¥çš„å€™é€‰éšè—çŠ¶æ€</li><li>ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€å¯èƒ½åŒ…å«äº†æ—¶é—´åºåˆ—æˆªè‡³ä¸Šä¸€æ—¶é—´æ­¥çš„å…¨éƒ¨å†å²ä¿¡æ¯</li><li>é‡ç½®é—¨å¯ä»¥ç”¨æ¥ä¸¢å¼ƒä¸é¢„æµ‹æ— å…³çš„å†å²ä¿¡æ¯</li></ul></li><li>æ›´æ–°é—¨æœ‰åŠ©äºæ•æ‰æ—¶é—´åºåˆ—é‡Œé•¿æœŸçš„ä¾èµ–å…³ç³»<ul><li>æ›´æ–°é—¨å¯ä»¥æ§åˆ¶éšè—çŠ¶æ€åº”è¯¥å¦‚ä½•è¢«åŒ…å«å½“å‰æ—¶é—´æ­¥ä¿¡æ¯çš„å€™é€‰éšè—çŠ¶æ€æ‰€æ›´æ–°</li><li>å‡è®¾æ›´æ–°é—¨åœ¨æ—¶é—´æ­¥ $tâ€™$ åˆ° $t$ï¼ˆ$tâ€™ &lt; t$ï¼‰ä¹‹é—´ä¸€ç›´è¿‘ä¼¼ 1ã€‚é‚£ä¹ˆï¼Œåœ¨æ—¶é—´æ­¥ $tâ€™$ åˆ° $t$ ä¹‹é—´çš„è¾“å…¥ä¿¡æ¯å‡ ä¹æ²¡æœ‰æµå…¥æ—¶é—´æ­¥ $t$ çš„éšè—çŠ¶æ€ $\boldsymbol{H}_t$ã€‚å®é™…ä¸Šï¼Œè¿™å¯ä»¥çœ‹ä½œæ˜¯è¾ƒæ—©æ—¶åˆ»çš„éšè—çŠ¶æ€ $\boldsymbol{H}_{tâ€™-1}$ ä¸€ç›´é€šè¿‡æ—¶é—´ä¿å­˜å¹¶ä¼ é€’è‡³å½“å‰æ—¶é—´æ­¥ $t$ã€‚è¿™ä¸ªè®¾è®¡å¯ä»¥åº”å¯¹å¾ªç¯ç¥ç»ç½‘ç»œä¸­çš„æ¢¯åº¦è¡°å‡é—®é¢˜ï¼Œå¹¶æ›´å¥½åœ°æ•æ‰æ—¶é—´åºåˆ—ä¸­æ—¶é—´æ­¥è·ç¦»è¾ƒå¤§çš„ä¾èµ–å…³ç³»ã€‚</li></ul></li></ul><p>å®ç°ä¹Ÿå¯ä»¥ç›´æ¥å¤§è°ƒåº“ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">lr <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">2</span> <span class="token comment"># æ³¨æ„è°ƒæ•´å­¦ä¹ ç‡</span>gru_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>GRU<span class="token punctuation">(</span>input_size<span class="token operator">=</span>vocab_size<span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>num_hiddens<span class="token punctuation">)</span>model <span class="token operator">=</span> d2l<span class="token punctuation">.</span>RNNModel<span class="token punctuation">(</span>gru_layer<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>d2l<span class="token punctuation">.</span>train_and_predict_rnn_pytorch<span class="token punctuation">(</span>model<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> device<span class="token punctuation">,</span>                                corpus_indices<span class="token punctuation">,</span> idx_to_char<span class="token punctuation">,</span> char_to_idx<span class="token punctuation">,</span>                                num_epochs<span class="token punctuation">,</span> num_steps<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> clipping_theta<span class="token punctuation">,</span>                                batch_size<span class="token punctuation">,</span> pred_period<span class="token punctuation">,</span> pred_len<span class="token punctuation">,</span> prefixes<span class="token punctuation">)</span></code></pre><h4 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h4><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter06/6.8_lstm_3.svg" alt="img"></p><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{I}_t &= \sigma(\boldsymbol{X}_t \boldsymbol{W}_{xi} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{hi} + \boldsymbol{b}_i),\\\boldsymbol{F}_t &= \sigma(\boldsymbol{X}_t \boldsymbol{W}_{xf} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{hf} + \boldsymbol{b}_f),\\\boldsymbol{O}_t &= \sigma(\boldsymbol{X}_t \boldsymbol{W}_{xo} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{ho} + \boldsymbol{b}_o), \\ \tilde{\boldsymbol{C}}_t &= \text{tanh}(\boldsymbol{X}_t \boldsymbol{W}_{xc} + \boldsymbol{H}_{t-1} \boldsymbol{W}_{hc} + \boldsymbol{b}_c), \\ \boldsymbol{C}_t & = \boldsymbol{F}_t \odot \boldsymbol{C}_{t-1} + \boldsymbol{I}_t \odot \tilde{\boldsymbol{C}}_t, \\ \boldsymbol{H}_t &= \boldsymbol{O}_t \odot \text{tanh}(\boldsymbol{C}_t).\end{aligned}</script><ul><li>é—å¿˜é—¨æ§åˆ¶ä¸Šä¸€æ—¶é—´æ­¥çš„è®°å¿†ç»†èƒ $\boldsymbol{C}_{t-1}$ ä¸­çš„ä¿¡æ¯æ˜¯å¦ä¼ é€’åˆ°å½“å‰æ—¶é—´æ­¥ï¼Œè€Œè¾“å…¥é—¨åˆ™æ§åˆ¶å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ $\boldsymbol{X}_t$ é€šè¿‡å€™é€‰è®°å¿†ç»†èƒ $\tilde{\boldsymbol{C}}_t$ å¦‚ä½•æµå…¥å½“å‰æ—¶é—´æ­¥çš„è®°å¿†ç»†èƒã€‚<ul><li>å¦‚æœé—å¿˜é—¨ä¸€ç›´è¿‘ä¼¼ 1 ä¸”è¾“å…¥é—¨ä¸€ç›´è¿‘ä¼¼ 0ï¼Œè¿‡å»çš„è®°å¿†ç»†èƒå°†ä¸€ç›´é€šè¿‡æ—¶é—´ä¿å­˜å¹¶ä¼ é€’è‡³å½“å‰æ—¶é—´æ­¥ã€‚è¿™ä¸ªè®¾è®¡å¯ä»¥åº”å¯¹å¾ªç¯ç¥ç»ç½‘ç»œä¸­çš„æ¢¯åº¦è¡°å‡é—®é¢˜ï¼Œå¹¶æ›´å¥½åœ°æ•æ‰æ—¶é—´åºåˆ—ä¸­æ—¶é—´æ­¥è·ç¦»è¾ƒå¤§çš„ä¾èµ–å…³ç³»ã€‚</li></ul></li><li>å½“è¾“å‡ºé—¨è¿‘ä¼¼ 1 æ—¶ï¼Œè®°å¿†ç»†èƒä¿¡æ¯å°†ä¼ é€’åˆ°éšè—çŠ¶æ€ä¾›è¾“å‡ºå±‚ä½¿ç”¨ï¼›å½“è¾“å‡ºé—¨è¿‘ä¼¼ 0 æ—¶ï¼Œè®°å¿†ç»†èƒä¿¡æ¯åªè‡ªå·±ä¿ç•™ã€‚</li></ul><p>å®ç°ä¹Ÿæ˜¯å¤§è°ƒåº“ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">lr <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">2</span> <span class="token comment"># æ³¨æ„è°ƒæ•´å­¦ä¹ ç‡</span>lstm_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>input_size<span class="token operator">=</span>vocab_size<span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>num_hiddens<span class="token punctuation">)</span>model <span class="token operator">=</span> d2l<span class="token punctuation">.</span>RNNModel<span class="token punctuation">(</span>lstm_layer<span class="token punctuation">,</span> vocab_size<span class="token punctuation">)</span>d2l<span class="token punctuation">.</span>train_and_predict_rnn_pytorch<span class="token punctuation">(</span>model<span class="token punctuation">,</span> num_hiddens<span class="token punctuation">,</span> vocab_size<span class="token punctuation">,</span> device<span class="token punctuation">,</span>                                corpus_indices<span class="token punctuation">,</span> idx_to_char<span class="token punctuation">,</span> char_to_idx<span class="token punctuation">,</span>                                num_epochs<span class="token punctuation">,</span> num_steps<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> clipping_theta<span class="token punctuation">,</span>                                batch_size<span class="token punctuation">,</span> pred_period<span class="token punctuation">,</span> pred_len<span class="token punctuation">,</span> prefixes<span class="token punctuation">)</span></code></pre><h4 id="Deep-RNN"><a href="#Deep-RNN" class="headerlink" title="Deep-RNN"></a>Deep-RNN</h4><p>æœ¬ç« åˆ°ç›®å‰ä¸ºæ­¢ä»‹ç»çš„å¾ªç¯ç¥ç»ç½‘ç»œåªæœ‰ä¸€ä¸ªå•å‘çš„éšè—å±‚ï¼Œåœ¨æ·±åº¦å­¦ä¹ åº”ç”¨é‡Œï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨åˆ°å«æœ‰å¤šä¸ªéšè—å±‚çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼Œä¹Ÿç§°ä½œæ·±åº¦å¾ªç¯ç¥ç»ç½‘ç»œã€‚</p><p>å›¾ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªæœ‰ $L$ ä¸ªéšè—å±‚çš„æ·±åº¦å¾ªç¯ç¥ç»ç½‘ç»œï¼Œæ¯ä¸ªéšè—çŠ¶æ€ä¸æ–­ä¼ é€’è‡³å½“å‰å±‚çš„ä¸‹ä¸€æ—¶é—´æ­¥å’Œå½“å‰æ—¶é—´æ­¥çš„ä¸‹ä¸€å±‚ã€‚</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter06/6.9_deep-rnn.svg" alt="img"></p><script type="math/tex; mode=display">\begin{align}\boldsymbol{H}_t^{(1)} &= \phi(\boldsymbol{X}_t \boldsymbol{W}_{xh}^{(1)} + \boldsymbol{H}_{t-1}^{(1)} \boldsymbol{W}_{hh}^{(1)}  + \boldsymbol{b}_h^{(1)}), \\ \boldsymbol{H}_t^{(\ell)} & = \phi(\boldsymbol{H}_t^{(\ell-1)} \boldsymbol{W}_{xh}^{(\ell)} + \boldsymbol{H}_{t-1}^{(\ell)} \boldsymbol{W}_{hh}^{(\ell)}  + \boldsymbol{b}_h^{(\ell)}), 1 \lt \ell \le L, \\ \boldsymbol{O}_t &= \boldsymbol{H}_t^{(L)} \boldsymbol{W}_{hq} + \boldsymbol{b}_q.\end{align}</script><h4 id="bi-RNN"><a href="#bi-RNN" class="headerlink" title="bi-RNN"></a>bi-RNN</h4><p>ä¹‹å‰ä»‹ç»çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹éƒ½æ˜¯å‡è®¾å½“å‰æ—¶é—´æ­¥æ˜¯ç”±å‰é¢çš„è¾ƒæ—©æ—¶é—´æ­¥çš„åºåˆ—å†³å®šçš„ï¼Œå› æ­¤å®ƒä»¬éƒ½å°†ä¿¡æ¯é€šè¿‡éšè—çŠ¶æ€ä»å‰å¾€åä¼ é€’ã€‚</p><p>æœ‰æ—¶å€™ï¼Œå½“å‰æ—¶é—´æ­¥ä¹Ÿå¯èƒ½ç”±åé¢æ—¶é—´æ­¥å†³å®šã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å†™ä¸‹ä¸€ä¸ªå¥å­æ—¶ï¼Œå¯èƒ½ä¼šæ ¹æ®å¥å­åé¢çš„è¯æ¥ä¿®æ”¹å¥å­å‰é¢çš„ç”¨è¯ã€‚åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œé€šè¿‡å¢åŠ ä»åå¾€å‰ä¼ é€’ä¿¡æ¯çš„éšè—å±‚æ¥æ›´çµæ´»åœ°å¤„ç†è¿™ç±»ä¿¡æ¯ã€‚</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/chapter06/6.10_birnn.svg" alt="img"></p><script type="math/tex; mode=display">\begin{aligned}\overrightarrow{\boldsymbol{H}}_t &= \phi(\boldsymbol{X}_t \boldsymbol{W}_{xh}^{(f)} + \overrightarrow{\boldsymbol{H}}_{t-1} \boldsymbol{W}_{hh}^{(f)}  + \boldsymbol{b}_h^{(f)}),\\\overleftarrow{\boldsymbol{H}}_t &= \phi(\boldsymbol{X}_t \boldsymbol{W}_{xh}^{(b)} + \overleftarrow{\boldsymbol{H}}_{t+1} \boldsymbol{W}_{hh}^{(b)}  + \boldsymbol{b}_h^{(b)}),\end{aligned}</script><p>ç„¶åæˆ‘ä»¬è¿ç»“ä¸¤ä¸ªæ–¹å‘çš„éšè—çŠ¶æ€ $\overrightarrow{\boldsymbol{H}}_t$ å’Œ $\overleftarrow{\boldsymbol{H}}_t$ æ¥å¾—åˆ°éšè—çŠ¶æ€ $\boldsymbol{H}_t \in \mathbb{R}^{n \times 2h}$ï¼Œå¹¶å°†å…¶è¾“å…¥åˆ°è¾“å‡ºå±‚ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š&lt;a href=&quot;https://github.com/d2l-ai/d2l-zh&quot;&gt;https://github.com/d2l-ai/d2l-zh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š&lt;a href=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/#/&quot;&gt;https://tangshusen.me/Dive-into-DL-PyTorch/#/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çŸ¥è¯†æ¶æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œ c7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Part B åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Â§ 5 CNN&lt;ul&gt;
&lt;li&gt;åŸºæœ¬æ¦‚å¿µï¼šå·ç§¯å±‚ã€å¡«å……ä¸æ­¥é•¿ã€å¤šé€šé“ã€æ± åŒ–ã€æ‰¹é‡å½’ä¸€åŒ–&lt;/li&gt;
&lt;li&gt;æ¨¡å‹çš„ä¾‹å­ï¼šLeNetã€AlexNetã€VGGã€NiNã€GoogLeNetã€ResNetã€DenseNet&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Â§ 6 RNN&lt;ul&gt;
&lt;li&gt;è¯­è¨€æ¨¡å‹åŠå…¶è®¡ç®—ï¼ŒN-gram çš„æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;RNN åŸºæœ¬æ¨¡å‹åŠå…¶å®ç°ï¼Œå­—ç¬¦æ•°æ®é›†çš„åˆ¶ä½œ&lt;/li&gt;
&lt;li&gt;GRU, LSTM çš„åŸç†&lt;/li&gt;
&lt;li&gt;Deep-RNN, bi-RNN&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ Pytorch ver. é˜…è¯»æ‘˜å½• Part A</title>
    <link href="https://www.c7w.tech/dive-into-dl-pytorch-A/"/>
    <id>https://www.c7w.tech/dive-into-dl-pytorch-A/</id>
    <published>2022-01-24T09:22:22.000Z</published>
    <updated>2022-01-26T04:01:23.653Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png" alt=""></p><ul><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š<a href="https://github.com/d2l-ai/d2l-zh">https://github.com/d2l-ai/d2l-zh</a></li><li>ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š<a href="https://tangshusen.me/Dive-into-DL-PyTorch/#/">https://tangshusen.me/Dive-into-DL-PyTorch/#/</a></li></ul><p>çŸ¥è¯†æ¶æ„ï¼š</p><p><img src="https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg" alt="å°é¢"></p><p>æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œ c7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚</p><p>ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚</p><p>Part A åŒ…å«ï¼š</p><ul><li>Â§ 1 æ·±åº¦å­¦ä¹ ç®€ä»‹</li><li>Â§ 2 é¢„å¤‡çŸ¥è¯†ï¼šPytorch</li><li>Â§ 3 æ·±åº¦å­¦ä¹ åŸºç¡€<ul><li>çº¿æ€§å›å½’ï¼ŒSoftmax å›å½’ï¼Œå¤šå±‚æ„ŸçŸ¥æœºä¸‰ç±»åŸºæœ¬æ¨¡å‹</li><li>æƒé‡è¡°å‡å’Œ Dropout ä¸¤ç±»åº”å¯¹è¿‡æ‹Ÿåˆçš„æ–¹æ³•</li></ul></li><li>Â§ 4 æ·±åº¦å­¦ä¹ è®¡ç®—<ul><li>æ„é€  Pytorch æ¨¡å‹çš„æ–¹å¼</li><li>æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–ä¸å…±äº«</li><li>è‡ªå®šä¹‰ Layer</li><li>è¯»å–ä¸å­˜å‚¨</li><li>GPU è®¡ç®—</li></ul></li></ul><a id="more"></a><h2 id="æ·±åº¦å­¦ä¹ ç®€ä»‹"><a href="#æ·±åº¦å­¦ä¹ ç®€ä»‹" class="headerlink" title="æ·±åº¦å­¦ä¹ ç®€ä»‹"></a>æ·±åº¦å­¦ä¹ ç®€ä»‹</h2><ul><li><strong>æœºå™¨å­¦ä¹ ä¸æ·±åº¦å­¦ä¹ çš„å…³ç³»</strong></li></ul><p><strong>æœºå™¨å­¦ä¹ </strong>ç ”ç©¶å¦‚ä½•ä½¿è®¡ç®—æœºç³»ç»Ÿåˆ©ç”¨ç»éªŒæ”¹å–„æ€§èƒ½ã€‚å®ƒæ˜¯äººå·¥æ™ºèƒ½é¢†åŸŸçš„åˆ†æ”¯ï¼Œä¹Ÿæ˜¯å®ç°äººå·¥æ™ºèƒ½çš„ä¸€ç§æ‰‹æ®µã€‚</p><p>åœ¨æœºå™¨å­¦ä¹ çš„ä¼—å¤šç ”ç©¶æ–¹å‘ä¸­ï¼Œ<strong>è¡¨å¾å­¦ä¹ å…³æ³¨å¦‚ä½•è‡ªåŠ¨æ‰¾å‡ºè¡¨ç¤ºæ•°æ®çš„åˆé€‚æ–¹å¼</strong>ï¼Œä»¥ä¾¿æ›´å¥½åœ°å°†è¾“å…¥å˜æ¢ä¸ºæ­£ç¡®çš„è¾“å‡ºã€‚</p><p>è€Œæœ¬ä¹¦è¦é‡ç‚¹æ¢è®¨çš„<strong>æ·±åº¦å­¦ä¹ æ˜¯å…·æœ‰å¤šçº§è¡¨ç¤ºçš„è¡¨å¾å­¦ä¹ æ–¹æ³•</strong>ã€‚</p><p>åœ¨æ¯ä¸€çº§ï¼ˆä»åŸå§‹æ•°æ®å¼€å§‹ï¼‰ï¼Œæ·±åº¦å­¦ä¹ é€šè¿‡ç®€å•çš„å‡½æ•°å°†è¯¥çº§çš„è¡¨ç¤ºå˜æ¢ä¸ºæ›´é«˜çº§çš„è¡¨ç¤ºã€‚å› æ­¤ï¼Œæ·±åº¦å­¦ä¹ æ¨¡å‹ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ç”±è®¸å¤šç®€å•å‡½æ•°å¤åˆè€Œæˆçš„å‡½æ•°ã€‚å½“è¿™äº›å¤åˆçš„å‡½æ•°è¶³å¤Ÿå¤šæ—¶ï¼Œæ·±åº¦å­¦ä¹ æ¨¡å‹å°±å¯ä»¥è¡¨è¾¾éå¸¸å¤æ‚çš„å˜æ¢ã€‚</p><ul><li><strong>æ·±åº¦å­¦ä¹ çš„ä¸€ä¸ªå¤–åœ¨ç‰¹ç‚¹ï¼šEnd-to-end</strong></li></ul><p>æ·±åº¦å­¦ä¹ çš„ä¸€ä¸ªå¤–åœ¨ç‰¹ç‚¹æ˜¯<strong>ç«¯åˆ°ç«¯çš„è®­ç»ƒ</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯å°†å•ç‹¬è°ƒè¯•çš„éƒ¨åˆ†æ‹¼å‡‘èµ·æ¥ç»„æˆä¸€ä¸ªç³»ç»Ÿï¼Œè€Œæ˜¯å°†æ•´ä¸ªç³»ç»Ÿç»„å»ºå¥½ä¹‹åä¸€èµ·è®­ç»ƒã€‚</p><p>æ¯”å¦‚è¯´ï¼Œè®¡ç®—æœºè§†è§‰ç§‘å­¦å®¶ä¹‹å‰æ›¾ä¸€åº¦å°†ç‰¹å¾æŠ½å–ä¸æœºå™¨å­¦ä¹ æ¨¡å‹çš„æ„å»ºåˆ†å¼€å¤„ç†ï¼Œåƒæ˜¯Cannyè¾¹ç¼˜æ¢æµ‹ [20] å’ŒSIFTç‰¹å¾æå– [21] æ›¾å æ®ç»Ÿæ²»æ€§åœ°ä½è¾¾10å¹´ä»¥ä¸Šï¼Œä½†è¿™ä¹Ÿå°±æ˜¯äººç±»èƒ½æ‰¾åˆ°çš„æœ€å¥½æ–¹æ³•äº†ã€‚</p><p>å½“æ·±åº¦å­¦ä¹ è¿›å…¥è¿™ä¸ªé¢†åŸŸåï¼Œè¿™äº›ç‰¹å¾æå–æ–¹æ³•å°±è¢«æ€§èƒ½æ›´å¼ºçš„è‡ªåŠ¨ä¼˜åŒ–çš„é€çº§è¿‡æ»¤å™¨æ›¿ä»£äº†ã€‚</p><h2 id="é¢„å¤‡çŸ¥è¯†-Pytorch"><a href="#é¢„å¤‡çŸ¥è¯†-Pytorch" class="headerlink" title="é¢„å¤‡çŸ¥è¯†: Pytorch"></a>é¢„å¤‡çŸ¥è¯†: Pytorch</h2><h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><ul><li><strong>å¯¹ Tensor çš„æ“ä½œï¼šTensor çš„åˆ›å»º</strong></li></ul><div class="table-container"><table><thead><tr><th style="text-align:center">å‡½æ•°</th><th style="text-align:center">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:center"><code>Tensor(*sizes)</code></td><td style="text-align:center">åŸºç¡€æ„é€ å‡½æ•°</td></tr><tr><td style="text-align:center"><code>tensor(data,)</code></td><td style="text-align:center">ç±»ä¼¼ <code>np.array</code> çš„æ„é€ å‡½æ•°</td></tr><tr><td style="text-align:center"><code>ones(*sizes)</code></td><td style="text-align:center">å…¨ 1 Tensor</td></tr><tr><td style="text-align:center"><code>zeros(*sizes)</code></td><td style="text-align:center">å…¨ 0 Tensor</td></tr><tr><td style="text-align:center"><code>eye(*sizes)</code></td><td style="text-align:center">å¯¹è§’çº¿ä¸º 1ï¼Œå…¶ä»–ä¸º 0</td></tr><tr><td style="text-align:center"><code>arange(s,e,step)</code></td><td style="text-align:center">ä» s åˆ° eï¼Œæ­¥é•¿ä¸º step</td></tr><tr><td style="text-align:center"><code>linspace(s,e,steps)</code></td><td style="text-align:center">ä» s åˆ° eï¼Œå‡åŒ€åˆ‡åˆ†æˆ steps ä»½</td></tr><tr><td style="text-align:center"><code>rand/randn(*sizes)</code></td><td style="text-align:center">å‡åŒ€/æ ‡å‡†åˆ†å¸ƒ</td></tr><tr><td style="text-align:center"><code>normal(mean,std)/uniform(from,to)</code></td><td style="text-align:center">æ­£æ€åˆ†å¸ƒ/å‡åŒ€åˆ†å¸ƒ</td></tr><tr><td style="text-align:center"><code>randperm(m)</code></td><td style="text-align:center">éšæœºæ’åˆ—</td></tr></tbody></table></div><ul><li><strong>å¯¹ Tensor è¿›è¡Œæ“ä½œæ—¶æ³¨æ„å…¶å¯èƒ½çš„æ•°æ®å…±äº«</strong></li></ul><p>å¦‚ä½¿ç”¨ <code>view()</code> æ”¹å˜ Tensor çš„å½¢çŠ¶çš„æ—¶å€™ï¼Œæ³¨æ„è¿”å›çš„æ–° Tensor ä¸æº Tensor è™½ç„¶å¯èƒ½æœ‰ä¸åŒçš„ sizeï¼Œä½†æ˜¯æ˜¯å…±äº« data çš„ã€‚</p><p>æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è¿”å›ä¸€ä¸ªçœŸæ­£æ–°çš„å‰¯æœ¬ï¼ˆå³ä¸å…±äº« data å†…å­˜ï¼‰è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸPytorch è¿˜æä¾›äº†ä¸€ä¸ª <code>reshape()</code> å¯ä»¥æ”¹å˜å½¢çŠ¶ï¼Œä½†æ˜¯æ­¤å‡½æ•°å¹¶ä¸èƒ½ä¿è¯è¿”å›çš„æ˜¯å…¶æ‹·è´ï¼Œæ‰€ä»¥ä¸æ¨èä½¿ç”¨ã€‚æ¨èå…ˆç”¨ <code>clone</code> åˆ›é€ ä¸€ä¸ªå‰¯æœ¬ç„¶åå†ä½¿ç”¨ <code>view</code>ã€‚</p><p>æ³¨ï¼šè™½ç„¶ <code>view</code> è¿”å›çš„ <code>Tensor</code> ä¸æº <code>Tensor</code> æ˜¯å…±äº« <code>data</code> çš„ï¼Œä½†æ˜¯ä¾ç„¶æ˜¯ä¸€ä¸ªæ–°çš„ <code>Tensor</code>ï¼ˆå› ä¸º <code>Tensor</code> é™¤äº†åŒ…å« <code>data</code> å¤–è¿˜æœ‰ä¸€äº›å…¶ä»–å±æ€§ï¼‰ï¼ŒäºŒè€… <code>id</code>ï¼ˆå†…å­˜åœ°å€ï¼‰å¹¶ä¸ä¸€è‡´ã€‚</p><p>å¦å¤–ä¸€ä¸ªå¸¸ç”¨çš„å‡½æ•°å°±æ˜¯ <code>item()</code>, å®ƒå¯ä»¥å°†ä¸€ä¸ªæ ‡é‡ <code>Tensor</code> è½¬æ¢æˆä¸€ä¸ª Python Numberã€‚</p><ul><li><strong>å¹¿æ’­æœºåˆ¶</strong> Broadcasting</li></ul><p>å½“å¯¹ä¸¤ä¸ªå½¢çŠ¶ä¸åŒçš„ <code>Tensor</code> æŒ‰å…ƒç´ è¿ç®—æ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘å¹¿æ’­ï¼ˆbroadcastingï¼‰æœºåˆ¶ï¼šå…ˆé€‚å½“å¤åˆ¶å…ƒç´ ä½¿è¿™ä¸¤ä¸ª <code>Tensor</code> å½¢çŠ¶ç›¸åŒåå†æŒ‰å…ƒç´ è¿ç®—ã€‚ä¾‹å¦‚ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span>Output<span class="token punctuation">:</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># x</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># y</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># x+y</span></code></pre><ul><li><strong><code>Tensor</code> ä¸ <code>ndarray</code></strong> çš„è½¬æ¢</li></ul><p>å¾ˆå®¹æ˜“ç”¨ <code>numpy()</code> å’Œ <code>from_numpy()</code> å°† <code>Tensor</code> å’Œ NumPy ä¸­çš„æ•°ç»„ç›¸äº’è½¬æ¢ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šä¸¤ä¸ªå‡½æ•°æ‰€äº§ç”Ÿçš„ <code>Tensor</code> å’Œ NumPy ä¸­çš„æ•°ç»„å…±äº«ç›¸åŒçš„å†…å­˜ï¼ˆæ‰€ä»¥å®ƒä»¬ä¹‹é—´çš„è½¬æ¢å¾ˆå¿«ï¼‰ï¼Œæ”¹å˜å…¶ä¸­ä¸€ä¸ªæ—¶å¦ä¸€ä¸ªä¹Ÿä¼šæ”¹å˜ã€‚</p><p>ä¸ä¹‹ç›¸å¯¹æ¯”ï¼Œè¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„å°† NumPy ä¸­çš„ array è½¬æ¢æˆ <code>Tensor</code> çš„æ–¹æ³•å°±æ˜¯ <code>torch.tensor()</code>, éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ–¹æ³•æ€»æ˜¯ä¼šè¿›è¡Œæ•°æ®æ‹·è´ï¼ˆå°±ä¼šæ¶ˆè€—æ›´å¤šçš„æ—¶é—´å’Œç©ºé—´ï¼‰ï¼Œæ‰€ä»¥è¿”å›çš„ <code>Tensor</code>å’ŒåŸæ¥çš„æ•°æ®ä¸å†å…±äº«å†…å­˜ã€‚</p><p>æ‰€æœ‰åœ¨CPUä¸Šçš„ <code>Tensor</code>ï¼ˆé™¤äº† <code>CharTensor</code>ï¼‰éƒ½æ”¯æŒä¸ NumPy æ•°ç»„ç›¸äº’è½¬æ¢ã€‚</p><ul><li><strong><code>Tensor</code> on GPU</strong></li></ul><p>ç”¨æ–¹æ³• <code>to()</code> å¯ä»¥å°† <code>Tensor</code> åœ¨ CPU å’Œ GPUï¼ˆéœ€è¦ç¡¬ä»¶æ”¯æŒï¼‰ä¹‹é—´ç›¸äº’ç§»åŠ¨ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># ä»¥ä¸‹ä»£ç åªæœ‰åœ¨PyTorch GPUç‰ˆæœ¬ä¸Šæ‰ä¼šæ‰§è¡Œ</span><span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>          <span class="token comment"># GPU</span>    y <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>x<span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span>  <span class="token comment"># ç›´æ¥åˆ›å»ºä¸€ä¸ªåœ¨GPUä¸Šçš„Tensor</span>    x <span class="token operator">=</span> x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>                       <span class="token comment"># ç­‰ä»·äº .to("cuda")</span>    z <span class="token operator">=</span> x <span class="token operator">+</span> y    <span class="token keyword">print</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>z<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cpu"</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>double<span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># to()è¿˜å¯ä»¥åŒæ—¶æ›´æ”¹æ•°æ®ç±»å‹</span></code></pre><h3 id="Autograd"><a href="#Autograd" class="headerlink" title="Autograd"></a>Autograd</h3><ul><li><strong><code>Tensor</code> çš„ <code>requires_grad</code> ä¸ <code>Function</code></strong></li></ul><p>ä¸Šä¸€èŠ‚ä»‹ç»çš„ <code>Tensor</code> æ˜¯è¿™ä¸ªåŒ…çš„æ ¸å¿ƒç±»ï¼Œå¦‚æœå°†å…¶å±æ€§ <code>requires_grad</code> è®¾ç½®ä¸º <code>True</code>ï¼Œå®ƒå°†å¼€å§‹è¿½è¸ªï¼ˆtrackï¼‰åœ¨å…¶ä¸Šçš„æ‰€æœ‰æ“ä½œï¼ˆè¿™æ ·å°±å¯ä»¥åˆ©ç”¨é“¾å¼æ³•åˆ™è¿›è¡Œæ¢¯åº¦ä¼ æ’­äº†ï¼‰ã€‚</p><p>å®Œæˆè®¡ç®—åï¼Œå¯ä»¥è°ƒç”¨ <code>backward()</code> æ¥å®Œæˆæ‰€æœ‰æ¢¯åº¦è®¡ç®—ã€‚æ­¤ <code>Tensor</code> çš„æ¢¯åº¦å°†ç´¯ç§¯åˆ° <code>.grad</code> å±æ€§ä¸­ã€‚</p><p>å¦‚æœä¸æƒ³è¦è¢«ç»§ç»­è¿½è¸ªï¼Œå¯ä»¥è°ƒç”¨ <code>.detach()</code> å°†å…¶ä»è¿½è¸ªè®°å½•ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢å°†æ¥çš„è®¡ç®—è¢«è¿½è¸ªï¼Œè¿™æ ·æ¢¯åº¦å°±ä¼ ä¸è¿‡å»äº†ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ç”¨ <code>with torch.no_grad()</code> å°†ä¸æƒ³è¢«è¿½è¸ªçš„æ“ä½œä»£ç å—åŒ…è£¹èµ·æ¥ï¼Œè¿™ç§æ–¹æ³•åœ¨è¯„ä¼°æ¨¡å‹çš„æ—¶å€™å¾ˆå¸¸ç”¨ï¼Œå› ä¸ºåœ¨è¯„ä¼°æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è®¡ç®—å¯è®­ç»ƒå‚æ•°ï¼ˆ<code>requires_grad=True</code>ï¼‰çš„æ¢¯åº¦ã€‚</p><p><code>Function</code> æ˜¯å¦å¤–ä¸€ä¸ªå¾ˆé‡è¦çš„ç±»ã€‚<code>Tensor</code> å’Œ <code>Function</code> äº’ç›¸ç»“åˆå°±å¯ä»¥æ„å»ºä¸€ä¸ªè®°å½•æœ‰æ•´ä¸ªè®¡ç®—è¿‡ç¨‹çš„æœ‰å‘æ— ç¯å›¾ã€‚æ¯ä¸ª <code>Tensor</code> éƒ½æœ‰ä¸€ä¸ª <code>grad_fn</code> å±æ€§ï¼Œè¯¥å±æ€§å³åˆ›å»ºè¯¥ <code>Tensor</code> çš„ <code>Function</code> , å°±æ˜¯è¯´è¯¥ <code>Tensor</code> æ˜¯ä¸æ˜¯é€šè¿‡æŸäº›è¿ç®—å¾—åˆ°çš„ï¼Œè‹¥æ˜¯ï¼Œåˆ™ <code>grad_fn</code> è¿”å›ä¸€ä¸ªä¸è¿™äº›è¿ç®—ç›¸å…³çš„å¯¹è±¡ï¼Œå¦åˆ™æ˜¯ Noneã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad_fn<span class="token punctuation">)</span><span class="token boolean">None</span><span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>AddBackward0<span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>grad_fn<span class="token punctuation">)</span><span class="token operator">&lt;</span>AddBackward0 <span class="token builtin">object</span> at <span class="token number">0x7fbb003b4250</span><span class="token operator">></span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>is_leaf<span class="token punctuation">,</span> y<span class="token punctuation">.</span>is_leaf<span class="token punctuation">)</span><span class="token boolean">True</span> <span class="token boolean">False</span><span class="token operator">>></span><span class="token operator">></span> z <span class="token operator">=</span> y <span class="token operator">*</span> y <span class="token operator">*</span> <span class="token number">3</span><span class="token operator">>></span><span class="token operator">></span> out <span class="token operator">=</span> z<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> out<span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MulBackward0<span class="token operator">></span><span class="token punctuation">)</span> tensor<span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">.</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MeanBackward0<span class="token operator">></span><span class="token punctuation">)</span></code></pre><p>æ³¨æ„ x æ˜¯ç›´æ¥åˆ›å»ºçš„ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ <code>grad_fn</code>, è€Œ y æ˜¯é€šè¿‡ä¸€ä¸ªåŠ æ³•æ“ä½œåˆ›å»ºçš„ï¼Œæ‰€ä»¥å®ƒæœ‰ä¸€ä¸ªä¸º <code>&lt;AddBackward&gt;</code> çš„ <code>grad_fn</code>ã€‚åƒ x è¿™ç§ç›´æ¥åˆ›å»ºçš„ç§°ä¸ºå¶å­èŠ‚ç‚¹ï¼Œå¶å­èŠ‚ç‚¹å¯¹åº”çš„ <code>grad_fn</code> æ˜¯ <code>None</code>ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># ç¼ºå¤±æƒ…å†µä¸‹é»˜è®¤ requires_grad = False</span><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>requires_grad<span class="token punctuation">)</span> <span class="token comment"># False</span><span class="token boolean">False</span><span class="token comment"># é€šè¿‡ .requires_grad_() æ¥ç”¨ in-place çš„æ–¹å¼æ”¹å˜ requires_grad å±æ€§</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>requires_grad_<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.0261</span><span class="token punctuation">,</span>  <span class="token number">0.6281</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">1.1572</span><span class="token punctuation">,</span>  <span class="token number">6.8756</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>requires_grad<span class="token punctuation">)</span> <span class="token comment"># True</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>grad_fn<span class="token punctuation">)</span><span class="token operator">&lt;</span>SumBackward0 <span class="token builtin">object</span> at <span class="token number">0x7fba80387730</span><span class="token operator">></span></code></pre><ul><li><strong><code>backward()</code></strong></li></ul><p>å› ä¸º <code>out</code> æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œæ‰€ä»¥è°ƒç”¨ <code>backward()</code> æ—¶ä¸éœ€è¦æŒ‡å®šæ±‚å¯¼å˜é‡ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> out<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ç­‰ä»·äº out.backward(torch.tensor(1.))</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span> <span class="token comment"># Out å…³äº x çš„æ¢¯åº¦, d(out)/dx</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4.5000</span><span class="token punctuation">,</span> <span class="token number">4.5000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">4.5000</span><span class="token punctuation">,</span> <span class="token number">4.5000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>æœ¬è´¨ä¸Šï¼Œåå‘ä¼ æ’­çš„è¿‡ç¨‹æ˜¯åœ¨è®¡ç®—ä¸€ç³»åˆ— Jacobi çŸ©é˜µçš„ä¹˜ç§¯ã€‚</p><p>æ³¨æ„ï¼šgrad åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­æ˜¯ç´¯åŠ çš„ï¼Œè¿™æ„å‘³ç€æ¯ä¸€æ¬¡è¿è¡Œåå‘ä¼ æ’­ï¼Œæ¢¯åº¦éƒ½ä¼šç´¯åŠ ä¹‹å‰çš„æ¢¯åº¦ï¼Œæ‰€ä»¥<strong>ä¸€èˆ¬åœ¨åå‘ä¼ æ’­ä¹‹å‰éœ€æŠŠæ¢¯åº¦æ¸…é›¶</strong>ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># å†æ¥åå‘ä¼ æ’­ä¸€æ¬¡ï¼Œæ³¨æ„gradæ˜¯ç´¯åŠ çš„</span><span class="token operator">>></span><span class="token operator">></span> out2 <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> out2<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5.5000</span><span class="token punctuation">,</span> <span class="token number">5.5000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">5.5000</span><span class="token punctuation">,</span> <span class="token number">5.5000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> out3 <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> x<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> out3<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>æ³¨ï¼šPyTorch çš„ <code>backward</code> ä¸ºä»€ä¹ˆæœ‰ä¸€ä¸ª <code>grad_variables</code> å‚æ•°ï¼Ÿ</p><p>å‡è®¾ x ç»è¿‡ä¸€ç•ªè®¡ç®—å¾—åˆ° yï¼Œé‚£ä¹ˆ <code>y.backward(w)</code> æ±‚çš„ä¸æ˜¯ y å¯¹ x çš„å¯¼æ•°ï¼Œè€Œæ˜¯ <code>l = torch.sum(y*w)</code> å¯¹ x çš„å¯¼æ•°ã€‚w å¯ä»¥è§†ä¸º y çš„å„åˆ†é‡çš„æƒé‡ï¼Œä¹Ÿå¯ä»¥è§†ä¸ºé¥è¿œçš„æŸå¤±å‡½æ•° l å¯¹ y çš„åå¯¼æ•°ï¼ˆè¿™æ­£æ˜¯å‡½æ•°è¯´æ˜æ–‡æ¡£çš„å«ä¹‰ï¼‰ã€‚ç‰¹åˆ«åœ°ï¼Œè‹¥ y ä¸ºæ ‡é‡ï¼Œw å–é»˜è®¤å€¼ 1.0ï¼Œæ‰æ˜¯æŒ‰ç…§æˆ‘ä»¬é€šå¸¸ç†è§£çš„é‚£æ ·ï¼Œæ±‚ y å¯¹ x çš„å¯¼æ•°ã€‚</p><ul><li><strong>ä¸­æ–­æ¢¯åº¦ä¼ æ’­</strong></li></ul><pre class="language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>y1 <span class="token operator">=</span> x <span class="token operator">**</span> <span class="token number">2</span> <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    y2 <span class="token operator">=</span> x <span class="token operator">**</span> <span class="token number">3</span>y3 <span class="token operator">=</span> y1 <span class="token operator">+</span> y2<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>requires_grad<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y1<span class="token punctuation">.</span>requires_grad<span class="token punctuation">)</span> <span class="token comment"># True</span><span class="token keyword">print</span><span class="token punctuation">(</span>y2<span class="token punctuation">,</span> y2<span class="token punctuation">.</span>requires_grad<span class="token punctuation">)</span> <span class="token comment"># False</span><span class="token keyword">print</span><span class="token punctuation">(</span>y3<span class="token punctuation">,</span> y3<span class="token punctuation">.</span>requires_grad<span class="token punctuation">)</span> <span class="token comment"># True</span>Output<span class="token punctuation">:</span><span class="token boolean">True</span>tensor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>PowBackward0<span class="token operator">></span><span class="token punctuation">)</span> <span class="token boolean">True</span>tensor<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token boolean">False</span>tensor<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>ThAddBackward<span class="token operator">></span><span class="token punctuation">)</span> <span class="token boolean">True</span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ <code>y2</code> æ˜¯æ²¡æœ‰ <code>grad_fn</code> è€Œä¸” <code>y2.requires_grad=False</code> çš„ï¼Œè€Œ <code>y3</code> æ˜¯æœ‰ <code>grad_fn</code> çš„ã€‚å¦‚æœæˆ‘ä»¬å°†<code>y3</code>å¯¹<code>x</code>æ±‚æ¢¯åº¦çš„è¯ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">y3<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>Output<span class="token punctuation">:</span>tensor<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">)</span></code></pre><p>æ­£å¦‚æˆ‘ä»¬æ‰€ç†è§£çš„ï¼Œ$y_3 = y_1 + y_2 = x^2 + x^3$ï¼Œå…¶ä¸­ $y_2$ çš„æ¢¯åº¦ä¸è¢«å›ä¼ ï¼Œå› æ­¤ $\dfrac {d y_3} {dx} = 2x$.</p><p>æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹ <code>Tensor</code> çš„æ•°å€¼ï¼Œä½†æ˜¯åˆä¸å¸Œæœ›è¢« <code>autograd</code> è®°å½•ï¼ˆå³ä¸ä¼šå½±å“åå‘ä¼ æ’­ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä¹ˆå¯ä»¥å¯¹ <code>tensor.data</code> è¿›è¡Œæ“ä½œã€‚</p><pre class="language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment"># è¿˜æ˜¯ä¸€ä¸ªtensor</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>data<span class="token punctuation">.</span>requires_grad<span class="token punctuation">)</span> <span class="token comment"># ä½†æ˜¯å·²ç»æ˜¯ç‹¬ç«‹äºè®¡ç®—å›¾ä¹‹å¤–</span>y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> xx<span class="token punctuation">.</span>data <span class="token operator">*=</span> <span class="token number">100</span> <span class="token comment"># åªæ”¹å˜äº†å€¼ï¼Œä¸ä¼šè®°å½•åœ¨è®¡ç®—å›¾ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“æ¢¯åº¦ä¼ æ’­</span>y<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment"># æ›´æ”¹dataçš„å€¼ä¹Ÿä¼šå½±å“tensorçš„å€¼</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>grad<span class="token punctuation">)</span>Output<span class="token punctuation">:</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token boolean">False</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h2 id="æ·±åº¦å­¦ä¹ åŸºç¡€"><a href="#æ·±åº¦å­¦ä¹ åŸºç¡€" class="headerlink" title="æ·±åº¦å­¦ä¹ åŸºç¡€"></a>æ·±åº¦å­¦ä¹ åŸºç¡€</h2><h3 id="åŸºç¡€æ¨¡å‹"><a href="#åŸºç¡€æ¨¡å‹" class="headerlink" title="åŸºç¡€æ¨¡å‹"></a>åŸºç¡€æ¨¡å‹</h3><h4 id="Linear-Regression"><a href="#Linear-Regression" class="headerlink" title="Linear Regression"></a>Linear Regression</h4><p>é¦–å…ˆï¼Œå›å½’é—®é¢˜çš„è¾“å‡ºæ˜¯è¿ç»­å€¼ï¼Œè€Œåˆ†ç±»é—®é¢˜çš„è¾“å‡ºæ˜¯ç¦»æ•£å€¼ï¼Œè¿™æ˜¯äºŒè€…çš„åŒºåˆ«ã€‚</p><ul><li><strong>æ¨¡å‹å®šä¹‰</strong>ï¼šå‡è®¾æˆ‘ä»¬é‡‡é›†çš„æ ·æœ¬æ•°ä¸º $n$â€‹ï¼Œç´¢å¼•ä¸º $i$â€‹ çš„æ ·æœ¬çš„ç‰¹å¾ä¸º $x_1^{(i)}$â€‹ å’Œ $x_2^{(i)}$â€‹ï¼Œæ ‡ç­¾ä¸º $y^{(i)}$â€‹ã€‚å¯¹äºç´¢å¼•ä¸º $i$â€‹ çš„æˆ¿å±‹ï¼Œçº¿æ€§å›å½’æ¨¡å‹çš„æˆ¿å±‹ä»·æ ¼é¢„æµ‹è¡¨è¾¾å¼ä¸º <script type="math/tex">\hat{y}^{(i)} = x_1^{(i)} w_1 + x_2^{(i)} w_2 + b</script>â€‹</li><li><strong>æŸå¤±å‡½æ•°</strong>ï¼š$\ell^{(i)}(w_1, w_2, b) = \frac{1}{2} \left(\hat{y}^{(i)} - y^{(i)}\right)^2$â€‹, $ \ell(w_1, w_2, b) =\frac{1}{n} \sum_{i=1}^n \ell^{(i)}(w_1, w_2, b) =\frac{1}{n} \sum_{i=1}^n \frac{1}{2}\left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right)^2$â€‹</li></ul><p>åœ¨æ¨¡å‹è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾å‡ºä¸€ç»„æ¨¡å‹å‚æ•°ï¼Œè®°ä¸º $w_1^<em>, w_2^</em>, b^<em>$ï¼Œæ¥ä½¿è®­ç»ƒæ ·æœ¬å¹³å‡æŸå¤±æœ€å°ï¼š$ w_1^</em>, w_2^<em>, b^</em> = \underset{w_1, w_2, b}{\arg\min} \ell(w_1, w_2, b) $</p><ul><li><strong>ä¼˜åŒ–ç®—æ³•</strong></li></ul><p>å½“æ¨¡å‹å’ŒæŸå¤±å‡½æ•°å½¢å¼è¾ƒä¸ºç®€å•æ—¶ï¼Œä¸Šé¢çš„è¯¯å·®æœ€å°åŒ–é—®é¢˜çš„è§£å¯ä»¥ç›´æ¥ç”¨å…¬å¼è¡¨è¾¾å‡ºæ¥ã€‚è¿™ç±»è§£å«ä½œ<strong>è§£æè§£</strong>ã€‚æœ¬èŠ‚ä½¿ç”¨çš„çº¿æ€§å›å½’å’Œå¹³æ–¹è¯¯å·®åˆšå¥½å±äºè¿™ä¸ªèŒƒç•´ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°æ·±åº¦å­¦ä¹ æ¨¡å‹å¹¶æ²¡æœ‰è§£æè§£ï¼Œåªèƒ½é€šè¿‡ä¼˜åŒ–ç®—æ³•æœ‰é™æ¬¡è¿­ä»£æ¨¡å‹å‚æ•°æ¥å°½å¯èƒ½é™ä½æŸå¤±å‡½æ•°çš„å€¼ã€‚è¿™ç±»è§£å«ä½œ<strong>æ•°å€¼è§£</strong>ã€‚</p><p>åœ¨æ±‚æ•°å€¼è§£çš„ä¼˜åŒ–ç®—æ³•ä¸­ï¼Œ<strong>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™</strong>ï¼ˆMini-batch SGD, mini-batch stochastic gradient descentï¼‰åœ¨æ·±åº¦å­¦ä¹ ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚å®ƒçš„ç®—æ³•å¾ˆç®€å•ï¼šå…ˆé€‰å–ä¸€ç»„æ¨¡å‹å‚æ•°çš„åˆå§‹å€¼ï¼Œå¦‚éšæœºé€‰å–ï¼›æ¥ä¸‹æ¥å¯¹å‚æ•°è¿›è¡Œå¤šæ¬¡è¿­ä»£ï¼Œä½¿æ¯æ¬¡è¿­ä»£éƒ½å¯èƒ½é™ä½æŸå¤±å‡½æ•°çš„å€¼ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œå…ˆéšæœºå‡åŒ€é‡‡æ ·ä¸€ä¸ªç”±å›ºå®šæ•°ç›®è®­ç»ƒæ•°æ®æ ·æœ¬æ‰€ç»„æˆçš„å°æ‰¹é‡ï¼ˆmini-batchï¼‰$\mathcal{B}$â€‹ï¼Œç„¶åæ±‚å°æ‰¹é‡ä¸­æ•°æ®æ ·æœ¬çš„å¹³å‡æŸå¤±æœ‰å…³æ¨¡å‹å‚æ•°çš„å¯¼æ•°ï¼ˆæ¢¯åº¦ï¼‰ï¼Œæœ€åç”¨æ­¤ç»“æœä¸é¢„å…ˆè®¾å®šçš„ä¸€ä¸ªæ­£æ•° learning_rate $\eta$ çš„ä¹˜ç§¯ä½œä¸ºæ¨¡å‹å‚æ•°åœ¨æœ¬æ¬¡è¿­ä»£çš„å‡å°é‡ã€‚</p><p>åœ¨è®­ç»ƒæœ¬èŠ‚è®¨è®ºçš„çº¿æ€§å›å½’æ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹çš„æ¯ä¸ªå‚æ•°å°†ä½œå¦‚ä¸‹è¿­ä»£ï¼š</p><script type="math/tex; mode=display">\begin{aligned} w_1 &\leftarrow w_1 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}} \frac{ \partial \ell^{(i)}(w_1, w_2, b) }{\partial w_1} = w_1 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_1^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right), \\w_2 &\leftarrow w_2 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}} \frac{ \partial \ell^{(i)}(w_1, w_2, b) }{\partial w_2} = w_2 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_2^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right), \\b &\leftarrow b - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}} \frac{ \partial \ell^{(i)}(w_1, w_2, b) }{\partial b} = b - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}\left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right). \end{aligned}</script><p>åœ¨ä¸Šå¼ä¸­ï¼Œ$|\mathcal{B}|$ ä»£è¡¨æ¯ä¸ªå°æ‰¹é‡ä¸­çš„æ ·æœ¬ä¸ªæ•°ï¼ˆæ‰¹é‡å¤§å°ï¼Œbatch sizeï¼‰ï¼Œ$\eta$ ç§°ä½œå­¦ä¹ ç‡ï¼ˆlearning rateï¼‰å¹¶å–æ­£æ•°ã€‚éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™é‡Œçš„æ‰¹é‡å¤§å°å’Œå­¦ä¹ ç‡çš„å€¼æ˜¯äººä¸ºè®¾å®šçš„ï¼Œå¹¶ä¸æ˜¯é€šè¿‡æ¨¡å‹è®­ç»ƒå­¦å‡ºçš„ï¼Œå› æ­¤å«ä½œè¶…å‚æ•°ï¼ˆhyperparameterï¼‰ã€‚æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„â€œè°ƒå‚â€æŒ‡çš„æ­£æ˜¯è°ƒèŠ‚è¶…å‚æ•°ï¼Œä¾‹å¦‚é€šè¿‡åå¤è¯•é”™æ¥æ‰¾åˆ°è¶…å‚æ•°åˆé€‚çš„å€¼ã€‚</p><h5 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h5><ul><li>ç”Ÿæˆæ•°æ®é›†</li></ul><pre class="language-python" data-language="python"><code class="language-python">num_inputs <span class="token operator">=</span> <span class="token number">2</span>num_examples <span class="token operator">=</span> <span class="token number">1000</span>true_w <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4</span><span class="token punctuation">]</span>true_b <span class="token operator">=</span> <span class="token number">4.2</span>features <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>num_examples<span class="token punctuation">,</span> num_inputs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span>labels <span class="token operator">=</span> true_w<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> features<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> true_w<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> features<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> true_blabels <span class="token operator">+=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.01</span><span class="token punctuation">,</span> size<span class="token operator">=</span>labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span></code></pre><ul><li>è¯»å–æ•°æ®</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> Databatch_size <span class="token operator">=</span> <span class="token number">10</span><span class="token comment"># å°†è®­ç»ƒæ•°æ®çš„ç‰¹å¾å’Œæ ‡ç­¾ç»„åˆ</span>dataset <span class="token operator">=</span> Data<span class="token punctuation">.</span>TensorDataset<span class="token punctuation">(</span>features<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token comment"># éšæœºè¯»å–å°æ‰¹é‡</span>data_iter <span class="token operator">=</span> Data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> data_iter<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>    <span class="token keyword">break</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2.7723</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6627</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.1058</span><span class="token punctuation">,</span>  <span class="token number">0.7688</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.4901</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.2260</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.7227</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2664</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.3390</span><span class="token punctuation">,</span>  <span class="token number">0.1162</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">1.6705</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.7930</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.2576</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2928</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">2.0475</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.7440</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">1.0685</span><span class="token punctuation">,</span>  <span class="token number">1.1920</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">1.0996</span><span class="token punctuation">,</span>  <span class="token number">0.5106</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  tensor<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">0.9066</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6247</span><span class="token punctuation">,</span>  <span class="token number">9.3383</span><span class="token punctuation">,</span>  <span class="token number">3.6537</span><span class="token punctuation">,</span>  <span class="token number">3.1283</span><span class="token punctuation">,</span> <span class="token number">17.0213</span><span class="token punctuation">,</span>  <span class="token number">5.6953</span><span class="token punctuation">,</span> <span class="token number">17.6279</span><span class="token punctuation">,</span>         <span class="token number">2.2809</span><span class="token punctuation">,</span>  <span class="token number">4.6661</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment"># å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è¿­ä»£å™¨è¿›è¡Œè¿­ä»£æ¯æ¬¡æ‹¿åˆ°çš„æ•°æ®ä¹Ÿæ˜¯ä»¥ batch çš„å½¢å¼å°è£…æˆ array</span></code></pre><ul><li>å®šä¹‰æ¨¡å‹</li></ul><p>é¦–å…ˆï¼Œå¯¼å…¥ <code>torch.nn</code> æ¨¡å—ã€‚å®é™…ä¸Šï¼Œâ€œnnâ€æ˜¯neural networksï¼ˆç¥ç»ç½‘ç»œï¼‰çš„ç¼©å†™ã€‚</p><p>é¡¾åæ€ä¹‰ï¼Œè¯¥æ¨¡å—å®šä¹‰äº†å¤§é‡ç¥ç»ç½‘ç»œçš„å±‚ã€‚ä¹‹å‰æˆ‘ä»¬å·²ç»ç”¨è¿‡äº† <code>autograd</code>ï¼Œè€Œ <code>nn</code> å°±æ˜¯åˆ©ç”¨ <code>autograd</code> æ¥å®šä¹‰æ¨¡å‹ã€‚</p><p><code>nn</code> çš„æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯ <code>Module</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œæ—¢å¯ä»¥è¡¨ç¤ºç¥ç»ç½‘ç»œä¸­çš„æŸä¸ªå±‚ï¼ˆlayerï¼‰ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªåŒ…å«å¾ˆå¤šå±‚çš„ç¥ç»ç½‘ç»œã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæœ€å¸¸è§çš„åšæ³•æ˜¯ç»§æ‰¿ <code>nn.Module</code>ï¼Œæ’°å†™è‡ªå·±çš„ç½‘ç»œ/å±‚ã€‚</p><p>ä¸€ä¸ª <code>nn.Module</code> å®ä¾‹åº”è¯¥åŒ…å«ä¸€äº›å±‚ä»¥åŠè¿”å›è¾“å‡ºçš„å‰å‘ä¼ æ’­ï¼ˆforwardï¼‰æ–¹æ³•ã€‚ä¸‹é¢å…ˆæ¥çœ‹çœ‹å¦‚ä½•ç”¨ <code>nn.Module</code> å®ç°ä¸€ä¸ªçº¿æ€§å›å½’æ¨¡å‹ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">LinearNet</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n_feature<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>LinearNet<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>n_feature<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># forward å®šä¹‰å‰å‘ä¼ æ’­</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        y <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">return</span> ynet <span class="token operator">=</span> LinearNet<span class="token punctuation">(</span>num_inputs<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span> <span class="token comment"># ä½¿ç”¨printå¯ä»¥æ‰“å°å‡ºç½‘ç»œçš„ç»“æ„</span><span class="token comment"># Output:</span>LinearNet<span class="token punctuation">(</span>  <span class="token punctuation">(</span>linear<span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>äº‹å®ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥ç”¨<code>nn.Sequential</code>æ¥æ›´åŠ æ–¹ä¾¿åœ°æ­å»ºç½‘ç»œï¼Œ<code>Sequential</code>æ˜¯ä¸€ä¸ªæœ‰åºçš„å®¹å™¨ï¼Œç½‘ç»œå±‚å°†æŒ‰ç…§åœ¨ä¼ å…¥<code>Sequential</code>çš„é¡ºåºä¾æ¬¡è¢«æ·»åŠ åˆ°è®¡ç®—å›¾ä¸­ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># å†™æ³•ä¸€</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># æ­¤å¤„è¿˜å¯ä»¥ä¼ å…¥å…¶ä»–å±‚</span>    <span class="token punctuation">)</span><span class="token comment"># å†™æ³•äºŒ</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>add_module<span class="token punctuation">(</span><span class="token string">'linear'</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># net.add_module ......</span><span class="token comment"># å†™æ³•ä¸‰</span><span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDictnet <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span>          <span class="token punctuation">(</span><span class="token string">'linear'</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment"># ......</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Output<span class="token punctuation">:</span>Sequential<span class="token punctuation">(</span>  <span class="token punctuation">(</span>linear<span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>å¯ä»¥é€šè¿‡ <code>net.parameters()</code> æ¥æŸ¥çœ‹æ¨¡å‹æ‰€æœ‰çš„å¯å­¦ä¹ å‚æ•°ï¼Œæ­¤å‡½æ•°å°†è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ã€‚<br><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span></code></pre><br>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">Parameter containing:tensor([[-0.0277,  0.2771]], requires_grad&#x3D;True)Parameter containing:tensor([0.3395], requires_grad&#x3D;True)</code></pre></p><p>æ³¨æ„ï¼š<code>torch.nn</code> <strong>ä»…æ”¯æŒè¾“å…¥ä¸€ä¸ª batch çš„æ ·æœ¬</strong>ï¼Œè€Œä¸æ”¯æŒå•ä¸ªæ ·æœ¬è¾“å…¥ï¼Œå¦‚æœåªæœ‰å•ä¸ªæ ·æœ¬ï¼Œå¯ä½¿ç”¨ <code>input.unsqueeze(0)</code> æ¥æ·»åŠ ä¸€ç»´ã€‚</p><p>é™„ï¼š<code>unsqueeze()</code> çš„ä½¿ç”¨ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> atensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">,</span>  <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">,</span>  <span class="token number">1.3125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">,</span>  <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># æœ€å¤–å±‚åŠ å£³</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">,</span>  <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">,</span>  <span class="token number">1.3125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">,</span>  <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># æ¬¡å¤–å±‚å…ƒç´ </span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">,</span>  <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">,</span>  <span class="token number">1.3125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">,</span>  <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">,</span>  <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">,</span>  <span class="token number">1.3125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">,</span>  <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">1.3125</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>IndexError<span class="token punctuation">:</span> Dimension out of <span class="token builtin">range</span> <span class="token punctuation">(</span>expected to be <span class="token keyword">in</span> <span class="token builtin">range</span> of <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> but got <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># æœ€å†…å±‚</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">1.3125</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span> <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ä¸€ç›´åˆ°æœ€å†…å±‚</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">,</span>  <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">,</span>  <span class="token number">1.3125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">,</span>  <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> a<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># æŸä¸€å±‚</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.6444</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5408</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6239</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8880</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.7358</span><span class="token punctuation">,</span>  <span class="token number">0.7287</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span> <span class="token number">1.1660</span><span class="token punctuation">,</span>  <span class="token number">1.3125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.4676</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.4620</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1572</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4755</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token punctuation">[</span> <span class="token number">0.6389</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.4514</span><span class="token punctuation">,</span>  <span class="token number">0.3339</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><ul><li>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> initinit<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>bias<span class="token punctuation">,</span> val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹biasçš„data: net[0].bias.data.fill_(0)</span></code></pre><ul><li>å®šä¹‰æŸå¤±å‡½æ•°</li></ul><p>PyTorch åœ¨ <code>nn</code> æ¨¡å—ä¸­æä¾›äº†å„ç§æŸå¤±å‡½æ•°ï¼Œè¿™äº›æŸå¤±å‡½æ•°å¯çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å±‚ï¼ŒPyTorch ä¹Ÿå°†è¿™äº›æŸå¤±å‡½æ•°å®ç°ä¸º <code>nn.Module</code> çš„å­ç±»ã€‚æˆ‘ä»¬ç°åœ¨ä½¿ç”¨å®ƒæä¾›çš„å‡æ–¹è¯¯å·®æŸå¤±ä½œä¸ºæ¨¡å‹çš„æŸå¤±å‡½æ•°ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><ul><li>å®šä¹‰ä¼˜åŒ–ç®—æ³•</li></ul><p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿæ— é¡»è‡ªå·±å®ç°å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚<code>torch.optim</code> æ¨¡å—æä¾›äº†å¾ˆå¤šå¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•æ¯”å¦‚ SGDã€Adam å’Œ RMSProp ç­‰ã€‚ä¸‹é¢æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äºä¼˜åŒ– <code>net</code> æ‰€æœ‰å‚æ•°çš„ä¼˜åŒ–å™¨å®ä¾‹ï¼Œå¹¶æŒ‡å®šå­¦ä¹ ç‡ä¸º 0.03 çš„å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ä¸ºä¼˜åŒ–ç®—æ³•ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optimoptimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.03</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">SGD (Parameter Group 0    dampening: 0    lr: 0.03    momentum: 0    nesterov: False    weight_decay: 0)</code></pre></p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºä¸åŒå­ç½‘ç»œè®¾ç½®ä¸åŒçš„å­¦ä¹ ç‡ï¼Œè¿™åœ¨ fine-tune æ—¶ç»å¸¸ç”¨åˆ°ã€‚ä¾‹ï¼š<br><pre class="language-python" data-language="python"><code class="language-python">optimizer <span class="token operator">=</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span><span class="token punctuation">[</span>                <span class="token comment"># å¦‚æœå¯¹æŸä¸ªå‚æ•°ä¸æŒ‡å®šå­¦ä¹ ç‡ï¼Œå°±ä½¿ç”¨æœ€å¤–å±‚çš„é»˜è®¤å­¦ä¹ ç‡</span>                <span class="token punctuation">&#123;</span><span class="token string">'params'</span><span class="token punctuation">:</span> net<span class="token punctuation">.</span>subnet1<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment"># lr=0.03</span>                <span class="token punctuation">&#123;</span><span class="token string">'params'</span><span class="token punctuation">:</span> net<span class="token punctuation">.</span>subnet2<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'lr'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">&#125;</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.03</span><span class="token punctuation">)</span></code></pre></p><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¸æƒ³è®©å­¦ä¹ ç‡å›ºå®šæˆä¸€ä¸ªå¸¸æ•°ï¼Œé‚£å¦‚ä½•è°ƒæ•´å­¦ä¹ ç‡å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ç§åšæ³•ã€‚ä¸€ç§æ˜¯ä¿®æ”¹ <code>optimizer.param_groups</code> ä¸­å¯¹åº”çš„å­¦ä¹ ç‡ï¼Œå¦ä¸€ç§æ˜¯æ›´ç®€å•ä¹Ÿæ˜¯è¾ƒä¸ºæ¨èçš„åšæ³• â€”â€” <strong>æ–°å»ºä¼˜åŒ–å™¨</strong>ï¼Œç”±äºoptimizerååˆ†è½»é‡çº§ï¼Œæ„å»ºå¼€é”€å¾ˆå°ï¼Œæ•…è€Œå¯ä»¥æ„å»ºæ–°çš„ optimizerã€‚ä½†æ˜¯åè€…å¯¹äºä½¿ç”¨åŠ¨é‡çš„ä¼˜åŒ–å™¨ï¼ˆå¦‚ Adamï¼‰ï¼Œä¼šä¸¢å¤±åŠ¨é‡ç­‰çŠ¶æ€ä¿¡æ¯ï¼Œå¯èƒ½ä¼šé€ æˆæŸå¤±å‡½æ•°çš„æ”¶æ•›å‡ºç°éœ‡è¡ç­‰æƒ…å†µã€‚<br><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># è°ƒæ•´å­¦ä¹ ç‡</span><span class="token keyword">for</span> param_group <span class="token keyword">in</span> optimizer<span class="token punctuation">.</span>param_groups<span class="token punctuation">:</span>    param_group<span class="token punctuation">[</span><span class="token string">'lr'</span><span class="token punctuation">]</span> <span class="token operator">*=</span> <span class="token number">0.1</span> <span class="token comment"># å­¦ä¹ ç‡ä¸ºä¹‹å‰çš„0.1å€</span></code></pre></p><ul><li>è®­ç»ƒæ¨¡å‹</li></ul><p>é€šè¿‡è°ƒç”¨ <code>optim</code> å®ä¾‹çš„ <code>step</code> å‡½æ•°æ¥è¿­ä»£æ¨¡å‹å‚æ•°ã€‚æŒ‰ç…§å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™çš„å®šä¹‰ï¼Œæˆ‘ä»¬åœ¨ <code>step</code> å‡½æ•°ä¸­æŒ‡æ˜æ‰¹é‡å¤§å°ï¼Œä»è€Œå¯¹æ‰¹é‡ä¸­æ ·æœ¬æ¢¯åº¦æ±‚å¹³å‡ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">num_epochs <span class="token operator">=</span> <span class="token number">3</span><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> num_epochs <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> data_iter<span class="token punctuation">:</span>        output <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">)</span>        l <span class="token operator">=</span> loss<span class="token punctuation">(</span>output<span class="token punctuation">,</span> y<span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># æ¢¯åº¦æ¸…é›¶ï¼Œç­‰ä»·äºnet.zero_grad()</span>        l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'epoch %d, loss: %f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>epoch<span class="token punctuation">,</span> l<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š<br><pre class="language-none"><code class="language-none">epoch 1, loss: 0.000457epoch 2, loss: 0.000081epoch 3, loss: 0.000198</code></pre></p><h4 id="Softmax-Regression"><a href="#Softmax-Regression" class="headerlink" title="Softmax Regression"></a>Softmax Regression</h4><p>çº¿æ€§å›å½’æ¨¡å‹é€‚ç”¨äº<strong>è¾“å‡ºä¸ºè¿ç»­å€¼</strong>çš„æƒ…æ™¯ã€‚</p><p>åœ¨å¦ä¸€ç±»æƒ…æ™¯ä¸­ï¼Œæ¨¡å‹è¾“å‡ºå¯ä»¥æ˜¯ä¸€ä¸ªåƒå›¾åƒç±»åˆ«è¿™æ ·çš„<strong>ç¦»æ•£å€¼</strong>ã€‚å¯¹äºè¿™æ ·çš„ç¦»æ•£å€¼é¢„æµ‹é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¸å¦‚ softmax å›å½’åœ¨å†…çš„<strong>åˆ†ç±»æ¨¡å‹</strong>ã€‚</p><p>å’Œçº¿æ€§å›å½’ä¸åŒï¼Œsoftmax å›å½’çš„<strong>è¾“å‡ºå•å…ƒä»ä¸€ä¸ªå˜æˆäº†å¤šä¸ª</strong>ï¼Œä¸”å¼•å…¥äº† softmax è¿ç®—ä½¿è¾“å‡ºæ›´é€‚åˆç¦»æ•£å€¼çš„é¢„æµ‹å’Œè®­ç»ƒã€‚æœ¬èŠ‚ä»¥ softmax å›å½’æ¨¡å‹ä¸ºä¾‹ï¼Œä»‹ç»ç¥ç»ç½‘ç»œä¸­çš„åˆ†ç±»æ¨¡å‹ã€‚</p><p>softmax å›å½’è·Ÿçº¿æ€§å›å½’ä¸€æ ·å°†è¾“å…¥ç‰¹å¾ä¸æƒé‡åšçº¿æ€§å åŠ ã€‚ä¸çº¿æ€§å›å½’çš„ä¸€ä¸ªä¸»è¦ä¸åŒåœ¨äºï¼Œsoftmax å›å½’çš„<strong>è¾“å‡ºå€¼ä¸ªæ•°ç­‰äºæ ‡ç­¾é‡Œçš„ç±»åˆ«æ•°</strong>ã€‚</p><ul><li>æ¨¡å‹å®šä¹‰</li></ul><script type="math/tex; mode=display">\begin{aligned} o_1 &= x_1 w_{11} + x_2 w_{21} + x_3 w_{31} + x_4 w_{41} + b_1,\\ o_2 &= x_1 w_{12} + x_2 w_{22} + x_3 w_{32} + x_4 w_{42} + b_2,\\ o_3 &= x_1 w_{13} + x_2 w_{23} + x_3 w_{33} + x_4 w_{43} + b_3. \\\end{aligned}</script><script type="math/tex; mode=display">\hat{y}_1, \hat{y}_2, \hat{y}_3 = \text{softmax}(o_1, o_2, o_3)</script><p>å…¶ä¸­ï¼š</p><script type="math/tex; mode=display">\hat{y_1} = \frac{ \exp(o_1)}{\sum_{i=1}^3 \exp(o_i)},\quad \hat{y_2} = \frac{ \exp(o_2)}{\sum_{i=1}^3 \exp(o_i)},\quad \hat{y_3} = \frac{ \exp(o_3)}{\sum_{i=1}^3 \exp(o_i)}.</script><ul><li>æŸå¤±å‡½æ•°ï¼šCross Entropy</li></ul><script type="math/tex; mode=display">H\left(\boldsymbol y^{(i)}, \boldsymbol {\hat y}^{(i)}\right ) = -\sum_{j=1}^q y_j^{(i)} \log \hat y_j^{(i)},</script><p>äº¤å‰ç†µåªå…³å¿ƒ<strong>å¯¹æ­£ç¡®ç±»åˆ«</strong>çš„é¢„æµ‹æ¦‚ç‡ï¼Œå› ä¸ºåªè¦å…¶å€¼è¶³å¤Ÿå¤§ï¼Œå°±å¯ä»¥ç¡®ä¿åˆ†ç±»ç»“æœæ­£ç¡®ã€‚</p><p>å‡è®¾è®­ç»ƒæ•°æ®é›†çš„æ ·æœ¬æ•°ä¸º $n$â€‹ï¼Œäº¤å‰ç†µæŸå¤±å‡½æ•°å®šä¹‰ä¸º $\ell(\boldsymbol{\Theta}) = \frac{1}{n} \sum_{i=1}^n H\left(\boldsymbol y^{(i)}, \boldsymbol {\hat y}^{(i)}\right ) $â€‹. å…¶ä¸­$\boldsymbol{\Theta}$â€‹â€‹ä»£è¡¨æ¨¡å‹å‚æ•°ã€‚</p><p>æ³¨æ„ï¼šè¿™é‡Œçš„äº¤å‰ç†µæ˜¯ H = - [ å®é™…å€¼ * log(é¢„æµ‹å€¼) ] çš„æ±‚å’Œã€‚è€Œ log(é¢„æµ‹å€¼) å´åˆå¯ä»¥æ›¿æ¢ä¸ºæ˜¯é¢„æµ‹æ—¶çš„ logits $o_i$â€‹â€‹â€‹ï¼ŒäºŒè€…ä¹‹é—´åªå·®äº†ä¸€ä¸ªç³»æ•°ã€‚å› æ­¤èƒŒåå®ç°å¯ä»¥ç›´æ¥ç”¨ logits å‚ä¸ç®€åŒ–è®¡ç®—ã€‚</p><blockquote><p>æ•°æ®é›†ä¸ç›¸å…³åŒ…çš„ä»‹ç»ï¼šFashion-MNIST</p><p>æœ¬èŠ‚æˆ‘ä»¬å°†ä½¿ç”¨ torchvision åŒ…ï¼Œå®ƒæ˜¯æœåŠ¡äº PyTorch æ·±åº¦å­¦ä¹ æ¡†æ¶çš„ï¼Œä¸»è¦ç”¨æ¥æ„å»ºè®¡ç®—æœºè§†è§‰æ¨¡å‹ã€‚ torchvision ä¸»è¦ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†æ„æˆï¼š</p><ol><li><code>torchvision.datasets</code>: ä¸€äº›åŠ è½½æ•°æ®çš„å‡½æ•°åŠå¸¸ç”¨çš„æ•°æ®é›†æ¥å£ï¼›</li><li><code>torchvision.models</code>: åŒ…å«å¸¸ç”¨çš„æ¨¡å‹ç»“æ„ï¼ˆå«é¢„è®­ç»ƒæ¨¡å‹ï¼‰ï¼Œä¾‹å¦‚ AlexNetã€VGGã€ResNet ç­‰ï¼›</li><li><code>torchvision.transforms</code>: å¸¸ç”¨çš„å›¾ç‰‡å˜æ¢ï¼Œä¾‹å¦‚è£å‰ªã€æ—‹è½¬ç­‰ï¼›</li><li><code>torchvision.utils</code>: å…¶ä»–çš„ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ã€‚</li></ol></blockquote><h4 id="æ„ŸçŸ¥æœº"><a href="#æ„ŸçŸ¥æœº" class="headerlink" title="æ„ŸçŸ¥æœº"></a>æ„ŸçŸ¥æœº</h4><ul><li>ä»…æ·»åŠ éšè—å±‚ï¼šå³ä¾¿å†æ·»åŠ æ›´å¤šçš„éšè—å±‚ï¼Œå°†çº¿æ€§éšè—å±‚é—´å½¼æ­¤ç›¸æ¥ä¾ç„¶åªèƒ½ä¸ä»…å«è¾“å‡ºå±‚çš„å•å±‚ç¥ç»ç½‘ç»œç­‰ä»·ã€‚</li></ul><p>ä¸Šè¿°é—®é¢˜çš„æ ¹æºåœ¨äºå…¨è¿æ¥å±‚åªæ˜¯å¯¹æ•°æ®åšä»¿å°„å˜æ¢ï¼ˆaffine transformationï¼‰ï¼Œè€Œå¤šä¸ªä»¿å°„å˜æ¢çš„å åŠ ä»ç„¶æ˜¯ä¸€ä¸ªä»¿å°„å˜æ¢ã€‚</p><p>è§£å†³é—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯å¼•å…¥éçº¿æ€§å˜æ¢ï¼Œä¾‹å¦‚å¯¹éšè—å˜é‡ä½¿ç”¨æŒ‰å…ƒç´ è¿ç®—çš„éçº¿æ€§å‡½æ•°è¿›è¡Œå˜æ¢ï¼Œç„¶åå†ä½œä¸ºä¸‹ä¸€ä¸ªå…¨è¿æ¥å±‚çš„è¾“å…¥ã€‚</p><p>è¿™ä¸ªéçº¿æ€§å‡½æ•°è¢«ç§°ä¸ºæ¿€æ´»å‡½æ•°ï¼ˆactivation functionï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ã€‚</p><ul><li>$Relu(x) = \max(0, x)$.</li><li>$sigmoid(x) =\sigma(x) = \dfrac 1 {1 + e^{-x}}$.</li><li>$\text{tanh}(x) = \frac{1 - \exp(-2x)}{1 + \exp(-2x)}$.</li></ul><p>å¤šå±‚æ„ŸçŸ¥æœºå°±æ˜¯å«æœ‰è‡³å°‘ä¸€ä¸ªéšè—å±‚çš„ç”±å…¨è¿æ¥å±‚ç»„æˆçš„ç¥ç»ç½‘ç»œï¼Œä¸”æ¯ä¸ªéšè—å±‚çš„è¾“å‡ºé€šè¿‡æ¿€æ´»å‡½æ•°è¿›è¡Œå˜æ¢ã€‚å¤šå±‚æ„ŸçŸ¥æœºçš„å±‚æ•°å’Œå„éšè—å±‚ä¸­éšè—å•å…ƒä¸ªæ•°éƒ½æ˜¯è¶…å‚æ•°ã€‚</p><h3 id="åº”å¯¹è¿‡æ‹Ÿåˆ"><a href="#åº”å¯¹è¿‡æ‹Ÿåˆ" class="headerlink" title="åº”å¯¹è¿‡æ‹Ÿåˆ"></a>åº”å¯¹è¿‡æ‹Ÿåˆ</h3><h4 id="L2-Regularization"><a href="#L2-Regularization" class="headerlink" title="L2 Regularization"></a>L2 Regularization</h4><ul><li><strong>æƒé‡è¡°å‡</strong>æ˜¯ä¸€ç§åº”å¯¹è¿‡æ‹Ÿåˆçš„æ–¹æ³•</li><li>æƒé‡è¡°å‡ç­‰ä»·äº $L_2$ èŒƒæ•°æ­£åˆ™åŒ–ï¼ˆregularizationï¼‰ã€‚æ­£åˆ™åŒ–é€šè¿‡ä¸ºæ¨¡å‹æŸå¤±å‡½æ•°æ·»åŠ æƒ©ç½šé¡¹ä½¿å­¦å‡ºçš„æ¨¡å‹å‚æ•°å€¼è¾ƒå°ï¼Œæ˜¯åº”å¯¹è¿‡æ‹Ÿåˆçš„å¸¸ç”¨æ‰‹æ®µã€‚æˆ‘ä»¬å…ˆæè¿° $L_2$ èŒƒæ•°æ­£åˆ™åŒ–ï¼Œå†è§£é‡Šå®ƒä¸ºä½•åˆç§°æƒé‡è¡°å‡ã€‚</li></ul><p>$L_2$ èŒƒæ•°æ­£åˆ™åŒ–åœ¨æ¨¡å‹åŸæŸå¤±å‡½æ•°åŸºç¡€ä¸Šæ·»åŠ  $L_2$ èŒƒæ•°æƒ©ç½šé¡¹ï¼Œä»è€Œå¾—åˆ°è®­ç»ƒæ‰€éœ€è¦æœ€å°åŒ–çš„å‡½æ•°ã€‚</p><p>$L_2$ èŒƒæ•°æƒ©ç½šé¡¹æŒ‡çš„æ˜¯æ¨¡å‹æƒé‡å‚æ•°æ¯ä¸ªå…ƒç´ çš„å¹³æ–¹å’Œä¸ä¸€ä¸ªæ­£çš„å¸¸æ•°çš„ä¹˜ç§¯ã€‚å³å®šä¹‰æ–°çš„ Loss Function ä¸ºï¼š</p><script type="math/tex; mode=display">\ell(w, b) + \frac{\lambda}{2n} \|\boldsymbol{w}\|^2</script><p>ä¸ºä»€ä¹ˆ $L_2$ Regularization èƒ½èµ·åˆ°â€œæƒé‡è¡°å‡â€çš„ä½œç”¨å‘¢ï¼Ÿæˆ‘ä»¬è€ƒè™‘ Optimizer çš„è¿­ä»£æ–¹å¼â€¦</p><script type="math/tex; mode=display">\begin{aligned} w_1 &\leftarrow \left(1- \frac{\eta\lambda}{|\mathcal{B}|} \right)w_1 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_1^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right),\\ w_2 &\leftarrow \left(1- \frac{\eta\lambda}{|\mathcal{B}|} \right)w_2 - \frac{\eta}{|\mathcal{B}|} \sum_{i \in \mathcal{B}}x_2^{(i)} \left(x_1^{(i)} w_1 + x_2^{(i)} w_2 + b - y^{(i)}\right). \end{aligned}</script><p>è¿™æ˜¯å› ä¸ºå¦‚æœæˆ‘ä»¬å¯¹æŸå¤±å‡½æ•°æ±‚æ¢¯åº¦ï¼Œå°±å¿…ç„¶å¸¦æœ‰äº†å’ŒåŸæœ‰çš„ $w$ æœ‰å…³çš„ä¸€é¡¹ã€‚ç„¶åæˆ‘ä»¬åœ¨åšä¼˜åŒ–è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œ$L_2$ èŒƒæ•°æ­£åˆ™åŒ–ä»¤æƒé‡ $w_1$ å’Œ $w_2$ å…ˆè‡ªä¹˜å°äº 1 çš„æ•°ï¼Œå†å‡å»ä¸å«æƒ©ç½šé¡¹çš„æ¢¯åº¦ã€‚å› æ­¤ï¼Œ$L_2$ èŒƒæ•°æ­£åˆ™åŒ–åˆå«æƒé‡è¡°å‡ã€‚</p><p>æƒé‡è¡°å‡é€šè¿‡æƒ©ç½šç»å¯¹å€¼è¾ƒå¤§çš„æ¨¡å‹å‚æ•°ä¸ºéœ€è¦å­¦ä¹ çš„æ¨¡å‹å¢åŠ äº†é™åˆ¶ï¼Œè¿™å¯èƒ½å¯¹è¿‡æ‹Ÿåˆæœ‰æ•ˆã€‚å®é™…åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¹Ÿåœ¨æƒ©ç½šé¡¹ä¸­æ·»åŠ åå·®å…ƒç´ çš„å¹³æ–¹å’Œã€‚</p><h5 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h5><ul><li>å®šä¹‰ L2 èŒƒæ•°æƒ©ç½šé¡¹</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">l2_penalty</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>w<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span></code></pre><ul><li>Train (From scratch)</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">fit_and_plot</span><span class="token punctuation">(</span>lambd<span class="token punctuation">)</span><span class="token punctuation">:</span>    w<span class="token punctuation">,</span> b <span class="token operator">=</span> init_params<span class="token punctuation">(</span><span class="token punctuation">)</span>    train_ls<span class="token punctuation">,</span> test_ls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span>            <span class="token comment"># æ·»åŠ äº†L2èŒƒæ•°æƒ©ç½šé¡¹</span>            l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> lambd <span class="token operator">*</span> l2_penalty<span class="token punctuation">(</span>w<span class="token punctuation">)</span>            l <span class="token operator">=</span> l<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> w<span class="token punctuation">.</span>grad <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                w<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>                b<span class="token punctuation">.</span>grad<span class="token punctuation">.</span>data<span class="token punctuation">.</span>zero_<span class="token punctuation">(</span><span class="token punctuation">)</span>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            d2l<span class="token punctuation">.</span>sgd<span class="token punctuation">(</span><span class="token punctuation">[</span>w<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span> lr<span class="token punctuation">,</span> batch_size<span class="token punctuation">)</span>        train_ls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>train_features<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> train_labels<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        test_ls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>test_features<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    d2l<span class="token punctuation">.</span>semilogy<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> num_epochs <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> train_ls<span class="token punctuation">,</span> <span class="token string">'epochs'</span><span class="token punctuation">,</span> <span class="token string">'loss'</span><span class="token punctuation">,</span>                 <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> num_epochs <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_ls<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'L2 norm of w:'</span><span class="token punctuation">,</span> w<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ul><li>Train (Simple)</li></ul><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨æ„é€ ä¼˜åŒ–å™¨å®ä¾‹æ—¶é€šè¿‡ <code>weight_decay</code> å‚æ•°æ¥æŒ‡å®šæƒé‡è¡°å‡è¶…å‚æ•°ã€‚é»˜è®¤ä¸‹ï¼ŒPyTorch ä¼šå¯¹æƒé‡å’Œåå·®åŒæ—¶è¡°å‡ã€‚æˆ‘ä»¬å¯ä»¥åˆ†åˆ«å¯¹æƒé‡å’Œåå·®æ„é€ ä¼˜åŒ–å™¨å®ä¾‹ï¼Œä»è€Œåªå¯¹æƒé‡è¡°å‡ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">fit_and_plot_pytorch</span><span class="token punctuation">(</span>wd<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># å¯¹æƒé‡å‚æ•°è¡°å‡ã€‚æƒé‡åç§°ä¸€èˆ¬æ˜¯ä»¥weightç»“å°¾</span>    net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>net<span class="token punctuation">.</span>weight<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>net<span class="token punctuation">.</span>bias<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    optimizer_w <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>params<span class="token operator">=</span><span class="token punctuation">[</span>net<span class="token punctuation">.</span>weight<span class="token punctuation">]</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>lr<span class="token punctuation">,</span> weight_decay<span class="token operator">=</span>wd<span class="token punctuation">)</span> <span class="token comment"># å¯¹æƒé‡å‚æ•°è¡°å‡</span>    optimizer_b <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>params<span class="token operator">=</span><span class="token punctuation">[</span>net<span class="token punctuation">.</span>bias<span class="token punctuation">]</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>lr<span class="token punctuation">)</span>  <span class="token comment"># ä¸å¯¹åå·®å‚æ•°è¡°å‡</span>    train_ls<span class="token punctuation">,</span> test_ls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> train_iter<span class="token punctuation">:</span>            l <span class="token operator">=</span> loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>            optimizer_w<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            optimizer_b<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># å¯¹ä¸¤ä¸ª optimizer å®ä¾‹åˆ†åˆ«è°ƒç”¨ step å‡½æ•°ï¼Œä»è€Œåˆ†åˆ«æ›´æ–°æƒé‡å’Œåå·®</span>            optimizer_w<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>            optimizer_b<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>        train_ls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>train_features<span class="token punctuation">)</span><span class="token punctuation">,</span> train_labels<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        test_ls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">(</span>net<span class="token punctuation">(</span>test_features<span class="token punctuation">)</span><span class="token punctuation">,</span> test_labels<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    d2l<span class="token punctuation">.</span>semilogy<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> num_epochs <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> train_ls<span class="token punctuation">,</span> <span class="token string">'epochs'</span><span class="token punctuation">,</span> <span class="token string">'loss'</span><span class="token punctuation">,</span>                 <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> num_epochs <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_ls<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'L2 norm of w:'</span><span class="token punctuation">,</span> net<span class="token punctuation">.</span>weight<span class="token punctuation">.</span>data<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a>Dropout</h4><p>é™¤äº†å‰ä¸€èŠ‚ä»‹ç»çš„æƒé‡è¡°å‡ä»¥å¤–ï¼Œæ·±åº¦å­¦ä¹ æ¨¡å‹å¸¸å¸¸ä½¿ç”¨ä¸¢å¼ƒæ³•ï¼ˆDropoutï¼‰æ¥åº”å¯¹è¿‡æ‹Ÿåˆé—®é¢˜ã€‚ä¸¢å¼ƒæ³•æœ‰ä¸€äº›ä¸åŒçš„å˜ä½“ã€‚æœ¬èŠ‚ä¸­æåˆ°çš„ä¸¢å¼ƒæ³•ç‰¹æŒ‡å€’ç½®ä¸¢å¼ƒæ³•ï¼ˆinverted dropoutï¼‰ã€‚</p><p>å½“å¯¹æŸä¸ªéšè—å±‚ä½¿ç”¨ä¸¢å¼ƒæ³•æ—¶ï¼Œè¯¥å±‚çš„éšè—å•å…ƒå°†æœ‰ä¸€å®šæ¦‚ç‡è¢«ä¸¢å¼ƒæ‰ã€‚è®¾ä¸¢å¼ƒæ¦‚ç‡ä¸º $p$ï¼Œé‚£ä¹ˆæœ‰ $p$ çš„æ¦‚ç‡å…¶è¾“å‡º $h_i$ ä¼šè¢«æ¸…é›¶ï¼Œæœ‰ $1-p$ çš„æ¦‚ç‡ $h_i$ ä¼šé™¤ä»¥ $1-p$ åšæ‹‰ä¼¸ã€‚</p><p>ä¸¢å¼ƒæ¦‚ç‡æ˜¯ä¸¢å¼ƒæ³•çš„è¶…å‚æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œè®¾éšæœºå˜é‡ $\xi_i$ ä¸º 0 å’Œ 1 çš„æ¦‚ç‡åˆ†åˆ«ä¸º $p$ å’Œ $1-p$ ã€‚ä½¿ç”¨ä¸¢å¼ƒæ³•æ—¶æˆ‘ä»¬è®¡ç®—æ–°çš„éšè—å•å…ƒ $ h_iâ€™ = \frac{\xi_i}{1-p} h_i $ï¼Œç”±äº $E(\xi_i) = 1-p$ï¼Œå› æ­¤</p><script type="math/tex; mode=display">E(h_i') = \frac{E(\xi_i)}{1-p}h_i = h_i</script><p>å³<strong>ä¸¢å¼ƒæ³•ä¸æ”¹å˜å…¶è¾“å…¥çš„æœŸæœ›å€¼</strong>ã€‚</p><ul><li>å®ç°ï¼ˆSimpleï¼‰</li></ul><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        d2l<span class="token punctuation">.</span>FlattenLayer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_inputs<span class="token punctuation">,</span> num_hiddens1<span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>drop_prob1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># Here</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens1<span class="token punctuation">,</span> num_hiddens2<span class="token punctuation">)</span><span class="token punctuation">,</span>         nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>drop_prob2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># Here</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>num_hiddens2<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token keyword">for</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>param<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span></code></pre><blockquote><ul><li><strong>æ•°å€¼ç¨³å®šæ€§</strong></li></ul><p>æ·±åº¦æ¨¡å‹æœ‰å…³æ•°å€¼ç¨³å®šæ€§çš„å…¸å‹é—®é¢˜æ˜¯è¡°å‡ï¼ˆvanishingï¼‰å’Œçˆ†ç‚¸ï¼ˆexplosionï¼‰ã€‚</p><p>å½“ç¥ç»ç½‘ç»œçš„å±‚æ•°è¾ƒå¤šæ—¶ï¼Œæ¨¡å‹çš„æ•°å€¼ç¨³å®šæ€§å®¹æ˜“å˜å·®ã€‚å‡è®¾ä¸€ä¸ªå±‚æ•°ä¸º $L$ çš„å¤šå±‚æ„ŸçŸ¥æœºçš„ç¬¬ $l$ å±‚ $\boldsymbol{H}^{(l)}$ çš„æƒé‡å‚æ•°ä¸º $\boldsymbol{W}^{(l)}$ï¼Œè¾“å‡ºå±‚ $\boldsymbol{H}^{(L)}$ çš„æƒé‡å‚æ•°ä¸º $\boldsymbol{W}^{(L)}$ã€‚</p><p>ä¸ºäº†ä¾¿äºè®¨è®ºï¼Œä¸è€ƒè™‘åå·®å‚æ•°ï¼Œä¸”è®¾æ‰€æœ‰éšè—å±‚çš„æ¿€æ´»å‡½æ•°ä¸ºæ’ç­‰æ˜ å°„ $\phi(x) = x$ã€‚</p><p>ç»™å®šè¾“å…¥ $\boldsymbol{X}$ï¼Œå¤šå±‚æ„ŸçŸ¥æœºçš„ç¬¬ $l$ å±‚çš„è¾“å‡º $\boldsymbol{H}^{(l)} = \boldsymbol{X} \boldsymbol{W}^{(1)} \boldsymbol{W}^{(2)} \ldots \boldsymbol{W}^{(l)}$ã€‚</p><p>æ­¤æ—¶ï¼Œå¦‚æœå±‚æ•°$l$è¾ƒå¤§ï¼Œ$\boldsymbol{H}^{(l)}$ çš„è®¡ç®—å¯èƒ½ä¼šå‡ºç°è¡°å‡æˆ–çˆ†ç‚¸ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾è¾“å…¥å’Œæ‰€æœ‰å±‚çš„æƒé‡å‚æ•°éƒ½æ˜¯æ ‡é‡ï¼Œå¦‚æƒé‡å‚æ•°ä¸º 0.2 å’Œ 5ï¼Œå¤šå±‚æ„ŸçŸ¥æœºçš„ç¬¬ 30 å±‚è¾“å‡ºä¸ºè¾“å…¥ $\boldsymbol{X}$ åˆ†åˆ«ä¸ $0.2^{30} \approx 1 \times 10^{-21}$ï¼ˆè¡°å‡ï¼‰å’Œ $5^{30} \approx 9 \times 10^{20}$ï¼ˆçˆ†ç‚¸ï¼‰çš„ä¹˜ç§¯ã€‚</p><p>ç±»ä¼¼åœ°ï¼Œå½“å±‚æ•°è¾ƒå¤šæ—¶ï¼Œæ¢¯åº¦çš„è®¡ç®—ä¹Ÿæ›´å®¹æ˜“å‡ºç°è¡°å‡æˆ–çˆ†ç‚¸ã€‚</p><ul><li><strong>æ¨¡å‹åˆå§‹åŒ–</strong></li></ul><p>åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œé€šå¸¸éœ€è¦éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è§£é‡Šè¿™æ ·åšçš„åŸå› ã€‚</p><p>è€ƒè™‘å¤šå±‚æ„ŸçŸ¥æœºæ¨¡å‹ã€‚å¦‚æœå°†æ¯ä¸ªéšè—å•å…ƒçš„å‚æ•°éƒ½åˆå§‹åŒ–ä¸ºç›¸ç­‰çš„å€¼ï¼Œé‚£ä¹ˆåœ¨æ­£å‘ä¼ æ’­æ—¶æ¯ä¸ªéšè—å•å…ƒå°†æ ¹æ®ç›¸åŒçš„è¾“å…¥è®¡ç®—å‡ºç›¸åŒçš„å€¼ï¼Œå¹¶ä¼ é€’è‡³è¾“å‡ºå±‚ã€‚</p><p>åœ¨åå‘ä¼ æ’­ä¸­ï¼Œæ¯ä¸ªéšè—å•å…ƒçš„å‚æ•°æ¢¯åº¦å€¼ç›¸ç­‰ã€‚å› æ­¤ï¼Œè¿™äº›å‚æ•°åœ¨ä½¿ç”¨åŸºäºæ¢¯åº¦çš„ä¼˜åŒ–ç®—æ³•è¿­ä»£åå€¼ä¾ç„¶ç›¸ç­‰ã€‚</p><p>ä¹‹åçš„è¿­ä»£ä¹Ÿæ˜¯å¦‚æ­¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— è®ºéšè—å•å…ƒæœ‰å¤šå°‘ï¼Œéšè—å±‚æœ¬è´¨ä¸Šåªæœ‰ 1 ä¸ªéšè—å•å…ƒåœ¨å‘æŒ¥ä½œç”¨ã€‚</p><p>å› æ­¤ï¼Œæ­£å¦‚åœ¨å‰é¢çš„å®éªŒä¸­æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬é€šå¸¸å°†ç¥ç»ç½‘ç»œçš„æ¨¡å‹å‚æ•°ï¼Œç‰¹åˆ«æ˜¯æƒé‡å‚æ•°ï¼Œè¿›è¡Œéšæœºåˆå§‹åŒ–ã€‚</p><p>PyTorch ä¸­ <code>nn.Module</code> çš„æ¨¡å—å‚æ•°éƒ½é‡‡å–äº†è¾ƒä¸ºåˆç†çš„åˆå§‹åŒ–ç­–ç•¥ã€‚</p></blockquote><h2 id="æ·±åº¦å­¦ä¹ è®¡ç®—"><a href="#æ·±åº¦å­¦ä¹ è®¡ç®—" class="headerlink" title="æ·±åº¦å­¦ä¹ è®¡ç®—"></a>æ·±åº¦å­¦ä¹ è®¡ç®—</h2><h3 id="æ¨¡å‹æ„é€ "><a href="#æ¨¡å‹æ„é€ " class="headerlink" title="æ¨¡å‹æ„é€ "></a>æ¨¡å‹æ„é€ </h3><ul><li>å¯ä»¥é€šè¿‡ç»§æ‰¿<code>Module</code>ç±»æ¥æ„é€ æ¨¡å‹ï¼Œé‡è½½ <code>__init__</code> å‡½æ•°å’Œ <code>forward</code> å‡½æ•°ã€‚</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MLP</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># å£°æ˜å¸¦æœ‰æ¨¡å‹å‚æ•°çš„å±‚ï¼Œè¿™é‡Œå£°æ˜äº†ä¸¤ä¸ªå…¨è¿æ¥å±‚</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># è°ƒç”¨ MLP çˆ¶ç±» Module çš„æ„é€ å‡½æ•°æ¥è¿›è¡Œå¿…è¦çš„åˆå§‹åŒ–ã€‚è¿™æ ·åœ¨æ„é€ å®ä¾‹æ—¶è¿˜å¯ä»¥æŒ‡å®šå…¶ä»–å‡½æ•°</span>        <span class="token comment"># å‚æ•°ï¼Œå¦‚â€œæ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–å’Œå…±äº«â€ä¸€èŠ‚å°†ä»‹ç»çš„æ¨¡å‹å‚æ•° params</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>MLP<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>hidden <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token comment"># éšè—å±‚</span>        self<span class="token punctuation">.</span>act <span class="token operator">=</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>output <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># è¾“å‡ºå±‚</span>    <span class="token comment"># å®šä¹‰æ¨¡å‹çš„å‰å‘è®¡ç®—ï¼Œå³å¦‚ä½•æ ¹æ®è¾“å…¥ x è®¡ç®—è¿”å›æ‰€éœ€è¦çš„æ¨¡å‹è¾“å‡º</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        a <span class="token operator">=</span> self<span class="token punctuation">.</span>act<span class="token punctuation">(</span>self<span class="token punctuation">.</span>hidden<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>output<span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre><ul><li><code>Sequential</code>ã€<code>ModuleList</code>ã€<code>ModuleDict</code>ç±»éƒ½ç»§æ‰¿è‡ª<code>Module</code>ç±»ã€‚</li></ul><p><strong><code>Sequential</code></strong></p><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> MySequential<span class="token punctuation">(</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span></code></pre><p><strong><code>ModuleList</code></strong></p><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">[</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>net<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># # ç±»ä¼¼ List çš„ append æ“ä½œ</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># ç±»ä¼¼ List çš„ç´¢å¼•è®¿é—®</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span><span class="token comment"># net(torch.zeros(1, 784)) # ä¼šæŠ¥ NotImplementedError</span></code></pre><p><code>ModuleList</code>ä»…ä»…æ˜¯ä¸€ä¸ªå‚¨å­˜å„ç§æ¨¡å—çš„åˆ—è¡¨ï¼Œè¿™äº›æ¨¡å—ä¹‹é—´æ²¡æœ‰è”ç³»ä¹Ÿæ²¡æœ‰é¡ºåºï¼ˆæ‰€ä»¥ä¸ç”¨ä¿è¯ç›¸é‚»å±‚çš„è¾“å…¥è¾“å‡ºç»´åº¦åŒ¹é…ï¼‰ï¼Œè€Œä¸”æ²¡æœ‰å®ç° <code>forward</code> åŠŸèƒ½éœ€è¦è‡ªå·±å®ç°ï¼Œæ‰€ä»¥ä¸Šé¢æ‰§è¡Œ <code>net(torch.zeros(1, 784))</code> ä¼šæŠ¥<code>NotImplementedError</code>ï¼›è€Œ <code>Sequential</code> å†…çš„æ¨¡å—éœ€è¦æŒ‰ç…§é¡ºåºæ’åˆ—ï¼Œè¦ä¿è¯ç›¸é‚»å±‚çš„è¾“å…¥è¾“å‡ºå¤§å°ç›¸åŒ¹é…ï¼Œå†…éƒ¨ <code>forward</code> åŠŸèƒ½å·²ç»å®ç°ã€‚æ­¤å¤–ï¼Œ<code>ModuleList</code> ä¸åŒäºä¸€èˆ¬çš„ Python çš„ <code>list</code>ï¼ŒåŠ å…¥åˆ° <code>ModuleList</code> é‡Œé¢çš„æ‰€æœ‰æ¨¡å—çš„å‚æ•°ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æ•´ä¸ªç½‘ç»œä¸­ã€‚</p><p><strong><code>ModuleDict</code></strong></p><p><code>ModuleDict</code> æ¥æ”¶ä¸€ä¸ªå­æ¨¡å—çš„å­—å…¸ä½œä¸ºè¾“å…¥, ç„¶åä¹Ÿå¯ä»¥ç±»ä¼¼å­—å…¸é‚£æ ·è¿›è¡Œæ·»åŠ è®¿é—®æ“ä½œã€‚</p><pre class="language-python" data-language="python"><code class="language-python">net <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleDict<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token string">'linear'</span><span class="token punctuation">:</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token string">'act'</span><span class="token punctuation">:</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>net<span class="token punctuation">[</span><span class="token string">'output'</span><span class="token punctuation">]</span> <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># æ·»åŠ </span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">[</span><span class="token string">'linear'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># è®¿é—®</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span><span class="token comment"># net(torch.zeros(1, 784)) # ä¼šæŠ¥NotImplementedError</span></code></pre><p>å’Œ <code>ModuleList</code> ä¸€æ ·ï¼Œ<code>ModuleDict</code> å®ä¾‹ä»…ä»…æ˜¯å­˜æ”¾äº†ä¸€äº›æ¨¡å—çš„å­—å…¸ï¼Œå¹¶æ²¡æœ‰å®šä¹‰ <code>forward</code> å‡½æ•°éœ€è¦è‡ªå·±å®šä¹‰ã€‚åŒæ ·ï¼Œ<code>ModuleDict</code> ä¹Ÿä¸Pythonçš„ <code>Dict</code> æœ‰æ‰€ä¸åŒï¼Œ<code>ModuleDict</code> é‡Œçš„æ‰€æœ‰æ¨¡å—çš„å‚æ•°ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æ•´ä¸ªç½‘ç»œä¸­ã€‚</p><ul><li>ä¸<code>Sequential</code>ä¸åŒï¼Œ<code>ModuleList</code>å’Œ<code>ModuleDict</code>å¹¶æ²¡æœ‰å®šä¹‰ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œï¼Œå®ƒä»¬åªæ˜¯å°†ä¸åŒçš„æ¨¡å—å­˜æ”¾åœ¨ä¸€èµ·ï¼Œéœ€è¦è‡ªå·±å®šä¹‰<code>forward</code>å‡½æ•°ã€‚</li><li>è™½ç„¶<code>Sequential</code>ç­‰ç±»å¯ä»¥ä½¿æ¨¡å‹æ„é€ æ›´åŠ ç®€å•ï¼Œä½†ç›´æ¥ç»§æ‰¿<code>Module</code>ç±»å¯ä»¥æå¤§åœ°æ‹“å±•æ¨¡å‹æ„é€ çš„çµæ´»æ€§ã€‚</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">FancyMLP</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>FancyMLP<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>rand_weight <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requires_grad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># ä¸å¯è®­ç»ƒå‚æ•°ï¼ˆå¸¸æ•°å‚æ•°ï¼‰</span>        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token comment"># ä½¿ç”¨åˆ›å»ºçš„å¸¸æ•°å‚æ•°ï¼Œä»¥åŠ nn.functional ä¸­çš„ relu å‡½æ•°å’Œ mm å‡½æ•°</span>        x <span class="token operator">=</span> nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>rand_weight<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># å¤ç”¨å…¨è¿æ¥å±‚ã€‚ç­‰ä»·äºä¸¤ä¸ªå…¨è¿æ¥å±‚å…±äº«å‚æ•°</span>        x <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token comment"># æ§åˆ¶æµï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ item å‡½æ•°æ¥è¿”å›æ ‡é‡è¿›è¡Œæ¯”è¾ƒ</span>        <span class="token keyword">while</span> x<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>            x <span class="token operator">/=</span> <span class="token number">2</span>        <span class="token keyword">if</span> x<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.8</span><span class="token punctuation">:</span>            x <span class="token operator">*=</span> <span class="token number">10</span>        <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–ä¸å…±äº«"><a href="#æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–ä¸å…±äº«" class="headerlink" title="æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–ä¸å…±äº«"></a>æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–ä¸å…±äº«</h3><p>æœ¬èŠ‚ç”¨åˆ°çš„æ¨¡å‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">from</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">import</span> initnet <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># pytorch å·²è¿›è¡Œé»˜è®¤åˆå§‹åŒ–</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span>X <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>Y <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>Output<span class="token punctuation">:</span>Sequential<span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><ul><li><strong>è®¿é—®æ¨¡å‹å‚æ•°</strong></li></ul><p>å¯¹äº <code>Sequential</code> å®ä¾‹ï¼ˆæ´¾ç”Ÿè‡ª <code>Module</code>ï¼‰ä¸­å«æ¨¡å‹å‚æ•°çš„å±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Module</code> ç±»çš„ <code>parameters()</code> æˆ–è€… <code>named_parameters</code> æ–¹æ³•æ¥è®¿é—®æ‰€æœ‰å‚æ•°ï¼ˆä»¥è¿­ä»£å™¨çš„å½¢å¼è¿”å›ï¼‰ï¼Œåè€…é™¤äº†è¿”å›å‚æ•° <code>Tensor</code> å¤–è¿˜ä¼šè¿”å›å…¶åå­—ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'generator'</span><span class="token operator">></span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> param<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">0.</span>weight torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token number">0.</span>bias torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token number">2.</span>weight torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token number">2.</span>bias torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>æ¥ä¸‹æ¥è®¿é—®å•å±‚çš„å‚æ•°ã€‚å¯¹äºä½¿ç”¨ <code>Sequential</code> ç±»æ„é€ çš„ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ–¹æ‹¬å· <code>[]</code> æ¥è®¿é—®ç½‘ç»œçš„ä»»ä¸€å±‚ã€‚ç´¢å¼• 0 è¡¨ç¤ºéšè—å±‚ä¸º <code>Sequential</code> å®ä¾‹æœ€å…ˆæ·»åŠ çš„å±‚ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> net<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> param<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>weight torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'torch.nn.parameter.Parameter'</span><span class="token operator">></span>bias torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'torch.nn.parameter.Parameter'</span><span class="token operator">></span></code></pre><p>è¿”å›çš„ <code>param</code> çš„ç±»å‹ä¸º <code>torch.nn.parameter.Parameter</code>ï¼Œå…¶å®è¿™æ˜¯ <code>Tensor</code> çš„å­ç±»ï¼Œå’Œ <code>Tensor</code> ä¸åŒçš„æ˜¯å¦‚æœä¸€ä¸ª <code>Tensor</code> æ˜¯ <code>Parameter</code>ï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨è¢«æ·»åŠ åˆ°æ¨¡å‹çš„å‚æ•°åˆ—è¡¨é‡Œã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>MyModel<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>weight1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>weight2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>n <span class="token operator">=</span> MyModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> n<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>    Output<span class="token punctuation">:</span>weight1</code></pre><ul><li><strong>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</strong></li></ul><p>PyTorch ä¸­ <code>nn.Module</code> çš„æ¨¡å—å‚æ•°éƒ½é‡‡å–äº†è¾ƒä¸ºåˆç†çš„åˆå§‹åŒ–ç­–ç•¥ï¼Œä½†æˆ‘ä»¬ç»å¸¸éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥åˆå§‹åŒ–æƒé‡ã€‚</p><p>PyTorch çš„ <code>init</code> æ¨¡å—é‡Œæä¾›äº†å¤šç§é¢„è®¾çš„åˆå§‹åŒ–æ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†æƒé‡å‚æ•°åˆå§‹åŒ–æˆå‡å€¼ä¸º 0ã€æ ‡å‡†å·®ä¸º 0.01 çš„æ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼Œå¹¶ä¾ç„¶å°†åå·®å‚æ•°æ¸…é›¶ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'weight'</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>        init<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>param<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> param<span class="token punctuation">.</span>data<span class="token punctuation">)</span>Output<span class="token punctuation">:</span><span class="token number">0.</span>weight tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.0030</span><span class="token punctuation">,</span>  <span class="token number">0.0094</span><span class="token punctuation">,</span>  <span class="token number">0.0070</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0010</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.0001</span><span class="token punctuation">,</span>  <span class="token number">0.0039</span><span class="token punctuation">,</span>  <span class="token number">0.0105</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0126</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span> <span class="token number">0.0105</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0135</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0047</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0006</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token number">2.</span>weight tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.0074</span><span class="token punctuation">,</span>  <span class="token number">0.0051</span><span class="token punctuation">,</span>  <span class="token number">0.0066</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>ä¸‹é¢ä½¿ç”¨å¸¸æ•°æ¥åˆå§‹åŒ–æƒé‡å‚æ•°ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'bias'</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>        init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>param<span class="token punctuation">,</span> val<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> param<span class="token punctuation">.</span>data<span class="token punctuation">)</span>Output<span class="token punctuation">:</span><span class="token number">0.</span>bias tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token number">2.</span>bias tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦çš„åˆå§‹åŒ–æ–¹æ³•å¹¶æ²¡æœ‰åœ¨ <code>init</code> æ¨¡å—ä¸­æä¾›ã€‚è¿™æ—¶ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œä»è€Œèƒ½å¤Ÿåƒä½¿ç”¨å…¶ä»–åˆå§‹åŒ–æ–¹æ³•é‚£æ ·ä½¿ç”¨å®ƒã€‚</p><p>é¦–å…ˆå‚è€ƒ normal_ çš„å®ç°ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">normal_</span><span class="token punctuation">(</span>tensor<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> tensor<span class="token punctuation">.</span>normal_<span class="token punctuation">(</span>mean<span class="token punctuation">,</span> std<span class="token punctuation">)</span></code></pre><p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">init_weight_</span><span class="token punctuation">(</span>tensor<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tensor<span class="token punctuation">.</span>uniform_<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>        tensor <span class="token operator">*=</span> <span class="token punctuation">(</span>tensor<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'weight'</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>        init_weight_<span class="token punctuation">(</span>param<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> param<span class="token punctuation">.</span>data<span class="token punctuation">)</span></code></pre><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç›´æ¥æ”¹å˜è¿™äº›å‚æ•°çš„ <code>data</code> æ¥è¾¾åˆ°æ”¹å†™æ¨¡å‹å‚æ•°å€¼çš„åŒæ—¶ä¸ä¼šå½±å“æ¢¯åº¦çš„æ•ˆæœã€‚</p><ul><li><strong>å…±äº«æ¨¡å‹å‚æ•°</strong></li></ul><p>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å¤šä¸ªå±‚ä¹‹é—´å…±äº«æ¨¡å‹å‚æ•°ã€‚</p><p>å…±äº«æ¨¡å‹å‚æ•°çš„æ–¹æ³•: <code>Module</code> ç±»çš„ <code>forward</code> å‡½æ•°é‡Œå¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªå±‚ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥ <code>Sequential</code> çš„æ¨¡å—æ˜¯åŒä¸€ä¸ª <code>Module</code> å®ä¾‹çš„è¯å‚æ•°ä¹Ÿæ˜¯å…±äº«çš„ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>linear<span class="token punctuation">,</span> linear<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span><span class="token keyword">for</span> name<span class="token punctuation">,</span> param <span class="token keyword">in</span> net<span class="token punctuation">.</span>named_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    init<span class="token punctuation">.</span>constant_<span class="token punctuation">(</span>param<span class="token punctuation">,</span> val<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> param<span class="token punctuation">.</span>data<span class="token punctuation">)</span>Output<span class="token punctuation">:</span>Sequential<span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Linear<span class="token punctuation">(</span>in_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> out_features<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token number">0.</span>weight tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># è¿™é‡Œåªè¾“å‡ºäº†ä¸€æ¬¡å‚æ•°åˆ—è¡¨ï¼Œè¯æ˜äºŒè€…å…±äº«</span></code></pre><p>å› ä¸ºæ¨¡å‹å‚æ•°é‡ŒåŒ…å«äº†æ¢¯åº¦ï¼Œæ‰€ä»¥åœ¨åå‘ä¼ æ’­è®¡ç®—æ—¶ï¼Œè¿™äº›å…±äº«çš„å‚æ•°çš„æ¢¯åº¦æ˜¯ç´¯åŠ çš„ã€‚</p><h3 id="è‡ªå®šä¹‰-Layer"><a href="#è‡ªå®šä¹‰-Layer" class="headerlink" title="è‡ªå®šä¹‰ Layer"></a>è‡ªå®šä¹‰ Layer</h3><p>æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <code>Module</code>æ¥è‡ªå®šä¹‰å±‚ï¼Œä»è€Œå¯ä»¥è¢«é‡å¤è°ƒç”¨ã€‚</p><ul><li><strong>ä¸å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚</strong></li></ul><p>äº‹å®ä¸Šï¼Œè‡ªå®šä¹‰å±‚å’Œè‡ªå®šä¹‰æ¨¡å‹ç±»ä¼¼ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠä¸€ä¸ª Packed çš„æ¨¡å‹è§†ä¸ºæ˜¯ä¸€ä¸ª Layerã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„ <code>CenteredLayer</code> ç±»é€šè¿‡ç»§æ‰¿ <code>Module</code> ç±»è‡ªå®šä¹‰äº†ä¸€ä¸ªå°†è¾“å…¥å‡æ‰å‡å€¼åè¾“å‡ºçš„å±‚ï¼Œå¹¶å°†å±‚çš„è®¡ç®—å®šä¹‰åœ¨äº† <code>forward</code> å‡½æ•°é‡Œã€‚è¿™ä¸ªå±‚é‡Œä¸å«æ¨¡å‹å‚æ•°ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token keyword">class</span> <span class="token class-name">CenteredLayer</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>CenteredLayer<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> x <span class="token operator">-</span> x<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ä¾‹åŒ–è¿™ä¸ª Layerï¼Œç„¶ååš Forward Feeding.</p><pre class="language-python" data-language="python"><code class="language-python">layer <span class="token operator">=</span> CenteredLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>layer<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Output<span class="token punctuation">:</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><ul><li><strong>å«æ¨¡å‹å‚æ•°çš„è‡ªå®šä¹‰å±‚</strong></li></ul><p>ä¹‹å‰æˆ‘ä»¬ä»‹ç»äº† <code>Parameter</code> ç±»å…¶å®æ˜¯ <code>Tensor</code> çš„å­ç±»ï¼Œå¦‚æœä¸€ä¸ª <code>Tensor</code> æ˜¯ <code>Parameter</code>ï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨è¢«æ·»åŠ åˆ°æ¨¡å‹çš„å‚æ•°åˆ—è¡¨é‡Œã€‚ // åœ¨è¿™é‡Œå¯ä»¥æ¨æµ‹è¿™ä¸ªå‚æ•°åˆ—è¡¨æ˜¯ <code>nn.Module</code> çš„æ•°æ®æˆå‘˜â€¦?</p><p>æ‰€ä»¥åœ¨è‡ªå®šä¹‰å«æ¨¡å‹å‚æ•°çš„å±‚æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å°†å‚æ•°å®šä¹‰æˆ <code>Parameter</code>ã€‚</p><p>é™¤äº†ç›´æ¥å®šä¹‰æˆ <code>Parameter</code> ç±»å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>ParameterList</code> å’Œ <code>ParameterDict</code> åˆ†åˆ«å®šä¹‰å‚æ•°çš„åˆ—è¡¨å’Œå­—å…¸ã€‚</p><ul><li><strong><code>ParameterList</code></strong></li></ul><p><code>ParameterList</code>æ¥æ”¶ä¸€ä¸ª <code>Parameter</code> å®ä¾‹çš„åˆ—è¡¨ä½œä¸ºè¾“å…¥ç„¶åå¾—åˆ°ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç”¨ç´¢å¼•æ¥è®¿é—®æŸä¸ªå‚æ•°ï¼Œå¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>append</code> å’Œ <code>extend</code> åœ¨åˆ—è¡¨åé¢æ–°å¢å‚æ•°ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>MyDense<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>params <span class="token operator">=</span> nn<span class="token punctuation">.</span>ParameterList<span class="token punctuation">(</span><span class="token punctuation">[</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>params<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            x <span class="token operator">=</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> xnet <span class="token operator">=</span> MyDense<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span></code></pre><p>Output:</p><pre class="language-none"><code class="language-none">MyDense(  (params): ParameterList(      (0): Parameter containing: [torch.FloatTensor of size 4x4]      (1): Parameter containing: [torch.FloatTensor of size 4x4]      (2): Parameter containing: [torch.FloatTensor of size 4x4]      (3): Parameter containing: [torch.FloatTensor of size 4x1]  ))</code></pre><ul><li><strong><code>ParameterDict</code></strong></li></ul><p><code>ParameterDict</code> æ¥æ”¶ä¸€ä¸ª <code>Parameter</code> å®ä¾‹çš„å­—å…¸ä½œä¸ºè¾“å…¥ç„¶åå¾—åˆ°ä¸€ä¸ªå‚æ•°å­—å…¸ï¼Œç„¶åå¯ä»¥æŒ‰ç…§å­—å…¸çš„è§„åˆ™ä½¿ç”¨äº†ã€‚</p><p>ä¾‹å¦‚ä½¿ç”¨ <code>update()</code> æ–°å¢å‚æ•°ï¼Œä½¿ç”¨ <code>keys()</code> è¿”å›æ‰€æœ‰é”®å€¼ï¼Œä½¿ç”¨ <code>items()</code> è¿”å›æ‰€æœ‰é”®å€¼å¯¹ç­‰ç­‰ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyDictDense</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">super</span><span class="token punctuation">(</span>MyDictDense<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>params <span class="token operator">=</span> nn<span class="token punctuation">.</span>ParameterDict<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>                <span class="token string">'linear1'</span><span class="token punctuation">:</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">'linear2'</span><span class="token punctuation">:</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>params<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'linear3'</span><span class="token punctuation">:</span> nn<span class="token punctuation">.</span>Parameter<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment"># æ–°å¢</span>    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> choice<span class="token operator">=</span><span class="token string">'linear1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>mm<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>params<span class="token punctuation">[</span>choice<span class="token punctuation">]</span><span class="token punctuation">)</span>net <span class="token operator">=</span> MyDictDense<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span></code></pre><p>Output:</p><pre class="language-none"><code class="language-none">MyDictDense(  (params): ParameterDict(      (linear1): Parameter containing: [torch.FloatTensor of size 4x4]      (linear2): Parameter containing: [torch.FloatTensor of size 4x1]      (linear3): Parameter containing: [torch.FloatTensor of size 4x2]  ))</code></pre><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„ key è¿›è¡Œä¸åŒçš„ forward feeding.</p><pre class="language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'linear1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'linear2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>net<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'linear3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>Output<span class="token punctuation">:</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.5082</span><span class="token punctuation">,</span> <span class="token number">1.5574</span><span class="token punctuation">,</span> <span class="token number">2.1651</span><span class="token punctuation">,</span> <span class="token number">1.2409</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MmBackward<span class="token operator">></span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.8783</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MmBackward<span class="token operator">></span><span class="token punctuation">)</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">2.2193</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.6539</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>MmBackward<span class="token operator">></span><span class="token punctuation">)</span></code></pre><h3 id="è¯»å–ä¸å­˜å‚¨"><a href="#è¯»å–ä¸å­˜å‚¨" class="headerlink" title="è¯»å–ä¸å­˜å‚¨"></a>è¯»å–ä¸å­˜å‚¨</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å¤„ç†æ•°æ®ä»¥åŠå¦‚ä½•æ„å»ºã€è®­ç»ƒå’Œæµ‹è¯•æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</p><p>ç„¶è€Œåœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶éœ€è¦æŠŠè®­ç»ƒå¥½çš„æ¨¡å‹éƒ¨ç½²åˆ°å¾ˆå¤šä¸åŒçš„è®¾å¤‡ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå†…å­˜ä¸­è®­ç»ƒå¥½çš„æ¨¡å‹å‚æ•°å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šä¾›åç»­è¯»å–ä½¿ç”¨ã€‚</p><ul><li><strong>è¯»å†™ <code>Tensor</code></strong></li></ul><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>save</code> å‡½æ•°å’Œ <code>load</code> å‡½æ•°åˆ†åˆ«å­˜å‚¨å’Œè¯»å– <code>Tensor</code>ã€‚</p><p><code>save</code> ä½¿ç”¨ Python çš„ pickle åº“å°†å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åå°†åºåˆ—åŒ–çš„å¯¹è±¡ä¿å­˜åˆ°ç¡¬ç›˜ã€‚</p><p>ä½¿ç”¨ <code>save</code> å¯ä»¥ä¿å­˜å„ç§å¯¹è±¡ï¼ŒåŒ…æ‹¬ <code>nn.Module</code>, <code>Tensor</code>, <code>dict</code> ç­‰ç­‰ã€‚</p><p>è€Œ <code>load</code> ä½¿ç”¨ unpickle å·¥å…·å°† pickle çš„å¯¹è±¡æ–‡ä»¶ååºåˆ—åŒ–ä¸ºå†…å­˜ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nnx <span class="token operator">=</span> torch<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token string">'x.pt'</span><span class="token punctuation">)</span>x2 <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'x.pt'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span> <span class="token comment"># tensor([1., 1., 1.])</span>y <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'xy.pt'</span><span class="token punctuation">)</span>xy_list <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'xy.pt'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>xy_list<span class="token punctuation">)</span> <span class="token comment"># [tensor([1., 1., 1.]), tensor([0., 0., 0., 0.])]</span>torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> x<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> y<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'xy_dict.pt'</span><span class="token punctuation">)</span>xy <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'xy_dict.pt'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>xy<span class="token punctuation">)</span> <span class="token comment"># &#123;'x': tensor([1., 1., 1.]), 'y': tensor([0., 0., 0., 0.])&#125;</span></code></pre><ul><li><strong>è¯»å†™æ¨¡å‹</strong></li></ul><p>PyTorch ä¸­ä¿å­˜å’ŒåŠ è½½è®­ç»ƒæ¨¡å‹æœ‰ä¸¤ç§å¸¸è§çš„æ–¹æ³•:</p><ol><li>ä»…ä¿å­˜å’ŒåŠ è½½æ¨¡å‹å‚æ•°(<code>state_dict</code>)ï¼›</li><li>ä¿å­˜å’ŒåŠ è½½æ•´ä¸ªæ¨¡å‹ã€‚</li></ol><p><strong>ä¿å­˜å’ŒåŠ è½½æ¨¡å‹çš„ <code>state_dict()</code> æˆå‘˜ï¼ˆRecommendedï¼‰</strong></p><p>ä¿å­˜ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">)</span> <span class="token comment"># æ¨èçš„æ–‡ä»¶åç¼€åæ˜¯ pt æˆ– pth</span></code></pre><p>åŠ è½½ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">model <span class="token operator">=</span> TheModelClass<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h3 id="GPU-è®¡ç®—"><a href="#GPU-è®¡ç®—" class="headerlink" title="GPU è®¡ç®—"></a>GPU è®¡ç®—</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ CPU è®¡ç®—ã€‚</p><p>å¯¹å¤æ‚çš„ç¥ç»ç½‘ç»œå’Œå¤§è§„æ¨¡çš„æ•°æ®æ¥è¯´ï¼Œä½¿ç”¨ CPU æ¥è®¡ç®—å¯èƒ½ä¸å¤Ÿé«˜æ•ˆã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨å•å— NVIDIA GPU æ¥è®¡ç®—ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>nvidia-smi</code> å‘½ä»¤æ¥æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯ã€‚</p><pre class="language-none"><code class="language-none">Wed Jan 26 11:48:28 2022+-----------------------------------------------------------------------------+| NVIDIA-SMI 457.49       Driver Version: 457.49       CUDA Version: 11.1     ||-------------------------------+----------------------+----------------------+| GPU  Name            TCC&#x2F;WDDM | Bus-Id        Disp.A | Volatile Uncorr. ECC || Fan  Temp  Perf  Pwr:Usage&#x2F;Cap|         Memory-Usage | GPU-Util  Compute M. ||                               |                      |               MIG M. ||&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;+&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;||   0  GeForce GTX 1650   WDDM  | 00000000:01:00.0 Off |                  N&#x2F;A || N&#x2F;A   43C    P8     4W &#x2F;  N&#x2F;A |    359MiB &#x2F;  4096MiB |      8%      Default ||                               |                      |                  N&#x2F;A |+-------------------------------+----------------------+----------------------+</code></pre><ul><li><strong>è®¡ç®—è®¾å¤‡</strong></li></ul><p>PyTorch å¯ä»¥æŒ‡å®šç”¨æ¥å­˜å‚¨å’Œè®¡ç®—çš„è®¾å¤‡ï¼Œå¦‚ä½¿ç”¨å†…å­˜çš„ CPU æˆ–è€…ä½¿ç”¨æ˜¾å­˜çš„ GPUã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyTorch ä¼šå°†æ•°æ®åˆ›å»ºåœ¨å†…å­˜ï¼Œç„¶ååˆ©ç”¨ CPU æ¥è®¡ç®—ã€‚</p><p>ç”¨ <code>torch.cuda.is_available()</code> æŸ¥çœ‹ GPU æ˜¯å¦å¯ç”¨:<br><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> torch<span class="token keyword">from</span> torch <span class="token keyword">import</span> nntorch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># è¾“å‡º True</span></code></pre></p><p>GPU çš„ç›¸å…³ä¿¡æ¯æŸ¥è¯¢ï¼š<br><pre class="language-python" data-language="python"><code class="language-python">torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>device_count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># æŸ¥çœ‹ GPU æ•°é‡ï¼Œè¾“å‡º 1</span>torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>current_device<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># æŸ¥çœ‹å½“å‰ GPU ç´¢å¼•å·ï¼Œè¾“å‡º 0</span>torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>get_device_name<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># æ ¹æ®ç´¢å¼•å·æŸ¥çœ‹ GPU åå­—ï¼Œè¾“å‡º 'GeForce GTX 1050'</span></code></pre></p><ul><li><strong><code>Tensor</code> çš„ GPU è®¡ç®—</strong></li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Tensor</code> ä¼šè¢«å­˜åœ¨å†…å­˜ä¸Šã€‚å› æ­¤ï¼Œä¹‹å‰æˆ‘ä»¬æ¯æ¬¡æ‰“å° <code>Tensor</code> çš„æ—¶å€™çœ‹ä¸åˆ° GPU ç›¸å…³æ ‡è¯†ã€‚<br><pre class="language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment"># tensor([1, 2, 3])</span></code></pre><br>ä½¿ç”¨ <code>.cuda()</code> å¯ä»¥å°†CPUä¸Šçš„ <code>Tensor</code> è½¬æ¢ï¼ˆå¤åˆ¶ï¼‰åˆ°GPUä¸Šã€‚</p><p>å¦‚æœæœ‰å¤šå—GPUï¼Œæˆ‘ä»¬ç”¨ <code>.cuda(i)</code>æ¥è¡¨ç¤ºç¬¬ $i$ å— GPU åŠç›¸åº”çš„æ˜¾å­˜ï¼ˆ$i$ ä» 0 å¼€å§‹ï¼‰ä¸” <code>cuda(0)</code> å’Œ <code>cuda()</code> ç­‰ä»·ã€‚</p><pre class="language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> x<span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment"># tensor([1, 2, 3], device='cuda:0')</span></code></pre><p>å¯ä»¥é€šè¿‡ <code>Tensor</code> çš„ <code>device</code> å±æ€§æ¥æŸ¥çœ‹è¯¥ <code>Tensor</code> æ‰€åœ¨çš„è®¾å¤‡ã€‚<br><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>device<span class="token punctuation">)</span> <span class="token comment"># device(type='cuda', index=0)</span></code></pre><br>å¯ä»¥ç›´æ¥åœ¨åˆ›å»ºçš„æ—¶å€™å°±æŒ‡å®šè®¾å¤‡ã€‚<br><pre class="language-python" data-language="python"><code class="language-python">device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token punctuation">)</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">)</span><span class="token comment"># or</span>x <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment"># tensor([1, 2, 3], device='cuda:0')</span></code></pre><br>å¦‚æœå¯¹åœ¨ GPU ä¸Šçš„æ•°æ®è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆç»“æœè¿˜æ˜¯å­˜æ”¾åœ¨ GPU ä¸Šã€‚<br><pre class="language-python" data-language="python"><code class="language-python">y <span class="token operator">=</span> x<span class="token operator">**</span><span class="token number">2</span><span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment"># tensor([1, 4, 9], device='cuda:0')</span></code></pre><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å­˜å‚¨åœ¨ä¸åŒä½ç½®ä¸­çš„æ•°æ®æ˜¯ä¸å¯ä»¥ç›´æ¥è¿›è¡Œè®¡ç®—çš„</strong>ã€‚å³å­˜æ”¾åœ¨ CPU ä¸Šçš„æ•°æ®ä¸å¯ä»¥ç›´æ¥ä¸å­˜æ”¾åœ¨ GPU ä¸Šçš„æ•°æ®è¿›è¡Œè¿ç®—ï¼Œä½äºä¸åŒ GPU ä¸Šçš„æ•°æ®ä¹Ÿæ˜¯ä¸èƒ½ç›´æ¥è¿›è¡Œè®¡ç®—çš„ã€‚</p><ul><li><strong>æ¨¡å‹çš„ GPU è®¡ç®—</strong></li></ul><p>åŒ <code>Tensor</code> ç±»ä¼¼ï¼ŒPyTorch æ¨¡å‹ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼è½¬ç§»åˆ° GPU ä¸Šã€‚</p><ul><li><code>.cuda(i)</code></li><li><code>.cpu()</code></li><li><code>.to(device)</code></li></ul><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ£€æŸ¥æ¨¡å‹çš„å‚æ•°çš„ <code>device</code> å±æ€§æ¥æŸ¥çœ‹å­˜æ”¾æ¨¡å‹çš„è®¾å¤‡ã€‚</p><p>åŒæ ·çš„ï¼Œéœ€è¦ä¿è¯æ¨¡å‹è¾“å…¥çš„ <code>Tensor</code> å’Œæ¨¡å‹éƒ½åœ¨åŒä¸€è®¾å¤‡ä¸Šï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/cover.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹åŸä¹¦åœ°å€ï¼š&lt;a href=&quot;https://github.com/d2l-ai/d2l-zh&quot;&gt;https://github.com/d2l-ai/d2l-zh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹(Pytorch ver.)ï¼š&lt;a href=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/#/&quot;&gt;https://tangshusen.me/Dive-into-DL-PyTorch/#/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çŸ¥è¯†æ¶æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tangshusen.me/Dive-into-DL-PyTorch/img/book-org.svg&quot; alt=&quot;å°é¢&quot;&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨é˜…è¯»è¿‡ç¨‹ä¸­åšä¸€äº›æ‘˜å½•ã€‚å¯¹äºã€Œæœºå™¨å­¦ä¹ ã€é¢†åŸŸï¼Œ c7w è™½ç„¶æ›¾å°è¯•ä»å„ä¸ªé¢†åŸŸå…¥é—¨ï¼Œä¹Ÿå°è¯•è®­è¿‡ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯ç¼ºå°‘ç³»ç»Ÿæ€§ã€ç»“æ„æ€§çš„å­¦ä¹ ã€‚å¸Œæœ›é˜…è¯»æœ¬ä¹¦èƒ½å¸¦æ¥æ›´å¤šçš„æ”¶è·å§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å‰é¢çš„ä¸€äº›ç¬”è®°ç›¸æ¯”ï¼Œæœ¬æ–‡æ›´åŠ ä¾§é‡äºã€Œå®è·µã€ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡å®åœ°æå‡è‡ªå·±çš„ä»£ç èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Part A åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Â§ 1 æ·±åº¦å­¦ä¹ ç®€ä»‹&lt;/li&gt;
&lt;li&gt;Â§ 2 é¢„å¤‡çŸ¥è¯†ï¼šPytorch&lt;/li&gt;
&lt;li&gt;Â§ 3 æ·±åº¦å­¦ä¹ åŸºç¡€&lt;ul&gt;
&lt;li&gt;çº¿æ€§å›å½’ï¼ŒSoftmax å›å½’ï¼Œå¤šå±‚æ„ŸçŸ¥æœºä¸‰ç±»åŸºæœ¬æ¨¡å‹&lt;/li&gt;
&lt;li&gt;æƒé‡è¡°å‡å’Œ Dropout ä¸¤ç±»åº”å¯¹è¿‡æ‹Ÿåˆçš„æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Â§ 4 æ·±åº¦å­¦ä¹ è®¡ç®—&lt;ul&gt;
&lt;li&gt;æ„é€  Pytorch æ¨¡å‹çš„æ–¹å¼&lt;/li&gt;
&lt;li&gt;æ¨¡å‹å‚æ•°çš„è®¿é—®ã€åˆå§‹åŒ–ä¸å…±äº«&lt;/li&gt;
&lt;li&gt;è‡ªå®šä¹‰ Layer&lt;/li&gt;
&lt;li&gt;è¯»å–ä¸å­˜å‚¨&lt;/li&gt;
&lt;li&gt;GPU è®¡ç®—&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="æœºå™¨å­¦ä¹ " scheme="https://www.c7w.tech/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>GAMES101 PA æŠ¥å‘Šå…¼è¯¾ç¨‹é‡ç‚¹ç®—æ³•å›é¡¾</title>
    <link href="https://www.c7w.tech/games101-pa/"/>
    <id>https://www.c7w.tech/games101-pa/</id>
    <published>2022-01-18T13:19:54.000Z</published>
    <updated>2022-01-29T15:20:05.858Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2022/01/28/hIQTsycbV6xeojp.png" alt="output-4"></p><p><img src="https://s2.loli.net/2022/01/29/GZtErdMFQcBfN8P.png" alt="7-256"></p><p>GAMES101 2020-Spring å¯¹åº”çš„ 8 æ¬¡ PA æ•´ç†ã€‚</p><p>ä»“åº“åœ°å€ï¼š<a href="https://github.com/c7w/GAMES101-HW-2020-Spring">https://github.com/c7w/GAMES101-HW-2020-Spring</a></p><p><em>ã€€ã€€Warning: FYI, these codes may be ugly and buggy.</em></p><a id="more"></a><h2 id="PA1"><a href="#PA1" class="headerlink" title="PA1"></a>PA1</h2><blockquote><p>æœ¬æ¬¡ä½œä¸šçš„ä»»åŠ¡æ˜¯å¡«å†™ä¸€ä¸ª<strong>æ—‹è½¬çŸ©é˜µ</strong>å’Œä¸€ä¸ª<strong>é€è§†æŠ•å½±çŸ©é˜µ</strong>ã€‚</p><p>ç»™å®šä¸‰ç»´ä¸‹ä¸‰ä¸ªç‚¹ $v_0(2.0, 0.0, âˆ’2.0), v_1(0.0, 2.0, âˆ’2.0), v_2(âˆ’2.0, 0.0, âˆ’2.0)$â€‹ï¼Œä½ éœ€è¦å°†è¿™ä¸‰ä¸ªç‚¹çš„åæ ‡å˜æ¢ä¸ºå±å¹•åæ ‡å¹¶åœ¨å±å¹•ä¸Šç»˜åˆ¶å‡ºå¯¹åº”çš„çº¿æ¡†ä¸‰è§’å½¢ (åœ¨ä»£ç æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬å·²ç»æä¾›äº† draw_triangle å‡½æ•°ï¼Œæ‰€ä»¥ä½ åªéœ€è¦å»æ„å»ºå˜æ¢çŸ©é˜µå³å¯)ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ¨¡å‹ã€è§†å›¾ã€æŠ•å½±ã€è§†å£ç­‰å˜æ¢æ¥å°†ä¸‰è§’å½¢æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚åœ¨æä¾›çš„ä»£ç æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬ç•™ä¸‹äº†æ¨¡å‹å˜æ¢å’ŒæŠ•å½±å˜æ¢çš„éƒ¨åˆ†ç»™ä½ å»å®Œæˆã€‚</p></blockquote><h3 id="ç®—æ³•å›é¡¾"><a href="#ç®—æ³•å›é¡¾" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><p>æ‹ç…§çš„ç¬¬ä¸€æ­¥æ˜¯æ¨¡å‹å˜æ¢ï¼Œä¹Ÿå°±æ˜¯æŠŠæ¨¡å‹æ”¾åœ¨åˆé€‚çš„ä½ç½®ä¸Šã€‚ç¬¬äºŒæ­¥æ˜¯æ‰¾å¥½è§’åº¦æ”¾ç›¸æœºï¼ˆView Transformationï¼‰ï¼Œä¹Ÿå°±æ˜¯è§†å›¾å˜æ¢ã€‚ç¬¬ä¸‰æ­¥æ˜¯åšæŠ•å½±å˜æ¢ï¼Œå°†ç…§ç‰‡å®šæ ¼ã€‚</p><ul><li>è§†å›¾å˜æ¢ï¼šå®šä¹‰ $M_{view}$ å˜æ¢ç›¸æœºï¼Œä½¿å¾—ç»è¿‡è¯¥å˜æ¢æ»¡è¶³ $\vec e = \vec 0, \hat g = -\hat z, \hat t = \hat y $ï¼Œå…¶ä¸­ï¼š$\vec e$ ä¸ºç›¸æœºæ‰€åœ¨ä½ç½®ï¼Œ $\hat g$ ä¸ºç›¸æœºçœ‹çš„æ–¹å‘ï¼Œ$\hat t$ ä¸ºç›¸æœºçš„å‘ä¸Šæ–¹å‘ã€‚</li></ul><script type="math/tex; mode=display">M_{view} = R_{view}T_{view} \ (**)\\T_{view} = \begin{bmatrix} 1&0&0&-x_e\\0&1&0&-y_e\\0&0&1&-z_e\\0&0&0&1\end{bmatrix}\\R_{view}^{-1} = \begin{bmatrix} x_{\hat g \times \hat t}&x_{\hat t}&x_{-\hat g}&0\\y_{\hat g \times \hat t}&y_{\hat t}&y_{-\hat g}&0\\z_{\hat g \times \hat t}&z_{\hat t}&z_{-\hat g}&0\\0&0&0&1\end{bmatrix}\\R_{view} = (R_{view}^{-1})^T =\begin{bmatrix} x_{\hat g \times \hat t}&y_{\hat g \times \hat t}&z_{\hat g \times \hat t}&0\\x_{\hat t}&y_{\hat t}&z_{\hat t}&0\\x_{-\hat g}&y_{-\hat g}&z_{-\hat g}&0\\0&0&0&1\end{bmatrix}\\</script><p>æˆ‘ä»¬è¦åšçš„ï¼Œæ˜¯æŠŠæ‰€æœ‰ç‰©ä½“éƒ½åº”ç”¨è¿™ä¸ªå˜æ¢ï¼Œä¿è¯ç›¸æœºä¸ç‰©ä½“çš„ç›¸å¯¹ä½ç½®ä¸å˜ã€‚</p><ul><li>æŠ•å½±å˜æ¢</li></ul><p><strong>é¦–å…ˆå°†æ‘„åƒæœºçš„è§†é”¥å‹æˆæ­£æ–¹ä½“ $M_{persp\rightarrow ortho}$â€‹ï¼Œç„¶åè¿›è¡Œæ­£äº¤æŠ•å½± $M_{ortho}$â€‹â€‹ã€‚</strong></p><p>è¿™é‡Œæˆ‘ä»¬ç•¥å»é€è§†æŠ•å½±çŸ©é˜µçš„æ¨å¯¼ï¼Œç›´æ¥ç»™å‡ºé€è§†æŠ•å½±è½¬æ¢ä¸ºæ­£äº¤æŠ•å½±çŸ©é˜µçš„è¡¨ç¤ºå½¢å¼ã€‚å…·ä½“çš„æ¨å¯¼å¯ä»¥é€šè¿‡è€ƒè™‘ä»¥ä¸‹ç‰¹æ®Šç‚¹ï¼Œä»£å…¥ç‰¹æ®Šå€¼æ¥å†³å®šçŸ©é˜µçš„å…ƒç´ ã€‚</p><ul><li>è¿‘å¹³é¢çš„åæ ‡ä¸æ”¹å˜</li><li>è¿œå¹³é¢çš„ $x,y$ åæ ‡è¢«å‹ç¼©è‡³ä¸è¿‘å¹³é¢ç›¸åŒ</li><li>è¿‘å¹³é¢ä¸­å¿ƒç‚¹ä¸è¿œå¹³é¢ä¸­å¿ƒç‚¹çš„ä½ç½®ä¸å˜</li></ul><script type="math/tex; mode=display">M_{persp\rightarrow ortho} = \begin{bmatrix}n & 0 & 0 & 0 \\0 & n & 0 & 0 \\0 & 0 & n+f & -nf \\0 & 0 & 1 & 0\end{bmatrix} \\\\</script><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æˆ‘ä»¬å¹³å¸¸çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨ $l, r, b,t$ æ¥æè¿°ä¸€ä¸ªè¿‘å¹³é¢çš„ä½ç½®ï¼Œè€Œæ˜¯æ›´å€¾å‘äºä½¿ç”¨ $fovY$â€‹(<strong>field-of-view</strong>, å‚ç›´è§†è§’) å’Œ <strong>aspect ratio</strong> è¿™ä¸¤ä¸ªé‡æ¥æè¿°ä¸€ä¸ªè¿‘å¹³é¢ã€‚</p><p>ä½¿ç”¨è¿™ä¸¤ä¸ªé‡æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è®¡ç®—å‡º $l,r,b,t$ å››ä¸ªè¿‘å¹³é¢å‚æ•°ã€‚</p><p><img src="https://i.loli.net/2021/11/06/NZbxWisdEH78plf.png" alt="image-20211106214646265"></p><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨æ­£äº¤æŠ•å½±æ˜ å°„åˆ° $[-1, 1]^3$ã€‚</p><script type="math/tex; mode=display">M_{\text {ortho }}=\left[\begin{array}{cccc}\frac{2}{r-l} & 0 & 0 & 0 \\0 & \frac{2}{t-b} & 0 & 0 \\0 & 0 & \frac{2}{n-f} & 0 \\0 & 0 & 0 & 1\end{array}\right]\left[\begin{array}{cccc}1 & 0 & 0 & -\frac{r+l}{2} \\0 & 1 & 0 & -\frac{t+b}{2} \\0 & 0 & 1 & -\frac{n+f}{2} \\0 & 0 & 0 & 1\end{array}\right]</script><h3 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p><img src="https://s2.loli.net/2022/01/28/ftcK5nhEdYaGwPp.png" alt="1"></p><h2 id="PA2"><a href="#PA2" class="headerlink" title="PA2"></a>PA2</h2><blockquote><p>ä»»åŠ¡å¦‚ä¸‹ï¼š</p><ul><li><code>rasterize_triangle()</code>: æ‰§è¡Œä¸‰è§’å½¢æ …æ ¼åŒ–ç®—æ³•</li><li><code>static bool insideTriangle()</code>: æµ‹è¯•ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…</li><li>æ­£ç¡®å®ç°æ·±åº¦ç¼“å†²ç®—æ³•</li><li>Super-sampling</li></ul></blockquote><h3 id="ç®—æ³•å›é¡¾-1"><a href="#ç®—æ³•å›é¡¾-1" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><ul><li>æ£€æµ‹ç‚¹åœ¨ä¸‰è§’å½¢å†…</li></ul><p>æˆ‘ä»¬è€ƒè™‘å¦‚ä¸‹çš„ä¸‰ä¸ªå‰ç§¯ã€‚$\overrightarrow {P_0P_1} \times \overrightarrow {P_0Q}$, $\overrightarrow {P_1P_2} \times \overrightarrow {P_1Q}$, $\overrightarrow {P_2P_0} \times \overrightarrow {P_2Q}$ å¦‚æœ z åæ ‡çš„ç¬¦å·ç›¸åŒï¼Œé‚£ä¹ˆç‚¹ Q å°±ä¸€å®šåœ¨ä¸‰è§’å½¢å†…ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¯¹å±å¹•çš„æ‰€æœ‰å…ƒç´ é‡‡æ ·ï¼Œé€ æˆäº†æ²¡æœ‰å¿…è¦çš„èµ„æºæµªè´¹ã€‚æˆ‘ä»¬ä½¿ç”¨<strong>åŒ…å›´ç›’</strong>ï¼ˆBounding Boxï¼‰çš„æ¦‚å¿µï¼Œå–ä¸‰è§’å½¢è¾¹ç•Œç‚¹çš„ x, y åæ ‡åˆ†åˆ«çš„æœ€å°å€¼æˆ–æœ€å¤§å€¼ï¼Œä½œä¸ºåŒ…å›´ç›’ x, y åæ ‡çš„æœ€å°å€¼ä¸æœ€å¤§å€¼ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½å¾—åˆ°ä¸€å¼ å¸¦é”¯é½¿çš„å›¾åƒäº†ã€‚</p><ul><li>Super-sampling</li></ul><p>è€Œåœ¨æˆ‘ä»¬å…·ä½“è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€‰æ‹© Supersampling çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å°†æŸä¸ªåƒç´ åˆ†ä¸º $N\times N$â€‹ ä¸ªé‡‡æ ·ç‚¹ï¼Œç„¶åå¯¹è¿™äº›é‡‡æ ·ç‚¹çš„åƒç´ å€¼å–å¹³å‡ã€‚</p><ul><li>æ·±åº¦ç¼“å†²</li></ul><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå›¾å½¢å­¦å¼•å…¥äº†æ·±åº¦ç¼“å­˜çš„æ¦‚å¿µã€‚æƒ³æ³•å°±æ˜¯å¯¹å±å¹•çš„æ‰€æœ‰åƒç´ é¢å¤–è®°å½•å…¶å½“å‰æ˜¾ç¤ºç‰©ä½“çš„æœ€æµ…æ·±åº¦ï¼ˆæ·±åº¦å–æ­£å€¼ï¼Œè¡¨ç¤ºè·ç¦»ç›¸æœºçš„è¿œè¿‘ï¼‰ã€‚è¿™æ ·ç±»ä¼¼äºåŠ¨æ€è§„åˆ’çš„ç®—æ³•æœ€ç»ˆå¤æ‚åº¦æ˜¯ $O(n)$ çš„ã€‚è€Œä¸”å¦‚æœæˆ‘ä»¬å‡è®¾åœ¨åŒä¸€æ·±åº¦å¤„ä¸ä¼šå‡ºç°ä¸¤ä¸ªæ¨¡å‹ï¼Œé‚£ä¹ˆä¸åŒæ¨¡å‹çš„ç€è‰²é¡ºåºå¯¹ç»“æœæ˜¯æ²¡æœ‰å½±å“çš„ã€‚</p><p><img src="https://i.loli.net/2021/11/10/vkn5R7zfhoNZTjC.png" alt="image-20211110140334554"></p><h3 id="å®éªŒç»“æœ-1"><a href="#å®éªŒç»“æœ-1" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p><img src="https://s2.loli.net/2022/01/28/ma6wt8dVnjGMTq4.png" alt="2-1"></p><p><img src="https://s2.loli.net/2022/01/28/GDWpa1w9JLNsXz6.png" alt="2-2"></p><h2 id="PA3"><a href="#PA3" class="headerlink" title="PA3"></a>PA3</h2><blockquote><p>ä»»åŠ¡ï¼š</p><ul><li>å‚æ•°æ’å€¼</li><li>Blinn-Phong æ¨¡å‹</li><li>Texture Mapping</li><li>Bump Mapping &amp; Displacement Mapping</li><li>å°è¯•æ›´å¤šæ¨¡å‹</li><li>åŒçº¿æ€§æ’å€¼</li></ul></blockquote><h3 id="ç®—æ³•å›é¡¾-2"><a href="#ç®—æ³•å›é¡¾-2" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><ul><li>é‡å¿ƒåæ ‡æ’å€¼</li></ul><p>å½“æˆ‘ä»¬çŸ¥é“äº†ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹çš„å±æ€§çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°åœ¨ä¸‰è§’å½¢å†…éƒ¨å±æ€§çš„å¹³æ»‘è¿‡æ¸¡ï¼Œå°±è¦å¼•å…¥é‡å¿ƒåæ ‡çš„æ¦‚å¿µã€‚å¯¹äºä¸€ä¸ªä¸‰è§’å½¢ ABC æ¥è¯´ï¼Œå…¶ä¸­ $(x,y) = \alpha A + \beta B + \gamma C$ï¼Œè‹¥ $\alpha + \beta + \gamma = 1$ï¼Œåˆ™ç§° $(\alpha, \beta, \gamma)$ ä¸ºè¯¥ä¸‰è§’å½¢å†…çš„ $(x,y)$ ç‚¹çš„é‡å¿ƒåæ ‡ï¼Œå…¶ä¸­ $\alpha, \beta, \gamma \ge 0$ã€‚</p><p><img src="https://i.loli.net/2021/11/11/U4jEISXchwARgZV.png" alt="image-20211111231732485"></p><ul><li>BP</li></ul><script type="math/tex; mode=display">\begin{aligned}L &=L_{a}+L_{d}+L_{s} \\&=k_{a} I_{a}+k_{d}\left(I / r^{2}\right) \max (0, \mathbf{n} \cdot \mathbf{l})+k_{s}\left(I / r^{2}\right) \max (0, \mathbf{n} \cdot \mathbf{h})^{p}\end{aligned}</script><h3 id="å®éªŒç»“æœ-2"><a href="#å®éªŒç»“æœ-2" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><ul><li>Normal</li></ul><p><img src="https://s2.loli.net/2022/01/28/K8ISoYs59h2wdPg.png" alt="output-2"></p><ul><li>BP</li></ul><p><img src="https://s2.loli.net/2022/01/28/oVBEDL2NuwRpkGO.png" alt="output-3"></p><ul><li>Texture</li></ul><p><img src="https://s2.loli.net/2022/01/28/hIQTsycbV6xeojp.png" alt="output-4"></p><ul><li>Bump Mapping &amp; Displacement Mapping</li></ul><p><img src="https://s2.loli.net/2022/01/28/HJiSMxQa4udzjPF.png" alt="output-5"></p><p><img src="https://s2.loli.net/2022/01/28/vXV89tQPTSUpDeA.png" alt="output-6"></p><ul><li>Bunny</li></ul><p><img src="https://s2.loli.net/2022/01/28/ERkHN7PlVSQF4qm.png" alt="bunny"></p><ul><li>åŒçº¿æ€§æ’å€¼å‰/å (Shrink texture.png by 50%)</li></ul><p><img src="https://s2.loli.net/2022/01/28/fm9AjRGu2rngCLw.png" alt="output-small"></p><p><img src="https://s2.loli.net/2022/01/28/I5jeWBENHgndFtC.png" alt="output-small2"></p><h3 id="å®éªŒæ¡†æ¶"><a href="#å®éªŒæ¡†æ¶" class="headerlink" title="å®éªŒæ¡†æ¶"></a>å®éªŒæ¡†æ¶</h3><ul><li><code>main.cpp</code><ul><li><code>Eigen::Matrix4f get_view_matrix(Eigen::Vector3f eye_pos)</code></li><li><code>Eigen::Matrix4f get_model_matrix(float angle)</code></li><li><code>Eigen::Matrix4f get_projection_matrix(float eye_fov, float aspect_ratio, float zNear, float zFar)</code></li><li><code>struct Light &#123;Eigen::Vector3f position; Eigen::Vector3f intensity;&#125;;</code></li><li>Shaders<ul><li><code>Eigen::Vector3f texture_fragment_shader(const fragment_shader_payload&amp; payload)</code></li><li><code>Eigen::Vector3f phong_fragment_shader(const fragment_shader_payload&amp; payload)</code><ul><li>å®šä¹‰ $k_d, k_s, k_a, lights, amb_light, eye_pos$â€‹</li><li>è¿”å› $result_color * 255.0$</li></ul></li><li><code>Eigen::Vector3f displacement_fragment_shader(const fragment_shader_payload&amp; payload)</code></li><li><code>Eigen::Vector3f bump_fragment_shader(const fragment_shader_payload&amp; payload)</code></li></ul></li><li><code>int main()</code><ul><li>è¯»å–æ¨¡å‹ï¼Œç„¶åå°†æ¨¡å‹ä¸­çš„å„ä¸ªé¢å»ºç«‹ Triangle å¯¹è±¡</li><li>å»ºç«‹ Rasterizer ç±»å¯¹è±¡ï¼Œè®¾ç½®æè´¨</li><li>è°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œç„¶åä½¿ç”¨ OpenCV åº“ä¿å­˜æ¸²æŸ“ç»“æœ</li></ul></li></ul></li><li><code>OBJ_Loader.h</code>ï¼šåŠ è½½æ¨¡å‹ç”¨</li><li><p><code>Rasterizer.hpp/Rasterizer.cpp</code></p><ul><li>å…¶ä¸­çš„ rasterizer å­ç±»å†…åŒ…æ‹¬äº†ä¸€äº›å¿…å¤‡çš„ç»“æ„å’Œå‡½æ•°</li><li><code>std::vector&lt;Eigen::Vector3f&gt; frame_buf;</code></li><li><code>std::vector&lt;float&gt; depth_buf;</code></li></ul></li><li><p><code>Texture.hpp/Texture.cpp</code></p><ul><li><code>cv::Mat image_data;</code> // Raw data</li><li><code>int width, height;</code></li><li><code>Vector3f getColor(float u, float v);</code></li></ul></li><li><code>Triangle.hpp/Triangle.cpp</code><ul><li><code>Vector4f v[3];</code> // Original coordinates of the triangle</li><li><code>Vector3f color[3]; Vector2f tex_coords[3]; Vector3f normal[3];</code> // Color, texture_coord, normal vector for each vertex</li></ul></li></ul><h2 id="PA4"><a href="#PA4" class="headerlink" title="PA4"></a>PA4</h2><blockquote><p>ä½¿ç”¨ <strong>De Casteljau ç®—æ³•</strong> ç”Ÿæˆè´å¡å°”æ›²çº¿ã€‚</p></blockquote><h3 id="ç®—æ³•å›é¡¾-3"><a href="#ç®—æ³•å›é¡¾-3" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><p>ï¼ˆ1ï¼‰å…ˆè€ƒè™‘ä¸‰ä¸ªæ§åˆ¶ç‚¹ï¼Œç”ŸæˆäºŒæ¬¡è´å¡å°”æ›²çº¿ã€‚</p><p><img src="https://i.loli.net/2021/12/01/fE6FrtaL2sDQIGT.png" alt="image-20211201194418429"></p><p>ï¼ˆ2ï¼‰å†è€ƒè™‘å››ä¸ªæ§åˆ¶ç‚¹ï¼Œç”Ÿæˆä¸‰æ¬¡è´å¡å°”æ›²çº¿ã€‚</p><p><img src="https://i.loli.net/2021/12/01/wR7VDnSPCrLxkKY.png" alt="image-20211201194528603"></p><p>(3) ä»£æ•°å½¢å¼ï¼šæ’å€¼ï¼</p><p><img src="https://i.loli.net/2021/12/01/pmW5vVa61urdbxI.png" alt="image-20211201194639946"></p><p>ç»™å®š $n+1$ ä¸ªæ§åˆ¶ç‚¹ï¼Œæœ‰è´å¡å°”æ›²çº¿å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">b^n(t) = b^n_0(t) = \sum_{j=0}^nb_jB_j^n(t) \\B_{i}^{n}(t)=\left(\begin{array}{l}n\\i\end{array}\right) t^{i}(1-t)^{n-i}</script><h3 id="å®éªŒç»“æœ-3"><a href="#å®éªŒç»“æœ-3" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p><img src="https://s2.loli.net/2022/01/29/kHpBU6wfgcvxi7W.png" alt="4"></p><h2 id="PA5"><a href="#PA5" class="headerlink" title="PA5"></a>PA5</h2><blockquote><p>åœ¨å…‰çº¿è¿½è¸ªä¸­ï¼Œæœ€é‡è¦çš„æ“ä½œä¹‹ä¸€å°±æ˜¯æ‰¾åˆ°å…‰çº¿ä¸ç‰©ä½“çš„äº¤ç‚¹ã€‚</p><p>ä¸€æ—¦æ‰¾åˆ°å…‰çº¿ä¸ç‰©ä½“çš„äº¤ç‚¹ï¼Œå°±å¯ä»¥æ‰§è¡Œç€è‰²å¹¶è¿”å›åƒç´ é¢œè‰²ã€‚</p><p>åœ¨è¿™æ¬¡ä½œä¸šä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸¤ä¸ªéƒ¨åˆ†ï¼šå…‰çº¿çš„ç”Ÿæˆå’Œå…‰çº¿ä¸ä¸‰è§’çš„ç›¸äº¤ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ï¼š</p><ul><li><code>Renderer.cpp</code> ä¸­çš„ <code>Render()</code>ï¼šè¿™é‡Œä½ éœ€è¦ä¸ºæ¯ä¸ªåƒç´ ç”Ÿæˆä¸€æ¡å¯¹åº”çš„å…‰çº¿ï¼Œç„¶åè°ƒç”¨å‡½æ•° <code>castRay()</code> æ¥å¾—åˆ°é¢œè‰²ï¼Œæœ€åå°†é¢œè‰²å­˜å‚¨åœ¨å¸§ç¼“å†²åŒºçš„ç›¸åº”åƒç´ ä¸­ã€‚</li><li><code>Triangle.hpp</code> ä¸­çš„ <code>rayTriangleIntersect()</code>: v0, v1, v2 æ˜¯ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼Œorig æ˜¯å…‰çº¿çš„èµ·ç‚¹ï¼Œdir æ˜¯å…‰çº¿å•ä½åŒ–çš„æ–¹å‘å‘é‡ã€‚tnear, u, v æ˜¯ä½ éœ€è¦ä½¿ç”¨æˆ‘ä»¬è¯¾ä¸Šæ¨å¯¼çš„ Moller-Trumbore ç®—æ³•æ¥æ›´æ–°çš„å‚æ•°ã€‚</li></ul></blockquote><h3 id="ç®—æ³•å›é¡¾-4"><a href="#ç®—æ³•å›é¡¾-4" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><ul><li>Whitted-style Ray Tracing</li></ul><p><img src="https://s2.loli.net/2022/01/14/T1xAeVvrhOoGJK4.png" alt="image-20220114155905503"></p><ul><li>MÃ¶ller Trumbore ç®—æ³•</li></ul><p>MÃ¶ller Trumbore ç®—æ³•ï¼Œå¯ä»¥ç›´æ¥åˆ¤æ–­äº¤ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…ï¼ˆéœ€è¦ç”¨åˆ°å…‹è±å§†æ³•åˆ™ï¼‰ï¼š</p><script type="math/tex; mode=display">\begin{gathered}\overrightarrow{\mathbf{O}}+t \overrightarrow{\mathbf{D}}=\left(1-b_{1}-b_{2}\right) \overrightarrow{\mathbf{P}}_{0}+b_{1} \overrightarrow{\mathbf{P}}_{1}+b_{2} \overrightarrow{\mathbf{P}}_{2} \\\text { Where: } \\{\left[\begin{array}{c}t \\b_{1} \\b_{2}\end{array}\right]=\frac{1}{\overrightarrow{\mathbf{S}}_{1} \bullet \overrightarrow{\mathbf{E}}_{1}}\left[\begin{array}{cc}\overrightarrow{\mathbf{S}}_{2} \cdot \overrightarrow{\mathbf{E}}_{2} \\\overrightarrow{\mathbf{S}}_{1} \cdot \overrightarrow{\mathbf{S}} \\\overrightarrow{\mathbf{S}}_{2} \cdot \overrightarrow{\mathbf{D}}\end{array}\right]} \\\text { Cost = (1 div, 27 mul, 17 add) } \\\overrightarrow{\mathbf{E}}_{1}=\overrightarrow{\mathbf{P}}_{1}-\overrightarrow{\mathbf{P}}_{0} \\\overrightarrow{\mathbf{E}}_{2}=\overrightarrow{\mathbf{P}}_{2}-\overrightarrow{\mathbf{P}}_{0} \\\overrightarrow{\mathbf{S}}=\overrightarrow{\mathbf{O}}-\overrightarrow{\mathbf{P}}_{0} \\\overrightarrow{\mathbf{S}}_{1}=\overrightarrow{\mathbf{D}} \times \overrightarrow{\mathbf{E}}_{2} \\\overrightarrow{\mathbf{S}}_{2}=\overrightarrow{\mathbf{S}} \times \overrightarrow{\mathbf{E}}_{1}\end{gathered}</script><h3 id="å®éªŒç»“æœ-4"><a href="#å®éªŒç»“æœ-4" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p><img src="https://s2.loli.net/2022/01/29/ZeSLqlF65o7vfD8.png" alt="5"></p><h2 id="PA6"><a href="#PA6" class="headerlink" title="PA6"></a>PA6</h2><blockquote><p>åœ¨ä¹‹å‰çš„ç¼–ç¨‹ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†åŸºç¡€çš„å…‰çº¿è¿½è¸ªç®—æ³•ï¼Œå…·ä½“è€Œè¨€æ˜¯å…‰çº¿ä¼ è¾“ã€å…‰çº¿ä¸ä¸‰è§’å½¢æ±‚äº¤ã€‚</p><p>æˆ‘ä»¬é‡‡ç”¨äº†è¿™æ ·çš„æ–¹æ³•å¯»æ‰¾å…‰çº¿ä¸åœºæ™¯çš„äº¤ç‚¹ï¼š<strong>éå†åœºæ™¯ä¸­çš„æ‰€æœ‰ç‰©ä½“ï¼Œåˆ¤æ–­å…‰çº¿æ˜¯å¦ä¸å®ƒç›¸äº¤ã€‚</strong></p><p>åœ¨åœºæ™¯ä¸­çš„ç‰©ä½“æ•°é‡ä¸å¤§æ—¶ï¼Œè¯¥åšæ³•å¯ä»¥å–å¾—è‰¯å¥½çš„ç»“æœï¼Œä½†å½“ç‰©ä½“æ•°é‡å¢å¤šã€æ¨¡å‹å˜å¾—æ›´åŠ å¤æ‚ï¼Œè¯¥åšæ³•å°†ä¼šå˜å¾—éå¸¸ä½æ•ˆã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åŠ é€Ÿç»“æ„æ¥åŠ é€Ÿæ±‚äº¤è¿‡ç¨‹ã€‚</p><p>åœ¨æœ¬æ¬¡ç»ƒä¹ ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ï¼š<strong>ç‰©ä½“åˆ’åˆ†ç®—æ³• Bounding Volume Hierarchy (BVH)</strong>ã€‚</p><p>æœ¬ç»ƒä¹ è¦æ±‚ä½ å®ç° Ray-Bounding Volume æ±‚äº¤ä¸ BVH æŸ¥æ‰¾ï¼Œé™„åŠ å†…å®¹ä¸ºä½¿ç”¨ <strong>SAH åŠ é€Ÿ</strong>ç®—æ³•å¯¹ BVH æŸ¥æ‰¾è¿›è¡Œæ”¹è¿›ã€‚</p></blockquote><h3 id="ç®—æ³•å›é¡¾-5"><a href="#ç®—æ³•å›é¡¾-5" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><h4 id="åŒ…å›´ç›’æ±‚äº¤"><a href="#åŒ…å›´ç›’æ±‚äº¤" class="headerlink" title="åŒ…å›´ç›’æ±‚äº¤"></a>åŒ…å›´ç›’æ±‚äº¤</h4><p>æˆ‘ä»¬å°†ï¼ˆåŒ…å›´ç›’ï¼‰é•¿æ–¹ä½“ç†è§£æˆä¸‰ä¸ªå¯¹é¢æ‰€åˆ†åˆ’å‡ºçš„ç©ºé—´çš„äº¤é›†ã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„åŒ…å›´ä½“ç§¯ä¾¿æ˜¯é•¿æ–¹ä½“ï¼Œä¸”é•¿æ–¹ä½“æ˜¯ä¸åæ ‡è½´å¹³è¡Œçš„ï¼Œå³è½´å¯¹é½åŒ…å›´ç›’ï¼ˆAABBï¼‰ã€‚é€‰ç”¨ AABB å¼åŒ…å›´ç›’æœ‰åˆ©äºåŠ é€Ÿè®¡ç®—ã€‚åˆ¤æ–­å…‰çº¿å’Œ AABB ç±»åŒ…å›´ç›’çš„æ±‚äº¤æ–¹æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/01/14/5rMlAnIw3gQBVNL.png" alt="image-20220114163501816"></p><p>æ ¸å¿ƒæ€æƒ³ï¼šåªæœ‰å½“å…‰çº¿è¿›å…¥æ‰€æœ‰ä¸‰ä¸ªå¯¹é¢åï¼Œå…‰çº¿æ‰è¿›å…¥äº†åŒ…å›´ç›’ï¼›è‹¥å…‰çº¿ä»æŸä¸€ä¸ªå¯¹é¢å‡ºå°„ï¼Œåˆ™å…‰çº¿ä¾¿ä»åŒ…å›´ç›’ä¸­å°„å‡ºã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥è®¡ç®—ä¸‰ä¸ªå¯¹é¢åˆ†åˆ«å¯¹åº”çš„ $t_{min}$â€‹â€‹ å’Œ $t_{max}$â€‹â€‹ï¼Œç„¶åå¯¹å…¶æ±‚äº¤ã€‚å½“ä¸”ä»…å½“ $t_{enter} \lt t_{exit}$â€‹â€‹ ä¸” $t_{exit} \ge 0$â€‹â€‹ï¼Œå…‰çº¿æ‰å¯èƒ½ä¸åŒ…å›´ç›’æœ‰äº¤ç‚¹ã€‚</p><h4 id="BVH"><a href="#BVH" class="headerlink" title="BVH"></a>BVH</h4><p>é€šè¿‡å¯¹å«æœ‰ç‰©ä½“çš„å‘é‡æ²¿è½´åˆ’åˆ†å»ºç«‹äºŒå‰æ ‘ï¼Œå¹¶ä¸”å¯¹äºäºŒå‰æ ‘çš„æ¯ä¸€ä¸ªç»“ç‚¹å»ºç«‹å…¶åŒ…å›´ç›’ã€‚</p><p><img src="https://s2.loli.net/2022/01/16/zbLpGw5E7SCgQAu.png" alt="image-20220116102930688"></p><p>å¦‚ä½•è¿›è¡Œåˆ’åˆ†ï¼Ÿ</p><ul><li>æ²¿ç€æœ€é•¿çš„ç»´åº¦æ¥åˆ’åˆ†</li><li>åˆ’åˆ†ç«¯ç‚¹å–ä¸­ä½æ•°<ul><li>å–ä¸‰è§’å½¢çš„é‡å¿ƒ</li></ul></li></ul><p><img src="https://s2.loli.net/2022/01/16/xtKaWO7lJ2Rm8Xb.png" alt="image-20220116103520101"></p><p>ä½¿ç”¨ BVH ç®—æ³•ï¼Œå³ä½¿åŒ…å›´ç›’å¯èƒ½åœ¨ç©ºé—´ä¸Šæœ‰ç›¸äº¤ï¼Œä½†æ˜¯æˆ‘ä»¬å´è§£å†³äº† kd-Tree å­˜åœ¨çš„é—®é¢˜ã€‚</p><h4 id="SAH-åŠ é€Ÿ"><a href="#SAH-åŠ é€Ÿ" class="headerlink" title="SAH åŠ é€Ÿ"></a>SAH åŠ é€Ÿ</h4><p>ï¼ˆBVHï¼‰æ„å»ºè¿‡ç¨‹ä¸­æœ€é‡è¦çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å¯¹å›¾å…ƒè¿›è¡Œåˆ’åˆ†â€¦åˆ’åˆ†æ—¶è¦<strong>å°½å¯èƒ½å‡å°‘åˆ’åˆ†åä¸¤éƒ¨åˆ†åŒ…å›´ç›’é‡å çš„ä½“ç§¯</strong>ï¼Œå› ä¸º<strong>é‡å çš„ä½“ç§¯è¶Šå¤§ï¼Œå…‰çº¿ç©¿è¿‡é‡å åŒºåŸŸçš„å¯èƒ½æ€§è¶Šå¤§ï¼Œéå†ä¸¤ä¸ªå­æ ‘çš„å¯èƒ½æ€§å°±è¶Šé«˜ï¼Œè®¡ç®—æ¶ˆè€—è¶Šå¤š</strong>ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„æ˜¯è¦å‡å°‘åˆ’åˆ†åå·¦å³å­èŠ‚ç‚¹é‡å çš„ä½“ç§¯ï¼Œå› æ­¤ä¸€èˆ¬<strong>åœ¨å›¾å…ƒè·¨åº¦æœ€å¤§çš„åæ ‡è½´ä¸Šè¿›è¡Œåˆ’åˆ†</strong>ã€‚è¿™é‡Œï¼Œå›¾å…ƒçš„è·¨åº¦å¯ä»¥ç”¨å›¾å…ƒçš„åŒ…å›´ç›’æ¥è¡¡é‡ä¹Ÿå¯ä»¥ç”¨å›¾å…ƒçš„è´¨å¿ƒæ¥è¡¡é‡ã€‚</p><p>ä¸¤ç§æœ€ç®€å•çš„åˆ’åˆ†æ–¹æ³•æ˜¯ï¼š</p><ul><li>å–åæ ‡è½´è·¨åº¦çš„ä¸­ç‚¹ $t_{\operatorname{mid}}=\frac{t_{\max }+t_{\min }}{2}$â€‹ ï¼Œè‹¥èŠ‚ç‚¹çš„åæ ‡å°äº $t_{mid}$ åˆ™å°†å…¶åˆ’åˆ†åˆ°å·¦èŠ‚ç‚¹ï¼Œå¦åˆ™å°†å…¶åˆ’åˆ†åˆ°å³èŠ‚ç‚¹ï¼ˆä¸­ç‚¹åˆ’åˆ†ï¼‰ã€‚</li><li>æœ€å·¦è¾¹çš„ $\frac n 2$â€‹ ä¸ªè¢«åˆ’åˆ†åˆ°å·¦èŠ‚ç‚¹ï¼Œå‰©ä¸‹çš„è¢«åˆ’åˆ†åˆ°å³èŠ‚ç‚¹ï¼ˆç­‰é‡åˆ’åˆ†ï¼‰ã€‚ // ä½œä¸šæ¡†æ¶ä¸­ Naive çš„åˆ’åˆ†ç”±æ­¤å®ç°</li></ul><p>ä¸€ç§æ›´ä¸ºå¸¸ç”¨ä¸”æ•ˆæœæ›´å¥½çš„æ–¹æ³•æ˜¯<strong>åŸºäºè¡¨é¢ç§¯çš„å¯å‘å¼è¯„ä¼°åˆ’åˆ†æ–¹æ³•</strong>ï¼ˆSurface Area Heuristicï¼ŒSAHï¼‰ï¼Œè¿™ç§æ–¹æ³•é€šè¿‡å¯¹æ±‚äº¤ä»£ä»·å’Œéå†ä»£ä»·è¿›è¡Œè¯„ä¼°ï¼Œç»™å‡ºäº†æ¯ä¸€ç§åˆ’åˆ†çš„ä»£ä»·ï¼ˆCostï¼‰ï¼Œè€Œæˆ‘ä»¬çš„ç›®çš„ä¾¿æ˜¯å»å¯»æ‰¾ä»£ä»·æœ€å°çš„åˆ’åˆ†ã€‚</p><p>å‡è®¾å½“å‰èŠ‚ç‚¹çš„åŒ…å›´ä½“ä¸­å­˜åœ¨ $n$â€‹ ä¸ªç‰©ä½“ï¼Œè®¾å¯¹æ¯ä¸€ä¸ªç‰©ä½“æ±‚äº¤çš„ä»£ä»·ä¸º $t(i)$â€‹â€‹ ï¼Œå¦‚æœä¸åšåˆ’åˆ†ä¾æ¬¡å¯¹å…¶æ±‚äº¤åˆ™æ€»çš„ä»£ä»·ä¸ºï¼š</p><script type="math/tex; mode=display">\sum t(i)=t(1)+t(2)+\cdots+t(n)</script><p>å¦‚æœè¿™äº›ç‰©ä½“åˆ’åˆ†ä¸º 2 ç»„ï¼Œè¿™ä¸¤ç»„ç‰©ä½“åˆ†åˆ«å¤„äºå®ƒä»¬çš„åŒ…å›´ç›’ A å’Œ B ä¸­ã€‚è®¾å…‰çº¿å‡»ä¸­å®ƒä»¬çš„æ¦‚ç‡åˆ†åˆ«ä¸º $p_A$â€‹â€‹â€‹â€‹â€‹â€‹â€‹ å’Œ $p_B$â€‹â€‹â€‹â€‹â€‹â€‹ ï¼Œéœ€è¦æ³¨æ„åŒ…å›´ç›’ A å’Œ B ä¹‹é—´å­˜åœ¨é‡å ï¼Œä¸”å®ƒä»¬å¹¶ä¸ä¸€å®šä¼šå¡«æ»¡å…¶çˆ¶èŠ‚ç‚¹çš„åŒ…å›´ä½“ï¼Œå› æ­¤ $p_A$â€‹â€‹â€‹ å’Œ $p_B$â€‹â€‹ çš„å’Œä¸ä¸€å®šä¸º1ï¼Œä¸”å®ƒä»¬çš„å’Œè¶Šå¤§è¯´æ˜ A å’Œ B çš„é‡å ç¨‹åº¦è¶Šå¤§ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œå½“å‰èŠ‚ç‚¹æ±‚äº¤çš„ä»£ä»·å¯ä»¥å†™ä¸ºï¼š</p><script type="math/tex; mode=display">c(A,B) = p_A \sum_{i \in A}t(i) + p_B \sum_{i \in B}t(i) + t_{traverse}</script><p>å…¶ä¸­ $t_{traverse}$â€‹â€‹â€‹ ä»£è¡¨éå†æ ‘çŠ¶ç»“æ„çš„ä»£ä»·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å‡è®¾å¯¹æ‰€æœ‰å›¾å…ƒçš„æ±‚äº¤ä»£ä»·æ˜¯ç›¸åŒçš„ï¼Œå¯è®¾ $t(i) \equiv 1$â€‹â€‹â€‹ï¼Œåˆéå†çš„ä»£ä»·å°äºæ±‚äº¤çš„ä»£ä»·ï¼Œå¯è®¾ $t_{traverse} = 0.125$â€‹â€‹ ã€‚è®¾åŒ…å›´ç›’Aä¸­å›¾å…ƒçš„ä¸ªæ•°ä¸º $a$â€‹ï¼ŒBä¸­å›¾å…ƒçš„ä¸ªæ•°ä¸º $b$ï¼Œåˆ™ï¼š</p><script type="math/tex; mode=display">c(A,B) = \frac {S(A)} {S(C)}a + \frac {S(B)} {S(C)}b + 0.125</script><p>SAH è€ƒè™‘åˆ°äº†å›¾å…ƒåœ¨ç©ºé—´ä¸­çš„åˆ†å¸ƒä¹Ÿè€ƒè™‘åˆ°äº†å­èŠ‚ç‚¹åŒ…å›´ä½“çš„é‡å ç¨‹åº¦ï¼Œåœ¨å®é™…åº”ç”¨ä¸­æ‹¥æœ‰å¾ˆå¥½çš„æ•ˆæœã€‚</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©ä¸€å®šçš„è¾…åŠ©ç©ºé—´ï¼Œåœ¨ $O(n)$â€‹ çš„æ—¶é—´å†…å®Œæˆè¿™ä¸ªåˆ’åˆ†è¿‡ç¨‹ã€‚è¿™é‡Œæˆ‘ä»¬<s>å·æ‡’</s>é‡‡ç”¨ä¸€ç§ $O(n \log n)$ çš„åˆ†åˆ’æ–¹å¼ï¼š</p><ul><li>å°†ç‰©ä½“æŒ‰ç…§è´¨å¿ƒé¡ºåºæ’åº. $O(n \log n)$</li><li>$\forall k$â€‹ï¼Œè®°å½• $a_i := \cup_{i \le k} \ S(i)$â€‹. $O(n)$â€‹â€‹</li><li>$\forall k$â€‹ï¼Œè®°å½• $b_i := \cup_{i \gt k} \ S(i)$â€‹. $O(n)$â€‹</li><li>$\forall k$â€‹ï¼Œè€ƒè™‘åˆ’åˆ† $[0, k] \ || \ [k+1, n)$â€‹ï¼Œè®¡ç®—å…¶ä»£ä»·å¹¶æ›´æ–°æœ€å°ä»£ä»·. $O(n)$â€‹</li></ul><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://zhuanlan.zhihu.com/p/50720158">https://zhuanlan.zhihu.com/p/50720158</a></p><h3 id="å®éªŒç»“æœ-5"><a href="#å®éªŒç»“æœ-5" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><p>é‡‡ç”¨ SAH åŠ é€Ÿå‰ï¼Œè¿›è¡Œ RT ç”¨æ—¶ 8 min 35 secsï¼›ä½¿ç”¨ SAH åŠ é€Ÿåï¼Œç”¨æ—¶ä¸º 8 min 48 secsã€‚</p><p>// Warning: this code may be buggy!</p><p>// æ²¡é”™ç”¨äº†è¿™ ** ä¼˜åŒ–åˆæ…¢äº†æˆ‘ä¹Ÿä¸çŸ¥é“x</p><p>// æˆ‘æ„Ÿè§‰åŒ…å›´ç›’ç®—æ³•å°±éœ€è¦å¤§æ”¹ï¼Œanyway é¢†ä¼šç²¾ç¥å§x</p><p><img src="https://s2.loli.net/2022/01/18/Y9Nh7QAUxfncCgV.png" alt="6-1"></p><h3 id="å®éªŒæ¡†æ¶-1"><a href="#å®éªŒæ¡†æ¶-1" class="headerlink" title="å®éªŒæ¡†æ¶"></a>å®éªŒæ¡†æ¶</h3><ul><li><code>main.cpp</code><ul><li>åˆ›å»ºåœºæ™¯ï¼ˆ1280x960ï¼‰ä¸é¢„å¤„ç†<ul><li>å¯¼å…¥æ¨¡å‹ä¸º MeshTriangle ç±»å¯¹è±¡ï¼Œå¹¶æ·»åŠ å…¥åœºæ™¯ï¼›</li><li>å°†å…‰æºæ·»åŠ å…¥åœºæ™¯ï¼›</li><li>å¯¹åœºæ™¯æ‰§è¡Œ buildBVH()</li></ul></li><li>åˆ›å»º <code>Renderer</code> ç±»å¯¹è±¡æ¸²æŸ“å™¨ï¼Œå¹¶å¼€å§‹æ¸²æŸ“</li></ul></li><li><code>Vector.hpp, Vector.cpp</code>ï¼šå‘é‡ç±»ï¼Œæä¾›äº†å‘é‡ <code>Vector3f</code>, <code>Vector2f</code> çš„åŸºæœ¬æ“ä½œ</li><li><code>Object.hpp</code>ï¼šæŠ½è±¡ç±»<ul><li>æä¾›äº†ä»¥ä¸‹æ¥å£ï¼š<ul><li><code>bool intersect(const Ray&amp;)</code></li><li><code>bool intersect(const Ray&amp; ray, float&amp; distance, int&amp; index) const</code></li><li><code>Intersection getIntersection(Ray _ray)</code></li><li><code>void getSurfaceProperties(const Vector3f &amp;, const Vector3f &amp;, const uint32_t &amp;, const Vector2f &amp;, Vector3f &amp;, Vector2f &amp;) const</code></li><li><code>virtual Vector3f evalDiffuseColor(const Vector2f &amp;) const</code></li><li><code>virtual Bounds3 getBounds()</code></li></ul></li><li>æ€»ç»“æ¥è¯´ï¼Œé¦–å…ˆæ˜¯åˆ¤æ–­æœ‰æ— äº¤ç‚¹å’Œè·å–äº¤ç‚¹çš„æ¥å£ï¼Œç„¶åæ˜¯è·å–è¡¨é¢å±æ€§å’Œè®¡ç®—é¢œè‰²çš„æ¥å£ï¼Œç„¶åæ˜¯è·å–åŒ…å›´ç›’çš„æ¥å£ã€‚</li><li><code>Triangle.hpp/Sphere.hpp</code>ï¼šç»§æ‰¿è‡ª <code>Object</code>ï¼Œé‡è½½ä¸Šè¿°å‡½æ•°å¹¶å®ç°ä¸ºå¯¹åº”å¯¹è±¡</li></ul></li><li><code>Ray.hpp</code><ul><li><code>Vector3f orig, direction;</code>, <code>double t, t_min, t_max;</code></li></ul></li><li><code>Light.hpp</code>ï¼š<code>Vector3f position, intensity;</code><ul><li><code>AreaLight.hpp</code>ï¼š<code>Vector3f u, v, normal; double length;</code></li></ul></li><li><code>Intersection.hpp</code>ï¼š<ul><li><code>bool happened;</code></li><li><code>Vector3f coords, normal;</code></li><li><code>double distance;</code></li><li><code>Object* obj;</code></li><li><code>Material* m;</code></li></ul></li><li><code>Material.hpp</code>ï¼šå­˜å‚¨è¡¨é¢å±æ€§<ul><li>è¡¨é¢ç±»å‹ï¼š <code>enum MaterialType &#123; DIFFUSE_AND_GLOSSY, REFLECTION_AND_REFRACTION, REFLECTION &#125;;</code></li><li>è¡¨é¢é¢œè‰²ï¼ˆåå°„ï¼Œè¾å°„ï¼‰ï¼ŒæŠ˜å°„ç‡ï¼ŒBP æ¨¡å‹ä¸­çš„ $k_d, k_s, p$â€‹</li></ul></li><li><code>Bounds3.hpp</code>ï¼šåŒ…å›´ç›’ç›¸å…³å‡½æ•°<ul><li>æ±‚å¯¹è§’çº¿ï¼Œç»´æ•°ï¼Œè¡¨é¢ç§¯ï¼Œä¸­å¿ƒç‚¹ï¼›</li><li>ä¸å¦å¤–ä¸€ä¸ªåŒ…å›´ç›’æ±‚äº¤ï¼Œæ±‚å¹¶ï¼›</li><li>æ£€æµ‹ä¸¤ä¸ªåŒ…å›´ç›’æ˜¯å¦äº’ç›¸åŒ…å«æˆ–è€…é‡å ï¼›</li><li>åˆ¤æ–­ä¸å…‰çº¿æ˜¯å¦ç›¸äº¤ï¼›</li></ul></li><li><code>BVH.hpp/BVH.cpp</code>ï¼šåŠ é€Ÿç»“æ„<ul><li><code>enum class SplitMethod &#123; NAIVE, SAH &#125;;</code></li><li>ä¸å…‰çº¿æ±‚äº¤<ul><li><code>Intersection Intersect(const Ray &amp;ray) const;</code></li><li><code>Intersection getIntersection(BVHBuildNode* node, const Ray&amp; ray)const;</code></li><li><code>bool IntersectP(const Ray &amp;ray) const;</code></li></ul></li><li>æœ¬è´¨æ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œæ‹¥æœ‰æ ‘å½¢ç»“æ„<ul><li><code>BVHBuildNode* root;</code></li><li><code>BVHBuildNode* recursiveBuild(std::vector&lt;Object*&gt;objects);</code></li><li><code>BVHBuildNode* recursiveBuildSAH(std::vector&lt;Object*&gt;objects);</code></li></ul></li><li>å­˜å‚¨å…¶å›¾å…ƒ primitive çš„æŒ‡é’ˆ<ul><li><code>std::vector&lt;Object*&gt; primitives;</code></li></ul></li></ul></li><li><code>Renderer.hpp / Renderer.cpp</code><ul><li>ç»™å®šä¸€ä¸ªåœºæ™¯ï¼Œåˆ›å»ºæ¸²æŸ“ä»»åŠ¡</li><li>ç®¡ç†ä»»åŠ¡è¿‡ç¨‹ä¸­çš„ framebuffer ç­‰ç­‰å›¾åƒæ•°æ®</li><li>ç®¡ç†æ•´ä¸ªæ¸²æŸ“æµç¨‹ä»¥åŠæ•°æ®æœ€ç»ˆçš„å†™å…¥æ–‡ä»¶</li></ul></li><li><code>Scene.hpp / Scene.cpp</code><ul><li>å›¾åƒç›¸å…³çš„è®¾å®š<ul><li><code>int width, height;</code></li><li><code>double fov;</code></li><li><code>Vector3f backgroundColor;</code></li><li><code>maxDepth;</code></li></ul></li><li>æ¨¡å‹ç›¸å…³çš„è®¾å®š Get / Set<ul><li><code>void Add(Object *object);</code></li><li><code>void Add(std::unique_ptr&lt;Light&gt; light);</code></li></ul></li><li>ä¸å…‰çº¿æ±‚äº¤çš„å‡½æ•°ï¼š<code>Intersection intersect(const Ray&amp; ray) const;</code></li><li>BVH ç›¸å…³ï¼š<ul><li><code>BVHAccel *bvh = nullptr;</code></li><li><code>void buildBVH();</code></li></ul></li><li>æ¸²æŸ“ä¸»å‡½æ•°ï¼š<ul><li><code>Vector3f castRay(const Ray &amp;ray, int depth) const;</code> // Important!</li><li><code>bool trace(const Ray &amp;ray, const std::vector&lt;Object*&gt; &amp;objects, float &amp;tNear, uint32_t &amp;index, Object **hitObject);</code></li></ul></li></ul></li></ul><h2 id="PA7"><a href="#PA7" class="headerlink" title="PA7"></a>PA7</h2><blockquote><ul><li>å®ç° Path Tracing ç®—æ³•</li></ul></blockquote><h3 id="ç®—æ³•å›é¡¾-6"><a href="#ç®—æ³•å›é¡¾-6" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><pre class="language-none"><code class="language-none">def ray_generation(camPos, pixel):Uniformly choose N samples from the pixelpixel_radiance &#x3D; 0.0for sample in the pixel:Shoot a ray r(camPos, cam_to_sample)if ray r hit the scene at p:pixel_radiance +&#x3D; 1 &#x2F; N * shade(p, sample_to_cam)    return pixel_radiancedef shade(p, wo):# Contributions from the light sourceL_dir &#x3D; 0.0Uniformly sample the light at x&#39; (pdf_light &#x3D; 1&#x2F;A)Shoot a ray from p to x&#39;if the ray is not blocked in the middle:L_dir &#x3D; L_i * f_r * cos \theta * cos \theta&#39; &#x2F; |x&#39;-p|^2 &#x2F; pdf_light        # Contributions from other places    L_indir &#x3D; 0.0    If test Russian Roulette with probability P_RR :        Uniformly sample the hemisphere toward wi (pdf_hemi &#x3D; 1 &#x2F; 2pi)        Trace a ray r(p, wi)        If ray r hit a non-emitting object at q:            L_indir &#x3D; shade(q, -wi) * f_r * cos \theta &#x2F; pdf_hemi &#x2F; P_RR        Return L_dir + L_indir</code></pre><h3 id="å®éªŒç»“æœ-6"><a href="#å®éªŒç»“æœ-6" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h3><ul><li>SPP = 16 / 32 / 64 / 256</li></ul><p><img src="https://s2.loli.net/2022/01/29/pwevmYcRyDqBPxh.png" alt="7-16"></p><p><img src="https://s2.loli.net/2022/01/29/1OrJUsgTSLocbwK.png" alt="7-32"></p><p><img src="https://s2.loli.net/2022/01/29/7aCgFk6KOdqS4bM.png" alt="7-64"></p><p><img src="https://s2.loli.net/2022/01/29/GZtErdMFQcBfN8P.png" alt="7-256"></p><h2 id="PA8"><a href="#PA8" class="headerlink" title="PA8"></a>PA8</h2><blockquote><ul><li>è¿æ¥ç»³å­çº¦æŸï¼Œæ­£ç¡®çš„æ„é€ ç»³å­ </li><li>åŠéšå¼æ¬§æ‹‰æ³•</li><li>æ˜¾å¼æ¬§æ‹‰æ³•</li><li>æ˜¾å¼ Verlet</li><li>é˜»å°¼</li></ul></blockquote><h3 id="ç®—æ³•å›é¡¾-7"><a href="#ç®—æ³•å›é¡¾-7" class="headerlink" title="ç®—æ³•å›é¡¾"></a>ç®—æ³•å›é¡¾</h3><ul><li>æ˜¾å¼/åŠéšå¼æ¬§æ‹‰æ³•</li></ul><script type="math/tex; mode=display">\boldsymbol{f}_{a \rightarrow b}=k_{s} \frac{\boldsymbol{b}-\boldsymbol{a}}{\|\boldsymbol{b}-\boldsymbol{a}\|}(\|\boldsymbol{b}-\boldsymbol{a}\|-l) \\f_{b \rightarrow a} = - f_{ a \rightarrow b}</script><script type="math/tex; mode=display">\begin{aligned}&\mathrm{F}=\mathrm{ma} \\&\mathrm{v}(\mathrm{t}+1)=\mathrm{v}(\mathrm{t})+\mathrm{a}(\mathrm{t}) * \mathrm{dt} \\&\mathrm{x}(\mathrm{t}+1)=\mathrm{x}(\mathrm{t})+\mathrm{v}(\mathrm{t}) * \mathrm{dt} \\&\mathrm{x}(\mathrm{t}+1)=\mathrm{x}(\mathrm{t})+\mathrm{v}(\mathrm{t}+1) * \mathrm{dt}\end{aligned}</script><p>å€’æ•°ç¬¬äºŒè¡Œä¸ºæ˜¾å¼æ¬§æ‹‰æ³•ï¼Œæœ€åä¸€è¡Œä¸ºåŠéšå¼æ¬§æ‹‰æ³•ã€‚</p><ul><li>æ˜¾å¼ Verlet</li></ul><script type="math/tex; mode=display">x(t+1)=x(t)+[x(t)-x(t-1)]+a(t) * d t * d t</script><ul><li>é˜»å°¼</li></ul><script type="math/tex; mode=display">x(t+1) =x(t)+(1-\text {damping\_factor }) *[x(t)-x(t-1)]+a(t) * d t * d t</script>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2022/01/28/hIQTsycbV6xeojp.png&quot; alt=&quot;output-4&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.loli.net/2022/01/29/GZtErdMFQcBfN8P.png&quot; alt=&quot;7-256&quot;&gt;&lt;/p&gt;
&lt;p&gt;GAMES101 2020-Spring å¯¹åº”çš„ 8 æ¬¡ PA æ•´ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä»“åº“åœ°å€ï¼š&lt;a href=&quot;https://github.com/c7w/GAMES101-HW-2020-Spring&quot;&gt;https://github.com/c7w/GAMES101-HW-2020-Spring&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ã€€ã€€Warning: FYI, these codes may be ugly and buggy.&lt;/em&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/è®¡ç®—æœºå›¾å½¢å­¦" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="å›¾å½¢å­¦" scheme="https://www.c7w.tech/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>GAMES101 ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦åŸºç¡€ ç¬”è®°ï¼ˆä¸‹ï¼‰</title>
    <link href="https://www.c7w.tech/games101-cont/"/>
    <id>https://www.c7w.tech/games101-cont/</id>
    <published>2022-01-16T14:27:32.000Z</published>
    <updated>2022-01-29T10:43:40.391Z</updated>
    
    <content type="html"><![CDATA[<p>GAMES 101 ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦åŸºç¡€ ç¬”è®°ï¼ˆä¸‹ç¯‡ï¼‰.</p><ul><li>å…‰çº¿è¿½è¸ªï¼ˆWhitted-styleï¼Œæ±‚äº¤ç®—æ³•ï¼ŒåŠ é€Ÿç»“æ„ï¼Œè¾å°„åº¦é‡å­¦ï¼Œè·¯å¾„è¿½è¸ªï¼‰</li><li>æè´¨ä¸å¤–è§‚</li><li>åŠ¨ç”»ä¸æ¨¡æ‹Ÿ</li></ul><a id="more"></a><h2 id="å…‰çº¿è¿½è¸ª-Ray-Tracing"><a href="#å…‰çº¿è¿½è¸ª-Ray-Tracing" class="headerlink" title="å…‰çº¿è¿½è¸ª Ray Tracing"></a>å…‰çº¿è¿½è¸ª Ray Tracing</h2><h3 id="ä»é—®é¢˜å‡ºå‘"><a href="#ä»é—®é¢˜å‡ºå‘" class="headerlink" title="ä»é—®é¢˜å‡ºå‘"></a>ä»é—®é¢˜å‡ºå‘</h3><p>å¦‚ä½•ç”¨å…‰æ …åŒ–çš„æ‰‹æ³•è§£å†³é˜´å½±çš„é—®é¢˜ï¼Ÿ</p><p>é‡è¦æ€æƒ³ï¼šç‚¹ä¸åœ¨é˜´å½±ä¸­ï¼Œå½“ä¸”ä»…å½“ç‚¹å¿…é¡»åŒæ—¶è¢«å…‰æºå’Œæ‘„åƒæœºçœ‹åˆ°ã€‚</p><ol><li>ä»å…‰æºçœ‹å‘åœºæ™¯ï¼ˆç”¨ Z-bufferâ€™ è®°å½•æ·±åº¦ï¼‰</li><li>ä»æ‘„åƒæœºçœ‹å‘åœºæ™¯</li><li>å¦‚æœä¸¤æ·±åº¦ç›¸åŒï¼Œåˆ™æ— éœ€é˜´å½±ï¼›è‹¥ä¸¤æ·±åº¦ä¸åŒï¼Œåˆ™åœ¨é˜´å½±ä¸­ã€‚</li></ol><p>è¿™æ ·åšå­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>Hard shadowsï¼ˆé˜´å½±è¢« 0/1 åŒ–ï¼Œæ— æ³•è¡¨ç¤ºé˜´å½±çš„ç¨‹åº¦ï¼‰</li></ul><p>æå‡ºå…‰çº¿è¿½è¸ªï¼Œå°±æ˜¯ä¸ºäº†è§£å†³å…‰çº¿è¿½è¸ªæ— æ³•å¾ˆå¥½åœ°å¤„ç†<strong>å…¨å±€æ•ˆæœ</strong>çš„é—®é¢˜ã€‚</p><ul><li>Soft Shadows</li><li>Glossy reflection</li><li>Indirect illumination (å…‰çº¿ä¼šå¼¹å°„ä¸æ­¢ä¸€æ¬¡)</li></ul><p>å…‰çº¿è¿½è¸ªç”Ÿæˆçš„å›¾ç‰‡è´¨é‡å¾ˆé«˜ï¼Œä½†æ˜¯æ˜¯ç¦»çº¿çš„ç®—æ³•ï¼Œè¿ä½œé€Ÿåº¦ä¹Ÿå¾ˆæ…¢ã€‚</p><h3 id="åŸºç¡€ç®—æ³•"><a href="#åŸºç¡€ç®—æ³•" class="headerlink" title="åŸºç¡€ç®—æ³•"></a>åŸºç¡€ç®—æ³•</h3><h4 id="ç›¸å…³å®šä¹‰"><a href="#ç›¸å…³å®šä¹‰" class="headerlink" title="ç›¸å…³å®šä¹‰"></a>ç›¸å…³å®šä¹‰</h4><ul><li><p>å…‰çº¿</p><ul><li>å…‰çº¿æ²¿ç›´çº¿ä¼ æ’­</li><li>å…‰çº¿å’Œå…‰çº¿å¹¶ä¸ä¼šå‘ç”Ÿç¢°æ’</li><li>å…‰çº¿æ€»æ˜¯ä»å…‰æºå‘å‡ºï¼Œç»ˆæ­¢äºäººçš„çœ¼ç›ï¼ˆæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿçš„å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹ï¼‰<ul><li>æ ¹æ®å…‰è·¯çš„å¯é€†æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾â€œæ„ŸçŸ¥å…‰çº¿â€ä»äººçœ¼å‡ºå‘â€¦</li></ul></li></ul></li><li><p>å…‰çº¿æŠ•å°„</p></li></ul><p><img src="https://s2.loli.net/2022/01/14/wJAXG9b1VIEuSLt.png" alt="image-20220114154759095"></p><p>å¯¹äºæˆ‘ä»¬çœ¼å‰çš„æˆåƒå¹³é¢çš„æ¯ä¸€ä¸ªåƒç´ ç‚¹ï¼Œä»äººçœ¼å‘å‡ºä¸€æ¡â€œæ„ŸçŸ¥å…‰çº¿â€ç»è¿‡è¿™ä¸ªåƒç´ ç‚¹ï¼Œå¯èƒ½ä¼šè§¦ç¢°åˆ°åœºæ™¯ä¸­çš„æŸä¸ªä½ç½®ã€‚å¦‚æœè¯¥ä½ç½®å’Œå…‰æºçš„è¿çº¿ä¸Šæ— å…¶å®ƒç‰©ä½“çš„é®æŒ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¯¹å…¶è¿›è¡Œç€è‰²è®¡ç®—ã€‚</p><p><img src="https://s2.loli.net/2022/01/14/wCFDdpmHioMkrEL.png" alt="image-20220114155221509"></p><h4 id="Whitted-style-Ray-Tracing"><a href="#Whitted-style-Ray-Tracing" class="headerlink" title="Whitted-style Ray Tracing"></a>Whitted-style Ray Tracing</h4><p><img src="https://s2.loli.net/2022/01/14/T1xAeVvrhOoGJK4.png" alt="image-20220114155905503"></p><p>æ€è·¯ï¼šæ¨¡æ‹Ÿå…‰çº¿ä¸æ–­å¼¹å°„çš„è¿‡ç¨‹ï¼Œå¹¶è®°å½•å…‰çº¿åœ¨æ¯ä¸€ä¸ªå¼¹å°„ç‚¹çš„è¡°å‡ç‡ã€‚å¦‚ä¸Šå›¾ä¸­ï¼Œå¯¹äºç»ç’ƒçƒï¼Œéœ€è¦æ¨¡æ‹Ÿå…¶åå°„å’ŒæŠ˜å°„å…‰è·¯ã€‚å…·ä½“çš„æŠ€æœ¯å®ç°è§ä¸‹ã€‚</p><h4 id="å…‰çº¿å’Œç‰©ä½“è¡¨é¢äº¤ç‚¹çš„æ±‚æ³•"><a href="#å…‰çº¿å’Œç‰©ä½“è¡¨é¢äº¤ç‚¹çš„æ±‚æ³•" class="headerlink" title="å…‰çº¿å’Œç‰©ä½“è¡¨é¢äº¤ç‚¹çš„æ±‚æ³•"></a>å…‰çº¿å’Œç‰©ä½“è¡¨é¢äº¤ç‚¹çš„æ±‚æ³•</h4><ul><li>å¯¹äºéšå¼è¡¨é¢</li></ul><p>å…‰çº¿çš„å®šä¹‰ï¼šåŸç‚¹ $\vec o$â€‹â€‹ï¼Œä¼ æ’­æ–¹å‘ $\vec d \ (||\vec d||=1)$â€‹â€‹â€‹ï¼Œå…‰çº¿å®šä¹‰ä¸º $\vec r(t) = \vec o +t\vec d, \ t\ge0$â€‹â€‹ã€‚</p><p>çƒçš„å®šä¹‰ï¼š$\vec p: (\vec p - \vec c)^2 - R^2 = 0$.</p><script type="math/tex; mode=display">\begin{aligned}&(\mathbf{o}+t \mathbf{d}-\mathbf{c})^{2}-R^{2}=0 \\&a t^{2}+b t+c=0, \text { where } \\&a=\mathbf{d} \cdot \mathbf{d} \\&b=2(\mathbf{o}-\mathbf{c}) \cdot \mathbf{d} \\&c=(\mathbf{o}-\mathbf{c}) \cdot(\mathbf{o}-\mathbf{c})-R^{2} \\&t=\frac{-b \pm \sqrt{b^{2}-4 a c}}{2 a}\end{aligned}</script><ul><li>å¯¹äºæ˜¾å¼è¡¨é¢</li></ul><p>ä¸€ä¸ªç®€å•çš„æƒ³æ³•æ˜¯å¯¹æ¨¡å‹çš„æ‰€æœ‰ä¸‰è§’å½¢è¡¨é¢åšéå†ï¼Œç„¶åé€‰æ‹© $t$ æœ€å°çš„é‚£ä¸ªã€‚ï¼ˆå¯èƒ½ä¸å­˜åœ¨ï¼Œå¯ä»¥ä¼˜åŒ–*ï¼‰</p><p>äºæ˜¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»…è€ƒè™‘å…‰çº¿å¦‚ä½•ä¸å•ä¸ªä¸‰è§’å½¢æ±‚äº¤ã€‚</p><p>å®šä¹‰å¹³é¢ä¸º $(p-pâ€™) \cdot N = 0$.</p><script type="math/tex; mode=display">\begin{aligned}&\left(\mathbf{p}-\mathbf{p}^{\prime}\right) \cdot \mathbf{N}=\left(\mathbf{o}+t \mathbf{d}-\mathbf{p}^{\prime}\right) \cdot \mathbf{N}=0 \\&t=\frac{\left(\mathbf{p}^{\prime}-\mathbf{o}\right) \cdot \mathbf{N}}{\mathbf{d} \cdot \mathbf{N}} \quad \text { Check: } 0 \leq t<\infty\end{aligned}</script><p>ç„¶ååˆ¤æ–­äº¤ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…ã€‚</p><p>æ­¤å¤–è¿˜æœ‰ MÃ¶ller Trumbore ç®—æ³•ï¼Œå¯ä»¥ç›´æ¥åˆ¤æ–­äº¤ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…ï¼ˆéœ€è¦ç”¨åˆ°å…‹è±å§†æ³•åˆ™ï¼‰ï¼š</p><script type="math/tex; mode=display">\begin{gathered}\overrightarrow{\mathbf{O}}+t \overrightarrow{\mathbf{D}}=\left(1-b_{1}-b_{2}\right) \overrightarrow{\mathbf{P}}_{0}+b_{1} \overrightarrow{\mathbf{P}}_{1}+b_{2} \overrightarrow{\mathbf{P}}_{2} \\\text { Where: } \\{\left[\begin{array}{c}t \\b_{1} \\b_{2}\end{array}\right]=\frac{1}{\overrightarrow{\mathbf{S}}_{1} \bullet \overrightarrow{\mathbf{E}}_{1}}\left[\begin{array}{cc}\overrightarrow{\mathbf{S}}_{2} \cdot \overrightarrow{\mathbf{E}}_{2} \\\overrightarrow{\mathbf{S}}_{1} \cdot \overrightarrow{\mathbf{S}} \\\overrightarrow{\mathbf{S}}_{2} \cdot \overrightarrow{\mathbf{D}}\end{array}\right]} \\\text { Cost = (1 div, 27 mul, 17 add) } \\\overrightarrow{\mathbf{E}}_{1}=\overrightarrow{\mathbf{P}}_{1}-\overrightarrow{\mathbf{P}}_{0} \\\overrightarrow{\mathbf{E}}_{2}=\overrightarrow{\mathbf{P}}_{2}-\overrightarrow{\mathbf{P}}_{0} \\\overrightarrow{\mathbf{S}}=\overrightarrow{\mathbf{O}}-\overrightarrow{\mathbf{P}}_{0} \\\overrightarrow{\mathbf{S}}_{1}=\overrightarrow{\mathbf{D}} \times \overrightarrow{\mathbf{E}}_{2} \\\overrightarrow{\mathbf{S}}_{2}=\overrightarrow{\mathbf{S}} \times \overrightarrow{\mathbf{E}}_{1}\end{gathered}</script><p>è¯¥æ€æ ·åŠ é€Ÿä¸æ¨¡å‹æ±‚äº¤å‘¢(*)ï¼Ÿ</p><ul><li><p>Naive algorithm = #pixels â¨‰ # traingles (â¨‰ #bounces) å¤ªæ…¢äº†ï¼Œä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚</p></li><li><p>Improved Algorithm: Bounding Volume</p><ul><li>è¿™é‡Œæˆ‘ä»¬ä»ç„¶å¼•å…¥â€œåŒ…å›´ç›’â€çš„æ€æƒ³ï¼Œè¿™é‡Œç§°ä¸º Bounding Volume</li><li>å…‰çº¿èƒ½å¤Ÿä¸æ¨¡å‹æœ‰äº¤ç‚¹çš„å¿…è¦æ¡ä»¶ï¼šå…‰çº¿èƒ½å¤Ÿä¸åŒ…å›´æ¨¡å‹çš„ä¸€ä¸ªç®€å•åŒ…å›´ä½“ç§¯æœ‰äº¤ç‚¹</li></ul></li></ul><p><img src="https://s2.loli.net/2022/01/14/gtSeZD1FWrcXQCs.png" alt="image-20220114163023985"></p><p>æˆ‘ä»¬å°†é•¿æ–¹ä½“ç†è§£æˆä¸‰ä¸ªå¯¹é¢æ‰€åˆ†åˆ’å‡ºçš„ç©ºé—´çš„äº¤é›†ã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„åŒ…å›´ä½“ç§¯ä¾¿æ˜¯é•¿æ–¹ä½“ï¼Œä¸”é•¿æ–¹ä½“æ˜¯ä¸åæ ‡è½´å¹³è¡Œçš„ï¼Œå³è½´å¯¹é½åŒ…å›´ç›’ï¼ˆAABBï¼‰ã€‚é€‰ç”¨ AABB å¼åŒ…å›´ç›’æœ‰åˆ©äºåŠ é€Ÿè®¡ç®—ã€‚åˆ¤æ–­å…‰çº¿å’Œ AABB ç±»åŒ…å›´ç›’çš„æ±‚äº¤æ–¹æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/01/14/5rMlAnIw3gQBVNL.png" alt="image-20220114163501816"></p><p>æ ¸å¿ƒæ€æƒ³ï¼šåªæœ‰å½“å…‰çº¿è¿›å…¥æ‰€æœ‰ä¸‰ä¸ªå¯¹é¢åï¼Œå…‰çº¿æ‰è¿›å…¥äº†åŒ…å›´ç›’ï¼›è‹¥å…‰çº¿ä»æŸä¸€ä¸ªå¯¹é¢å‡ºå°„ï¼Œåˆ™å…‰çº¿ä¾¿ä»åŒ…å›´ç›’ä¸­å°„å‡ºã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥è®¡ç®—ä¸‰ä¸ªå¯¹é¢åˆ†åˆ«å¯¹åº”çš„ $t_{min}$â€‹â€‹ å’Œ $t_{max}$â€‹â€‹ï¼Œç„¶åå¯¹å…¶æ±‚äº¤ã€‚å½“ä¸”ä»…å½“ $t_{enter} \lt t_{exit}$â€‹â€‹ ä¸” $t_{exit} \ge 0$â€‹â€‹ï¼Œå…‰çº¿æ‰å¯èƒ½ä¸åŒ…å›´ç›’æœ‰äº¤ç‚¹ã€‚</p><h4 id="ä½¿ç”¨åŒ…å›´ç›’åŠ é€Ÿå…‰çº¿è¿½è¸ª"><a href="#ä½¿ç”¨åŒ…å›´ç›’åŠ é€Ÿå…‰çº¿è¿½è¸ª" class="headerlink" title="ä½¿ç”¨åŒ…å›´ç›’åŠ é€Ÿå…‰çº¿è¿½è¸ª"></a>ä½¿ç”¨åŒ…å›´ç›’åŠ é€Ÿå…‰çº¿è¿½è¸ª</h4><h5 id="Uniform-Grids"><a href="#Uniform-Grids" class="headerlink" title="Uniform Grids"></a>Uniform Grids</h5><p>â‘  é¢„å¤„ç†</p><p><img src="https://s2.loli.net/2022/01/14/Ggt2BDyranQYdCh.png" alt="image-20220114165308910"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå–æ ¼å­æ•° #cells = #objs * 27.</p><p>â‘¡ å…‰çº¿ä¸åœºæ™¯ä¸­æ¨¡å‹çš„æ±‚äº¤</p><p><img src="https://s2.loli.net/2022/01/14/qTfEAhQo5OXLcgW.png" alt="image-20220114165353415"></p><p>å­˜åœ¨çš„é—®é¢˜ï¼šTeapot in a Stadiumï¼Œäº‹å®ä¸Šç‰©ä½“æ¨¡å‹åœ¨ç©ºé—´ä¸­çš„åˆ†å¸ƒå¯èƒ½å¹¶ä¸å‡åŒ€ï¼</p><h5 id="ç©ºé—´åˆ’åˆ†-Spatial-Partitions"><a href="#ç©ºé—´åˆ’åˆ†-Spatial-Partitions" class="headerlink" title="ç©ºé—´åˆ’åˆ† Spatial Partitions"></a>ç©ºé—´åˆ’åˆ† Spatial Partitions</h5><ul><li>Oct-Tree</li><li>Kd-Tree</li><li>BSP-Tree</li></ul><p>è¿™é‡Œä»¥ Kd-Tree ä¸ºä¾‹ï¼ŒKd-Tree çš„å…·ä½“å®ç°åœ¨ã€Šæ•°æ®ç»“æ„ã€‹è¯¾ç¨‹ä¸­å·²è¯¦ç»†ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¾¿ä¸å†èµ˜è¿°ã€‚æˆ‘ä»¬å°†ç©ºé—´æ¨¡å‹é¦–å…ˆä½¿ç”¨ Kd-Tree é¢„å¤„ç†ï¼Œç„¶åé’ˆå¯¹ä¸åŒçš„å…‰çº¿ï¼ˆQueryï¼‰ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li>é¦–å…ˆåˆ¤æ–­å…‰çº¿å’Œæœ€å¤–å±‚åŒ…å›´ç›’æ˜¯å¦æœ‰äº¤ç‚¹ï¼Œå¦‚æœæœ‰é‚£ä¹ˆï¼š<ul><li>å¦‚æœåŒ…å›´ç›’ä¸ºå¶å­ç»“ç‚¹ï¼Œç›´æ¥åˆ¤æ–­å…‰çº¿å’ŒåŒ…å›´ç›’ä¸­æ¨¡å‹æ˜¯å¦ç›¸äº¤å¹¶æ±‚äº¤ï¼›</li><li>å¦‚æœåŒ…å›´ç›’éå¶å­ç»“ç‚¹ï¼Œé‚£ä¹ˆå¯¹å…¶ä¸¤ä¸ªå­èŠ‚ç‚¹çš„åŒ…å›´ç›’ï¼Œåˆ†åˆ«åˆ¤æ–­å…¶æ˜¯å¦ä¸å…‰çº¿æœ‰äº¤ï¼Œè‹¥æœ‰åˆ™é€’å½’åœ°æ‰§è¡Œæ­¤è¿‡ç¨‹ã€‚</li></ul></li></ul><p>kd-Tree å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>éš¾ä»¥åˆ¤æ–­å®é™…çš„ç‰©ä½“å’ŒåŒ…å›´ç›’æ˜¯å¦ç›¸äº¤<ul><li>å³ä½¿æ˜¯å¯¹äºç‰©ä½“å…¨éƒ¨ä¸ºä¸‰è§’å½¢çš„åœºæ™¯ï¼Œä¹Ÿéš¾ä»¥åˆ¤æ–­å•ä¸ªåŒ…å›´ç›’å’Œå•ä¸ªä¸‰è§’å½¢æ˜¯å¦æœ‰äº¤ç‚¹ï¼</li></ul></li><li>æ­¤å¤–ï¼Œä¸€ä¸ªç‰©ä½“å¯èƒ½å‡ºç°åœ¨å¤šä¸ªå¶å­ç»“ç‚¹ä¸­â€¦</li></ul><h5 id="Object-Partitions"><a href="#Object-Partitions" class="headerlink" title="Object Partitions"></a>Object Partitions</h5><ul><li>Bounding volume Hierarchy (BVH)</li></ul><p>æˆ‘ä»¬åˆ’åˆ†çš„ä¸æ˜¯ç©ºé—´ï¼Œè€Œæ˜¯ç‰©ä½“ï¼</p><p><img src="https://s2.loli.net/2022/01/16/zbLpGw5E7SCgQAu.png" alt="image-20220116102930688"></p><p>å¦‚ä½•è¿›è¡Œåˆ’åˆ†ï¼Ÿ</p><ul><li>æ²¿ç€æœ€é•¿çš„ç»´åº¦æ¥åˆ’åˆ†</li><li>åˆ’åˆ†ç«¯ç‚¹å–ä¸­ä½æ•°<ul><li>å–ä¸‰è§’å½¢çš„é‡å¿ƒ</li></ul></li></ul><p><img src="https://s2.loli.net/2022/01/16/xtKaWO7lJ2Rm8Xb.png" alt="image-20220116103520101"></p><p>ä½¿ç”¨ BVH ç®—æ³•ï¼Œå³ä½¿åŒ…å›´ç›’å¯èƒ½åœ¨ç©ºé—´ä¸Šæœ‰ç›¸äº¤ï¼Œä½†æ˜¯æˆ‘ä»¬å´è§£å†³äº† kd-Tree å­˜åœ¨çš„é—®é¢˜ã€‚</p><h4 id="è¾å°„åº¦é‡å­¦"><a href="#è¾å°„åº¦é‡å­¦" class="headerlink" title="è¾å°„åº¦é‡å­¦"></a>è¾å°„åº¦é‡å­¦</h4><p>è¾å°„åº¦é‡å­¦æä¾›äº†ç²¾å‡†åœ°æè¿°å…‰è¿™ä¸ªç‰©ç†é‡çš„æ–¹æ³•ã€‚</p><ul><li>å…‰ç…§çš„åº¦é‡æ–¹æ³•å’Œå•ä½</li><li>ç²¾ç¡®åœ°åº¦é‡å…‰çš„æ—¶ç©ºå±æ€§<ul><li>Radiant Flux è¾å°„é€šé‡</li><li>Radiant Intensity è¾å°„å¼ºåº¦</li><li>Irradiance è¾å°„ç…§åº¦</li><li>Radiance è¾å°„äº®åº¦</li></ul></li><li>ä½¿ç”¨ç‰©ç†æ­£ç¡®çš„æ–¹æ³•æ¥è®¡ç®—å…‰ç…§</li></ul><h5 id="ç‰©ç†é‡çš„å®šä¹‰"><a href="#ç‰©ç†é‡çš„å®šä¹‰" class="headerlink" title="ç‰©ç†é‡çš„å®šä¹‰"></a>ç‰©ç†é‡çš„å®šä¹‰</h5><ul><li><strong>Radiant Energy</strong> $Q$ (è¾å°„èƒ½é‡ï¼Œå•ä½ J)</li><li><strong>Radiant Flux</strong> (åˆå <strong>Power</strong>) $\Phi = \frac {dQ} {dt}$â€‹ ï¼ˆè¾å°„é€šé‡ï¼Œå•ä½ W, lmï¼‰</li></ul><p><img src="https://s2.loli.net/2022/01/16/z41TFClAOsMcS9I.png" alt="image-20220116104840613"></p><ul><li><strong>Radiant Intensity</strong> $I(\omega) = \frac {d \Phi} {d \omega}$ï¼Œå…¶ä¸­ $\omega$â€‹â€‹ æ˜¯ç«‹ä½“è§’ï¼Œå•ä½ä¸º lm/sr =: cd (åå¾·æ‹‰)ï¼Œæ¯å•ä½ç«‹ä½“è§’çš„åŠŸç‡</li></ul><blockquote><p>ç«‹ä½“è§’çš„å®šä¹‰ï¼š</p><p><img src="https://s2.loli.net/2022/01/16/la1fuCOdi9mKokN.png" alt="image-20220116105159216"></p></blockquote><p>ç‰¹åˆ«åœ°ï¼Œè‹¥å…‰æºå‡åŒ€è¾å°„ï¼Œåˆ™æˆ‘ä»¬æœ‰ $I = \frac {\Phi} {4\pi}$â€‹ã€‚</p><ul><li><strong>Irradiance</strong> $E(x) = \frac { d \Phi(x)} {dA}$ï¼Œè¾ç…§åº¦ï¼Œå•ä½é¢ç§¯ä¸Šçš„è¾å°„é€šé‡ï¼Œå•ä½ lux.</li></ul><p><img src="https://s2.loli.net/2022/01/16/uXeymz4bKvgBPiV.png" alt="image-20220116110821261"></p><ul><li><strong>Radiance</strong> $L(p, \omega) = \frac {d^2\Phi(p, \omega)} {d \omega dA \cos \theta}$â€‹</li></ul><p><img src="https://s2.loli.net/2022/01/16/w8AWzY3Cs1HkaZP.png" alt="image-20220116111154506"></p><p>è¾å°„åº¦(äº®åº¦)æ˜¯æ¯å•ä½ç«‹ä½“è§’å’Œæ¯å•ä½æŠ•å½±é¢ç§¯ä¸Šï¼Œç”±è¡¨é¢åå°„ã€å‘å°„æˆ–æ¥æ”¶çš„èƒ½é‡ã€‚è¾å°„åº¦æ˜¯å…‰çº¿çš„å±æ€§ã€‚</p><ul><li>Radiance is power per solid angle per projected unit area;</li><li>Irradiance is power per projected unit area;</li><li>Intensity is power per solid angle;</li><li>That is to sayâ€¦</li><li>Radiance is intensity per projected unit area;</li><li>Radiance is irradiance per solid angle, ä¹Ÿå°±æ˜¯è¯´ï¼Œirradiance æ˜¯ä¸€ä¸ªè¡¨é¢ $dA \cos \theta$æ¥æ”¶åˆ°çš„èƒ½é‡ï¼Œradiance æ˜¯è¯¥è¡¨é¢æœç€æŸä¸ª $\omega$ ç«‹ä½“è§’æ–¹å‘è¾å°„å‡ºå»æˆ–æ¥æ”¶åˆ°çš„èƒ½é‡ï¼Œåè€…å…·æœ‰è¡¨æ˜æ–¹å‘çš„èƒ½åŠ›ã€‚</li></ul><h4 id="åŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼ˆBRDFï¼‰"><a href="#åŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼ˆBRDFï¼‰" class="headerlink" title="åŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼ˆBRDFï¼‰"></a>åŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼ˆBRDFï¼‰</h4><ul><li>BRDF := Bidirectional Reflectance Distribution Function</li></ul><p>ä»€ä¹ˆæ˜¯åå°„ï¼Ÿåå°„å¯ä»¥çœ‹åšæ˜¯ç‰©ä½“è¡¨é¢å¸æ”¶äº†ç…§å°„åˆ°è¯¥å¤„çš„æ‰€æœ‰èƒ½é‡ï¼Œç„¶åå†è¾å°„å‡ºå»çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚</p><p>BRDF è¿™ä¸ªåˆ†å¸ƒå‡½æ•°æ˜¯ç”¨äºæè¿°ï¼Œå¯¹äºç‰©ä½“è¡¨é¢ä¸€ä¸ªå°é¢ç§¯ $dA$ï¼Œæ¥æ”¶åˆ°çš„æ¥è‡ªäºç«‹ä½“è§’ $d \omega_i$ çš„ irradianceï¼Œä¼šä»¥æ€æ ·çš„æ–¹å¼è¢«è¾å°„å‡ºå»ï¼Œåˆ†å¸ƒäºå„ä¸ª solid angle ä¸­ã€‚å³ï¼š$BRDF := \frac {dL_r({\omega _r)}} {L(w_i) \cos \theta \ d\omega_i} \rightarrow percentage$â€‹. å³ï¼šæœæŸä¸ªæ–¹å‘çš„è¾å°„åº¦å æ€»ç…§åº¦çš„æ¯”ä¾‹ã€‚</p><p><img src="https://s2.loli.net/2022/01/16/QCrPA8qnHXOhu2W.png" alt="image-20220116114348861"></p><p>ä½¿ç”¨ BRDF å¯ä»¥ç”¨æ¥å®šä¹‰é•œé¢åå°„å’Œæ¼«åå°„ã€‚æ­¤å¤–ï¼ŒBRDF è¿˜å¯ä»¥ç”¨æ¥å®šä¹‰ç‰©ä½“è¡¨é¢çš„æè´¨ã€‚</p><p>äºæ˜¯ï¼Œå€ŸåŠ©äº BRDF çš„å®šä¹‰ï¼Œæˆ‘ä»¬è€ƒè™‘çœŸå®çš„å…‰çº¿ä¼ æ’­ã€‚ä»æŸä¸ªç‚¹ $dA$ å‘ $\omega_r$ æ–¹å‘å‡ºå°„çš„ radianceï¼Œå¯ä»¥é€šè¿‡è€ƒè™‘æ‰€æœ‰ $w_i$ åˆ°è¾¾è¿™ä¸ªç‚¹çš„ç…§åº¦ä¹˜ä»¥å…¶å¯¹åº”çš„ BRDF å æ¯”ï¼Œç„¶åæ±‚å’Œå¾—åˆ°ã€‚</p><p><img src="https://s2.loli.net/2022/01/16/xbeovLICaJnK7sj.png" alt="image-20220116115205963"></p><p>é—®é¢˜ï¼šæˆ‘ä»¬è€ƒè™‘çš„å…¥å°„ Radiance å¯èƒ½ä¸ä»…ä»…ç”±å…‰æºå‘å‡ºï¼Œä¹Ÿå¯èƒ½æ˜¯ç”±å…¶ä»–ç‰©ä½“å…ˆç»è¿‡è‹¥å¹²æ¬¡åå°„å¾—åˆ°â€¦</p><h4 id="Rendering-Equation"><a href="#Rendering-Equation" class="headerlink" title="Rendering Equation"></a>Rendering Equation</h4><script type="math/tex; mode=display">L_{o}\left(p, \omega_{o}\right)=L_{e}\left(p, \omega_{o}\right)+\int_{\Omega^{+}} L_{i}\left(p, \omega_{i}\right) f_{r}\left(p, \omega_{i}, \omega_{o}\right)\left(n \cdot \omega_{i}\right) \mathrm{d} \omega_{i}</script><p>ç»è¿‡æ¨å¯¼ä¹‹åï¼Œæˆ‘ä»¬å¾—å‡ºï¼š</p><p><img src="https://s2.loli.net/2022/01/16/gFjCZGfP3VmcYTs.png" alt="image-20220116151021069"></p><p>å…¨å±€å…‰ç…§ L = ç›´æ¥å…‰ç…§ E å’Œé—´æ¥å…‰ç…§çš„é›†åˆï¼Œå…¶ä¸­ K æ˜¯åå°„ç®—ç¬¦ã€‚</p><h4 id="è·¯å¾„è¿½è¸ª"><a href="#è·¯å¾„è¿½è¸ª" class="headerlink" title="è·¯å¾„è¿½è¸ª"></a>è·¯å¾„è¿½è¸ª</h4><blockquote><p><strong>è’™ç‰¹å¡æ´›ç§¯åˆ†</strong></p><p>ç›®çš„æ˜¯ä¸ºäº†è§£å†³å®šç§¯åˆ† $\int_a^bf(x)dx$ é—®é¢˜ã€‚</p><p>åšæ³•æ˜¯åœ¨ $[a,b]$â€‹ é—´éšæœºé‡‡æ ·è¶³å¤Ÿå¤šæ¬¡ï¼Œç„¶åå°†è¶³å¤Ÿå¤šæ¬¡çš„ç»“æœè¿›è¡Œå¹³å‡åä½œä¸ºå‡½æ•°å‡å€¼ç§¯åˆ†ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨å‡åŒ€é‡‡æ ·çš„æ–¹å¼ï¼š</p><p><img src="https://s2.loli.net/2022/01/16/4MltFzimgEdkbVR.png" alt="image-20220116153649942"></p><p>æ›´ä¸€èˆ¬åœ°ï¼Œæˆ‘ä»¬æœ‰ï¼š</p><script type="math/tex; mode=display">\int f(x) \mathrm{d} x=\frac{1}{N} \sum_{i=1}^{N} \frac{f\left(X_{i}\right)}{p\left(X_{i}\right)} \quad X_{i} \sim p(x)</script></blockquote><p>å›å¿† Whitted-style ray tracing:</p><ul><li>å¯ä»¥åšé•œé¢åå°„å’ŒæŠ˜å°„çš„æ•ˆæœ</li><li>é‡åˆ°æ¼«åå°„å¹³é¢ä¾¿åœæ­¢</li></ul><p>ä½¿ç”¨æ¸²æŸ“æ–¹ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹æ¨å¯¼è¿‡ç¨‹ï¼š</p><p>å¯¹äºéå…‰æºè¡¨é¢ $dA$â€‹â€‹â€‹ï¼Œæˆ‘ä»¬æœ‰ï¼š</p><script type="math/tex; mode=display">L_{o}\left(p, \omega_{o}\right)=\int_{\Omega^{+}} L_{i}\left(p, \omega_{i}\right) f_{r}\left(p, \omega_{i}, \omega_{o}\right)\left(n \cdot \omega_{i}\right) \mathrm{d} \omega_{i}</script><p>å¯¹ $w_i$â€‹â€‹ è¿›è¡Œ Sampleï¼Œä¸” Sample å‡åŒ€åˆ†å¸ƒäº $[0, 2\pi]$â€‹â€‹ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼š</p><script type="math/tex; mode=display">L_{o}\left(p, \omega_{o}\right) \approx \frac{1}{N} \sum_{i=1}^{N} \frac{L_{i}\left(p, \omega_{i}\right) f_{r}\left(p, \omega_{i}, \omega_{o}\right)\left(n \cdot \omega_{i}\right)}{p\left(\omega_{i}\right)}</script><p>è¿›è€Œï¼Œæˆ‘ä»¬å¯ä»¥æå‡ºä¸€ç§ç€è‰²ç®—æ³•ï¼š</p><p><img src="https://s2.loli.net/2022/01/16/QVLKN1BoPISCDZE.png" alt="image-20220116164125480"></p><p>ç„¶è€Œï¼Œæˆ‘ä»¬å¦‚ä½•ç»§ç»­å¼•å…¥å…¨å±€å…‰ç…§çš„æ¦‚å¿µå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦è€ƒè™‘å¦‚æœå…‰çº¿ $r$ å‘½ä¸­æŸä¸ªç‰©ä½“æ—¶çš„æƒ…å†µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°†è¯¥ç‰©ä½“è¡¨é¢è§†ä¸ºæ–°çš„å…‰æºï¼š</p><p><img src="https://s2.loli.net/2022/01/16/qEcxeKGIJSw1lLb.png" alt="image-20220116164724144"></p><p>æˆ‘ä»¬åªéœ€è¦è®¡ç®— $q$ å¤„ï¼Œ$-w_i$ æ–¹å‘å‘å°„çš„ Radianceï¼Œä¾¿å¯ä»¥å¾—åˆ°æ¸²æŸ“ç»“æœã€‚</p><p>ä½†æ˜¯è¿™æ ·åšå¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œå…‰çº¿çš„æ•°ç›®ä¼šå‘ç”ŸæŒ‡æ•°çˆ†ç‚¸ï¼Œäºæ˜¯æˆ‘ä»¬åªèƒ½åœ¨é‡‡æ ·æ—¶å– N=1ï¼Œå³åœ¨è®¡ç®—è’™ç‰¹å¡æ´›ç§¯åˆ†æ—¶å– N=1ï¼Œç„¶åä»…è¿½è¸ªä¸€æ ¹å…‰çº¿çš„æƒ…å†µã€‚</p><p><img src="https://s2.loli.net/2022/01/16/rxEkeSplq6doBgQ.png" alt="image-20220116164911441"></p><p>æˆ‘ä»¬ä¾¿å°†è¿™ç§ N=1 çš„å¤„ç†æ–¹å¼ç§°ä¸ºâ€œè·¯å¾„è¿½è¸ªâ€ã€‚</p><p>ä¸ºäº†é™ä½ Noiseï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åƒå¹³é¢ä¸Šçš„æ¯ä¸ªåƒç´ éƒ½è¿½è¸ªå¤šæ¡è¿™æ ·çš„â€œè·¯å¾„â€ï¼Œç„¶åå°†è¿™äº›è·¯å¾„è®¡ç®—å¾—åˆ°çš„ Radiance å–å¹³å‡å€¼å³å¯ã€‚</p><p><img src="https://s2.loli.net/2022/01/16/gbk2BK9LGTjZ1PV.png" alt="image-20220116165143374"></p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½® shade è¿‡ç¨‹çš„é€’å½’åŸºã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æœ€å¤§å…‰çº¿å¼¹å°„æ¬¡æ•°ï¼Œä½†è¿™æ ·å–å¾—çš„æ•ˆæœä¸å¦‚ä½¿ç”¨ <code>Russian Roulette</code>ï¼ˆä¿„ç½—æ–¯è½®ç›˜èµŒï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæŸä¸ªç‚¹çš„ç€è‰²ç»“æœï¼Œæˆ‘ä»¬ç»™å®š $p$ çš„æ¦‚ç‡è¿”å› $result_{old} / p$ï¼Œ$1-p$ çš„æ¦‚ç‡è¿”å› $0$â€‹ï¼Œè¿™æ ·åšæˆ‘ä»¬ç€è‰²ç»“æœçš„æœŸæœ›ä»æ˜¯ $result_{old}$ï¼</p><p><img src="https://s2.loli.net/2022/01/16/7g4DHb8rNKmeC1M.png" alt="image-20220116165744374"></p><p>ç›®å‰æˆ‘ä»¬å°±å¾—åˆ°äº†è·¯å¾„è¿½è¸ªç®—æ³•çš„æ­£ç¡®ç‰ˆæœ¬ï¼Œå³å¯¹äºæ¯ä¸ªåƒå¹³é¢ä¸Šçš„åƒç´ ç‚¹è°ƒç”¨ ray_generation è¿‡ç¨‹ï¼Œè€Œ shade è¿‡ç¨‹åˆ™åŠ å…¥äº†è¿™æ ·çš„å‡ ä½•åˆ†å¸ƒæ–¹å¼æ¥ç¡®å®šå…‰çº¿æ˜¯å¦èƒ½å¤Ÿç»§ç»­ç”Ÿå­˜ã€‚ä½†æ˜¯ç›®å‰æ¥è¯´ï¼Œæˆ‘ä»¬çš„ç®—æ³•å¯èƒ½åœ¨æ•ˆç‡ä¸Šå¹¶ä¸é«˜ï¼Œåœ¨ä½é‡‡æ ·ç‡ï¼ˆSPP, Samples per pixelï¼‰çš„æƒ…å†µä¸‹æ•ˆæœå¹¶ä¸å¥½ï¼š</p><p><img src="https://s2.loli.net/2022/01/16/1M76Bj8Q9lnav3K.png" alt="image-20220116170133804"></p><p>è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæˆ‘ä»¬çš„å…‰æºè¿‡å°ï¼Œæˆ‘ä»¬éœ€è¦è¶³å¤Ÿå¤šæ¬¡é‡‡æ ·ï¼Œæ‰æœ‰å¯èƒ½å°†â€œè¿½è¸ªç”¨å…‰çº¿â€æœ€ç»ˆå‘½ä¸­å…‰æºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤§éƒ¨åˆ†çš„è¿½è¸ªè·¯å¾„éƒ½æ˜¯æ— æ•ˆçš„ï¼š</p><p><img src="https://s2.loli.net/2022/01/16/1j7Tk6HnRyMsVD5.png" alt="image-20220116170327150"></p><p>æˆ–è®¸æˆ‘ä»¬èƒ½æ‰¾åˆ°æ›´åˆé€‚çš„é‡‡æ ·æ¦‚ç‡åˆ†å¸ƒâ€¦æ¯”å¦‚ï¼Œ<strong>å¯¹å…‰æºé‡‡æ ·</strong>ï¼</p><p><img src="https://s2.loli.net/2022/01/16/s8yVDHI3JiXBFeU.png" alt="image-20220116190243440"></p><p>äºæ˜¯ï¼š</p><script type="math/tex; mode=display">\begin{aligned}L_{o}\left(x, \omega_{o}\right) &=\int_{\Omega^{+}} L_{i}\left(x, \omega_{i}\right) f_{r}\left(x, \omega_{i}, \omega_{o}\right) \cos \theta \mathrm{d} \omega_{i} \\&=\int_{A} L_{i}\left(x, \omega_{i}\right) f_{r}\left(x, \omega_{i}, \omega_{o}\right) \frac{\cos \theta \cos \theta^{\prime}}{\left\|x^{\prime}-x\right\|^{2}} \mathrm{~d} A\end{aligned}</script><p>åœ¨ä¹‹å‰æˆ‘ä»¬å‡è®¾å…‰çº¿å¯ä»¥åœ¨é‡‡æ ·åŠçƒé¢ä¸Šå‡åŒ€å°„å‡ºï¼Œè€Œç°åœ¨æˆ‘ä»¬å°†ç‚¹ $dA$ å¤„çš„ Radiance åˆ†ä¸¤éƒ¨åˆ†æ¥è€ƒè™‘ï¼š</p><ol><li>å…‰æºçš„ç›´æ¥è´¡çŒ®ï¼ˆä¸éœ€è¦ RR è®¡ç®—ï¼‰</li><li>å…¶ä»–è¡¨é¢çš„åå°„å…‰çš„è´¡çŒ®ï¼ˆä½¿ç”¨ RRï¼‰</li></ol><p>è¿™æ ·è€ƒè™‘åï¼Œæˆ‘ä»¬å¾—å‡ºæ”¹è¿›ç‰ˆçš„è·¯å¾„è¿½è¸ªä¼ªä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/01/16/zMDhcL3almKIr6t.png" alt="image-20220116190636646"></p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å…‰æºå‘å‡ºçš„å…‰æŸæ˜¯å¦å¯èƒ½è¢«éšœç¢ç‰©é®æŒ¡â€¦</p><p><img src="https://s2.loli.net/2022/01/16/OEXG9d2tikuHncl.png" alt="image-20220116190917657"></p><p>æœ€åï¼Œè·¯å¾„è¿½è¸ªçš„ä¼ªä»£ç æ•´ç†å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">ray_generation</span><span class="token punctuation">(</span>camPos<span class="token punctuation">,</span> pixel<span class="token punctuation">)</span><span class="token punctuation">:</span>Uniformly choose N samples <span class="token keyword">from</span> the pixelpixel_radiance <span class="token operator">=</span> <span class="token number">0.0</span><span class="token keyword">for</span> sample <span class="token keyword">in</span> the pixel<span class="token punctuation">:</span>Shoot a ray r<span class="token punctuation">(</span>camPos<span class="token punctuation">,</span> cam_to_sample<span class="token punctuation">)</span><span class="token keyword">if</span> ray r hit the scene at p<span class="token punctuation">:</span>pixel_radiance <span class="token operator">+=</span> <span class="token number">1</span> <span class="token operator">/</span> N <span class="token operator">*</span> shade<span class="token punctuation">(</span>p<span class="token punctuation">,</span> sample_to_cam<span class="token punctuation">)</span>    <span class="token keyword">return</span> pixel_radiance<span class="token keyword">def</span> <span class="token function">shade</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> wo<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment"># Contributions from the light source</span>L_dir <span class="token operator">=</span> <span class="token number">0.0</span>Uniformly sample the light at x' <span class="token punctuation">(</span>pdf_light <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span>A<span class="token punctuation">)</span>Shoot a ray <span class="token keyword">from</span> p to x'<span class="token keyword">if</span> the ray <span class="token keyword">is</span> <span class="token keyword">not</span> blocked <span class="token keyword">in</span> the middle<span class="token punctuation">:</span>L_dir <span class="token operator">=</span> L_i <span class="token operator">*</span> f_r <span class="token operator">*</span> cos \theta <span class="token operator">*</span> cos \theta<span class="token string">' / |x'</span><span class="token operator">-</span>p<span class="token operator">|</span><span class="token operator">^</span><span class="token number">2</span> <span class="token operator">/</span> pdf_light        <span class="token comment"># Contributions from other places</span>    L_indir <span class="token operator">=</span> <span class="token number">0.0</span>    If test Russian Roulette <span class="token keyword">with</span> probability P_RR <span class="token punctuation">:</span>        Uniformly sample the hemisphere toward wi <span class="token punctuation">(</span>pdf_hemi <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> 2pi<span class="token punctuation">)</span>        Trace a ray r<span class="token punctuation">(</span>p<span class="token punctuation">,</span> wi<span class="token punctuation">)</span>        If ray r hit a non<span class="token operator">-</span>emitting <span class="token builtin">object</span> at q<span class="token punctuation">:</span>            L_indir <span class="token operator">=</span> shade<span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token operator">-</span>wi<span class="token punctuation">)</span> <span class="token operator">*</span> f_r <span class="token operator">*</span> cos \theta <span class="token operator">/</span> pdf_hemi <span class="token operator">/</span> P_RR        Return L_dir <span class="token operator">+</span> L_indir</code></pre><h2 id="æè´¨ä¸å¤–è§‚-Materials-and-Appearance"><a href="#æè´¨ä¸å¤–è§‚-Materials-and-Appearance" class="headerlink" title="æè´¨ä¸å¤–è§‚ Materials and Appearance"></a>æè´¨ä¸å¤–è§‚ Materials and Appearance</h2><ul><li>Material == BRDF!</li></ul><h3 id="ä¸€äº›æè´¨çš„ä¾‹å­"><a href="#ä¸€äº›æè´¨çš„ä¾‹å­" class="headerlink" title="ä¸€äº›æè´¨çš„ä¾‹å­"></a>ä¸€äº›æè´¨çš„ä¾‹å­</h3><h4 id="æ¼«åå°„ææ–™-Diffuse-Lambertian-Material"><a href="#æ¼«åå°„ææ–™-Diffuse-Lambertian-Material" class="headerlink" title="æ¼«åå°„ææ–™ Diffuse/Lambertian Material"></a>æ¼«åå°„ææ–™ Diffuse/Lambertian Material</h4><p>å‡è®¾å…¥å°„å…‰çš„ Radiance å‡åŒ€åˆ†å¸ƒï¼š</p><script type="math/tex; mode=display">\begin{aligned}L_{o}\left(\omega_{o}\right) &=\int_{H^{2}} f_{r} L_{i}\left(\omega_{i}\right) \cos \theta_{i} \mathrm{~d} \omega_{i} \\&=f_{r} L_{i} \int_{H^{2}}\left(\omega_{i}\right) \cos \theta_{i} \mathrm{~d} \omega_{i} \\&=\pi f_{r} L_{i} \\f_{r}=\frac{\rho}{\pi} &-\text { albedo (color) }\end{aligned}</script><p>è¿™é‡Œ $\rho$ å¯ä»¥æ˜¯å¸¸æ•°ï¼ˆå•é€šé“ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯é’ˆå¯¹ä¸åŒé€šé“å®šä¹‰äº†ä¸åŒæ•°å€¼çš„å‘é‡ã€‚</p><h4 id="æŠ›å…‰çš„é‡‘å±-Glossy-Material"><a href="#æŠ›å…‰çš„é‡‘å±-Glossy-Material" class="headerlink" title="æŠ›å…‰çš„é‡‘å± Glossy Material"></a>æŠ›å…‰çš„é‡‘å± Glossy Material</h4><p><img src="https://s2.loli.net/2022/01/17/9xZHgA8u6icXKyo.png" alt="image-20220117103604496"></p><h4 id="ç†æƒ³åå°„-æŠ˜å°„æè´¨"><a href="#ç†æƒ³åå°„-æŠ˜å°„æè´¨" class="headerlink" title="ç†æƒ³åå°„/æŠ˜å°„æè´¨"></a>ç†æƒ³åå°„/æŠ˜å°„æè´¨</h4><p><img src="https://s2.loli.net/2022/01/17/RgoxIXL2qr3MaD7.png" alt="image-20220117103654766"></p><ul><li>åå°„ï¼šåå°„å®šå¾‹</li><li>æŠ˜å°„ï¼šæŠ˜å°„å®šå¾‹ Snellâ€™s Lawï¼Œæ³¨æ„å…¨åå°„çš„æƒ…å†µ</li><li>èƒ½é‡åˆ†é…ï¼šè²æ¶…å°”å…¬å¼ Fresnel Term</li></ul><blockquote><p>ç²¾ç¡®çš„è²æ¶…å°”å…¬å¼ï¼š</p><script type="math/tex; mode=display">\begin{aligned}&R_{\mathrm{s}}=\left|\frac{n_{1} \cos \theta_{\mathrm{i}}-n_{2} \cos \theta_{\mathrm{t}}}{n_{1} \cos \theta_{\mathrm{i}}+n_{2} \cos \theta_{\mathrm{t}}}\right|^{2}=\left|\frac{n_{1} \cos \theta_{\mathrm{i}}-n_{2} \sqrt{1-\left(\frac{n_{1}}{n_{2}} \sin \theta_{\mathrm{i}}\right)^{2}}}{n_{1} \cos \theta_{\mathrm{i}}+n_{2} \sqrt{1-\left(\frac{n_{1}}{n_{2}} \sin \theta_{\mathrm{i}}\right)^{2}}}\right|^{2} \\&R_{\mathrm{p}}=\left|\frac{n_{1} \cos \theta_{\mathrm{t}}-n_{2} \cos \theta_{\mathrm{i}}}{n_{1} \cos \theta_{\mathrm{t}}+n_{2} \cos \theta_{\mathrm{i}}}\right|^{2}=\left|\frac{n_{1} \sqrt{1-\left(\frac{n_{1}}{n_{2}} \sin \theta_{\mathrm{i}}\right)^{2}}-n_{2} \cos \theta_{\mathrm{i}}}{n_{1} \sqrt{1-\left(\frac{n_{1}}{n_{2}} \sin \theta_{\mathrm{i}}\right)^{2}}+n_{2} \cos \theta_{\mathrm{i}}}\right|^{2} \\& R_{eff} = \frac 1 2 (R_s + R_p)\end{aligned}</script></blockquote><p>è¿‘ä¼¼åï¼š</p><script type="math/tex; mode=display">\begin{aligned}R(\theta) &=R_{0}+\left(1-R_{0}\right)(1-\cos \theta)^{5} \\R_{0} &=\left(\frac{n_{1}-n_{2}}{n_{1}+n_{2}}\right)^{2}\end{aligned}</script><h4 id="å¾®è¡¨é¢æ¨¡å‹-Microfacet-Material"><a href="#å¾®è¡¨é¢æ¨¡å‹-Microfacet-Material" class="headerlink" title="å¾®è¡¨é¢æ¨¡å‹ Microfacet Material"></a>å¾®è¡¨é¢æ¨¡å‹ Microfacet Material</h4><p>è™½ç„¶ç‰©ä½“çš„è¡¨é¢æ˜¯ç²—ç³™çš„ï¼Œä½†æ˜¯è‹¥ä»è¿œå¤„çœ‹ï¼Œåˆ™å¯ä»¥å°†ç‰©ä½“è¡¨é¢è§†ä¸ºæ˜¯å¹³çš„ã€‚å³å¯¹äºç²—ç³™è¡¨é¢æ¥è¯´ï¼š</p><ul><li>ä»è¿œå¤„çœ‹å¯ä»¥è§†ä¸ºæ˜¯å¹³çš„ç²—ç³™è¡¨é¢</li><li>ä»è¿‘å¤„çœ‹çœ‹åˆ°çš„æ˜¯é«˜ä½èµ·ä¼çš„é«˜å…‰è¡¨é¢</li></ul><p>ä»è¿œå¤„çœ‹çœ‹åˆ°çš„æ˜¯æè´¨ï¼Œä»è¿‘å¤„çœ‹çœ‹åˆ°çš„æ˜¯å‡ ä½•ã€‚</p><p><img src="https://s2.loli.net/2022/01/17/8ESojAlrTM1sptY.png" alt="image-20220117110551868"></p><p>æˆ‘ä»¬è€ƒè™‘è¿™äº›å¾®è¡¨é¢çš„æ³•çº¿çš„åˆ†å¸ƒæƒ…å†µã€‚å¦‚æœå…¶åˆ†å¸ƒæ–¹å·®è¾ƒå°ï¼Œåˆ™è¡¨é¢æ˜¯ Glossy çš„ï¼›è€Œå¦‚æœå…¶åˆ†å¸ƒæ–¹å·®è¾ƒå¤§ï¼Œæˆ‘ä»¬å¯ä»¥è§†å…¶è¡¨é¢ä¸º Diffuse å‹ã€‚</p><p><img src="https://s2.loli.net/2022/01/17/n8QueMgHco16W5R.png" alt="image-20220117111415698"></p><h4 id="å„å‘åŒæ€§ä¸å„å‘å¼‚æ€§æè´¨"><a href="#å„å‘åŒæ€§ä¸å„å‘å¼‚æ€§æè´¨" class="headerlink" title="å„å‘åŒæ€§ä¸å„å‘å¼‚æ€§æè´¨"></a>å„å‘åŒæ€§ä¸å„å‘å¼‚æ€§æè´¨</h4><p>è¿™æ˜¯ä¸€ç§åˆ†ç±»æè´¨çš„æ–¹å¼ã€‚å„å‘åŒæ€§æè´¨çš„å¾®è¡¨é¢çš„æ³•çº¿åˆ†å¸ƒå¹¶ä¸å…·æœ‰æ˜ç¡®çš„æ–¹å‘æ€§ï¼Œè€Œå„å‘å¼‚æ€§æè´¨çš„æ³•çº¿åˆ†å¸ƒå´å…·æœ‰ï¼Œå› è€Œåè€…å…·æœ‰ä¸€äº›ç‰¹æ®Šçš„æ€§è´¨ã€‚</p><p>ä»å®šä¹‰ä¸Šæ¥è¯´ï¼Œåè€…çš„ BRDF ä¸å…¶ç»å¯¹æ–¹ä½è§’ $\Phi$ æœ‰å…³ã€‚</p><h3 id="BRDF-çš„æ€§è´¨ä¸å…¶æµ‹é‡"><a href="#BRDF-çš„æ€§è´¨ä¸å…¶æµ‹é‡" class="headerlink" title="BRDF çš„æ€§è´¨ä¸å…¶æµ‹é‡"></a>BRDF çš„æ€§è´¨ä¸å…¶æµ‹é‡</h3><blockquote><p>BRDF çš„æ€§è´¨ï¼š</p><ul><li>Non-negativity</li><li>Linearity</li><li>Reciprocity principleï¼š $f_r(w_r \rightarrow w_i) = f_r(w_i \rightarrow w_r)$</li><li>Energy conservation</li><li>Isotropic or anisotropic</li></ul></blockquote><p>æµ‹é‡æ–¹æ³•ï¼š</p><p><img src="https://s2.loli.net/2022/01/17/cegxist9jRBoTdb.png" alt="image-20220117112601733"></p><ul><li>MERL BRDF Database</li></ul><h2 id="çŸ¥è¯†è¡¥å®Œ"><a href="#çŸ¥è¯†è¡¥å®Œ" class="headerlink" title="çŸ¥è¯†è¡¥å®Œ"></a>çŸ¥è¯†è¡¥å®Œ</h2><h3 id="ç›¸æœºã€æ£±é•œä¸å…‰åœº"><a href="#ç›¸æœºã€æ£±é•œä¸å…‰åœº" class="headerlink" title="ç›¸æœºã€æ£±é•œä¸å…‰åœº"></a>ç›¸æœºã€æ£±é•œä¸å…‰åœº</h3><ul><li>æˆåƒ Imaging = Synthesis åˆæˆ + Capture æ•æ‰</li></ul><h4 id="FOV"><a href="#FOV" class="headerlink" title="FOV"></a>FOV</h4><ul><li>å°å­”æˆåƒï¼šé’ˆå­”ç›¸æœº</li></ul><p><img src="https://s2.loli.net/2022/01/17/NtqCuUidJ1kSafb.png" alt="image-20220117162312506"></p><p>è§†åœº $FOV = 2 \arctan(\frac {h} {2f})$â€‹ï¼Œä¸€èˆ¬æˆ‘ä»¬å– $h=36 * 24mm$ æ—¶ $f$ çš„å¤§å°ä½œä¸º $FOV$ çš„å¤§å°ã€‚</p><h4 id="Exposure"><a href="#Exposure" class="headerlink" title="Exposure"></a>Exposure</h4><ul><li>æ›å…‰ Exposure = Time * Irradiance</li></ul><p>å…¶ä¸­ Time ç”±å¿«é—¨æ§åˆ¶ï¼Œèƒ½é‡ç”±å…‰åœˆçš„å¤§å°å’Œç„¦è·å†³å®šã€‚æ­¤å¤–ï¼ŒISO æ„Ÿå…‰åº¦å¯ä»¥è§†ä¸ºæ˜¯åæœŸå¤„ç†ï¼Œç»™æ„Ÿå…‰çš„å¤šå°‘è¿›è¡Œå€å¢ã€‚è¿™äº›å› ç´ éƒ½èƒ½å½±å“æˆåƒçš„äº®åº¦ã€‚</p><p><img src="https://s2.loli.net/2022/01/17/73moA5gzpaDlFU9.png" alt="image-20220117163652644"></p><p>åŸç†ï¼šISO ä½œä¸ºåæœŸå¤„ç†ï¼Œå¯¹äºå«æœ‰å™ªå£°çš„ä¿¡å·ï¼ŒåŒæ—¶å°†ä¿¡å·æ”¾å¤§ï¼Œå™ªå£°ä¹Ÿéšä¹‹è¢«æ”¾å¤§ï¼Œå› æ­¤ä¼šæ˜¾å¾— Noisyï¼›F-Number(F-Stop) ä¸€èˆ¬å†™ä½œ F<strong>N</strong> æˆ– F/<strong>N</strong>ã€‚è¿™é‡Œçš„ N å¯ä»¥è¿‘ä¼¼ç†è§£ä¸ºå…‰åœˆç›´å¾„çš„å€’æ•°ã€‚å¿«é—¨é€Ÿåº¦å˜å¿«ä¹Ÿä¼šé™ä½ Exposureï¼Œè€Œå˜æ…¢ä¼šäº§ç”Ÿæ¨¡ç³Šã€‚</p><h4 id="è–„é€é•œ-Thin-lens"><a href="#è–„é€é•œ-Thin-lens" class="headerlink" title="è–„é€é•œ Thin lens"></a>è–„é€é•œ Thin lens</h4><p>å¹³è¡Œå…‰å…¥å°„ï¼Œå‡ºå°„å…‰è¿‡ç„¦ç‚¹ï¼›è¿‡ç„¦ç‚¹å…‰å…¥å°„ï¼Œå‡ºå°„å…‰å¹³è¡Œï¼›ç„¦è·å¯ä»»æ„æ”¹å˜ï¼›$\frac 1 f = \frac 1 {z_i} + \frac 1 {z_o}$â€‹ã€‚</p><p>åˆ©ç”¨è–„é€é•œå¯ä»¥è§£é‡Šæ™¯æ·±çš„é—®é¢˜ï¼š</p><p><img src="https://s2.loli.net/2022/01/17/r8hei9FOAUZWb7P.png" alt="image-20220117165250088"></p><h4 id="å…‰åœº-Light-Field-Lumigraph"><a href="#å…‰åœº-Light-Field-Lumigraph" class="headerlink" title="å…‰åœº Light Field / Lumigraph"></a>å…‰åœº Light Field / Lumigraph</h4><ul><li>å…¨å…‰å‡½æ•°ï¼šæˆ‘ä»¬çœ‹åˆ°çš„ä¸–ç•Œæ˜¯ä¸ƒç»´å‡½æ•°</li></ul><p><img src="https://s2.loli.net/2022/01/17/OWevpzGJ1g7kVf4.png" alt="image-20220117171128615"></p><ul><li>å…‰åœºæ˜¯å…¨å…‰å‡½æ•°åœ¨ä½ç½®é›†åˆä¸Šçš„é™åˆ¶ï¼Œç»™å®šä»»ä½•ä¸€ä¸ªä½ç½®å’Œä»»ä½•ä¸€ä¸ªæ–¹å‘ï¼Œè¾“å‡ºå…‰çº¿çš„å¼ºåº¦ã€‚<ul><li>è¦æƒ³æè¿°ä¸€ä¸ªå‘å…‰ç‰©ä½“å¯¹äºä»»ä½•ä½ç½®ä»»ä½•æ–¹å‘çš„è¾å°„è´¡çŒ®ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç”¨ä¸€ä¸ªåŒ…å›´ç›’ç½©ä½è¿™ä¸ªç‰©ä½“ï¼Œåªéœ€è¦çŸ¥é“è¿™ä¸ªåŒ…å›´ç›’ä¸Šä»»æ„ä¸€ç‚¹å¯¹äºä»»æ„æ–¹å‘çš„è¾å°„è´¡çŒ®ï¼Œå°±å¯ä»¥ç”¨äºæ›¿ä»£è¿™ä¸ªç‰©ä½“çš„è¾å°„è´¡çŒ®ã€‚</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªç‰©ä½“ï¼Œæˆ‘ä»¬ä½œå…¨å…‰å‡½æ•°åœ¨å…¶åŒ…å›´ç›’ä¸Šçš„é™åˆ¶ï¼Œåªè¦å¼„æ¸…æ¥šå…¶åŒ…å›´ç›’ä¸Šä»»æ„ä¸€ç‚¹å¯¹äºä»»æ„æ–¹å‘çš„å…‰ç…§è¾å°„ï¼Œå°±å¯ä»¥ç”¨äºæ›¿ä»£è¿™ä¸ªå‘å…‰ç‰©ä½“ã€‚è¿™æ ·åšæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œ Query.</li><li>U-V å¹³é¢ä¸ S-T å¹³é¢</li><li>å…‰åœºç…§ç›¸æœº</li></ul></li></ul><h3 id="é¢œè‰²ä¸æ„ŸçŸ¥"><a href="#é¢œè‰²ä¸æ„ŸçŸ¥" class="headerlink" title="é¢œè‰²ä¸æ„ŸçŸ¥"></a>é¢œè‰²ä¸æ„ŸçŸ¥</h3><ul><li>è°±åŠŸç‡å¯†åº¦ï¼ˆSPDï¼‰ï¼Œå…·æœ‰çº¿æ€§å¯åŠ æ€§ï¼›</li><li><strong>é¢œè‰²</strong>äº‹å®ä¸Šæ˜¯äººçš„ä¸€ç§æ„ŸçŸ¥ï¼Œå®ƒå¹¶ä¸æ˜¯å…‰çš„ä¸€ç§å±æ€§ï¼›</li><li>äººæ„Ÿå…‰çš„ç”Ÿç‰©åŸºç¡€ï¼šè§†ç½‘è†œä¸Šçš„ Cone å‹ç»†èƒ</li><li>åŒè‰²å¼‚è°±ç°è±¡çš„å­˜åœ¨</li><li>é¢œè‰²çš„æ··åˆä¸åŒ¹é…<ul><li>åŠ è‰²ç³»ç»Ÿ</li></ul></li><li>é¢œè‰²ç©ºé—´ä¸è‰²åŸŸï¼ŒRGB, XYZ, HSV, Lab, CMYK</li></ul><h2 id="åŠ¨ç”»ä¸æ¨¡æ‹Ÿ"><a href="#åŠ¨ç”»ä¸æ¨¡æ‹Ÿ" class="headerlink" title="åŠ¨ç”»ä¸æ¨¡æ‹Ÿ"></a>åŠ¨ç”»ä¸æ¨¡æ‹Ÿ</h2><h3 id="è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ"><a href="#è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ" class="headerlink" title="è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ"></a>è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ</h3><ul><li>è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿï¼šä¸€ç³»åˆ—ç›¸äº’è¿æ¥çš„è´¨ç‚¹å’Œå¼¹ç°§</li></ul><script type="math/tex; mode=display">\boldsymbol{f}_{a \rightarrow b}=k_{s} \frac{\boldsymbol{b}-\boldsymbol{a}}{\|\boldsymbol{b}-\boldsymbol{a}\|}(\|\boldsymbol{b}-\boldsymbol{a}\|-l) \\f_{b \rightarrow a} = - f_{ a \rightarrow b}</script><p>æˆ‘ä»¬å†å¼•å…¥å†…éƒ¨æŸè€—æ‘©æ“¦åŠ›ä»¥è®©è¯¥ç³»ç»Ÿå¯ä»¥åœä¸‹æ¥ï¼š</p><script type="math/tex; mode=display">\boldsymbol{f}_{\boldsymbol{b}}=-k_{d} \ \left( \frac{\boldsymbol{b}-\boldsymbol{a}}{\|\boldsymbol{b}-\boldsymbol{a}\|} \cdot(\dot{\boldsymbol{b}}-\dot{\boldsymbol{a}}) \right)\  \frac{\boldsymbol{b}-\boldsymbol{a}}{\|\boldsymbol{b}-\boldsymbol{a}\|}</script><ul><li>è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿç»„æˆçš„ç»“æ„ï¼š<ul><li>Sheet / Block / â€¦</li><li>ä¸‹å›¾ä¸ºç”¨è´¨ç‚¹å¼¹ç°§ç³»ç»Ÿå¯¹å¸ƒæ–™çš„æ¨¡æ‹Ÿï¼š</li></ul></li></ul><p><img src="https://s2.loli.net/2022/01/18/nKJWEFLij1BHOXz.png" alt="image-20220118112053335"></p><h3 id="ç²’å­ç³»ç»Ÿ"><a href="#ç²’å­ç³»ç»Ÿ" class="headerlink" title="ç²’å­ç³»ç»Ÿ"></a>ç²’å­ç³»ç»Ÿ</h3><p>æŠŠæˆ‘ä»¬è€ƒè™‘çš„ç‰©ä½“ç»†åˆ†æˆç²’å­è¡¨ç¤ºï¼Œç„¶ååœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§ä¸­ï¼š</p><ul><li>(å¦‚æœéœ€è¦) åˆ›å»ºæ–°ç²’å­</li><li>è®¡ç®—æ¯ä¸ªç²’å­ä¸Šçš„ä½œç”¨åŠ›</li><li>æ›´æ–°æ¯ä¸ªç²’å­çš„ä½ç½®å’Œé€Ÿåº¦</li><li>ï¼ˆå¦‚æœéœ€è¦ï¼‰ç§»é™¤æŸäº›ä¾‹å­</li><li>æ¸²æŸ“è¯¥å¸§</li></ul><h3 id="è¿åŠ¨å­¦"><a href="#è¿åŠ¨å­¦" class="headerlink" title="è¿åŠ¨å­¦"></a>è¿åŠ¨å­¦</h3><ul><li>æ­£å‘è¿åŠ¨å­¦ï¼šé€šè¿‡å®šä¹‰å„ä¸ªéƒ¨ä»¶ä¹‹é—´çš„è¿æ¥æ–¹å¼ï¼Œç»™å®šå‚æ•°ï¼ˆå¦‚ $l, \theta$ï¼‰ï¼Œå³å¯è®¡ç®—ç›¸åº”éƒ¨ä»¶çš„ä½ç½®</li><li>é€†è¿åŠ¨å­¦ï¼šå¯ä»¥é€šè¿‡æ‹–æ‹½ç­‰æ–¹å¼æ”¹å˜æœ€ç»ˆç›®æ ‡éƒ¨ä»¶çš„ä½ç½®ï¼Œä¸­é—´çš„å„ä¸ªéƒ¨ä»¶çš„æƒ…å†µè‡ªåŠ¨è®¡ç®—å¾—å‡º</li></ul><blockquote><p>é€†è¿åŠ¨å­¦çš„åº”ç”¨ï¼š Rigging</p><p>Rigging æ˜¯å¯¹äºä¸€ä¸ªè§’è‰²çš„æ§åˆ¶ï¼Œå°±åƒæ˜¯æçº¿æœ¨å¶ä¸€æ ·ï¼Œæ”¹å˜è§’è‰²çš„å§¿æ€æˆ–è¡¨æƒ…â€¦</p><p>ä¸åŒè§’è‰²çš„ Rigging æ˜¯ä¸åŒçš„â€¦</p></blockquote><h3 id="æ±‚è§£"><a href="#æ±‚è§£" class="headerlink" title="æ±‚è§£"></a>æ±‚è§£</h3><ul><li><strong>Eulerâ€™s Method</strong>ï¼šç®€å•çš„è¿­ä»£æ³•ï¼Œååˆ†ä¸ç²¾ç¡®ä¸”ä¸ç¨³å®š</li></ul><script type="math/tex; mode=display">\begin{aligned}&\boldsymbol{x}^{t+\Delta t}=\boldsymbol{x}^{t}+\Delta t \dot{\boldsymbol{x}}^{t} \\&\dot{\boldsymbol{x}}^{t+\Delta t}=\dot{\boldsymbol{x}}^{t}+\Delta t \ddot{\boldsymbol{x}}^{t}\end{aligned}</script><p>ç”¨æ•°å€¼è¿­ä»£çš„æ–¹æ³•è§£ ODE å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li>è¯¯å·®ï¼šéšç€è¿­ä»£æ­¥æ•°çš„å¢åŠ ï¼Œè¿­ä»£ç»“æœå’ŒçœŸå®ç»“æœå­˜åœ¨åç§»</li><li>ç¨³å®šæ€§ï¼šåŸæœ¬æ”¶æ•›çš„ç»“æœ<strong>å‘æ•£</strong>ï¼Œå¦‚èºæ—‹é€Ÿåº¦åœºä¸­ç²’å­åº”è¯¥æœ€ç»ˆåšåŒ€é€Ÿåœ†å‘¨è¿åŠ¨ï¼Œè€Œå®é™…æ¨¡æ‹Ÿå´ä¼šé£å‡ºè¯¥åœº</li></ul><p>äºæ˜¯ï¼Œæˆ‘ä»¬æœ‰è‹¥å¹²æ–¹æ³•è§£å†³è¿™ç§ä¸ç¨³å®šæ€§ï¼š</p><ul><li><strong>ä¸­ç‚¹æ³• Midpoint Method</strong></li></ul><script type="math/tex; mode=display">\begin{aligned}x_{\mathrm{mid}} &=x(t)+\Delta t / 2 \cdot v(x(t), t) \\x(t+\Delta t) &=x(t)+\Delta t \cdot v\left(x_{\mathrm{mid}}, t\right)\end{aligned}\</script><ul><li><strong>Adaptive Step Size è‡ªé€‚åº”æ­¥é•¿</strong></li></ul><p>æŒ‰ç…§è¯¯å·®é¡¹åˆ¤æ–­æ˜¯å¦å°† $\Delta t$â€‹ ç»§ç»­ç»†åˆ†â€¦</p><pre class="language-none"><code class="language-none">Repeat until error is below certain threshold epsilon:Compute x(T) one Euler step, size TCompute x(T&#x2F;2) two Euler steps, size T&#x2F;2Compute error &#x3D; || x(T) - x(T&#x2F;2) ||if (error &gt; threshold):T &lt;- reduced(T)else:break</code></pre><ul><li><strong>éšå¼æ¬§æ‹‰æ–¹æ³•</strong></li></ul><script type="math/tex; mode=display">\begin{aligned}\boldsymbol{x}^{t+\Delta t} &=\boldsymbol{x}^{t}+\Delta t \dot{\boldsymbol{x}}^{t+\Delta t} \\\dot{\boldsymbol{x}}^{t+\Delta t} &=\dot{\boldsymbol{x}}^{t}+\Delta t \ddot{\boldsymbol{x}}^{t+\Delta t}\end{aligned}</script><p>è¿™ç§æ–¹æ³•æä¾›äº†æ›´å¥½çš„ç¨³å®šæ€§ï¼Œä¸‹é¢æˆ‘ä»¬å°±è¿›è¡Œç¨³å®šæ€§çš„å®šä¹‰ï¼š</p><ul><li>å±€éƒ¨æˆªæ–­è¯¯å·® Truncation Error</li><li>ç´¯ç§¯è¯¯å·® Accumulated Error</li></ul><p>æˆ‘ä»¬ä¸€èˆ¬ç ”ç©¶è¯¯å·®å°±æ˜¯ç ”ç©¶è¿™ä¸¤ä¸ªè¯¯å·®å’Œæˆ‘ä»¬æ‰€å–çš„ $\Delta t$ çš„é˜¶æ•°çš„å…³ç³»ã€‚</p><p>æ¨å¯¼å¯ä»¥å¾—å‡ºï¼Œéšå¼æ¬§æ‹‰æ–¹æ³•ï¼š</p><ul><li>Local Truncation Error: $O(h^2)$</li><li>Global Truncation Error: $O(h)$</li><li>$h$ is the step size, i.e. $\Delta t$â€‹.</li></ul><p>è¯¯å·®æ˜¯ $O(h)$ çš„æ„æ€æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å°†æ­¥é•¿ç¼©å°åˆ°åŸæ¥çš„ä¸€åŠï¼Œé‚£ä¹ˆè¯¯å·®æœŸæœ›ä¹Ÿç¼©å°åˆ°åŸæ¥çš„ä¸€åŠã€‚</p><p>Runge-Kutta Families ä¸­çš„ RK4 æ–¹æ³•å¹¿æ³›å¾—åˆ°è¿ç”¨ï¼Œæ˜¯ä¸€ä¸ª 4 é˜¶çš„æ–¹æ³•ã€‚</p><ul><li><strong>Position-Based / Verlet Integration</strong>ï¼Œä¸€ç§ä¸æ˜¯åŸºäºç‰©ç†çš„æ–¹æ³•<ul><li>è¿™ç§æ–¹æ³•å¿«é€Ÿç®€å•ï¼Œä½†æ˜¯å¯èƒ½ä¸ä¼šéµå®ˆèƒ½é‡å®ˆæ’ç­‰ç‰©ç†å®šå¾‹</li></ul></li></ul><p>ä¸‹é¢ä¸¾ä¸€ä¸ªç®€å•çš„ Position-Based æ–¹æ³•çš„ä¾‹å­ï¼Œå³æ¸²æŸ“å¦‚ä¸‹å›¾ç‰‡çš„ä¾‹å­ã€‚</p><p><img src="https://s2.loli.net/2022/01/18/Z21NyICghTidwWG.png" alt="image-20220118165158591"></p><p>å…³é”®æƒ³æ³•å¦‚ä¸‹ï¼š</p><ul><li>å°†æ°´è§†ä¸ºæ˜¯å¾ˆå¤šå°åˆšä½“çƒç»„æˆçš„</li><li>è®¤ä¸ºæ°´çš„å¯†åº¦æ˜¯ä¸å˜çš„ï¼Œå³è¿™äº›å°åˆšä½“çƒæ˜¯ä¸å¯ä»¥è¢«å‹ç¼©çš„</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦æŸå¤„æ°´çš„å¯†åº¦æ”¹å˜äº†ï¼Œå°±åº”è¯¥é€šè¿‡é‡æ–°åˆ†å¸ƒä¸åŒåŒºåŸŸçš„åˆšä½“çƒçš„æ•°é‡æ¥â€œçŸ«æ­£â€è¿™ä¸ªå˜åŒ–<ul><li>éœ€è¦çŸ¥é“æ°´çš„å¯†åº¦åœºçš„æ¢¯åº¦ï¼</li><li>è¿™ä¸ªæ°´çš„å¯†åº¦åœºæ˜¯ç”±åˆšä½“çƒæ‰€åœ¨ä½ç½®å†³å®šçš„â€¦</li></ul></li><li>å¦‚ä½•çŸ«æ­£ï¼ŸGradient Descent!</li></ul><blockquote><p>æ¨¡æ‹Ÿæ–¹æ³•çš„æ€»ç»“ï¼š</p><ul><li>ï¼ˆè´¨ç‚¹æ³•ï¼‰æ‹‰æ ¼æœ—æ—¥æ–¹æ³•ï¼Œå°†ç‰©ä½“ç»†åˆ†æˆä¸€ä¸ªä¸ªè´¨ç‚¹</li><li>ï¼ˆç½‘æ ¼æ³•ï¼‰æ¬§æ‹‰æ–¹æ³•ï¼Œå°†æ•´ä¸ªç©ºé—´åˆ†ä¸ºä¸åŒçš„ç½‘æ ¼ï¼Œè€ƒè™‘ç©ºé—´ç½‘æ ¼ä¸­å­˜åœ¨çš„ç‰©ä½“éšç€æ—¶é—´çš„å˜åŒ–</li></ul></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;GAMES 101 ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦åŸºç¡€ ç¬”è®°ï¼ˆä¸‹ç¯‡ï¼‰.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…‰çº¿è¿½è¸ªï¼ˆWhitted-styleï¼Œæ±‚äº¤ç®—æ³•ï¼ŒåŠ é€Ÿç»“æ„ï¼Œè¾å°„åº¦é‡å­¦ï¼Œè·¯å¾„è¿½è¸ªï¼‰&lt;/li&gt;
&lt;li&gt;æè´¨ä¸å¤–è§‚&lt;/li&gt;
&lt;li&gt;åŠ¨ç”»ä¸æ¨¡æ‹Ÿ&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="ç†è®º" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/"/>
    
    <category term="ç†è®º/è®¡ç®—æœºå›¾å½¢å­¦" scheme="https://www.c7w.tech/categories/%E7%90%86%E8%AE%BA/%E7%90%86%E8%AE%BA-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
    
    <category term="å›¾å½¢å­¦" scheme="https://www.c7w.tech/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>Python Pandas åº“ä½¿ç”¨æŒ‡åŒ—</title>
    <link href="https://www.c7w.tech/python-pandas/"/>
    <id>https://www.c7w.tech/python-pandas/</id>
    <published>2022-01-11T12:26:30.000Z</published>
    <updated>2022-01-29T13:45:58.186Z</updated>
    
    <content type="html"><![CDATA[<p><code>Pandas</code> æ˜¯ Python ä¸‹çš„é«˜æ€§èƒ½çš„æ•°æ®ç®¡ç†å·¥å…·ä¸æ•°æ®åˆ†æå·¥å…·ã€‚</p><p>æœ¬æ–‡ä¸­ä»‹ç»äº† <code>Pandas</code> åº“ä¸­çš„ä¸€äº›å¸¸ç”¨ç±»ï¼Œç„¶åè®°å½•äº†ä¸€äº›ç®€å•çš„ç­›é€‰ï¼Œåˆ‡ç‰‡ç­‰ç­‰ç”¨æ³•ã€‚</p><a id="more"></a><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><ul><li>ï¼ˆä¸»è¦æ•°æ®ç»“æ„ï¼‰Pandas çš„ä¸»è¦æ•°æ®ç»“æ„æ˜¯ <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series">Series</a>ï¼ˆä¸€ç»´æ•°æ®ï¼‰ä¸ <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame">DataFrame</a>ï¼ˆäºŒç»´æ•°æ®ï¼‰ã€‚</li><li>ï¼ˆå¤§å°ä¸å˜ï¼‰Pandas æ‰€æœ‰æ•°æ®ç»“æ„çš„å€¼éƒ½æ˜¯å¯å˜çš„ï¼Œä½†æ•°æ®ç»“æ„çš„å¤§å°å¹¶ééƒ½æ˜¯å¯å˜çš„ï¼Œæ¯”å¦‚ï¼ŒSeries çš„é•¿åº¦ä¸å¯æ”¹å˜ï¼Œä½† DataFrame é‡Œå°±å¯ä»¥æ’å…¥åˆ—ã€‚</li><li>ï¼ˆå€¾å‘äºå¤åˆ¶ï¼‰Pandas é‡Œï¼Œç»å¤§å¤šæ•°æ–¹æ³•éƒ½ä¸æ”¹å˜åŸå§‹çš„è¾“å…¥æ•°æ®ï¼Œè€Œæ˜¯å¤åˆ¶æ•°æ®ï¼Œç”Ÿæˆæ–°çš„å¯¹è±¡ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒåŸå§‹è¾“å…¥æ•°æ®<strong>ä¸å˜</strong>æ›´ç¨³å¦¥ã€‚</li></ul><h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</code></pre><h3 id="ç”Ÿæˆ-Series-ä¸-DataFrame"><a href="#ç”Ÿæˆ-Series-ä¸-DataFrame" class="headerlink" title="ç”Ÿæˆ Series ä¸ DataFrame"></a>ç”Ÿæˆ Series ä¸ DataFrame</h3><ul><li>Series çš„ç”Ÿæˆï¼šé»˜è®¤ä½¿ç”¨æ•´æ•°ç´¢å¼•</li></ul><pre class="language-none"><code class="language-none">&gt;&gt;&gt; s &#x3D; pd.Series([1,3,5,np.nan,6,8])&gt;&gt;&gt; s0    1.01    3.02    5.03    NaN4    6.05    8.0dtype: float64</code></pre><ul><li>DataFrame çš„ç”Ÿæˆï¼šâ‘  æŒ‡å®šæ•°æ®ï¼Œç´¢å¼•ï¼Œåˆ—åä¸æ˜¯å¦ä¸ºæ‹·è´<ul><li><code>class pandas.DataFrame(data=None, index=None, columns=None, dtype=None, copy=None)</code></li></ul></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> dates <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20220101'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> datesDatetimeIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'2022-01-01'</span><span class="token punctuation">,</span> <span class="token string">'2022-01-02'</span><span class="token punctuation">,</span> <span class="token string">'2022-01-03'</span><span class="token punctuation">,</span> <span class="token string">'2022-01-04'</span><span class="token punctuation">,</span>               <span class="token string">'2022-01-05'</span><span class="token punctuation">,</span> <span class="token string">'2022-01-06'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>              dtype<span class="token operator">=</span><span class="token string">'datetime64[ns]'</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>dates<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.165424</span> <span class="token operator">-</span><span class="token number">0.095599</span>  <span class="token number">0.940562</span> <span class="token operator">-</span><span class="token number">0.629898</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">0.237563</span>  <span class="token number">0.252783</span>  <span class="token number">1.362851</span> <span class="token operator">-</span><span class="token number">1.525588</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">2.222287</span> <span class="token operator">-</span><span class="token number">0.591918</span> <span class="token operator">-</span><span class="token number">1.450194</span>  <span class="token number">0.860104</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span> <span class="token operator">-</span><span class="token number">0.560238</span>  <span class="token number">0.548346</span> <span class="token operator">-</span><span class="token number">0.691656</span> <span class="token operator">-</span><span class="token number">0.810484</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">1.600348</span>  <span class="token number">0.242665</span>  <span class="token number">0.836329</span>  <span class="token number">0.372371</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.332250</span> <span class="token operator">-</span><span class="token number">0.941505</span>  <span class="token number">0.110009</span> <span class="token operator">-</span><span class="token number">1.478538</span><span class="token operator">>></span><span class="token operator">></span> a1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"A"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token operator">>></span><span class="token operator">></span> a2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"A"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token operator">>></span><span class="token operator">></span> pd1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> pd1   A  B    c    C<span class="token number">0</span>  <span class="token number">1</span>  <span class="token number">2</span>  <span class="token number">3.0</span>  NaN<span class="token number">1</span>  <span class="token number">1</span>  <span class="token number">3</span>  NaN  <span class="token number">5.0</span></code></pre><ul><li>DataFrame çš„ç”Ÿæˆï¼šâ‘¡ read_csv</li></ul><pre class="language-python" data-language="python"><code class="language-python">task <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'./Data/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>camp_name<span class="token punctuation">&#125;</span></span><span class="token string">/task.csv'</span></span><span class="token punctuation">)</span>         tid     name   score<span class="token number">0</span>  <span class="token number">0001</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>A   ä»»åŠ¡ <span class="token number">1</span><span class="token operator">-</span>A       <span class="token number">5</span><span class="token number">1</span>  <span class="token number">0001</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>B   ä»»åŠ¡ <span class="token number">1</span><span class="token operator">-</span>B       <span class="token number">7</span><span class="token number">2</span>  <span class="token number">0001</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>C   ä»»åŠ¡ <span class="token number">1</span><span class="token operator">-</span>C       <span class="token number">2</span><span class="token number">3</span>  <span class="token number">0001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span>A   ä»»åŠ¡ <span class="token number">2</span><span class="token operator">-</span>A       <span class="token number">5</span><span class="token number">4</span>  <span class="token number">0001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span>B   ä»»åŠ¡ <span class="token number">2</span><span class="token operator">-</span>B       <span class="token number">5</span><span class="token number">5</span>  <span class="token number">0001</span><span class="token operator">-</span><span class="token number">99</span><span class="token operator">-</span>A    Bonus       <span class="token number">1</span></code></pre><ul><li>DataFrame çš„ç”Ÿæˆï¼šâ‘¢ data ä¸­ä¼ å…¥ Seriesï¼Œåˆ©ç”¨å…¶æ‰€æœ‰çš„ indexã€‚å¦‚æœä¸åŒåˆ—çš„ index ä¸ matchï¼Œé‚£ä¹ˆæŠ¥é”™ã€‚</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># Example</span>df2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>                     <span class="token string">'B'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20130102'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'C'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'D'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'E'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Categorical<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">>></span><span class="token operator">></span> df2     A          B    C  D      E    F<span class="token number">0</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">1</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo<span class="token number">2</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">3</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo<span class="token comment"># Test</span>df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>                     <span class="token string">'B'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20130102'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'C'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'D'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'E'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Categorical<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/frame.py"</span><span class="token punctuation">,</span> line <span class="token number">614</span><span class="token punctuation">,</span> <span class="token keyword">in</span> __init__    mgr <span class="token operator">=</span> dict_to_mgr<span class="token punctuation">(</span>data<span class="token punctuation">,</span> index<span class="token punctuation">,</span> columns<span class="token punctuation">,</span> dtype<span class="token operator">=</span>dtype<span class="token punctuation">,</span> copy<span class="token operator">=</span>copy<span class="token punctuation">,</span> typ<span class="token operator">=</span>manager<span class="token punctuation">)</span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/internals/construction.py"</span><span class="token punctuation">,</span> line <span class="token number">464</span><span class="token punctuation">,</span> <span class="token keyword">in</span> dict_to_mgr    <span class="token keyword">return</span> arrays_to_mgr<span class="token punctuation">(</span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/internals/construction.py"</span><span class="token punctuation">,</span> line <span class="token number">119</span><span class="token punctuation">,</span> <span class="token keyword">in</span> arrays_to_mgr    index <span class="token operator">=</span> _extract_index<span class="token punctuation">(</span>arrays<span class="token punctuation">)</span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/internals/construction.py"</span><span class="token punctuation">,</span> line <span class="token number">649</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _extract_index    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>ValueError<span class="token punctuation">:</span> array length <span class="token number">4</span> does <span class="token keyword">not</span> match index length <span class="token number">6</span>        <span class="token comment"># Another Test</span>df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>                     <span class="token string">'B'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20130102'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'C'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'D'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'E'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Categorical<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/frame.py"</span><span class="token punctuation">,</span> line <span class="token number">614</span><span class="token punctuation">,</span> <span class="token keyword">in</span> __init__    mgr <span class="token operator">=</span> dict_to_mgr<span class="token punctuation">(</span>data<span class="token punctuation">,</span> index<span class="token punctuation">,</span> columns<span class="token punctuation">,</span> dtype<span class="token operator">=</span>dtype<span class="token punctuation">,</span> copy<span class="token operator">=</span>copy<span class="token punctuation">,</span> typ<span class="token operator">=</span>manager<span class="token punctuation">)</span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/internals/construction.py"</span><span class="token punctuation">,</span> line <span class="token number">464</span><span class="token punctuation">,</span> <span class="token keyword">in</span> dict_to_mgr    <span class="token keyword">return</span> arrays_to_mgr<span class="token punctuation">(</span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/internals/construction.py"</span><span class="token punctuation">,</span> line <span class="token number">119</span><span class="token punctuation">,</span> <span class="token keyword">in</span> arrays_to_mgr    index <span class="token operator">=</span> _extract_index<span class="token punctuation">(</span>arrays<span class="token punctuation">)</span>  File <span class="token string">"/home/c7w/.local/lib/python3.8/site-packages/pandas/core/internals/construction.py"</span><span class="token punctuation">,</span> line <span class="token number">649</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _extract_index    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>ValueError<span class="token punctuation">:</span> array length <span class="token number">4</span> does <span class="token keyword">not</span> match index length <span class="token number">7</span>                <span class="token comment"># Another Test</span>df3 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span>                     <span class="token string">'B'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20130102'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'C'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'D'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'E'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Categorical<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token string">'foo'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df3     A          B    C     D      E    F<span class="token number">0</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">12.0</span>   test  foo<span class="token number">1</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">12.0</span>  train  foo<span class="token number">2</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">12.0</span>   test  foo<span class="token number">3</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">12.0</span>  train  foo</code></pre><h3 id="æŸ¥çœ‹æ•°æ®"><a href="#æŸ¥çœ‹æ•°æ®" class="headerlink" title="æŸ¥çœ‹æ•°æ®"></a>æŸ¥çœ‹æ•°æ®</h3><ul><li>åˆ—æ•°æ®ç±»å‹</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df2<span class="token punctuation">.</span>dtypesA           float64B    datetime64<span class="token punctuation">[</span>ns<span class="token punctuation">]</span>C           float32D             int32E          categoryF            <span class="token builtin">object</span>dtype<span class="token punctuation">:</span> <span class="token builtin">object</span></code></pre><ul><li>é¢„è§ˆæ•°æ®</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df2     A          B    C  D      E    F<span class="token number">0</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">1</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo<span class="token number">2</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">3</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo<span class="token operator">>></span><span class="token operator">></span> df2<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># é»˜è®¤æœ€å¤šæ˜¾ç¤º 5 æ¡æ•°æ®</span>     A          B    C  D      E    F<span class="token number">0</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">1</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo<span class="token number">2</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">3</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo<span class="token operator">>></span><span class="token operator">></span> df2<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>     A          B    C  D      E    F<span class="token number">0</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">1</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo<span class="token operator">>></span><span class="token operator">></span> df2<span class="token punctuation">.</span>tail<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>     A          B    C  D      E    F<span class="token number">2</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>   test  foo<span class="token number">3</span>  <span class="token number">1.0</span> <span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.0</span>  <span class="token number">3</span>  train  foo</code></pre><ul><li>æ˜¾ç¤ºç´¢å¼•ä¸åˆ—</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df2<span class="token punctuation">.</span>indexInt64Index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int64'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df2<span class="token punctuation">.</span>columnsIndex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'object'</span><span class="token punctuation">)</span></code></pre><ul><li>è½¬æ¢æˆ numpy å¯¹è±¡</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>dates<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.451372</span>  <span class="token number">1.581206</span> <span class="token operator">-</span><span class="token number">0.499837</span> <span class="token operator">-</span><span class="token number">0.549320</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">0.508692</span> <span class="token operator">-</span><span class="token number">0.304325</span>  <span class="token number">1.995154</span> <span class="token operator">-</span><span class="token number">0.895727</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">0.681460</span>  <span class="token number">1.214341</span> <span class="token operator">-</span><span class="token number">0.608446</span> <span class="token operator">-</span><span class="token number">1.054553</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span> <span class="token operator">-</span><span class="token number">1.032206</span>  <span class="token number">0.237051</span>  <span class="token number">1.502665</span> <span class="token operator">-</span><span class="token number">0.048824</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">1.707183</span>  <span class="token number">0.382228</span>  <span class="token number">1.335121</span> <span class="token operator">-</span><span class="token number">1.099418</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.895205</span>  <span class="token number">0.982582</span>  <span class="token number">0.188397</span>  <span class="token number">0.023960</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># çº¯ float ç±»å‹ï¼Œè½¬æ¢é€Ÿåº¦è¾ƒå¿«</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.45137221</span><span class="token punctuation">,</span>  <span class="token number">1.58120564</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.49983697</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.54931982</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span> <span class="token number">0.50869221</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.30432474</span><span class="token punctuation">,</span>  <span class="token number">1.99515425</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.89572709</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span> <span class="token number">0.68146026</span><span class="token punctuation">,</span>  <span class="token number">1.21434138</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.60844611</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.05455281</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.03220563</span><span class="token punctuation">,</span>  <span class="token number">0.23705134</span><span class="token punctuation">,</span>  <span class="token number">1.50266499</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.04882351</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span> <span class="token number">1.70718305</span><span class="token punctuation">,</span>  <span class="token number">0.38222751</span><span class="token punctuation">,</span>  <span class="token number">1.33512092</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.09941788</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span> <span class="token number">0.89520526</span><span class="token punctuation">,</span>  <span class="token number">0.98258218</span><span class="token punctuation">,</span>  <span class="token number">0.18839673</span><span class="token punctuation">,</span>  <span class="token number">0.02396049</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df2<span class="token punctuation">.</span>to_numpy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># å¤åˆæ•°æ®ç±»å‹ï¼Œè½¬æ¢é€Ÿåº¦æ…¢</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> Timestamp<span class="token punctuation">(</span><span class="token string">'2013-01-02 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> Timestamp<span class="token punctuation">(</span><span class="token string">'2013-01-02 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> Timestamp<span class="token punctuation">(</span><span class="token string">'2013-01-02 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> Timestamp<span class="token punctuation">(</span><span class="token string">'2013-01-02 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      dtype<span class="token operator">=</span><span class="token builtin">object</span><span class="token punctuation">)</span></code></pre><ul><li>æ•°æ®ç»Ÿè®¡ä¿¡æ¯</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>              A         B         C         Dcount  <span class="token number">6.000000</span>  <span class="token number">6.000000</span>  <span class="token number">6.000000</span>  <span class="token number">6.000000</span>mean   <span class="token number">0.384827</span>  <span class="token number">0.682181</span>  <span class="token number">0.652176</span> <span class="token operator">-</span><span class="token number">0.603980</span>std    <span class="token number">0.981800</span>  <span class="token number">0.698997</span>  <span class="token number">1.106773</span>  <span class="token number">0.497813</span><span class="token builtin">min</span>   <span class="token operator">-</span><span class="token number">1.032206</span> <span class="token operator">-</span><span class="token number">0.304325</span> <span class="token operator">-</span><span class="token number">0.608446</span> <span class="token operator">-</span><span class="token number">1.099418</span><span class="token number">25</span><span class="token operator">%</span>   <span class="token operator">-</span><span class="token number">0.211356</span>  <span class="token number">0.273345</span> <span class="token operator">-</span><span class="token number">0.327779</span> <span class="token operator">-</span><span class="token number">1.014846</span><span class="token number">50</span><span class="token operator">%</span>    <span class="token number">0.595076</span>  <span class="token number">0.682405</span>  <span class="token number">0.761759</span> <span class="token operator">-</span><span class="token number">0.722523</span><span class="token number">75</span><span class="token operator">%</span>    <span class="token number">0.841769</span>  <span class="token number">1.156402</span>  <span class="token number">1.460779</span> <span class="token operator">-</span><span class="token number">0.173948</span><span class="token builtin">max</span>    <span class="token number">1.707183</span>  <span class="token number">1.581206</span>  <span class="token number">1.995154</span>  <span class="token number">0.023960</span></code></pre><h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><ul><li>è½¬ç½®</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>T   <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>A   <span class="token operator">-</span><span class="token number">0.451372</span>    <span class="token number">0.508692</span>    <span class="token number">0.681460</span>   <span class="token operator">-</span><span class="token number">1.032206</span>    <span class="token number">1.707183</span>    <span class="token number">0.895205</span>B    <span class="token number">1.581206</span>   <span class="token operator">-</span><span class="token number">0.304325</span>    <span class="token number">1.214341</span>    <span class="token number">0.237051</span>    <span class="token number">0.382228</span>    <span class="token number">0.982582</span>C   <span class="token operator">-</span><span class="token number">0.499837</span>    <span class="token number">1.995154</span>   <span class="token operator">-</span><span class="token number">0.608446</span>    <span class="token number">1.502665</span>    <span class="token number">1.335121</span>    <span class="token number">0.188397</span>D   <span class="token operator">-</span><span class="token number">0.549320</span>   <span class="token operator">-</span><span class="token number">0.895727</span>   <span class="token operator">-</span><span class="token number">1.054553</span>   <span class="token operator">-</span><span class="token number">0.048824</span>   <span class="token operator">-</span><span class="token number">1.099418</span>    <span class="token number">0.023960</span></code></pre><ul><li>æŒ‰ç´¢å¼•æ’åº<ul><li><code>DataFrame.sort_index(axis=0, level=None, ascending=True, inplace=False, kind=&#39;quicksort&#39;, na_position=&#39;last&#39;, sort_remaining=True, ignore_index=False, key=None)</code></li><li>kind å¯ä»¥å–â€™mergesortâ€™ï¼Œä»¥è¾¾åˆ°ç¨³å®šçš„ç›®çš„</li><li>axis å– 0 æŒ‰è¡Œæ’åºï¼Œå– 1 æŒ‰åˆ—æ’åº</li></ul></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df4 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                   columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df4     A<span class="token number">100</span>  <span class="token number">1</span><span class="token number">29</span>   <span class="token number">2</span><span class="token number">234</span>  <span class="token number">3</span><span class="token number">1</span>    <span class="token number">4</span><span class="token number">150</span>  <span class="token number">5</span><span class="token operator">>></span><span class="token operator">></span> df4<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span>     A<span class="token number">1</span>    <span class="token number">4</span><span class="token number">29</span>   <span class="token number">2</span><span class="token number">100</span>  <span class="token number">1</span><span class="token number">150</span>  <span class="token number">5</span><span class="token number">234</span>  <span class="token number">3</span><span class="token operator">>></span><span class="token operator">></span> df4 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df4     B   A<span class="token number">100</span>  <span class="token number">1</span>   <span class="token number">2</span><span class="token number">29</span>   <span class="token number">3</span>   <span class="token number">4</span><span class="token number">234</span>  <span class="token number">5</span>   <span class="token number">6</span><span class="token number">1</span>    <span class="token number">7</span>   <span class="token number">8</span><span class="token number">150</span>  <span class="token number">9</span>  <span class="token number">10</span><span class="token operator">>></span><span class="token operator">></span> df4<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span>     B   A<span class="token number">1</span>    <span class="token number">7</span>   <span class="token number">8</span><span class="token number">29</span>   <span class="token number">3</span>   <span class="token number">4</span><span class="token number">100</span>  <span class="token number">1</span>   <span class="token number">2</span><span class="token number">150</span>  <span class="token number">9</span>  <span class="token number">10</span><span class="token number">234</span>  <span class="token number">5</span>   <span class="token number">6</span><span class="token operator">>></span><span class="token operator">></span> df4<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>      A  B<span class="token number">100</span>   <span class="token number">2</span>  <span class="token number">1</span><span class="token number">29</span>    <span class="token number">4</span>  <span class="token number">3</span><span class="token number">234</span>   <span class="token number">6</span>  <span class="token number">5</span><span class="token number">1</span>     <span class="token number">8</span>  <span class="token number">7</span><span class="token number">150</span>  <span class="token number">10</span>  <span class="token number">9</span></code></pre><ul><li>æŒ‰æŸåˆ—æ’åº<ul><li><code>DataFrame.sort_values(by, axis=0, ascending=True, inplace=False, kind=&#39;quicksort&#39;, na_position=&#39;last&#39;, ignore_index=False, key=None)</code></li><li>na_position å¯ä»¥æ˜¯ <code>first</code> å’Œ <code>last</code></li><li>å¦‚æœ ignore_index ä¸ºçœŸï¼Œé‚£ä¹ˆç»“æœçš„ç´¢å¼•ä¼šä» 0 æ ‡å·è‡³ n-1</li><li>key: æ¥å—ä¸€ä¸ª Series ä½œä¸ºè¾“å‡ºï¼Œè¿”å›ä¸€ä¸ª shape ç›¸åŒçš„ Seriesï¼Œç„¶åä½¿ç”¨åè€…è¿›è¡Œæ’åºæ“ä½œ</li></ul></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'col1'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'col2'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'col3'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token string">'col4'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df  col1  col2  col3 col4<span class="token number">0</span>    A     <span class="token number">2</span>     <span class="token number">0</span>    a<span class="token number">1</span>    A     <span class="token number">1</span>     <span class="token number">1</span>    B<span class="token number">2</span>    B     <span class="token number">9</span>     <span class="token number">9</span>    c<span class="token number">3</span>  NaN     <span class="token number">8</span>     <span class="token number">4</span>    D<span class="token number">4</span>    D     <span class="token number">7</span>     <span class="token number">2</span>    e<span class="token number">5</span>    C     <span class="token number">4</span>     <span class="token number">3</span>    F<span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'col1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  col1  col2  col3 col4<span class="token number">0</span>    A     <span class="token number">2</span>     <span class="token number">0</span>    a<span class="token number">1</span>    A     <span class="token number">1</span>     <span class="token number">1</span>    B<span class="token number">2</span>    B     <span class="token number">9</span>     <span class="token number">9</span>    c<span class="token number">5</span>    C     <span class="token number">4</span>     <span class="token number">3</span>    F<span class="token number">4</span>    D     <span class="token number">7</span>     <span class="token number">2</span>    e<span class="token number">3</span>  NaN     <span class="token number">8</span>     <span class="token number">4</span>    D<span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'col1'</span><span class="token punctuation">,</span> <span class="token string">'col2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  col1  col2  col3 col4<span class="token number">1</span>    A     <span class="token number">1</span>     <span class="token number">1</span>    B<span class="token number">0</span>    A     <span class="token number">2</span>     <span class="token number">0</span>    a<span class="token number">2</span>    B     <span class="token number">9</span>     <span class="token number">9</span>    c<span class="token number">5</span>    C     <span class="token number">4</span>     <span class="token number">3</span>    F<span class="token number">4</span>    D     <span class="token number">7</span>     <span class="token number">2</span>    e<span class="token number">3</span>  NaN     <span class="token number">8</span>     <span class="token number">4</span>    Ddf<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'col4'</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> col<span class="token punctuation">:</span> col<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  col1  col2  col3 col4<span class="token number">0</span>    A     <span class="token number">2</span>     <span class="token number">0</span>    a<span class="token number">1</span>    A     <span class="token number">1</span>     <span class="token number">1</span>    B<span class="token number">2</span>    B     <span class="token number">9</span>     <span class="token number">9</span>    c<span class="token number">3</span>  NaN     <span class="token number">8</span>     <span class="token number">4</span>    D<span class="token number">4</span>    D     <span class="token number">7</span>     <span class="token number">2</span>    e<span class="token number">5</span>    C     <span class="token number">4</span>     <span class="token number">3</span>    F</code></pre><h3 id="é€‰æ‹©"><a href="#é€‰æ‹©" class="headerlink" title="é€‰æ‹©"></a>é€‰æ‹©</h3><ul><li>è·å–å•åˆ—ï¼šä½¿ç”¨ <code>df.A</code> æˆ–è€… <code>df[&#39;A&#39;]</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.288924</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>A<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   <span class="token operator">-</span><span class="token number">0.514649</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>   <span class="token operator">-</span><span class="token number">2.059045</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>   <span class="token operator">-</span><span class="token number">1.398741</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">0.642856</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">0.288924</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>   <span class="token operator">-</span><span class="token number">0.604422</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> A<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64            <span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   <span class="token operator">-</span><span class="token number">0.514649</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>   <span class="token operator">-</span><span class="token number">2.059045</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>   <span class="token operator">-</span><span class="token number">1.398741</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">0.642856</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">0.288924</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>   <span class="token operator">-</span><span class="token number">0.604422</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> A<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64</code></pre><ul><li>è·å–å¤šè¡Œï¼šä½¿ç”¨ <code>[]</code> åš Slice</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>                   A         B         C         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">[</span><span class="token string">'20220102'</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                   A         B         C         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.288924</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span></code></pre><ul><li>æŒ‰æ ‡ç­¾ç´¢å¼•ï¼šä½¿ç”¨ <code>.loc[]</code></li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span> <span class="token punctuation">:</span> <span class="token punctuation">,</span> <span class="token punctuation">:</span> <span class="token punctuation">]</span>                   A         B         C         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.288924</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span> <span class="token string">'20220101'</span> <span class="token punctuation">,</span> <span class="token punctuation">:</span> <span class="token punctuation">]</span>A   <span class="token operator">-</span><span class="token number">0.514649</span>B    <span class="token number">2.198378</span>C   <span class="token operator">-</span><span class="token number">0.986735</span>D   <span class="token operator">-</span><span class="token number">0.368712</span>Name<span class="token punctuation">:</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64<span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span> <span class="token string">'20220101'</span> <span class="token punctuation">,</span> <span class="token string">'C'</span> <span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">0.9867347785391464</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span> <span class="token string">'20220101'</span> <span class="token punctuation">:</span> <span class="token string">'20220104'</span> <span class="token punctuation">,</span> <span class="token string">'C'</span> <span class="token punctuation">]</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>   <span class="token operator">-</span><span class="token number">0.986735</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>    <span class="token number">0.607552</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">1.459097</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">0.378368</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> C<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64<span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span> <span class="token string">'20220101'</span> <span class="token punctuation">:</span> <span class="token string">'20220104'</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>                   C         B         B         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.986735</span>  <span class="token number">2.198378</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.368712</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">0.607552</span>  <span class="token number">1.715020</span>  <span class="token number">1.715020</span>  <span class="token number">1.145638</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.459097</span>  <span class="token number">1.538408</span>  <span class="token number">1.538408</span>  <span class="token number">0.491077</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.378368</span>  <span class="token number">0.670310</span>  <span class="token number">0.670310</span> <span class="token operator">-</span><span class="token number">0.167852</span></code></pre><ul><li>æŒ‰æ•´æ•°ç´¢å¼•</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>                   C         B         B         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">0.607552</span>  <span class="token number">1.715020</span>  <span class="token number">1.715020</span>  <span class="token number">1.145638</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.459097</span>  <span class="token number">1.538408</span>  <span class="token number">1.538408</span>  <span class="token number">0.491077</span></code></pre><ul><li>Bool ç´¢å¼•</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>B<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>    <span class="token number">2.198378</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>    <span class="token number">1.715020</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">1.538408</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">0.670310</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">1.131819</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>   <span class="token operator">-</span><span class="token number">0.483053</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> B<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64            <span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>B <span class="token operator">></span> <span class="token number">1</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>     <span class="token boolean">True</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>     <span class="token boolean">True</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>     <span class="token boolean">True</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token boolean">False</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>     <span class="token boolean">True</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>    <span class="token boolean">False</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> B<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> <span class="token builtin">bool</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">.</span>B <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">]</span>                   A         B         C         D<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.288924</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span></code></pre><ul><li>ç”¨ <code>isin()</code>  ç­›é€‰</li></ul><pre class="language-python" data-language="python"><code class="language-python">In <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">:</span> df2 <span class="token operator">=</span> df<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>In <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">:</span> df2<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">,</span> <span class="token string">'four'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span>In <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">:</span> df2Out<span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    A         B         C         D      E<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  <span class="token number">0.469112</span> <span class="token operator">-</span><span class="token number">0.282863</span> <span class="token operator">-</span><span class="token number">1.509059</span> <span class="token operator">-</span><span class="token number">1.135632</span>    one<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">1.212112</span> <span class="token operator">-</span><span class="token number">0.173215</span>  <span class="token number">0.119209</span> <span class="token operator">-</span><span class="token number">1.044236</span>    one<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">0.861849</span> <span class="token operator">-</span><span class="token number">2.104569</span> <span class="token operator">-</span><span class="token number">0.494929</span>  <span class="token number">1.071804</span>    two<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.721555</span> <span class="token operator">-</span><span class="token number">0.706771</span> <span class="token operator">-</span><span class="token number">1.039575</span>  <span class="token number">0.271860</span>  three<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">-</span><span class="token number">0.424972</span>  <span class="token number">0.567020</span>  <span class="token number">0.276232</span> <span class="token operator">-</span><span class="token number">1.087401</span>   four<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.673690</span>  <span class="token number">0.113648</span> <span class="token operator">-</span><span class="token number">1.478427</span>  <span class="token number">0.524988</span>  threeIn <span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">:</span> df2<span class="token punctuation">[</span>df2<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'four'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>Out<span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    A         B         C         D     E<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">0.861849</span> <span class="token operator">-</span><span class="token number">2.104569</span> <span class="token operator">-</span><span class="token number">0.494929</span>  <span class="token number">1.071804</span>   two<span class="token number">2013</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">-</span><span class="token number">0.424972</span>  <span class="token number">0.567020</span>  <span class="token number">0.276232</span> <span class="token operator">-</span><span class="token number">1.087401</span>  four</code></pre><ul><li>èµ‹å€¼</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span>  <span class="token number">1</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span>  <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.288924</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span>  <span class="token number">4</span><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token operator">=</span>pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20220103'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> s<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">6</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">5</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>    <span class="token number">3</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>    <span class="token number">2</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>    <span class="token number">1</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64        <span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>F <span class="token operator">=</span> s<span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span>  <span class="token number">1</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span>  <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.288924</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span>  <span class="token number">4</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span>  <span class="token number">1</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.288924</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token string">'20220105'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">114514</span><span class="token operator">>></span><span class="token operator">></span> df                        A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span>  <span class="token number">1</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>      <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>      <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>       <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">114514.000000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>      <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>at<span class="token punctuation">[</span><span class="token string">'20220105'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">114514</span><span class="token operator">>></span><span class="token operator">></span> df                        A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>      <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span>  <span class="token number">1</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>      <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>      <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>       <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">114514.000000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>      <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>  <span class="token number">2.198378</span> <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span>  <span class="token number">1</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span> <span class="token operator">-</span><span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">-</span><span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>  <span class="token number">1.557318</span> <span class="token operator">-</span><span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">[</span>df <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span>                   A         B         C         D   E   F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">-</span><span class="token number">0.514649</span>       NaN <span class="token operator">-</span><span class="token number">0.986735</span> <span class="token operator">-</span><span class="token number">0.368712</span> NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span> <span class="token operator">-</span><span class="token number">2.059045</span>       NaN       NaN       NaN NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">1.398741</span>       NaN       NaN       NaN NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>       NaN       NaN       NaN <span class="token operator">-</span><span class="token number">0.167852</span> NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">-</span><span class="token number">0.012000</span>       NaN       NaN       NaN NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">0.604422</span> <span class="token operator">-</span><span class="token number">0.483053</span>       NaN <span class="token operator">-</span><span class="token number">0.158592</span> NaN NaN<span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">[</span>df <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>df<span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  <span class="token number">0.514649</span>  <span class="token number">2.198378</span>  <span class="token number">0.986735</span>  <span class="token number">0.368712</span>  <span class="token number">1</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span></code></pre><h3 id="ç¼ºå¤±å€¼"><a href="#ç¼ºå¤±å€¼" class="headerlink" title="ç¼ºå¤±å€¼"></a>ç¼ºå¤±å€¼</h3><ul><li>åˆ é™¤å¸¦æœ‰ç¼ºçœå€¼çš„è¡Œ</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df1 <span class="token operator">=</span> df<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df1                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  <span class="token number">0.514649</span>  <span class="token number">2.198378</span>  <span class="token number">0.986735</span>  <span class="token number">0.368712</span>  <span class="token number">1</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> df1<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>how<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">)</span>                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> df1                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  <span class="token number">0.514649</span>  <span class="token number">2.198378</span>  <span class="token number">0.986735</span>  <span class="token number">0.368712</span>  <span class="token number">1</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span></code></pre><ul><li>å¡«å……ç¼ºçœå€¼</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df1<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  <span class="token number">0.514649</span>  <span class="token number">2.198378</span>  <span class="token number">0.986735</span>  <span class="token number">0.368712</span>  <span class="token number">1</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token number">2.059045</span>  <span class="token number">1.715020</span>  <span class="token number">0.607552</span>  <span class="token number">1.145638</span>  <span class="token number">2</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span></code></pre><ul><li>è·å–æ˜¯å¦ä¸º Nan</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> pd<span class="token punctuation">.</span>isna<span class="token punctuation">(</span>df1<span class="token punctuation">)</span>                A      B      C      D      E      F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>   <span class="token boolean">True</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">02</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>   <span class="token boolean">True</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span>  <span class="token boolean">False</span></code></pre><h3 id="è¿ç®—"><a href="#è¿ç®—" class="headerlink" title="è¿ç®—"></a>è¿ç®—</h3><p>Pandas é»˜è®¤ç”¨ <code>np.nan</code> è¡¨ç¤ºç¼ºå¤±æ•°æ®ã€‚ä¸‹åˆ—è®¡ç®—æ—¶ï¼Œé»˜è®¤ä¸åŒ…å«ç¼ºå¤±å€¼ã€‚</p><ul><li>æ±‚å¹³å‡å€¼</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df <span class="token operator">=</span> df1<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>how<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>A    <span class="token number">0.664505</span>B    <span class="token number">0.955897</span>C    <span class="token number">0.981879</span>D    <span class="token number">0.427724</span>E    <span class="token number">3.750000</span>F    <span class="token number">4.500000</span>dtype<span class="token punctuation">:</span> float64    <span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">2.314554</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">1.809898</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">1.761655</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>    <span class="token number">1.633897</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64</code></pre><ul><li>ä½œå·®</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> s<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">6</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">5</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>    <span class="token number">3</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>    <span class="token number">2</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>    <span class="token number">1</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64        <span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>s<span class="token punctuation">)</span>            <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>  <span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   E   F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>                  NaN                  NaN  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>                  NaN                  NaN  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>                  NaN                  NaN  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> NaN NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>                  NaN                  NaN  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> NaN NaN<span class="token punctuation">[</span><span class="token number">4</span> rows x <span class="token number">12</span> columns<span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>s<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span>                   A         B         C         D    E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span> <span class="token operator">-</span><span class="token number">4.601259</span> <span class="token operator">-</span><span class="token number">4.461592</span> <span class="token operator">-</span><span class="token number">4.540903</span> <span class="token operator">-</span><span class="token number">5.508923</span> <span class="token operator">-</span><span class="token number">3.0</span>  <span class="token number">0.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span> <span class="token operator">-</span><span class="token number">4.357144</span> <span class="token operator">-</span><span class="token number">4.329690</span> <span class="token operator">-</span><span class="token number">4.621632</span> <span class="token operator">-</span><span class="token number">4.832148</span> <span class="token operator">-</span><span class="token number">1.0</span>  <span class="token number">0.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span> <span class="token operator">-</span><span class="token number">3.988000</span> <span class="token operator">-</span><span class="token number">2.868181</span> <span class="token operator">-</span><span class="token number">3.467266</span> <span class="token operator">-</span><span class="token number">3.106626</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span> <span class="token operator">-</span><span class="token number">2.395578</span> <span class="token operator">-</span><span class="token number">2.516947</span> <span class="token operator">-</span><span class="token number">1.442682</span> <span class="token operator">-</span><span class="token number">2.841408</span>  <span class="token number">1.0</span>  <span class="token number">0.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">07</span>       NaN       NaN       NaN       NaN  NaN  NaN<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">08</span>       NaN       NaN       NaN       NaN  NaN  NaN</code></pre><ul><li>Apply å‡½æ•°</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>cumsum<span class="token punctuation">)</span>                   A         B         C         D   E     F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>   <span class="token number">3</span>   <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">2.041597</span>  <span class="token number">2.208717</span>  <span class="token number">1.837465</span>  <span class="token number">0.658930</span>   <span class="token number">7</span>  <span class="token number">11.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">2.053597</span>  <span class="token number">3.340537</span>  <span class="token number">2.370199</span>  <span class="token number">1.552304</span>  <span class="token number">11</span>  <span class="token number">15.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">2.658018</span>  <span class="token number">3.823590</span>  <span class="token number">3.927517</span>  <span class="token number">1.710896</span>  <span class="token number">15</span>  <span class="token number">18.0</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> x<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>A    <span class="token number">1.386741</span>B    <span class="token number">1.055355</span>C    <span class="token number">1.178950</span>D    <span class="token number">0.734782</span>E    <span class="token number">1.000000</span>F    <span class="token number">3.000000</span>dtype<span class="token punctuation">:</span> float64</code></pre><ul><li>Series çš„é¢‘æ•°ç»Ÿè®¡</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df                   A         B         C         D  E    F<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>  <span class="token number">1.398741</span>  <span class="token number">1.538408</span>  <span class="token number">1.459097</span>  <span class="token number">0.491077</span>  <span class="token number">3</span>  <span class="token number">6.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>  <span class="token number">0.642856</span>  <span class="token number">0.670310</span>  <span class="token number">0.378368</span>  <span class="token number">0.167852</span>  <span class="token number">4</span>  <span class="token number">5.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>  <span class="token number">0.012000</span>  <span class="token number">1.131819</span>  <span class="token number">0.532734</span>  <span class="token number">0.893374</span>  <span class="token number">4</span>  <span class="token number">4.0</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>  <span class="token number">0.604422</span>  <span class="token number">0.483053</span>  <span class="token number">1.557318</span>  <span class="token number">0.158592</span>  <span class="token number">4</span>  <span class="token number">3.0</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>E<span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">03</span>    <span class="token number">3</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">04</span>    <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span>    <span class="token number">4</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">06</span>    <span class="token number">4</span>Freq<span class="token punctuation">:</span> D<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> E<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64            <span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>E<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token number">4</span>    <span class="token number">3</span><span class="token number">3</span>    <span class="token number">1</span>Name<span class="token punctuation">:</span> E<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64</code></pre><h3 id="åˆå¹¶-Merge"><a href="#åˆå¹¶-Merge" class="headerlink" title="åˆå¹¶ Merge"></a>åˆå¹¶ Merge</h3><h4 id="Concat"><a href="#Concat" class="headerlink" title="Concat"></a>Concat</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> df1 <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> df2 <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> df          <span class="token number">0</span>         <span class="token number">1</span>         <span class="token number">2</span>         <span class="token number">3</span><span class="token number">0</span> <span class="token operator">-</span><span class="token number">0.453289</span>  <span class="token number">0.892104</span>  <span class="token number">1.891981</span>  <span class="token number">0.485892</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">2.703414</span> <span class="token operator">-</span><span class="token number">0.685189</span> <span class="token operator">-</span><span class="token number">0.903685</span> <span class="token operator">-</span><span class="token number">0.137809</span><span class="token number">2</span>  <span class="token number">0.500884</span>  <span class="token number">0.831745</span> <span class="token operator">-</span><span class="token number">0.757333</span>  <span class="token number">1.997601</span><span class="token number">3</span>  <span class="token number">0.939272</span>  <span class="token number">1.907135</span> <span class="token operator">-</span><span class="token number">0.528942</span> <span class="token operator">-</span><span class="token number">0.724512</span><span class="token number">4</span>  <span class="token number">0.796412</span>  <span class="token number">0.958696</span>  <span class="token number">1.352733</span>  <span class="token number">1.805198</span><span class="token number">5</span> <span class="token operator">-</span><span class="token number">1.141725</span>  <span class="token number">1.591892</span> <span class="token operator">-</span><span class="token number">0.171487</span> <span class="token operator">-</span><span class="token number">0.289578</span><span class="token number">6</span>  <span class="token number">0.155887</span> <span class="token operator">-</span><span class="token number">0.646798</span>  <span class="token number">1.151169</span>  <span class="token number">1.051582</span><span class="token number">7</span> <span class="token operator">-</span><span class="token number">0.917709</span> <span class="token operator">-</span><span class="token number">0.156452</span>  <span class="token number">0.578088</span>  <span class="token number">0.639791</span><span class="token number">8</span>  <span class="token number">0.570383</span> <span class="token operator">-</span><span class="token number">0.513202</span>  <span class="token number">0.891358</span> <span class="token operator">-</span><span class="token number">0.567285</span><span class="token number">9</span>  <span class="token number">1.858860</span>  <span class="token number">1.628878</span> <span class="token operator">-</span><span class="token number">1.269917</span> <span class="token operator">-</span><span class="token number">0.396636</span><span class="token operator">>></span><span class="token operator">></span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token number">0</span>         <span class="token number">1</span>         <span class="token number">2</span>         <span class="token number">3</span><span class="token number">0</span> <span class="token operator">-</span><span class="token number">0.453289</span>  <span class="token number">0.892104</span>  <span class="token number">1.891981</span>  <span class="token number">0.485892</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">2.703414</span> <span class="token operator">-</span><span class="token number">0.685189</span> <span class="token operator">-</span><span class="token number">0.903685</span> <span class="token operator">-</span><span class="token number">0.137809</span><span class="token number">2</span>  <span class="token number">0.500884</span>  <span class="token number">0.831745</span> <span class="token operator">-</span><span class="token number">0.757333</span>  <span class="token number">1.997601</span><span class="token number">7</span> <span class="token operator">-</span><span class="token number">0.917709</span> <span class="token operator">-</span><span class="token number">0.156452</span>  <span class="token number">0.578088</span>  <span class="token number">0.639791</span><span class="token number">8</span>  <span class="token number">0.570383</span> <span class="token operator">-</span><span class="token number">0.513202</span>  <span class="token number">0.891358</span> <span class="token operator">-</span><span class="token number">0.567285</span><span class="token number">9</span>  <span class="token number">1.858860</span>  <span class="token number">1.628878</span> <span class="token operator">-</span><span class="token number">1.269917</span> <span class="token operator">-</span><span class="token number">0.396636</span></code></pre><h4 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h4><p>SQL é£æ ¼çš„åˆå¹¶ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> left <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'key'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'lval'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> right <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">'key'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'rval'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> left   key  lval<span class="token number">0</span>  foo     <span class="token number">1</span><span class="token number">1</span>  foo     <span class="token number">2</span><span class="token operator">>></span><span class="token operator">></span> right   key  rval<span class="token number">0</span>  foo     <span class="token number">4</span><span class="token number">1</span>  foo     <span class="token number">5</span><span class="token operator">>></span><span class="token operator">></span> pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">'key'</span><span class="token punctuation">)</span>   key  lval  rval<span class="token number">0</span>  foo     <span class="token number">1</span>     <span class="token number">4</span><span class="token number">1</span>  foo     <span class="token number">1</span>     <span class="token number">5</span><span class="token number">2</span>  foo     <span class="token number">2</span>     <span class="token number">4</span><span class="token number">3</span>  foo     <span class="token number">2</span>     <span class="token number">5</span></code></pre><h4 id="è¿½åŠ -Append"><a href="#è¿½åŠ -Append" class="headerlink" title="è¿½åŠ  Append"></a>è¿½åŠ  Append</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> s <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> df          A         B         C         D<span class="token number">0</span> <span class="token operator">-</span><span class="token number">0.019536</span>  <span class="token number">1.644399</span>  <span class="token number">1.250679</span>  <span class="token number">0.140385</span><span class="token number">1</span>  <span class="token number">0.770806</span>  <span class="token number">1.496631</span>  <span class="token number">0.216141</span>  <span class="token number">0.265806</span><span class="token number">2</span>  <span class="token number">1.166252</span>  <span class="token number">0.415610</span> <span class="token operator">-</span><span class="token number">1.166003</span>  <span class="token number">1.359695</span><span class="token number">3</span> <span class="token operator">-</span><span class="token number">0.360562</span>  <span class="token number">0.463504</span>  <span class="token number">0.507450</span> <span class="token operator">-</span><span class="token number">0.651677</span><span class="token number">4</span> <span class="token operator">-</span><span class="token number">0.459843</span> <span class="token operator">-</span><span class="token number">2.204788</span>  <span class="token number">1.381087</span> <span class="token operator">-</span><span class="token number">0.988501</span><span class="token number">5</span>  <span class="token number">0.505702</span> <span class="token operator">-</span><span class="token number">0.213073</span> <span class="token operator">-</span><span class="token number">1.264545</span>  <span class="token number">1.884786</span><span class="token number">6</span> <span class="token operator">-</span><span class="token number">0.955691</span>  <span class="token number">0.130868</span> <span class="token operator">-</span><span class="token number">0.722569</span> <span class="token operator">-</span><span class="token number">0.514278</span><span class="token number">7</span>  <span class="token number">0.768887</span>  <span class="token number">0.195819</span> <span class="token operator">-</span><span class="token number">0.997779</span> <span class="token operator">-</span><span class="token number">0.707758</span><span class="token operator">>></span><span class="token operator">></span> sA    <span class="token number">0.505702</span>B   <span class="token operator">-</span><span class="token number">0.213073</span>C   <span class="token operator">-</span><span class="token number">1.264545</span>D    <span class="token number">1.884786</span>Name<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64        <span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>append<span class="token punctuation">(</span>s<span class="token punctuation">,</span> ignore_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>          A         B         C         D<span class="token number">0</span> <span class="token operator">-</span><span class="token number">0.019536</span>  <span class="token number">1.644399</span>  <span class="token number">1.250679</span>  <span class="token number">0.140385</span><span class="token number">1</span>  <span class="token number">0.770806</span>  <span class="token number">1.496631</span>  <span class="token number">0.216141</span>  <span class="token number">0.265806</span><span class="token number">2</span>  <span class="token number">1.166252</span>  <span class="token number">0.415610</span> <span class="token operator">-</span><span class="token number">1.166003</span>  <span class="token number">1.359695</span><span class="token number">3</span> <span class="token operator">-</span><span class="token number">0.360562</span>  <span class="token number">0.463504</span>  <span class="token number">0.507450</span> <span class="token operator">-</span><span class="token number">0.651677</span><span class="token number">4</span> <span class="token operator">-</span><span class="token number">0.459843</span> <span class="token operator">-</span><span class="token number">2.204788</span>  <span class="token number">1.381087</span> <span class="token operator">-</span><span class="token number">0.988501</span><span class="token number">5</span>  <span class="token number">0.505702</span> <span class="token operator">-</span><span class="token number">0.213073</span> <span class="token operator">-</span><span class="token number">1.264545</span>  <span class="token number">1.884786</span><span class="token number">6</span> <span class="token operator">-</span><span class="token number">0.955691</span>  <span class="token number">0.130868</span> <span class="token operator">-</span><span class="token number">0.722569</span> <span class="token operator">-</span><span class="token number">0.514278</span><span class="token number">7</span>  <span class="token number">0.768887</span>  <span class="token number">0.195819</span> <span class="token operator">-</span><span class="token number">0.997779</span> <span class="token operator">-</span><span class="token number">0.707758</span><span class="token number">8</span>  <span class="token number">0.505702</span> <span class="token operator">-</span><span class="token number">0.213073</span> <span class="token operator">-</span><span class="token number">1.264545</span>  <span class="token number">1.884786</span></code></pre><h3 id="åˆ†ç»„-Grouping"><a href="#åˆ†ç»„-Grouping" class="headerlink" title="åˆ†ç»„ Grouping"></a>åˆ†ç»„ Grouping</h3><p>â€œgroup byâ€ æŒ‡çš„æ˜¯æ¶µç›–ä¸‹åˆ—ä¸€é¡¹æˆ–å¤šé¡¹æ­¥éª¤çš„å¤„ç†æµç¨‹ï¼š</p><ul><li><strong>åˆ†å‰²</strong>ï¼šæŒ‰æ¡ä»¶æŠŠæ•°æ®åˆ†å‰²æˆå¤šç»„ï¼›</li><li><strong>åº”ç”¨</strong>ï¼šä¸ºæ¯ç»„å•ç‹¬åº”ç”¨å‡½æ•°ï¼›</li><li><strong>ç»„åˆ</strong>ï¼šå°†å¤„ç†ç»“æœç»„åˆæˆä¸€ä¸ªæ•°æ®ç»“æ„ã€‚</li></ul><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> df          A         B         C         D  E<span class="token number">0</span> <span class="token operator">-</span><span class="token number">0.019536</span>  <span class="token number">1.644399</span>  <span class="token number">1.250679</span>  <span class="token number">0.140385</span>  <span class="token number">1</span><span class="token number">1</span>  <span class="token number">0.770806</span>  <span class="token number">1.496631</span>  <span class="token number">0.216141</span>  <span class="token number">0.265806</span>  <span class="token number">1</span><span class="token number">2</span>  <span class="token number">1.166252</span>  <span class="token number">0.415610</span> <span class="token operator">-</span><span class="token number">1.166003</span>  <span class="token number">1.359695</span>  <span class="token number">1</span><span class="token number">3</span> <span class="token operator">-</span><span class="token number">0.360562</span>  <span class="token number">0.463504</span>  <span class="token number">0.507450</span> <span class="token operator">-</span><span class="token number">0.651677</span>  <span class="token number">3</span><span class="token number">4</span> <span class="token operator">-</span><span class="token number">0.459843</span> <span class="token operator">-</span><span class="token number">2.204788</span>  <span class="token number">1.381087</span> <span class="token operator">-</span><span class="token number">0.988501</span>  <span class="token number">4</span><span class="token number">5</span>  <span class="token number">0.505702</span> <span class="token operator">-</span><span class="token number">0.213073</span> <span class="token operator">-</span><span class="token number">1.264545</span>  <span class="token number">1.884786</span>  <span class="token number">3</span><span class="token number">6</span> <span class="token operator">-</span><span class="token number">0.955691</span>  <span class="token number">0.130868</span> <span class="token operator">-</span><span class="token number">0.722569</span> <span class="token operator">-</span><span class="token number">0.514278</span>  <span class="token number">2</span><span class="token number">7</span>  <span class="token number">0.768887</span>  <span class="token number">0.195819</span> <span class="token operator">-</span><span class="token number">0.997779</span> <span class="token operator">-</span><span class="token number">0.707758</span>  <span class="token number">2</span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>pandas<span class="token punctuation">.</span>core<span class="token punctuation">.</span>groupby<span class="token punctuation">.</span>generic<span class="token punctuation">.</span>DataFrameGroupBy <span class="token builtin">object</span> at <span class="token number">0x000001EE0AF69FD0</span><span class="token operator">></span><span class="token operator">>></span><span class="token operator">></span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          A         B         C         DE<span class="token number">1</span>  <span class="token number">1.917522</span>  <span class="token number">3.556640</span>  <span class="token number">0.300816</span>  <span class="token number">1.765886</span><span class="token number">2</span> <span class="token operator">-</span><span class="token number">0.186804</span>  <span class="token number">0.326687</span> <span class="token operator">-</span><span class="token number">1.720349</span> <span class="token operator">-</span><span class="token number">1.222036</span><span class="token number">3</span>  <span class="token number">0.145139</span>  <span class="token number">0.250431</span> <span class="token operator">-</span><span class="token number">0.757095</span>  <span class="token number">1.233109</span><span class="token number">4</span> <span class="token operator">-</span><span class="token number">0.459843</span> <span class="token operator">-</span><span class="token number">2.204788</span>  <span class="token number">1.381087</span> <span class="token operator">-</span><span class="token number">0.988501</span></code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="http://www.pypandas.cn/docs/">http://www.pypandas.cn/docs/</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;Pandas&lt;/code&gt; æ˜¯ Python ä¸‹çš„é«˜æ€§èƒ½çš„æ•°æ®ç®¡ç†å·¥å…·ä¸æ•°æ®åˆ†æå·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸­ä»‹ç»äº† &lt;code&gt;Pandas&lt;/code&gt; åº“ä¸­çš„ä¸€äº›å¸¸ç”¨ç±»ï¼Œç„¶åè®°å½•äº†ä¸€äº›ç®€å•çš„ç­›é€‰ï¼Œåˆ‡ç‰‡ç­‰ç­‰ç”¨æ³•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="æŠ€æœ¯" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="æŠ€æœ¯/Pythonåº”ç”¨" scheme="https://www.c7w.tech/categories/%E6%8A%80%E6%9C%AF/%E6%8A%80%E6%9C%AF-Python%E5%BA%94%E7%94%A8/"/>
    
    
    <category term="æ•°æ®åˆ†æ" scheme="https://www.c7w.tech/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
</feed>
